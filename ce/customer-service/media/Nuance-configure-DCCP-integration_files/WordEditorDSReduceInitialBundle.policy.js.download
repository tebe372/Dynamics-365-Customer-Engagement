'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1733:function(E,I,c){E=c(0);var l=c(8),e=c(61),a=c(688),k=c(69),x=c(328);class y{constructor(Da,xb,Jb=null){this.id=Da.Id;Jb||(Jb="");this.CQn=Jb;this.sensitivityLabel=Da}}Object(E.a)(y,"AutoPolicyLabelData",null,[]);class m{constructor(Da,xb){this.lDa=Da;this.displayName=xb}}Object(E.a)(m,"PolicyLabelRequestState",null,[]);class t{constructor(){this.ubg=this.DTf=""}}Object(E.a)(t,"PolicyStrings",null,[]);var z=
c(154),v=c(2),H=c(84),F=c(11),G=c(34),L=c(18);class J{static get gJf(){return J.NYm}}J.NYm="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(E.a)(J,"JustificationDialogHtml",null,[]);class K extends z.a{constructor(Da,xb){super(!1,!1,K.PL);this.dcb=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.Kud=null;this.Jud=!1;this.uwd=Da;this.xv=xb;this.Vg=this.oNk();this.Cd=1;this.yg=K.id;this.ze(1,CommonUIStrings.l_DialogChange);this.ora(1,!1);this.zV(0)}ihg(){if(K.PL)this.Uh(CommonUIStrings.l_SensitivityJustificationTitle,
Object(e.a)(this,this.s7i,"reactJustificationDialogHandler"),this.Cfi(this.Jud));else{const Da={};for(let xb=0;xb<this.dcb.length;xb++)Da[K.e5f+xb]=!1;Da[K.Fbd]="";this.Uh(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.MYm,"justificationDialogHandler"),Da);this.R6f();G.a.addHandler($get(K.Fbd),F.a.input,Object(e.a)(this,this.eJo,"textAreaHandler"))}}validate(){if(K.PL)return this.DJj(this.Kud);const Da=$get(K.Fbd);return Da.disabled?!0:this.DJj(Da.value)}DJj(Da){const xb=2>
Da.length,Jb=500<Da.length,Mb=RegExp("[{|}|;|\\\\]").test(Da);Da=""===L.a.jza(Da);return!xb&&!Jb&&!Mb&&!Da}MYm(Da,xb){let Jb="";if(1===Da)for(let Mb=0;Mb<this.dcb.length;Mb++)if(xb[K.e5f+Mb]){Jb=Mb===this.dcb.length-1?xb[K.Fbd]:this.dcb[Mb];break}this.xv(Da,this.uwd,Jb)}s7i(Da){let xb="";1===Da&&this.Kud&&(xb=this.Kud);this.xv(Da,this.uwd,xb)}Ypn(Da){this.Kud=Da;Da=this.validate();this.Jud!==Da&&(this.Jud=Da,this.o6(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.s7i,"reactJustificationDialogHandler"),
this.Cfi(this.Jud)))}Cfi(Da){return{["id"]:this.yg,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Da},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(e.a)(this,this.Ypn,"onJustificationUpdated")}}eJo(Da){Da.target&&this.ora(1,this.validate())}oNk(){return z.a.Kx(K.gJf,v.AFrameworkApplication.Ms,H.getImageClass(K.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.dcb[0],this.dcb[1],this.dcb[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}R6f(){const Da=document.getElementsByName(K.I1m);for(let xb=0;xb<Da.length;xb++)G.a.addHandler(Da[xb],
F.a.focus,Object(e.a)(this,this.hce,"radioButtonFocusHandler")),G.a.addHandler(Da[xb],F.a.click,Object(e.a)(this,this.hce,"radioButtonFocusHandler"))}hce(Da){if(Da=Da.target){Da.checked=!0;var xb=$get(K.Fbd);Da.id===K.e5f+(this.dcb.length-1)?(xb.disabled=!1,Sys.UI.DomElement.setVisible(xb,!0),xb.focus()):(xb.disabled=!0,Da.focus());this.ora(1,this.validate())}}static get PL(){return v.AFrameworkApplication.ua.Jb.vF&&v.AFrameworkApplication.ua.Jb.gHf}}K.gJf=J.gJf;K.I1m="ListRadioBox";K.e5f="radiobox";
K.Fbd="txtJustification";K.iconName="Info_32x32x32";K.id="JustificationDialog";Object(E.a)(K,"JustificationDialog",z.a,[]);class S extends z.a{constructor(Da,xb,Jb){super(!1,!1,!0);if(Da&&Jb){var Mb={["id"]:"MandatoryLabellingDialog"};this.C0j=Jb;this.sJe=xb;if(!v.AFrameworkApplication.K.$("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.sJe&&""!==this.sJe)Mb.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.sJe,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};xb={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(xb.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Da});Mb.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:xb};Da={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Mb};Mb.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Mb.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.Uh(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(e.a)(this,this.l$m,"mandatoryLabellingDialogHandler"),Da)}else l.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}l$m(Da,xb){1===Da&&xb.selectedLabel&&(Da=xb.selectedLabel,""!==Da&&this.C0j(Da))}}Object(E.a)(S,"MandatoryLabellingDialog",z.a,[]);class R{constructor(){this.hMa=!!v.AFrameworkApplication.ua&&
v.AFrameworkApplication.ua.Jb.vF}Xbl(Da,xb,Jb){this.hMa&&new S(Da,xb,Jb)}static get instance(){return R._instance||(R._instance=new R)}}R._instance=null;Object(E.a)(R,"MandatoryLabellingDialogFactory",null,[1740]);class M{}M.EDo="sbProtectForm14";M.HDo="SBStatusBarMarkAsReadOnly14";M.r0m="Info_16x16x32";M.uIc="QuickSearchCompletedToday_16x16x32";M.x5f="CommonControlCheckboxCheck_16";M.Mzj="On";M.visible="Visible";M.aHl="ImageIsVisible";M.aJa="SourceControlId";M.menuItemId="MenuItemId";M.menu="Menu";
M.cth="AppLockId";M.value="Value";M.labelText="LabelText";M.alt="Alt";M.Zpi="Image16by16";M.dbc="Image16by16Class";M.DDo="SBProtectForm_16";M.GDo="SBStatusBarMarkAsReadOnly_16";M.icon="Icon";M.iconColor="IconColor";M.customTooltip="CustomTooltip";M.MPn="MipTagDynamicFillWithOutline_20";M.NPn="MipTagLockDynamicFillWithOutline_20";M.LPn="MipTagErrorOutline_20";M.OPn="MipTagQuestionOutline_20";M.Ime="transparent";M.cRo="UILocation";Object(E.a)(M,"PolicyConstants",null,[]);class O extends z.a{constructor(Da,
xb,Jb){super(!1,!1,O.PL);this.uwd=Da;this.Paa=xb;this.xv=Jb;this.Cd=1;this.yg=O.id;this.zV(1);this.zV(0)}Ihg(){const Da={["id"]:"UserDefinedPermissionsDialog"};O.PL&&this.Uh("Defined Permissions",Object(e.a)(this,this.h1o,"userDefinedPermissionsDialogHandler"),Da)}h1o(Da){1!==Da&&this.xv(Da,this.uwd,"",this.Paa)}static get PL(){return v.AFrameworkApplication.ua.Jb.vF&&v.AFrameworkApplication.ua.Jb.gHf}}O.id="UserDefinedPermissionsDialog";Object(E.a)(O,"UserDefinedPermissionsDialog",z.a,[]);var U=
c(699),X=c(190),P=c(165),Z=c(690),ba=c(76),Y=c(46),da=c(369),ia=c(306),la=c(133),wa=c(434),va=c(163),qa=c(53),Na=c(150),Sa=c(383),Ia=c(21),ta=c(73),ra=c(12),fa=c(27),pa=c(117);class oa{constructor(Da,xb,Jb,Mb){this.Xxc=this.xwb=null;this.F1g=this.ZGe=this.PHe=this.Axc=this.E3g=this.r6g=this.nye=!1;this.IVb=this.PWa=this.cZa=this.w$a=this.Paa=this.eA=this.kCa=this.ak=null;this.t_j=this.gue=0;this.fVg=this.Y2g=this.JMg=this.uOe=null;this.ga=Da;this.Wi=xb;this.Ca=Jb;this.Hh=Mb;this.lzc={};this.ebh={};
this.t6g={};this.Skb=Jb.$("WacApplyManualPolicyLabelIsEnabled");this.Hh.value.hCd(Object(e.a)(this,this.S2f,"processAutoSensitivityLabel"));this.Hh.value.q0e(Object(e.a)(this,this.S2f,"processAutoSensitivityLabel"));this.Hh.value.R_e(Object(e.a)(this,this.Lvn,"onUpdateLabelInfo"));v.AFrameworkApplication.ua&&v.AFrameworkApplication.ua.v_a(Object(e.a)(this,this.bUn,"refreshDocumentPolicyLabelsOnModeChange"));Jb.$("SupportsPolicies")&&Jb.kb("AppliedPolicyId")&&(this.xwb=Jb.kb("IrmPolicyTitle"),this.Xxc=
Jb.kb("IrmPolicyDescription"));this.UWj=this.Ca.mc("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.VWj=this.Ca.mc("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get cI(){return v.AFrameworkApplication.cI||!!this.Y2g&&this.Y2g()}Tb(){this.ga.ra(ra.a.oZf,ta.a.frame,Object(e.a)(this,this.FLd,"documentLabelPaneHandler"));this.ga.fb(ra.a.Kic,ta.a.frame,Object(e.a)(this,this.Kic,"queryPolicyLabel"),96);this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",
!1)&&(this.ga.ra(ra.a.yZi,ta.a.frame,Object(e.a)(this,this.FLd,"documentLabelPaneHandler")),this.ga.fb(ra.a.o5c,ta.a.frame,Object(e.a)(this,this.o5c,"queryPolicyShortLabel"),96));this.ga.ra(ra.a.jSb,ta.a.frame,Object(e.a)(this,this.jSb,"toggleSensitivity"));this.ga.ra(ra.a.JNb,ta.a.frame,Object(e.a)(this,this.JNb,"populateSensitivityFlyout"));this.ga.ra(ra.a.xQb,ta.a.frame,Object(e.a)(this,this.xQb,"setSensitivity"));this.ga.fb(ra.a.r5c,ta.a.frame,Object(e.a)(this,this.r5c,"querySensitivity"),96);
this.ga.ra(ra.a.uOb,ta.a.frame,Object(e.a)(this,this.uOb,"querySensitivityToggleButton"));this.ga.ra(ra.a.tOb,ta.a.frame,Object(e.a)(this,this.tOb,"querySensitivitySubFlyout"));this.tFc(ra.a.jSb)||this.ga.Xc(ra.a.jSb,4);this.tFc(ra.a.JNb)||this.ga.Xc(ra.a.JNb,4);this.tFc(ra.a.xQb)||this.ga.Xc(ra.a.xQb,4);this.tFc(ra.a.uOb)||this.ga.Xc(ra.a.uOb,4);this.tFc(ra.a.tOb)||this.ga.Xc(ra.a.tOb,4);this.Wi.updateCommandUI();v.AFrameworkApplication.K&&la.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&
this.Hh.value.i1n(Object(e.a)(this,this.d9i,"registerActionsHandler"))}d9i(){this.Tb()}h9a(){this.ga.Xv(ra.a.oZf,ta.a.frame,Object(e.a)(this,this.FLd,"documentLabelPaneHandler"));this.ga.Xv(ra.a.Kic,ta.a.frame,Object(e.a)(this,this.Kic,"queryPolicyLabel"));this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.ga.Xv(ra.a.yZi,ta.a.frame,Object(e.a)(this,this.FLd,"documentLabelPaneHandler")),this.ga.Xv(ra.a.o5c,ta.a.frame,Object(e.a)(this,this.o5c,"queryPolicyShortLabel")));
this.ga.Xv(ra.a.jSb,ta.a.frame,Object(e.a)(this,this.jSb,"toggleSensitivity"));this.ga.Xv(ra.a.JNb,ta.a.frame,Object(e.a)(this,this.JNb,"populateSensitivityFlyout"));this.ga.Xv(ra.a.xQb,ta.a.frame,Object(e.a)(this,this.xQb,"setSensitivity"));this.ga.Xv(ra.a.r5c,ta.a.frame,Object(e.a)(this,this.r5c,"querySensitivity"));this.ga.Xv(ra.a.uOb,ta.a.frame,Object(e.a)(this,this.uOb,"querySensitivityToggleButton"));this.ga.Xv(ra.a.tOb,ta.a.frame,Object(e.a)(this,this.tOb,"querySensitivitySubFlyout"))}jSb(){return 32}l5h(Da){const xb=
"mandatoryLabelling_"+Da.Id;this.t6g[xb]=Da.Id;return{["type"]:"AppToggleButtonProps",["id"]:xb,["label"]:Da.DisplayName,["hideLabel"]:!1,["customTooltip"]:Da.Tooltip}}fKb(){return this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}bGf(){return this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)}c4l(){const Da=[],xb=this.kCa;for(let Mb in xb){var Jb=xb[Mb];const gb=this.eA[Mb];if(gb&&gb.Enabled&&!gb.HasUserDefinedPermissions)if(Jb.count){const Wb=
{["sections"]:[],["shouldAutoOpen"]:!1},vc={["id"]:"mandatoryLabelling_flyoutMenuSection_"+gb.Id,["controls"]:[]};for(let Fb of Jb)(Jb=this.eA[Fb])&&Jb.Enabled&&!Jb.HasUserDefinedPermissions&&Array.add(vc.controls,this.l5h(Jb));Array.add(Wb.sections,vc);Array.add(Da,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+gb.Id,["label"]:gb.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:Wb})}else Array.add(Da,this.l5h(gb))}return Da}JNb(Da,xb,Jb,Mb,gb){if(1===
Jb||!this.Hh.value.r3b(!0))return 32;gb.MenuItems=Object.assign(new da.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(gb.MenuItems.MenuSectionList,this.Dva(!this.isReactRibbonEnabled()));this.ak.CustomUrl&&Array.add(gb.MenuItems.MenuSectionList,this.Cbl(this.isReactRibbonEnabled()?this.ak.CustomUrl:L.a.xf(this.ak.CustomUrl)));this.isReactRibbonEnabled()||(gb.PopulationXML=P.o(gb.MenuItems));return 32}r5c(Da,xb,Jb,Mb,gb){if(1===Jb||!gb||!this.Skb)return 32;this.ak=this.Hh.value.ry;
if(this.Hh.value.r3b(!0)&&(gb[M.visible]=!0,this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.E3g||(Y.a("MipLabelsAvailable"),this.E3g=!0):Y.a("MipLabelsAvailable"),this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.ak&&this.ak.AreLabelsAvailable&&(Da=Ia.a.instance.Ta("Common.ISystemInitiatedFeedback")))){const Wb=oa.$e(this.ak.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";
Da.execute(vc=>{vc.logActivity(Wb,null)})}return 32}uOb(Da,xb,Jb,Mb,gb){if(1===Jb||!gb)return 32;let Wb,vc;gb[M.Mzj]=!!(Wb=gb[M.menuItemId])&&!!(vc=this.lzc[Wb])&&vc===this.ak.AppliedPolicyId;return 32}tOb(Da,xb,Jb,Mb,gb){if(1===Jb||!gb)return 32;let Wb,vc,Fb;Da=!!(Wb=gb[M.aJa])&&!!(vc=this.lzc[Wb])&&!!(Fb=this.kCa[vc])&&Fb.contains(this.ak.AppliedPolicyId);gb[M.aHl]=Da;gb[M.Mzj]=Da;return 32}xQb(Da,xb,Jb,Mb,gb){if(1===Jb||!gb)return 32;Da=this.lzc[gb[M.aJa]];xb=this.dRo(gb[M.cRo]);Jb=new fa.a;Jb.name=
"SensitivityPickerLocation";Jb.int64=xb;Y.a("SensitivityPickerUsage",void 0,void 0,[Jb]);return this.Z7a(Da,gb,2)}FZd(){return!!v.AFrameworkApplication.ua&&1===v.AFrameworkApplication.ua.mode}bUn(){this.ZGe&&!this.FZd()&&(this.ZGe=!1,this.Hh.value.aUn())}RNo(){this.ak.DefaultLabelId&&this.ak.MandatoryLabelingEnforced?this.nye||this.FZd()?this.ak.AppliedPolicyId?this.cjf(""):(this.Hh.value.xTm(this.Hh.value.vZc)||this.FZd())&&this.XWh():this.blj():this.ak.DefaultLabelId?this.blj():this.ak.MandatoryLabelingEnforced&&
(this.ak.AppliedPolicyId?this.cjf(""):this.XWh())}Uzi(){return this.ak.MandatoryLabelingEnforced?this.ak&&this.ak.AreLabelsAvailable?this.Ca.$("TestOverrideIsReactDialogEnabled")||this.Wi&&this.Wi.Jb&&this.Wi.Jb.vF?!0:(l.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(l.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(l.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),
!1)}XWh(){!this.Uzi()||v.AFrameworkApplication.Dpa||this.r6g||(this.r6g=v.AFrameworkApplication.Dpa=!0,l.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Hh.value.z6i("",1),this.Hh.value.RZe(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,()=>{this.j$m()}))}cjf(Da){this.Uzi()&&v.AFrameworkApplication.Dpa&&(v.AFrameworkApplication.Dpa=
!1,l.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Hh.value.V7f(),this.Hh.value.z6i(Da,2))}j$m(){R.instance.Xbl(this.c4l(),this.ak.CustomUrl,Object(e.a)(this,this.k$m,"mandatoryLabellingDialogCallback"))}k$m(Da){this.cjf(this.t6g[Da])}Jwh(){return this.Ca.$("CoAuthForProtectedFilesEnabled")&&this.Ca.$("SupportsOfficeClientCoauthoring")&&this.Ca.$("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.fVg&&this.cI}Z7a(Da,xb,Jb,Mb=null){this.Hh.value.POn(Jb);
let gb=32,Wb=!1,vc=!0;const Fb=2===Jb||8===Jb||16===Jb,ya=Da===this.ak.AppliedPolicyId;if(this.JMg&&this.JMg(Da,Fb))l.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",Jb),this.Wi.updateCommandUI();else if(xb&&M.cth in xb&&this.Hh.value.Qko(xb[M.cth]),Da)if(this.Hh.value.CCi()||this.Jwh()&&this.PHe)l.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
Jb),this.Wi.updateCommandUI(),Fb&&this.CCd(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.Ca.$("HasDocumentEditRights"))if(this.Hh.value.hTk(Da))if(!this.fKb()&&this.eA[Da]&&this.eA[Da].HasUserDefinedPermissions&&!ya)l.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",Jb),1!==Jb&&4!==Jb&&this.lBk();else if(Fb&&this.ak.MandatoryLabelingEnforced&&ya)l.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",Jb),this.CCd(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Fb&&this.Ca.$("WacLabelingJustificationDialogIsEnabled")&&this.ak.RequiredDowngradeJustification&&(ya||this.eA[Da].RequiredDowngradeJustification)&&(this.fKb()?!this.F1g&&!Mb:!this.Paa))return l.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
Jb),this.ihg(Da),gb;if(this.fKb()&&this.eA[Da].HasUserDefinedPermissions&&!ya)return l.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",Jb),this.Ihg(Da,Mb),gb;if(this.Jwh()&&!this.fVg())this.gue<this.UWj?(l.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.gue,Jb),this.PHe=!0,this.gue++,pa.Task.delay(this.VWj).continueWith(()=>{this.PHe=!1;this.Z7a(Da,xb,Jb)})):(l.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",Jb),Wb=1!==Jb,vc=!1,gb=8);else{if(this.URm(Da)&&(l.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",Jb),1===Jb||8===Jb||4===Jb))return gb;l.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",Jb);this.setPolicyLabel(ya?"":Da,this.fKb()?Mb:this.Paa,"",Jb);return gb}}else l.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",Jb),this.Wi.updateCommandUI(),Fb&&this.CCd(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else l.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",Jb),this.Wi.updateCommandUI(),Fb&&this.CCd(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else l.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",Jb),this.Wi.updateCommandUI(),Wb=Fb,vc=!1,gb=8;this.Hh.value.S6i(0,Jb,Wb,vc);return gb}kEk(Da,xb,Jb=null,Mb=!1){ba.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.Ca.$("SupportsOfficeClientCoauthoring")&&this.Ca.$("CoAuthForProtectedFilesIsEnabled")?(this.Axc=!1,(this.ak=this.Hh.value.ry)&&!this.ak.AppliedPolicyId?this.Axc=!0:this.ak&&
this.ak.PolicyLabelAssignmentMethod&&(this.Axc=Na.e(this.ak.PolicyLabelAssignmentMethod)===Na.e("standard"))):this.Axc=Mb;Da=oa.$e(Da)?null:this.eA[Da];(xb=oa.$e(xb)?null:this.eA[xb])?this.cZa=new y(xb,!0,Jb):(this.Hh.value.KTa(29),this.PWa=null);Da?this.w$a=new y(Da,!1):this.IVb=null;this.S2f(null,null)}hFk(Da){this.Z7a(Da,null,16)}zjo(){this.eA={};if(this.ak=this.Hh.value.ry)for(const Da of this.ak.SensitivityLabels)this.eA[Da.Id]=Da}URm(Da){if(this.kCa&&Da in this.kCa){Da=this.kCa[Da];for(let xb of Da)if((Da=
this.eA[xb])&&Da.Enabled)return!0}return!1}Wlo(){this.kCa={};if(this.ak=this.Hh.value.ry){for(const Da of this.ak.SensitivityLabels)Da.ParentId||(this.kCa[Da.Id]=new k.a);for(const Da of this.ak.SensitivityLabels){if(this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RemoveDisabledLabelsFromChildLabel",!1)){if(!(Da.ParentId&&Da.ParentId in this.kCa&&Da.Enabled))continue}else if(!(Da.ParentId&&Da.ParentId in this.kCa))continue;this.kCa[Da.ParentId].add(Da.Id)}}}cMn(){this.ak=this.Hh.value.ry;
const Da=this.Skb&&this.isReactRibbonEnabled()&&this.Hh.value.r3b();oa.$de(Da)}blj(){if(this.Ca.$("WacApplyDefaultPolicyLabelIsEnabled"))if(this.FZd())this.ZGe=!0;else if(!this.nye)if(this.nye=!0,this.ak=this.Hh.value.ry,this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.ak&&this.ak.DefaultLabelId)if(!this.ak.AppliedPolicyId)l.ULS.sendTraceTag(509732190,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.ak.DefaultLabelType),this.Z7a(this.ak.DefaultLabelId,
null,1);else if(x.a.hh().equals(this.ak.DefaultLabelType,"documentLibraryDefault")){const Da=this.eA[this.ak.AppliedPolicyId],xb=this.eA[this.ak.DefaultLabelId];this.ak.AppliedPolicyId!==this.ak.DefaultLabelId&&x.a.hh().equals(this.ak.PolicyLabelAssignmentMethod,"standard")&&Da.Order<xb.Order&&(l.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.ak.DefaultLabelType),this.Z7a(this.ak.DefaultLabelId,null,1))}}else this.ak&&this.ak.DefaultLabelId&&!this.ak.AppliedPolicyId&&
(l.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.ak.DefaultLabelId),this.Z7a(this.ak.DefaultLabelId,null,1))}S2f(){if(!this.Hh.value.CCi()){var Da=this.eA[this.ak.AppliedPolicyId];this.Axc&&this.w$a&&this.IVb!==this.w$a.id&&(!Da||Da.Order<this.w$a.sensitivityLabel.Order)&&(Da=this.Z7a(this.w$a.id,{},4),32!==Da?l.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Da):(this.IVb=this.w$a.id,this.PWa&&
(Da=this.eA[this.PWa])&&Da.Order<=this.w$a.sensitivityLabel.Order&&(this.Hh.value.KTa(29),this.PWa=null)));Da=this.eA[this.Hh.value.ry.AppliedPolicyId];if(this.cZa&&this.PWa!==this.cZa.id&&(!Da||Da.Order<this.cZa.sensitivityLabel.Order)){const xb=this.cZa.id;this.Hh.value.KTa(29);this.Hh.value.nBd(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.rTd(this.cZa.sensitivityLabel))+" "+this.cZa.CQn,CommonUIStrings.l_PolicyLabelRecommendationButton,
()=>{this.Z7a(xb,{},8)});this.PWa=this.cZa.id}this.cZa=this.w$a=null}}setPolicyLabel(Da,xb,Jb,Mb=2){this.fKb()?xb&&(this.F1g=!0):this.Paa=xb;this.Hh.value.setPolicyLabel(Da);this.Wi.updateCommandUI();Jb=new m(Mb,this.rTd(this.eA[Da]));this.Hh.value.geg(Da,this.fKb()?xb:this.Paa,Jb)}t6k(Da,xb,Jb,Mb){1===Da&&this.setPolicyLabel(xb,Mb,Jb)}s6k(Da,xb,Jb){1===Da?this.fKb()?this.Z7a(xb,null,2,Jb):this.setPolicyLabel(xb===this.ak.AppliedPolicyId?"":xb,Jb,""):this.Wi.updateCommandUI()}ihg(Da){(new K(Da,Object(e.a)(this,
this.s6k,"continueToSetPolicyLabelFromJustificationDialog"))).ihg()}Ihg(Da,xb){(new O(Da,xb,Object(e.a)(this,this.t6k,"continueToSetPolicyLabelFromUDPDialog"))).Ihg()}CCd(Da="",xb=""){const Jb=new va.StandardDialog;Jb.Lt=v.AFrameworkApplication.bda;Jb.Cd=0;Jb.ze(1,CommonUIStrings.l_DialogClose);Jb.DV(Da,xb,null)}QKk(Da){1===Da&&this.Hh.value.WOn()}lBk(){const Da=new va.StandardDialog;Da.Lt=v.AFrameworkApplication.bda;Da.Cd=1;Da.ze(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Da.ze(0,CommonUIStrings.l_DialogClose);
Da.DV(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(e.a)(this,this.QKk,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.Wi&&!!this.Wi.Jb&&this.Wi.Jb.Gr}Adc(){return this.Wi&&this.Wi.Jb?this.Wi.Jb.Adc:!1}FLd(){return 32}vmo(Da,xb,Jb,Mb){Da?(Mb[M.value]=Da,Mb[M.labelText]=Da,Mb[M.customTooltip]=xb,this.dmj(Jb,v.AFrameworkApplication.EF,Mb)):(Mb[M.iconColor]=M.Ime,this.ak.MandatoryLabelingEnforced?(Mb[M.value]=Mb[M.labelText]=
this.FTd().ubg,Mb[M.icon]=M.LPn):(Mb[M.value]=Mb[M.labelText]=this.FTd().DTf,Mb[M.icon]=M.OPn));Mb[M.visible]=!0}cko(Da){let xb="",Jb="",Mb="";if(this.ak.AreLabelsAvailable){let gb=null;this.eA&&(gb=this.eA[this.ak.AppliedPolicyId]);gb&&(xb=this.rTd(gb),Jb=gb.Tooltip,v.AFrameworkApplication.EF=this.Hh.value.xdc(gb),Mb=this.Oof(gb));if(!this.Hh.value.r3b()&&!gb)return}else{if(!this.xwb)return;xb=this.xwb;Mb=M.Ime;Jb=this.Xxc?this.Xxc:""}this.vmo(xb,Jb,Mb,Da)}Kic(Da,xb,Jb,Mb,gb){if(1===Jb)return 32;
this.ak=this.Hh.value.ry;if(!this.ak||!gb)return 32;gb[M.value]="";gb[M.labelText]="";gb[M.alt]=null;gb[M.Zpi]=null;gb[M.dbc]=null;gb[M.customTooltip]="";gb[M.visible]=!1;gb[M.iconColor]="";gb[M.icon]="";if(this.bGf())this.cko(gb);else{Jb=xb=Da="";if(!this.ak.AreLabelsAvailable){if(!this.xwb)return 32;Da=this.xwb;Jb=M.Ime;this.Xxc&&(xb=this.Xxc)}else if(this.ak.AppliedPolicyId){Mb=null;for(const Wb of this.ak.SensitivityLabels)if(Wb.Id.toLowerCase()===this.ak.AppliedPolicyId.toLowerCase()){Mb=Wb;
break}Mb&&(Da=this.rTd(Mb),xb=Mb.Tooltip,v.AFrameworkApplication.EF=this.Hh.value.xdc(Mb),Jb=this.Oof(Mb))}Da&&(gb[M.value]=Da,gb[M.labelText]=Da,this.Adc()?gb[M.customTooltip]=xb:gb[M.alt]=xb,this.dmj(Jb,v.AFrameworkApplication.EF,gb),gb[M.visible]=!0)}return 32}o5c(Da,xb,Jb,Mb,gb){if(1===Jb)return 32;this.ak=this.Hh.value.ry;if(!this.ak||!gb)return 32;gb[M.labelText]="";if(this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",!1)&&this.ak.HideBarByDefault)return 32;
Da="";if(this.ak.AreLabelsAvailable)if(this.ak.AppliedPolicyId){if(!this.eA)return 32;(xb=this.eA[this.Hh.value.ry.AppliedPolicyId])&&(Da=xb.ParentId&&this.eA[xb.ParentId]?this.eA[xb.ParentId].DisplayName:xb.DisplayName)}else Da=this.ak.MandatoryLabelingEnforced?this.FTd().ubg:this.FTd().DTf;else{if(!this.xwb)return 32;Da=this.xwb}gb[M.labelText]=Da;return 32}rTd(Da){return Da?this.eA?Da.ParentId&&this.eA[Da.ParentId]?this.eA[Da.ParentId].DisplayName+"\\"+Da.DisplayName:Da.DisplayName:(l.ULS.sendTraceTag(4282E4,
306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Da.DisplayName):""}dmj(Da,xb,Jb){this.bGf()?(Jb[M.icon]=this.yii(xb),Jb[M.iconColor]=this.zii(Da)):this.Adc()?Jb[M.icon]=xb?M.DDo:M.GDo:(Jb[M.Zpi]=v.AFrameworkApplication.Ms,Jb[M.dbc]=xb?H.getImageClass(M.EDo):H.getImageClass(M.HDo))}Cbl(Da){const xb=this.jDb("LearnMoreSection",!0);Da=Object.assign(new X.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Da,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",
Image16by16:v.AFrameworkApplication.Ms,Image16by16Class:H.getImageClass(M.r0m),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(xb.ControlList,Da);return xb}gOh(Da,xb,Jb=!1){let Mb;Mb="Toggle_"+Da.Id;Mb="Sensitivity_"+Mb;const gb=Da.DisplayName,Wb=Da.Tooltip;var vc=Da.Id===this.ak.AppliedPolicyId,Fb=Jb?L.a.xf(Mb):Mb;this.bGf()?(vc=this.Oof(Da),xb=Object.assign(new wa.a,{Id:Fb,ExternalId:Fb,LabelText:Jb?L.a.xf(gb):gb,Command:"2935633379",MenuItemId:Fb,QueryCommand:"991261903",
Visible:!0,Alt:Jb?L.a.xf(Wb):Wb,AriaLabel:qa.a.TGc,IconColor:this.zii(vc),KeyTip:xb}),xb.ExternalImageId=this.yii(this.Hh.value.xdc(Da))):(Fb=Object.assign(new U.a,{Id:Fb,ExternalId:Fb,LabelText:Jb?L.a.xf(gb):gb,Command:"2935633379",MenuItemId:Fb,QueryCommand:"991261903",CheckedImage:v.AFrameworkApplication.Ms,Visible:!0,Alt:Jb?L.a.xf(Wb):Wb,IsChecked:vc,AriaLabel:qa.a.TGc,KeyTip:xb}),this.isReactRibbonEnabled()?(Fb.CheckedImageClass=H.getImageClass(M.x5f),Fb.ExternalImageId=M.x5f):Fb.CheckedImageClass=
H.getImageClass(M.uIc),xb=Fb);Fb=Mb;this.lzc[Fb]=Da.Id;this.ebh[Da.Id]=Fb;return xb}jDb(Da,xb=!1){return Object.assign(new ia.a,{Title:"",Id:Da,DisplayMode:M.menu,ShowMenuSectionSeparator:xb,ControlsId:"Ctrl_"+Da,ControlList:[]})}Tel(Da,xb,Jb){Da=this.jDb(Da+"Sub");let Mb=1;for(let gb of xb)(xb=this.eA[gb])&&xb.Enabled&&(Array.add(Da.ControlList,this.gOh(xb,Mb.toString(),Jb)),Mb++);return Da}Dva(Da=!1){const xb=this.jDb("SensitivitySection");let Jb=1;const Mb=this.kCa;for(let Wb in Mb){const vc=Mb[Wb],
Fb=this.eA[Wb];if(Fb&&Fb.Enabled){if(vc.count){var gb="Sensitivity_"+Fb.Name;Da&&L.a.xf(gb);gb="Label"+this.t_j++;const ya=Object.assign(new Z.a,{Id:gb,ExternalId:gb,LabelText:Da?L.a.xf(Fb.DisplayName):Fb.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new da.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:qa.a.TGc,KeyTip:Jb.toString(),Alt:Da?L.a.xf(Fb.Tooltip):Fb.Tooltip});this.isReactRibbonEnabled()?
ya.ExternalImageId=M.x5f:(ya.Image16by16=v.AFrameworkApplication.Ms,ya.Image16by16Class=H.getImageClass(M.uIc));Array.add(ya.Menu.MenuSectionList,this.Tel(gb,vc,Da));Array.add(xb.ControlList,ya);this.lzc[ya.Id]=Fb.Id;this.ebh[Fb.Id]=ya.Id}else Array.add(xb.ControlList,this.gOh(Fb,Jb.toString(),Da));Jb++}}return xb}tFc(Da){return!!this.ga.k0(Da)&&!!this.ga.k0(Da).flags&&!!this.ga.k0(Da).flags.length}Lvn(Da,xb){xb.onSuccess&&this.eA&&(Da=this.eA[this.Hh.value.ry.AppliedPolicyId])&&(this.PWa&&(xb=this.eA[this.PWa])&&
xb.Order<=Da.Order&&(this.Hh.value.KTa(29),this.PWa=null),this.IVb&&this.IVb!==Da.Id&&(this.Hh.value.KTa(28),this.IVb=null))}yii(Da){return Da?M.NPn:M.MPn}zii(Da){return Da?Da:M.Ime}Oof(Da){if(Da.Color||!Da.ParentId)return Da.Color;const xb=this.eA[Da.ParentId];return xb?xb.Color:Da.Color}dRo(Da){switch(Da){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}FTd(){this.uOe||(this.uOe=Object.assign(new t,{DTf:HeaderStrings.NoSensitivityLabel,ubg:HeaderStrings.SelectASensitivityLabel}));
return this.uOe}static CZo(){v.AFrameworkApplication.K&&!v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||!la.c()||appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",!0))}static $de(Da){v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Da?(Sa.a.FSa("ribbon","sensitivity"),Sa.a.nnb("ribbon","sensitivity")):Sa.a.eUf("ribbon",
"sensitivity"));la.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Da))}static $e(Da){return Da&&Da.length?!1:!0}}Object(E.a)(oa,"PolicyActor",null,[1729]);var Aa=c(542),xa=c(78),Ka=c(1948);class za extends Sys.EventArgs{constructor(Da,xb,Jb,Mb,gb,Wb){super();this.d4b=Da;this.title=xb;this.message=Jb;this.buttonText=Mb;this.IHc=gb;this.p0d=Wb}}Object(E.a)(za,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ha extends Sys.EventArgs{constructor(Da,
xb,Jb,Mb,gb){super();this.d4b=Da;this.title=xb;this.message=Jb;this.buttonText=Mb;this.IHc=gb}}Object(E.a)(ha,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Oa=c(1947);class ib extends Sys.EventArgs{constructor(Da,xb,Jb){super();this.NFh=Da;this.MFh=xb;this.existingLabelPriority=Jb}}Object(E.a)(ib,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Wa extends Sys.EventArgs{constructor(Da){super();this.k$l=Da}}Object(E.a)(Wa,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class nb extends Sys.EventArgs{constructor(){super()}}
Object(E.a)(nb,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Db{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=this.HideBarByDefault=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=
this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl="";this.HideBarByDefault=!1}}Object(E.a)(Db,"GetPolicyLabelsData",null,[]);class Ma extends Sys.EventArgs{constructor(Da=!1){super();this.onSuccess=Da}}Object(E.a)(Ma,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Qa extends Sys.EventArgs{constructor(Da,xb){super();this.cNi=Da;this.appMode=xb}}Object(E.a)(Qa,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class fb extends Sys.EventArgs{constructor(Da,
xb,Jb,Mb){super();this.title=Da;this.JDn=xb;this.buttonText=Jb;this.Fln=Mb}}Object(E.a)(fb,"PolicyTipEventArgs",Sys.EventArgs,[]);class dc extends Sys.EventArgs{constructor(Da,xb){super();this.d4b=Da;this.p0d=xb}}Object(E.a)(dc,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class bc extends Sys.EventArgs{constructor(){super()}}Object(E.a)(bc,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Bb extends Sys.EventArgs{constructor(Da,xb){super();this.e1f=Da;this.lDa=
xb}}Object(E.a)(Bb,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class Ob extends Sys.EventArgs{constructor(Da,xb,Jb,Mb=null,gb=null,Wb=null,vc=null){super();this.errorType=Da;this.i2e=xb;this.jxo=Jb;this.title=Mb;this.message=gb;this.buttonText=Wb;this.IHc=vc}}Object(E.a)(Ob,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Va extends Sys.EventArgs{constructor(Da){super();this.i2e=Da}}Object(E.a)(Va,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class ab extends Sys.EventArgs{constructor(Da){super();
this.eto=Da}}Object(E.a)(ab,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var Gb=c(83),Ua=c(99),yb=c(29),Yb=c(40),pc=c(37),Fc=c(466),Zb=c(288),Tb=c(177);class kc{static lio(Da,xb){if(!Da||!xb||Da.count!==xb.count)return!1;for(let Jb of Da)if(!xb.contains(Jb))return!1;return!0}static toArray(Da){if(!Da)return null;const xb=Array(Da.count);let Jb=0;for(let Mb of Da)xb[Jb]=Mb,Jb++;return xb}}Object(E.a)(kc,"HashSetUtils",null,[]);var ec=c(210),bb=c(111);class db{constructor(Da,xb,Jb,Mb=0,gb=null,
Wb=0){this.eye=this.wK=null;this.Mdb=this.Nvc=this.Qvc=0;this.usa="";this.ezb=this.D3g=this.NLg=this.h0g=this.mWa=this.OJe=null;this.I1g=!1;this.btb=null;this.GDe=0;this.Ztd=this.izb=this.rvb=this.Ytd=null;this.sa=new xa.a;this.F9c=this.BRc=this.Ll=null;this.pFe=!1;this.vZc=null;this.Ca=Da;this.Zf=xb;this.je=Jb;this.frd=Mb;this.ry=new Db;this.dbh=this.Ca.kb("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.Yu=gb;this.Zzc=0===Wb?this.OSi(v.AFrameworkApplication.ua.Jb.yk):this.OSi(Wb);this.Skb=
Da.$("WacApplyManualPolicyLabelIsEnabled");this.lcc=Da.$("CoAuthForProtectedFilesIsEnabled");this.Uqb=Da.$("SupportsOfficeClientCoauthoring");this.DCi=!1;this.Tmj=3E4;this.Ib=Ua.a.instance;Da.$("SupportsPolicies")&&Y.a("MipSupportsPolicies");this.lcc&&this.Uqb&&Y.a("MipSupportsOfficeClientCoauthoring")}get nDf(){return this.pFe}Ryk(Da){this.sa.addHandler("PolicyTipEvent",Da)}R_e(Da){this.sa.addHandler("LabelInfoUpdateEvent",Da)}i1n(Da){this.sa.removeHandler("LabelInfoUpdateEvent",Da)}jzk(Da){this.sa.addHandler("SetPolicyLabelTriggeredEventKey",
Da)}hCd(Da){this.sa.addHandler("SetPolicyLabelEventKey",Da)}q0e(Da){this.sa.addHandler("SetPolicyLabelFailureEventKey",Da)}Swk(Da){this.sa.addHandler("GetPolicyLabelEventKey",Da)}Rwk(Da){this.sa.addHandler("GetAutoPolicyLabelEventKey",Da);this.nDf&&(l.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.k5f(new Wa(0)))}Nwk(Da){this.sa.addHandler("CreateAutoCLPSecurityNodesEventKey",Da)}rzk(Da){this.sa.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",
Da)}szk(Da){this.sa.addHandler("UpdateAutoCLPSITNodesEventKey",Da)}swk(Da){this.sa.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Da)}$yk(Da){this.sa.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Da)}twk(Da){this.sa.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Da)}azk(Da){this.sa.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Da)}wqh(Da){this.sa.addHandler("MandatoryLabellingAppHandlerEventKey",Da)}pzk(Da){this.sa.addHandler("UDPLabelingAppHandlerEventKey",
Da)}get mMm(){if(!this.wK)return!1;for(const Da of this.wK.oPc())if(!Da.Capabilities||!Da.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get iCi(){return!!this.Ll}Dzm(Da){Da&&this.lcc&&this.Uqb&&Da.execute(Object(e.a)(this,this.C3e,"awaitRtc"))}kzm(Da){Da&&this.lcc&&this.Uqb&&Da.continueWith(()=>{this.wK=Da.result})}qWk(){return this.h0g?this.h0g():!1}lq(){return(new Date).getTime()}C3e(Da){if(!this.iCi){var xb=Da.TQc();xb.continueWith(()=>{this.Ll=xb.result;this.Ll.S3(Object(e.a)(this,
this.eqn,"onLabelChangeUpdateOverRtc"))})}}eqn(Da,xb){12===xb.type&&(this.D3g?this.D3g():this.aGb(this.usa,2,this.mWa,!0))}Ypf(){this.je&&(this.Ytd=this.je.Yf("WebServiceCall","Call Get Policy Endpoint On Server"));var Da=ec.a.N0a(1,1);this.Ca.$("SendHostAttributionInfoForPolicyLabelEnabled")?(Da=new Fc.a(this.B$b("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Da),this.Zf.send(Da).fza(Object(e.a)(this,this.xUi,"onDataLossPolicySuccessCallback"),
Object(e.a)(this,this.wUi,"onDataLossPolicyFailureCallback"))):this.Zf.lj(this.B$b("datalosspolicy"),1,null,null,!0,2,Object(e.a)(this,this.xUi,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.wUi,"onDataLossPolicyFailureCallback"),null);this.Qvc++;l.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.dbh,this.Qvc)}aUn(){this.aGb(this.usa,2,this.mWa)}aGb(Da,xb=0,Jb=null,Mb=!1){ba.Health.instance.recordKpiUsage("MipGetPolicyLabel",
0,"officewebclp",this.v2a(void 0,xb));this.BRc=this.lq();const gb=this.ibf(xb);this.gRd(Da,gb,Jb,Mb,xb);this.iPb(!0)}xUi(Da){this.q2i();let xb="";({data:xb}=this.Nng(Da)).returnValue&&(l.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.Qvc=0,this.je&&(this.Ztd=this.je.Yf("Task","Parse and Handle Get Policy Response")),this.BAn(xb),this.Ztd&&(this.Ztd.stop(),this.Ztd=null))}wUi(Da){this.q2i();this.Qvc<=this.frd?this.Ypf():(l.ULS.sendTraceTag(25565154,306,
15,"Request to get DataLossPrevention policy failed with error response: {0}.",Da?Da.data?Da.data.Oja:null:null),this.Qvc=0)}CCi(){return 0<this.Mdb}setPolicyLabel(Da){this.ry.AppliedPolicyId=Da}geg(Da,xb,Jb=null){const Mb=this.Val(Jb);this.hmo(Da,xb,Mb,Jb)}iYi(Da){this.izb&&(this.izb.stop(),this.izb=null);let xb,Jb;({Gij:xb,Smj:Jb}=this.bhi(Da));const Mb=Da.data.state,gb=Mb?Mb.lDa:2;let Wb="";({data:Wb}=this.Nng(Da)).returnValue?(l.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",
gb),this.Mdb=0,this.iBn(Wb,xb,Jb,Mb)):this.R$f(gb)}POn(Da){ba.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.v2a(Da));this.F9c=this.lq();l.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.sa.raiseEvent("SetPolicyLabelTriggeredEventKey",new Va(Da))}win(){this.lcc&&this.Uqb&&this.iCi&&this.Ll.qN(12,null,!0)}hYi(Da){this.izb&&(this.izb.stop(),this.izb=null);let xb;({Gij:Jb,Smj:xb}=this.bhi(Da));if(this.Mdb<=this.frd)this.geg(Jb,xb);else{var Jb=
(Jb=Da.data.state)?Jb.lDa:2;l.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Da?Da.data?Da.data.Oja:null:null,Jb);this.vZc="WACServerConnectionFailed";this.Mdb=0;this.R$f(Jb)}}xTm(Da){if(Da&&("LabelNotSupported"===Da||"LabelErrorRetryLater"===Da||"CoherencyFailure"===Da||"LabelIdNotFound"===Da||"LabelDisabled"===Da))return l.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Da),!0;l.ULS.sendTraceTag(539103557,306,
50,"LabelError is not retriable: {0}",Da);return!1}xdc(Da){return this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPAsProtectedLabelEnabled",!1)?Da.IsEndpointProtectionEnabled||Da.HasUserDefinedPermissions:Da.IsEndpointProtectionEnabled}hTk(Da){if(!Da)return!1;let xb=null,Jb=null;for(const Mb of this.ry.SensitivityLabels)Mb.Id===Da&&(xb=Mb),Mb.Id===this.usa&&(Jb=Mb);if(!xb)return!1;if(this.lcc&&this.Uqb){if(this.NLg&&this.NLg()||this.mMm)return!0}else if(v.AFrameworkApplication.Tm&&
v.AFrameworkApplication.Tm.f2a||this.mWa&&this.mWa())return!0;return this.xdc(xb)===(!!Jb&&this.xdc(Jb))}nBd(Da,xb,Jb,Mb,gb){28===Da?this.o6i(new za(Da,xb,Jb,Mb,gb,!1)):this.o6i(new za(Da,xb,Jb,Mb,gb,!0))}KTa(Da){28===Da?this.L6i(new dc(Da,!1)):this.L6i(new dc(Da,!0))}PNn(Da,xb,Jb){l.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.sa.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ib(Da,xb,Jb))}XOn(Da){l.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");
this.sa.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ib(null,null,Da))}YOn(Da,xb){l.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.sa.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ib(Da,xb,null))}z6i(Da,xb){l.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===xb?"Reading":"Edit")+" switch event.");this.sa.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Qa(Da,xb))}RZe(Da,xb,Jb,Mb,gb){37===Da&&this.ANn(new ha(37,xb,Jb,Mb,gb))}V7f(){this.IOn(new bc)}WOn(){l.ULS.sendTraceTag(540608322,
306,50,"Raising a UDP labeling event.");this.sa.raiseEvent("UDPLabelingAppHandlerEventKey",new ab(!0))}r3b(Da=!1){const xb=!!this.ry&&this.ry.AreLabelsAvailable&&!!this.ry.SensitivityLabels&&0<this.ry.SensitivityLabels.length&&Tb.a.any(this.ry.SensitivityLabels,Jb=>!!Jb&&Jb.Enabled);xb||Da||oa.$de(!1);return xb}oVi(Da){this.rvb&&(this.rvb.stop(),this.rvb=null);var xb="";this.iPb(!1);({data:xb}=this.Nng(Da)).returnValue?(l.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),
this.Nvc=0,xb=this.UAn(xb),Da=this.Oei(Da.data),ba.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.Fib(void 0,Da,this.BRc)),this.BRc=null,Da=new Wa(Da),this.ZNn(Da),this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?xb&&this.nro()?this.nDf?this.aUo():(this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.UId(),this.k5f(Da),this.pFe=!0):xb||this.uce():!this.nDf&&xb&&this.Ca.$("WacApplyManualPolicyLabelIsEnabled")&&
this.gvh()?(this.k5f(Da),this.pFe=!0):xb||this.uce()):this.uce()}nro(){if(!this.Ca.$("WacApplyManualPolicyLabelIsEnabled"))return l.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.gvh())return!1;if(""===this.usa)return l.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.btb===this.GDe)return l.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),
!1;l.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}UId(){this.FEj();l.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.ezb.count,this.btb);const Da=kc.toArray(this.ezb);this.PNn(Da,Da,this.btb)}aUo(){var Da=this.ezb;this.FEj();kc.lio(Da,this.ezb)||(l.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.ezb.count),
Da=kc.toArray(this.ezb),this.YOn(Da,Da));this.I1g&&(l.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.btb),this.XOn(this.btb))}FEj(){const Da=new Aa.a(x.a.hh());for(const xb of this.ry.SensitivityLabels)if(xb&&xb.AutoLabelingSensitiveTypeIds&&0<xb.AutoLabelingSensitiveTypeIds.length)for(const Jb of xb.AutoLabelingSensitiveTypeIds)Jb&&Da.add(Jb);this.ezb=Da}nVi(Da){const xb=this.Oei(Da.data);ba.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",
!1,!1,this.Fib(void 0,xb,this.BRc));this.BRc=null;this.rvb&&(this.rvb.stop(),this.rvb=null);if(this.Nvc<=this.frd){if(this.Ca.$("SendHostAttributionInfoForPolicyLabelEnabled")){const Jb=Da.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in Jb&&Jb[ec.a.nfe]&&"HostAttributionInfo.ScenarioTypeParamName"in Jb&&Jb[ec.a.ofe]){Da.data.request.get_headers();Da.data.request.get_headers();Da=this.ibf(xb);this.gRd(this.usa,Da,this.mWa,void 0,xb);return}}this.aGb(this.usa,xb,this.mWa)}else l.ULS.sendTraceTag(34996494,
306,15,"Request to get label policy failed with error response: {0}.",Da?Da.data?Da.data.Oja:null:null),this.uce(),this.Nvc=0,this.iPb(!1)}Oei(Da){return Da.state?Da.state:0}B$b(Da,xb=!1){let Jb=String.format("{0}{1}?action={2}&{3}",this.Ca.kb("PolicyHandlerWebServiceBase")||v.AFrameworkApplication.ua.Jb.BSa,this.dbh,Da,v.AFrameworkApplication.am);"setpolicylabel"===Da&&v.AFrameworkApplication.Tm&&v.AFrameworkApplication.Tm.PEf&&(Jb=Yb.a.fp(Jb,"sl","1"));xb&&(Jb=Yb.a.fp(Jb,"cbd","1"));return Jb}bhi(Da){let xb,
Jb;xb=Jb=null;Da&&Da.data&&Da.data.request&&Da.data.request.get_headers()&&(xb=Da.data.request.get_headers()[Zb.a.Dbg],Jb=Da.data.request.get_headers()[Zb.a.feg]);return{Gij:xb,Smj:Jb}}Nng(Da){Da=Da?Da.data?Da.data.se:null:null;return Da&&Da.length&&!this.yUm(Da)?{returnValue:!0,data:Da}:(l.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:Da})}BAn(Da){let xb;try{xb=yb.b(Da)}catch(Jb){l.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");
return}if(xb)if(xb.IsPolicyTipAvailable)switch(xb.IsPolicyTipAvailable.toLowerCase()){case "false":l.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":l.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.eye=xb.NavigateUrl;this.Exo(xb.GeneralText,Object(e.a)(this,this.inn,"onDataLossPolicyOverrideButtonClick"));break;default:l.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",
xb.IsPolicyTipAvailable)}else l.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else l.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}z7k(Da){switch(Da){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;
case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}iBn(Da,xb,Jb,Mb){var gb=Mb?Mb.lDa:2;let Wb=0,vc="",Fb;if(({Gt:Fb}=yb.d(Da)).returnValue)if(Fb){vc="Success";Da=this.ibf(3);if(Fb.IsSuccessful){ba.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.Fib(gb,void 0,
this.F9c));this.vZc=this.F9c=null;l.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",gb);2===gb&&this.KTa(29);this.qno(xb,gb);this.win();this.KTa(28);Mb&&4===gb&&this.nBd(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Mb.displayName),CommonUIStrings.l_DialogOk,()=>{});Y.a("MipAppliedLabels",void 0,void 0,[Object.assign(new fa.a,{name:"SetPolicyLabelApplyFlag",
string:Oa.a[gb]})]);this.gRd(xb,Da,this.mWa,void 0,3);return}l.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",gb,Fb.FailureReason);this.vZc=Fb.FailureReason;this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",!1)?Wb=this.z7k(Fb.FailureReason):"FileTooLarge"===Fb.FailureReason?Wb=7:"LabelNotSupported"===Fb.FailureReason?Wb=13:"LabelDisabled"===
Fb.FailureReason?Wb=9:"MinorVersionLimitExceeded"===Fb.FailureReason&&(Wb=15);this.DCi&&0<=Fb.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Mb=new Gb.a(2,1,this.Tmj,()=>{l.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.Mdb);this.Mdb<=this.frd&&this.geg(xb,Jb)}),this.Ib.Wb(Mb));this.lcc&&this.Uqb&&this.gRd(this.ry.AppliedPolicyId,Da,this.mWa,!0,3)}else vc="setPolicyLabelData null.",l.ULS.sendTraceTag(42467541,
306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",gb);else vc="TryDeserialize failed.",l.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",gb);this.R$f(gb,Wb);gb=this.Fib(gb,void 0,this.F9c);this.F9c=null;gb.extendedProperties.set("SetPolicyLabelDataFailureReason",this.vZc);gb.extendedProperties.set("SetPolicyLabelDataParseStatus",vc.toString());ba.Health.instance.recordKpiFailure("MipSetPolicyLabel",
"SetPolicyLabelFailure",!1,!1,gb)}R$f(Da,xb=0){const Jb=2===Da||8===Da||16===Da;this.setPolicyLabel(this.usa);this.x6i(new Ma);this.S6i(xb,Da,Jb,!1)}qno(Da,xb){this.setPolicyLabel(this.usa=Da);if(""===Da)v.AFrameworkApplication.EF=!1,v.AFrameworkApplication.wMd=!1;else for(const Jb of this.ry.SensitivityLabels)if(Jb.Id===Da){v.AFrameworkApplication.EF=this.xdc(Jb);break}this.OOn(new Bb(Da,xb))}nXo(){for(const Da of this.ry.SensitivityLabels)Da&&Da.Enabled&&(Da.Id===this.usa&&(this.I1g=this.btb!==
Da.Order,this.btb=Da.Order),Da.Order>this.GDe&&(this.GDe=Da.Order))}UAn(Da){if(!({Gt:Da}=yb.d(Da)).returnValue)return l.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Da)return l.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!Da.AreLabelsAvailable)return!1;this.ry=Da;this.usa=Da.AppliedPolicyId;this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnablePdfProtectionUsageTelemetry",
!1)&&this.Ca.appSettings&&(this.Ca.appSettings.AppliedPolicyId=this.usa);this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.nXo();this.r3b()&&l.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.x6i(new Ma(!0));return!0}gvh(){if(!this.r3b())return l.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Da of this.ry.SensitivityLabels)if(Da&&
Da.AutoLabelingSensitiveTypeIds&&0<Da.AutoLabelingSensitiveTypeIds.length)return!0;l.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}x6i(Da){l.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.sa.raiseEvent("LabelInfoUpdateEvent",Da)}ZNn(Da){l.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.sa.raiseEvent("GetPolicyLabelEventKey",Da)}uce(){oa.$de(!1);this.sa.raiseEvent("GetPolicyLabelFailureEventKey",
new nb)}k5f(Da){this.Yu&&this.Yu.execute(xb=>{xb=[xb.isFeatureEnabled("MsoClpSpTwo",!0),xb.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(xb).then(Jb=>{Tb.a.any(Jb,Mb=>Mb)&&(l.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.sa.raiseEvent("GetAutoPolicyLabelEventKey",Da),this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.UId(),Y.a("MipAutoClassificationEnabled"));return null})})}v2a(Da=null,xb=null){const Jb=
new Map;Jb.set("ClpCoauth",this.Uqb.toString());null!=Da&&Jb.set("ApplyLabelFlags",Oa.a[Da]);null!=xb&&Jb.set("GetPolicyLabelsReason",Ka.a[xb]);return Jb}Fib(Da=null,xb=null,Jb=null){const Mb=new bb.a;Mb.extendedProperties=this.v2a(Da,xb);null!=Jb&&(Mb.durationMs=this.lq()-Jb);return Mb}OOn(Da){l.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.sa.raiseEvent("SetPolicyLabelEventKey",Da)}o6i(Da){l.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
Da&&Da.p0d&&Y.a("MipRecommendations");this.sa.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Da)}L6i(Da){l.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.sa.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Da)}ANn(Da){l.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.sa.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Da)}IOn(Da){l.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");
this.sa.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Da)}Exo(Da,xb=null){l.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.sa.raiseEvent("PolicyTipEvent",new fb(CommonUIStrings.l_PolicyBusinessBarTitle,Da,CommonUIStrings.l_PolicyOverrideButton,xb))}S6i(Da,xb,Jb,Mb=!0){l.ULS.sendTraceTag(42074656,306,Mb?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",xb);Mb=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let gb=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,
Wb=null,vc=null;switch(Da){case 2:Mb=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;gb=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:gb=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:Mb=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;gb=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Mb=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;
gb=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:Mb=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;gb=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:gb=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:Mb=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;gb=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 15:Mb=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,gb=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Wb=CommonUIStrings.l_LearnMore,vc=()=>{this.imo()}}Da=new Ob(Da,xb,Jb,Mb,gb,Wb,vc);this.sa.raiseEvent("SetPolicyLabelFailureEventKey",Da)}Qko(Da){this.OJe=Da}inn(){this.eye?(l.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),pc.a.qib(this.eye)):l.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}yUm(Da){if(!Da.startsWith("<")||
-1===Da.indexOf("Error")&&-1===Da.indexOf("Unavailable"))return!1;l.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}q2i(){this.Ytd&&(this.Ytd.stop(),this.Ytd=null)}cMl(Da){if(!Da)return"manual";switch(Da.lDa){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";
default:return"manual"}}oOl(Da){if(!Da)return"privileged";Da=Da.lDa;let xb="privileged";if(4===Da||1===Da)xb="standard";return xb}OSi(Da){switch(Da){case 1:return"Excel";case 4:return"OneNote";case 2:return"PowerPoint";case 5:return"Visio";case 3:return"Word";default:return"Unknown"}}gRd(Da,xb,Jb=null,Mb=!1,gb=0){this.Ca.$("WacLabelingGetPolicyLabelsIsEnabled")&&(this.usa=Da,this.mWa=Jb,this.je&&(this.rvb=this.je.Yf("WebServiceCall","Call Get Policy Endpoint On Server")),Jb={},Jb[Zb.a.cuh]=Da,this.Ca.$("SendHostAttributionInfoForPolicyLabelEnabled")?
(Da=new Fc.a(this.B$b("getpolicylabels",Mb),1,null,Jb,!0,2,gb,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,xb),this.Zf.send(Da).fza(Object(e.a)(this,this.oVi,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.nVi,"onGetPolicyLabelsFailureCallback"))):this.Zf.lj(this.B$b("getpolicylabels",Mb),1,null,Jb,!0,2,Object(e.a)(this,this.oVi,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.nVi,"onGetPolicyLabelsFailureCallback"),gb,void 0,void 0,void 0,
void 0,"22"),this.Nvc++,l.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.Nvc))}hmo(Da,xb,Jb,Mb=null){if(this.Skb){this.je&&(this.izb=this.je.Yf("WebServiceCall","Call Set Policy Endpoint On Server"));var gb={};gb[Zb.a.Dbg]=Da;xb&&(gb[Zb.a.feg]=encodeURIComponent(xb));this.OJe&&(gb[Zb.a.dth]=this.OJe);Mb?(gb[Zb.a.ceg]=this.cMl(Mb),gb[Zb.a.deg]=this.oOl(Mb),this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",
!1)&&1===Mb.lDa&&this.ry.DefaultLabelType&&(gb[Zb.a.Rmj]=this.ry.DefaultLabelType)):(gb[Zb.a.ceg]="manual",gb[Zb.a.deg]="privileged");this.Uqb&&this.ry&&(gb[Zb.a.r2i]=this.ry.PolicyLabelVersionToken);this.Ca.$("SendHostAttributionInfoForPolicyLabelEnabled")?(Da=new Fc.a(this.B$b("setpolicylabel",!0),1,null,gb,!0,2,Mb,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Jb),this.Zf.send(Da).fza(Object(e.a)(this,this.iYi,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,
this.hYi,"onSetPolicyLabelFailureCallback"))):this.Zf.lj(this.B$b("setpolicylabel",!0),1,null,gb,!0,2,Object(e.a)(this,this.iYi,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.hYi,"onSetPolicyLabelFailureCallback"),Mb,void 0,void 0,void 0,void 0,"32");this.Mdb++;l.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.Mdb)}else l.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}imo(){const Da=
new va.StandardDialog,xb=this.Ca.kb("BreadcrumbFolderUrl");xb?(Da.Cd=11,Da.ze(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Da.ze(2,CommonUIStrings.l_DialogOk)):(Da.Cd=0,Da.ze(1,CommonUIStrings.l_DialogOk));Da.JZe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Da.g_n();Da.DV(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,
Jb=>{1===Jb&&xb&&pc.a.wm(xb,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}ibf(Da){switch(Da){case 1:return ec.a.N0a(1,1);case 2:return ec.a.N0a(7,1);case 3:return ec.a.N0a(8,1);default:return ec.a.N0a(7,0)}}Val(Da=null){if(!Da)return ec.a.N0a(8,0);switch(Da.lDa){case 1:case 16:return ec.a.N0a(1,1);case 4:case 2:case 8:return ec.a.N0a(8,1);default:return ec.a.N0a(8,0)}}iPb(Da){this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",Da)}}Object(E.a)(db,"PolicyManager",null,[1706]);var Kb=c(120),Cb=c(162);class lb{constructor(){this.qSe=this.vOe=this.s6g=this.Bch=this.oMg=this.wt=this.bba=this.W=this.Hh=null}get name(){return"Common.App.Policy"}init(){v.AFrameworkApplication.K.$("ShouldInitCommonPolicyPackage")&&(v.AFrameworkApplication.K.$("IsDataLossPreventionEnabledForUser")&&v.AFrameworkApplication.ua&&(this.Hh=this.W.resolve("Common.App.Policy.Contracts.IPolicyManager"),
this.Hh.Ryk(Object(e.a)(this,this.Dxo,"showPolicyBusinessBar")),l.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?Kb.a.get_instance().pk(5,()=>{this.Hh.Ypf()}):Kb.a.get_instance().pk(6,()=>{this.Hh.Ypf()})),v.AFrameworkApplication.K.$("WacLabelingPoliciesIsEnabled")&&v.AFrameworkApplication.K.$("SupportsPolicies")?v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",
!1)?Kb.a.get_instance().pk(5,Object(e.a)(this,this.sTi,"onAfterRibbonBehaviorAttached")):Kb.a.get_instance().pk(6,Object(e.a)(this,this.sTi,"onAfterRibbonBehaviorAttached")):(oa.CZo(),oa.$de(!1)))}dispose(){}wc(Da){Da.register(1706,"Common.App.Policy.Contracts.IPolicyManager").ha().Ud(()=>new db(v.AFrameworkApplication.K,v.AFrameworkApplication.Ge,v.AFrameworkApplication.ua.Kq,v.AFrameworkApplication.K.mc("MaxGetPolicyRetries",1),Da.Ta("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
v.AFrameworkApplication.ua.Jb.yk));Da.register(oa,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").ha().Ud(()=>new oa(v.AFrameworkApplication.va,v.AFrameworkApplication.ua,v.AFrameworkApplication.K,Da.Ue("Common.App.Policy.Contracts.IPolicyManager")));this.W=Da}sTi(){this.wt=this.W.Oa("CommonUI.BusinessBar");this.Hh||(this.Hh=this.W.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.bba=this.W.resolve("Common.App.Policy.PolicyActor");la.a("isSharedUxGateEnabled")&&
appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Hh.R_e(Object(e.a)(this.bba,this.bba.d9i,"registerActionsHandler")):this.bba.Tb();this.Hh.R_e(Object(e.a)(this,this.mXo,"updateLabelInfo"));v.AFrameworkApplication.K.$("WacApplyManualPolicyLabelIsEnabled")&&(this.Hh.q0e(Object(e.a)(this,this.vqm,"handleSetPolicyLabelFailure")),this.Hh.swk(Object(e.a)(this,this.nBd,"addAutoPolicyBusinessBarEntry")),this.Hh.$yk(Object(e.a)(this,this.KTa,"removeAutoPolicyBusinessBarEntry")),
this.Hh.twk(Object(e.a)(this,this.RZe,"addMandatoryLabellingBusinessBarEntry")),this.Hh.azk(Object(e.a)(this,this.V7f,"removeMandatoryLabellingBusinessBarEntry")))}mXo(){this.bba.Wlo();this.bba.zjo();this.bba.cMn();const Da=this.Hh.qWk();v.AFrameworkApplication.K.$("HasDocumentEditRights")&&!Da?this.bba.RNo():l.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",v.AFrameworkApplication.K.$("HasDocumentEditRights"),
Da);v.AFrameworkApplication.ua.updateCommandUI()}Dxo(Da,xb){this.vOe&&this.wt.yY(38)&&this.wt.removeEntry(this.vOe);Da=this.Mei(xb.title,xb.JDn,38,xb.Fln,xb.buttonText);v.AFrameworkApplication.ua.Jb.Qma(Da,!0)?(this.vOe=Da,l.ULS.sendTraceTag(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user.")):l.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}vqm(Da,xb){xb.jxo&&(this.qSe&&this.wt.yY(21)&&this.wt.removeEntry(this.qSe),
Da=this.Mei(xb.title,xb.message,21,null,null,xb.IHc,xb.buttonText),v.AFrameworkApplication.ua.Jb.Qma(Da,!0)?(this.qSe=Da,l.ULS.sendTraceTag(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user.")):l.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}KTa(Da,xb){(Da=xb.p0d?this.Bch:this.oMg)&&this.wt&&this.wt.yY(xb.d4b)&&this.wt.removeEntry(Da)}nBd(Da,xb){this.wt&&(this.Hh.KTa(xb.d4b),Da=new a.a(xb.title,
xb.message,null),Da.id=xb.d4b,Da.closeable=!0,Da.image=3,Da.addButton(xb.buttonText,xb.IHc,xb.buttonText,!0),this.wt.sA(Da,!1),xb.p0d?this.Bch=Da:this.oMg=Da)}RZe(Da,xb){this.wt&&(Da=new a.a(xb.title,xb.message,null),Da.id=xb.d4b,Da.closeable=!1,Da.image=3,Da.addButton(xb.buttonText,xb.IHc,xb.buttonText,!1),this.wt.sA(Da,!1),this.s6g=Da)}V7f(){const Da=this.s6g;Da&&this.wt&&this.wt.yY(Da.id)&&this.wt.removeEntry(Da)}Mei(Da,xb,Jb,Mb=null,gb=null,Wb=null,vc=null){Da=new a.a(Da,xb,null);Da.id=Jb;Da.closeable=
!0;Mb&&Da.GBd(gb,Mb);Wb&&Da.addButton(vc,Wb,vc);return Da}static main(){Cb.a.instance.Gc(new lb)}}Object(E.a)(lb,"PackageManager",null,[1,2]);c.d(I,"a",function(){return mb});const mb=()=>{Type.registerNamespace("Common.App.Policy");lb.main()}},1745:function(E,I,c){E=c(0);var l=c(2),e=c(73),a=c(574),k=c(76),x=c(1948),y=c(83),m;(function(ra){ra[ra.generic=0]="generic";ra[ra.coherencyFailure=1]="coherencyFailure";ra[ra.disabledByPolicy=2]="disabledByPolicy";ra[ra.fileCheckedOut=3]="fileCheckedOut";
ra[ra.fileEncrypted=4]="fileEncrypted";ra[ra.fileLocked=5]="fileLocked";ra[ra.fileNotSupported=6]="fileNotSupported";ra[ra.fileTooLarge=7]="fileTooLarge";ra[ra.invalidOperationOnZeroByteFile=8]="invalidOperationOnZeroByteFile";ra[ra.labelDisabled=9]="labelDisabled";ra[ra.labelErrorRetryLater=10]="labelErrorRetryLater";ra[ra.labelIdNotFound=11]="labelIdNotFound";ra[ra.labelIrmDisabledByTenant=12]="labelIrmDisabledByTenant";ra[ra.labelNotSupported=13]="labelNotSupported";ra[ra.mandatoryConflict=14]=
"mandatoryConflict";ra[ra.minorVersionLimitExceeded=15]="minorVersionLimitExceeded"})(m||(m={}));Object(E.b)("SetPolicyLabelErrorType",m);var t=c(99),z=c(120),v=c(1947),H=c(162),F=c(9),G=c(3),L=c(47),J=c(7),K=c(787),S=c(694),R=c(166),M=c(5),O=c(8),U=c(465),X=c(111),P=c(1335),Z=c(1369),ba=c(785),Y=c(786),da=c(1949),ia=c(20),la=c(1652),wa=c(462),va=c(202);class qa{constructor(ra,fa){this.Ie=ra;this.bba=fa}initialize(){const ra=K.a.ml();ra&&ra.then(()=>{this.OVc()?this.Ie.ob(this,"AugLoop_SecurityClp_LabellingAnnotation"):
this.Ie.ob(this,"AugLoop_Automatic_Clp_LabellingAnnotation")})}KB(ra=null,fa=null){O.ULS.sendTraceTag(575963811,337,50,"HandleAnnotationEvent");if(va.WoncaApp.x_.G4o.tGf()){if(this.OVc()){if(!ra||"AugLoop_SecurityClp_LabellingAnnotation"!==ra.annotationType){O.ULS.sendTraceTag(538845259,337,15,"HandleAnnotationEvent - unsupported annotation");return}}else if(!ra||"AugLoop_Automatic_Clp_LabellingAnnotation"!==ra.annotationType){O.ULS.sendTraceTag(575972804,337,15,"HandleAnnotationEvent - unsupported annotation");
return}if(!fa||fa!==P.a.getTypeName()&&fa!==Z.a.getTypeName())O.ULS.sendTraceTag(575972805,337,15,"HandleAnnotationEvent - unsupported opType");else{fa=ra.content||{};ra=fa.automatic||{};var pa=ra.sensitivityLabel||{};ra=this.OVc()?ra.id:pa.id;pa=fa.recommended||{};var oa=pa.sensitivityLabel||{};fa=this.OVc()?pa.id:oa.id;pa=this.OVc()?pa.policyTip:oa.policyTip;this.bba.kEk(ra,fa,pa,this.vPm())}}else O.ULS.sendTraceTag(575972803,337,15,"HandleAnnotationEvent - not IsNotRead")}vPm(){const ra=F.App.za.jb.Zc.Hba;
return!ra.Tma||""===ra.Tma||ra.WJb}OVc(){return l.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}}Object(E.a)(qa,"AutoClpAnnotationEventHandler",null,[279]);var Na=c(29);class Sa{FHh(ra,fa,pa,oa,Aa,xa,Ka,za){const ha=fa.e1f;let Oa="",ib="";const Wa=ra.DefaultLabelId;let nb;ra.SensitivityLabels.forEach(Qa=>{Qa.Id==za&&(Oa=Qa.ParentId);Qa.Id==ha&&(ib=Qa.ParentId);Qa.Id==Wa&&Qa.ParentId&&(nb=Qa.ParentId)});const Db=[];ra.SensitivityLabels.forEach(Qa=>
{Qa.Id!=za&&Qa.Id!=Oa&&Qa.Id!=ha&&Qa.Id!=ib&&Qa.Id!=ra.DefaultLabelId||Db.push(Qa);nb&&Qa.Id==nb&&Db.push(Qa)});ra.SensitivityLabels=Db;const Ma={};Ma.clpLabelId=fa.e1f||"";Ma.clpTenantId=oa;Ma.clpApplyLabelFlags=fa.lDa;Ma.clpSupportsOfficeClientCoauthoring=pa;Ma.clpUserName=Aa;Ma.clpUserPrincipalName=xa;Ma.clpDocLocation=Ka;Ma.clpActions=Na.c(ra);fa=Na.c(Ma);pa=[];pa.push(fa);return pa}}Object(E.a)(Sa,"AutoSaveParameterComposer",null,[1804]);class Ia{}Ia.OFh="WordClpReadPolicy";Ia.T4b="WordClpSetPolicy";
Ia.EGd="wordclpfc";Object(E.a)(Ia,"Constants",null,[]);c.d(I,"a",function(){return ta});class ta{constructor(ra){this.Kch=!0;this.kXg=this.tmd=this.jXg=0;this.Vhd=this.tCe=!1;this.G9c=this.Ib=null;this.vga=()=>F.App.zd.amIAlone||F.App.zd.vga&&F.App.zd.mC.RGa;this.Ckn=()=>{l.AFrameworkApplication.va.fb(G.a.iHj,e.a.frame,this.MYo,96);a.a.Fp(ta.W.Ta("Common.App.Policy.Contracts.IPolicyManager")).continueWith(fa=>{var pa=0;k.Health.instance.recordKpiUsage(Ia.OFh,1,Ia.EGd,this.v2a());pa=(new Date).getTime();
ta.Hh=fa.result;this.Sdb&&(ta.Hh.kzm(F.App.Uoa().CWR(()=>F.App.Uoa().result.mC)),ta.Hh.Dzm(ta.W.Ta("Common.Interface.IRtcBasicProvider")),ta.Hh.Swk(this.j$l));ta.Hh.Skb=ta.Hh.Skb&&l.AFrameworkApplication.K.$("WordApplyManualPolicyLabelIsEnabled");this.Vhd&&ta.Hh.jzk(this.iun);ta.Hh.DCi=!0;ta.Hh.Tmj=l.AFrameworkApplication.K.mc("WordClpSetPolicyLabelZeroByteFailureRetryIntervalMs",3E4);ta.Hh.hCd(this.hun);ta.Hh.q0e(this.gun);l.AFrameworkApplication.K.$("AutoClpIsEnabled")&&l.AFrameworkApplication.K.$("AugLoopAnnotationsIsEnabled")&&
(ta.Hh.Rwk(this.DUn),l.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(ta.Hh.Nwk(this.UId),ta.Hh.rzk(this.ZTo),ta.Hh.szk(this.$To)));ta.Hh.wqh(this.gFk);ta.Hh.pzk(this.YQo);fa=l.AFrameworkApplication.K.kb("AppliedPolicyId");""===fa&&(fa=this.hTd().Tma);ta.Stb=fa;l.AFrameworkApplication.pu||ta.Hh.aGb(fa,x.a.boot,this.vga,!1);pa=Object.assign(new X.a,{durationMs:(new Date).getTime()-pa});k.Health.instance.recordKpiSuccess(Ia.OFh,pa)});a.a.Fp(ta.W.Ta("Common.App.Policy.Contracts.IPolicyActor")).continueWith(fa=>
{ta.bba=fa.result;ta.bba.Skb=ta.bba.Skb&&l.AFrameworkApplication.K.$("WordApplyManualPolicyLabelIsEnabled")})};this.j$l=(fa,pa)=>{O.ULS.sendTraceTag(579203664,337,100,"GetPolicyLabelHandler");this.tCe&&(ta.Stb=ta.Hh.ry.AppliedPolicyId,ta.Pxe=ta.Hh.ry.PolicyLabelVersionToken);this.sFi(this.hTd().Tma,ta.Hh.ry.AppliedPolicyId)||!(0<this.tmd)||this.tCe&&pa.k$l===x.a.selfSetPolicyLabel||(this.tmd--,O.ULS.sendTraceTag(579737543,337,15,"LabelId from host did not match content stream."),fa=new y.a(2,1,this.kXg,
()=>{O.ULS.sendTraceTag(579715490,337,15,"Retrying GetDocumentPolicyLabelsRequestAsync after labelId mismatch. getPolicyRetryRemainingCount : {0}",this.tmd);ta.Hh.aGb(this.hTd().Tma,x.a.refresh,this.vga,!0)}),this.Ib.Wb(fa))};this.MYo=(fa,pa,oa)=>{O.ULS.sendTraceTag(579203665,337,100,"UpdatePolicyLabelFromBox4 - Begin.");if(1===oa)return 32;fa=this.hTd();const Aa=fa.Tma;fa=this.Sdb?fa.CNb:null;if(this.Sdb?ta.Pxe===fa:this.sFi(ta.Stb,Aa))return O.ULS.sendTraceTag(579203666,337,100,"UpdatePolicyLabelFromBox4 - Label Change not detected."),
32;O.ULS.sendTraceTag(579203667,337,100,"UpdatePolicyLabelFromBox4 - Label Change detected.");this.tmd=this.jXg;ta.Hh?ta.Hh.aGb(Aa,x.a.refresh,this.vga,!0):a.a.Fp(ta.W.Ta("Common.App.Policy.Contracts.IPolicyManager")).continueWith(xa=>{ta.Hh=xa.result;ta.Hh.aGb(Aa,x.a.refresh,this.vga,!0)});ta.Stb&&(ta.POe=ta.Stb);ta.Stb=Aa;this.Sdb&&(ta.Pxe=fa);O.ULS.sendTraceTag(579203668,337,100,"UpdatePolicyLabelFromBox4 - End.");return 32};this.iun=(fa,pa)=>{fa=this.v2a(pa.i2e);k.Health.instance.recordKpiUsage(Ia.T4b,
1,Ia.EGd,fa);this.G9c=this.lq()};this.gun=(fa,pa)=>{this.Vhd||k.Health.instance.recordKpiUsage(Ia.T4b,1,Ia.EGd,this.v2a());fa=this.Fib(pa.i2e,this.G9c);fa.extendedProperties.set("ErrorType",m[pa.errorType]);k.Health.instance.recordKpiFailure(Ia.T4b,"Shared or Host SetPolicyLabel failure.",!1,!1,fa)};this.hun=(fa,pa)=>{this.Vhd||(k.Health.instance.recordKpiUsage(Ia.T4b,1,Ia.EGd,this.v2a()),this.G9c=this.lq());fa=F.App.za.jb.Zc;if(!this.Sdb){var oa=new L.GraphTransaction(0);try{oa.Db(fa),fa.Hba.Tma=
pa.e1f}finally{oa&&oa.dispose()}}ta.fhd=ta.W.resolve("WordEditor.AutoSaveParamsUpdateService");oa=new J.GraphIterator;oa.set(fa);if(ta.lA.IP(oa)){fa=oa.Ub(35);oa=ta.Hh.ry;var Aa=M.a.eeg,xa=l.AFrameworkApplication.K,Ka=null;Ka=xa.kb("EditDocInClientUrl");Ka||(O.ULS.sendTraceTag(523567771,337,50,"EditDocInClientUrl setting was empty. Falling back to WopiSrc"),Ka=xa.kb("WopiSrc"));Ka||O.ULS.sendTraceTag(523567772,337,10,"WopiSrc setting was empty.");var za=null;za=ta.POe?this.qMg.FHh(oa,pa,this.Sdb,
xa.kb("TenantId"),xa.kb("UserName"),xa.kb("UserPrincipalName"),Ka,ta.POe):this.qMg.FHh(oa,pa,this.Sdb,xa.kb("TenantId"),xa.kb("UserName"),xa.kb("UserPrincipalName"),Ka,ta.Stb);ta.fhd.yjj(fa,Aa,za,()=>{const ha=this.Fib(pa.lDa,this.G9c);k.Health.instance.recordKpiSuccess(Ia.T4b,ha)},(ha,Oa)=>{ha=this.Fib(pa.lDa,this.G9c);ha.extendedProperties.set("statusCode",U.a[Oa]);k.Health.instance.recordKpiFailure(Ia.T4b,"Word Save Failed",!1,!1,ha);O.ULS.sendTraceTag(592311969,337,10,"SetPolicyLabel Save failed with {0}.",
U.a[Oa])})}};this.DUn=()=>{this.Kch&&(ta.iMg=new qa(ta.W.resolve("Box4.AugmentationLoop.IAnnotationStorage"),ta.W.resolve("Common.App.Policy.Contracts.IPolicyActor"),ta.Hh),ta.iMg.initialize());this.Kch=!1};this.UId=(fa,pa)=>{const oa=Object.assign(new P.a,{parentPath:["session","doc","security"],items:[Object.assign(new Y.a,{id:"clp",body:Object.assign(new da.CLP,{existingLabelPriority:pa.existingLabelPriority,partialDocSITs:pa.NFh,fullDocSITs:pa.MFh})})]});K.a.ml().then(()=>{S.a.getAugLoopRuntimeManager().submitOperation(Object.assign(new ba.a,
{operation:oa}))})};this.ZTo=(fa,pa)=>{const oa=Object.assign(new Z.a,{parentPath:["session","doc","security"],items:[Object.assign(new Y.a,{id:"clp",body:Object.assign(new da.CLP,{existingLabelPriority:pa.existingLabelPriority})})]});K.a.ml().then(()=>{S.a.getAugLoopRuntimeManager().submitOperation(Object.assign(new ba.a,{operation:oa}))})};this.$To=(fa,pa)=>{const oa=Object.assign(new Z.a,{parentPath:["session","doc","security"],items:[Object.assign(new Y.a,{id:"clp",body:Object.assign(new da.CLP,
{partialDocSITs:pa.NFh,fullDocSITs:pa.MFh})})]});K.a.ml().then(()=>{S.a.getAugLoopRuntimeManager().submitOperation(Object.assign(new ba.a,{operation:oa}))})};this.gFk=(fa,pa)=>{pa&&pa.appMode?(fa=1===pa.appMode,l.AFrameworkApplication.va.Qb(fa?ia.a.Omc:ia.a.C8a,2,{IsFromMandatoryLabeling:!0}),fa||""===pa.cNi||ta.bba.hFk(pa.cNi),pa=fa?1:3,fa=l.AFrameworkApplication.va.mode,pa!==fa&&O.ULS.sendTraceTag(545818049,337,10,"ApplyMandatoryLabeling ModeSwitch Failed. Expected: {0}, Current: {1}",pa,fa)):O.ULS.sendTraceTag(572302786,
337,15,"ApplyMandatoryLabeling is called with invalid inputs.")};this.YQo=(fa,pa)=>{pa.eto&&l.AFrameworkApplication.va.Qb(G.a.openInClient,2,!1)};this.qMg=ra}get Sdb(){return l.AFrameworkApplication.K.$("SupportsOfficeClientCoauthoring")&&l.AFrameworkApplication.K.$("CoAuthForProtectedFilesIsEnabled")}get name(){return"WordEditor.Policy"}init(){ta.lA=R.PageNavigator.instance;this.Ib=t.a.instance;ta.Zb.nq.continueWith(()=>{this.wn()});this.jXg=l.AFrameworkApplication.K.mc("WordClpGetPolicyRetryCount",
10);this.kXg=l.AFrameworkApplication.K.mc("WordClpGetPolicyRetryTimeoutMs",3E4);this.tCe=l.AFrameworkApplication.K.$("WordClpGetPolicyUpdateLocal");this.Vhd=l.AFrameworkApplication.K.$("ClpKpiIsEnabled")}dispose(){}wc(ra){ta.W=ra;ta.W.ia("WordEditor.AutoSaveParamsUpdateService",()=>new la.a(ta.W.resolve("Box4.Graph.IGraphIteratorFactory"),wa.a.nR)).ha()}lq(){return(new Date).getTime()}wn(){ta.Zb.isFeatureEnabled(65)&&l.AFrameworkApplication.K.$("SupportsPolicies")&&z.a.get_instance().pk(10,this.Ckn)}v2a(ra=
null){const fa=new Map;fa.set("ClpCoauth",this.Sdb.toString());null!=ra&&fa.set("ApplyLabelFlags",v.a[ra]);return fa}hTd(){return F.App.za.jb.Zc.Hba}sFi(ra,fa){return(ra||"")===(fa||"")}Fib(ra,fa){const pa=new X.a;pa.extendedProperties=this.v2a(ra);null!=fa&&(pa.durationMs=this.lq()-fa);return pa}static get Zb(){return null!=ta.Zyg?ta.Zyg:ta.Zyg=ta.W.resolve("Box4.IFeatureHelper")}static main(){H.a.instance.Gc(new ta(new Sa))}}ta.W=null;ta.Hh=null;ta.bba=null;ta.fhd=null;ta.lA=null;ta.iMg=null;ta.Stb=
"";ta.Pxe="";ta.POe="";Object(E.a)(ta,"WordEditorPolicyPackage",null,[1,2])},1947:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);var l;(function(e){e[e.none=0]="none";e[e.reasonDefaultLabel=1]="reasonDefaultLabel";e[e.reasonManual=2]="reasonManual";e[e.reasonAutomatic=4]="reasonAutomatic";e[e.reasonRecommended=8]="reasonRecommended";e[e.reasonMandatory=16]="reasonMandatory"})(l||(l={}));Object(E.b)("ApplyLabelFlags",l)},1948:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);var l;(function(e){e[e.unknown=
0]="unknown";e[e.boot=1]="boot";e[e.refresh=2]="refresh";e[e.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(l||(l={}));Object(E.b)("GetPolicyLabelsReason",l)},1949:function(E,I,c){var l=this&&this.aB||(Object.create?function(a,k,x,y){void 0===y&&(y=x);Object.defineProperty(a,y,{enumerable:!0,get:function(){return k[x]}})}:function(a,k,x,y){void 0===y&&(y=x);a[y]=k[x]}),e=this&&this.__exportStar||function(a,k){for(var x in a)"default"===x||Object.prototype.hasOwnProperty.call(k,x)||l(k,a,x)};Object.defineProperty(I,
"__esModule",{value:!0});e(c(1950),I);e(c(1951),I)},1950:function(E,I){Object.defineProperty(I,"__esModule",{value:!0})},1951:function(E,I,c){Object.defineProperty(I,"__esModule",{value:!0});I.Security=I.DLP=I.CLP=I.SecurityShared=I.SeedAnnotation=I.EditAnnotation=I.SensitiveItemFullDocumentAnnotation=I.SensitiveItemRangeAnnotation=void 0;const l=c(257);class e{constructor(v){l.SchemaObject.assign(e,this,v)}get metadata(){return this.M_}set metadata(v){this.M_=v}static getTypeName(){return"AugLoop_SecurityShared_SensitiveItemRangeAnnotation"}static getBaseTypes(){return["AugLoop_Text_RangeAnnotation",
"AugLoop_Core_Annotation"]}}I.SensitiveItemRangeAnnotation=e;e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()};class a{constructor(v){l.SchemaObject.assign(a,this,v)}get metadata(){return this.M_}set metadata(v){this.M_=v}static getTypeName(){return"AugLoop_SecurityShared_SensitiveItemFullDocumentAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}I.SensitiveItemFullDocumentAnnotation=a;a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class k{constructor(v){l.SchemaObject.assign(k,this,
v)}get metadata(){return this.M_}set metadata(v){this.M_=v}static getTypeName(){return"AugLoop_SecurityShared_EditAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}I.EditAnnotation=k;k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};class x{constructor(v){l.SchemaObject.assign(x,this,v)}get metadata(){return this.M_}set metadata(v){this.M_=v}static getTypeName(){return"AugLoop_SecurityShared_SeedAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}I.SeedAnnotation=x;
x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};class y{constructor(v){l.SchemaObject.assign(y,this,v)}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static getBaseTypes(){return[]}}I.SecurityShared=y;y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class m{constructor(v){l.SchemaObject.assign(m,this,v)}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static getBaseTypes(){return["AugLoop_SecurityShared_SecurityShared"]}}I.CLP=m;m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};
class t{constructor(v){l.SchemaObject.assign(t,this,v)}static getTypeName(){return"AugLoop_SecurityShared_DLP"}static getBaseTypes(){return["AugLoop_SecurityShared_SecurityShared"]}}I.DLP=t;t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()};class z{constructor(v){l.SchemaObject.assign(z,this,v)}static getTypeName(){return"AugLoop_SecurityShared_Security"}static getBaseTypes(){return[]}}I.Security=z;z.H_={T_:z.getTypeName(),B_:z.getBaseTypes()}},2078:function(E,I,c){function l(){Type.registerNamespace("WordEditor.Policy");
Object(a.a)();k.a.main();e.ULS.sendTraceTag(508908063,306,50,"initializeOnDemandPackage has completed for WordEditor.Policy")}c.r(I);c.d(I,"initializeOnDemandPackage",function(){return l});var e=c(8),a=c(1733),k=c(1745)}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/20299002/wdjs/WordEditorDSReduceInitialBundle.policy.js.map