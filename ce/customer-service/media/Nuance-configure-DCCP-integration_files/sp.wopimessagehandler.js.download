function ULSudL(){var o=new Object;o.ULSTeamName="Microsoft SharePoint Foundation";o.ULSFileName="SP.WOPIMessageHandler.js";return o;}
Type.registerNamespace("SP.WOPIMessageHandler");SP.WOPIMessageHandler.LogLevel=function(){};SP.WOPIMessageHandler.LogLevel.prototype={verbose:0,info:1,warning:2,error:3};SP.WOPIMessageHandler.LogLevel.registerEnum("SP.WOPIMessageHandler.LogLevel",false);SP.WOPIMessageHandler.CrossDocumentMessage=function(a){ULSudL:;this.MessageId=a;this.SendTime=0;this.Values={}};SP.WOPIMessageHandler.AFrameworkApplication=function(){};SP.WOPIMessageHandler.WindowEventManager=function(){};SP.WOPIMessageHandler.WindowEventManager.prototype={addHandler:function(a,b){ULSudL:;var d=this;$addHandler(window.self,a,function(c){ULSudL:;var a=new SP.WOPIMessageHandler.WindowEventArgs;a.origin=c.rawEvent.origin;a.data=c.rawEvent.data;a.source=c.rawEvent.source;b(a)})},removeHandler:function(){}};SP.WOPIMessageHandler.WindowEventArgs=function(){ULSudL:;SP.WOPIMessageHandler.WindowEventArgs.initializeBase(this)};SP.WOPIMessageHandler.WindowEventArgs.prototype={origin:null,data:null,source:null};SP.WOPIMessageHandler.EventHandlerArgs=function(){};SP.WOPIMessageHandler.EventNames=function(){};SP.WOPIMessageHandler.BrowserUtils=function(){};SP.WOPIMessageHandler.BrowserUtils.get_isInternetExplorer8=function(){ULSudL:;return Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version===8};SP.WOPIMessageHandler.DomUtils=function(){};SP.WOPIMessageHandler.DomUtils.isFieldNullOrUndefined=function(b,a){ULSudL:;return SP.ScriptUtility.isNullOrUndefined(b[a])};SP.WOPIMessageHandler.ScriptUtils=function(){};SP.WOPIMessageHandler.ScriptUtils.isNullOrUndefined=function(a){ULSudL:;return SP.ScriptUtility.isNullOrUndefined(a)};SP.WOPIMessageHandler.UrlUtils=function(){};SP.WOPIMessageHandler.UrlUtils.getOrigin=function(a){ULSudL:;var b="",c=a.indexOf("://");if(c>0){var d=a.indexOf("/",c+3);if(d>0)b=a.substring(0,d);else b=a}return b};SP.WOPIMessageHandler.Debug=function(){};SP.WOPIMessageHandler.Debug.log=function(c){ULSudL:;for(var b=[],a=3;a<arguments.length;++a)b[a-3]=arguments[a];if(b.length>0)c=String.format.apply(null,[c].concat(b))};SP.WOPIMessageHandler.Debug.assert=function(){};SP.WOPIMessageHandler.Debug.assertStringTag=function(){};SP.WOPIMessageHandler.ADebugOptionsTab=function(){};SP.WOPIMessageHandler.ADebugOptionsTab.getOptionValue=function(){ULSudL:;return false};SP.WOPIMessageHandler.LogCategory=function(){};SP.WOPIMessageHandler.WOPIMessageHandler=function(){};SP.WOPIMessageHandler.WOPIMessageHandler.initialize=function(e,a,d,f,b,i,j){ULSudL:;try{ReadyToUploadLogs()}catch(p){}if(!a||!a.length)throw Error.argumentNull("wopiServerUrl");SP.WOPIMessageHandler.AFrameworkApplication.theWindowEventManager=new SP.WOPIMessageHandler.WindowEventManager;var h=$get("WebApplicationFrame");if(!h)if(window.location.href.toLowerCase().indexOf("doc.aspx")===-1)throw Error.invalidOperation();else return;SP.WOPIMessageHandler.WOPIMessageHandler.$C=a;SP.WOPIMessageHandler.WOPIMessageHandler.$0=new SP.WOPIMessageHandler.CrossDocumentMessenger(h.contentWindow,a);SP.WOPIMessageHandler.WOPIMessageHandler.$0.enable();if(b&&b.length>0)for(var m=b.split(";"),g=m,k=g.length,c=0;c<k;++c){var n=g[c];SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedOrigin(n)}else{SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedOrigin(a);SP.DebugLogger.Write("WOPIAllowOrigin",1,"WOPIMessageHandler allowedOrigins is empty for wopiServerUrl:"+a)}SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("App_LoadingStatus");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("App_LoadingStatus",SP.WOPIMessageHandler.WOPIMessageHandler.$Y);SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("File_Rename");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("File_Rename",SP.WOPIMessageHandler.WOPIMessageHandler.$c);SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("App_PushState");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("App_PushState",SP.WOPIMessageHandler.WOPIMessageHandler.$Z);SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("App_IsFrameTrusted");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("App_IsFrameTrusted",SP.WOPIMessageHandler.WOPIMessageHandler.$X);$addHandler(window.self,"popstate",SP.WOPIMessageHandler.WOPIMessageHandler.$S);SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("GetAccessToken");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("GetAccessToken",SP.WOPIMessageHandler.WOPIMessageHandler.$e);SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: register message handler for GetAccessToken.");SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("GetAccessTokenFirstParty");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("GetAccessTokenFirstParty",SP.WOPIMessageHandler.WOPIMessageHandler.$d);SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: register message handler for GetAccessTokenFirstParty.");SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("GetPrimaryIdentityInfo");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("GetPrimaryIdentityInfo",SP.WOPIMessageHandler.WOPIMessageHandler.$f);SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: register message handler for GetPrimaryIdentityInfo.");SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("App_RefreshSessionInfo");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("App_RefreshSessionInfo",SP.WOPIMessageHandler.WOPIMessageHandler.$a);SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: register message handler for AppRefreshSessionInfo.");if(!i){var o=window.self.WOPIPerf_EditNew?true:false;if(!o){if(!e||!e.length)throw Error.argumentNull("webUrl");if(!d||!d.length)throw Error.argumentNull("listID");if(f<0)throw Error.argumentOutOfRange("listItemID");}SP.WOPIMessageHandler.WOPIMessageHandler.$A=e;SP.WOPIMessageHandler.WOPIMessageHandler.$4=d;SP.WOPIMessageHandler.WOPIMessageHandler.$1=f;SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedReceivingMessage("UI_Sharing");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("UI_Sharing",SP.WOPIMessageHandler.WOPIMessageHandler.$g)}SP.WOPIMessageHandler.WOPIMessageHandler.$0.addAllowedFreeReceivingMessage("UI_CheckUserAccessAndGrantPermissions");SP.WOPIMessageHandler.WOPIMessageHandler.$0.registerCallback("UI_CheckUserAccessAndGrantPermissions",SP.WOPIMessageHandler.WOPIMessageHandler.$b);SP.WOPIMessageHandler.WOPIMessageHandler.$J=j;var l=new SP.WOPIMessageHandler.CrossDocumentMessage("Host_PostmessageReady");SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(l);EnsureScriptFunc("singlesignon.js","SingleSignOn",null)};SP.WOPIMessageHandler.WOPIMessageHandler.$g=function(a){ULSudL:;if(!a){SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: UI_Sharing message is null.");return}if(a.MessageId==="UI_Sharing"){var b=a.Values.ShareCorrelation,c=a.Values.nav,d=a.Values.mode;SP.WOPIMessageHandler.WOPIMessageHandler.$Q(b,c,d)}};SP.WOPIMessageHandler.WOPIMessageHandler.$b=function(a){ULSudL:;if(a.MessageId==="UI_CheckUserAccessAndGrantPermissions"){if(SP.WOPIMessageHandler.WOPIMessageHandler.$1<0){SP.WOPIMessageHandler.WOPIMessageHandler.$1=window.self.ListItemID;var b=window.self.ListGuid;SP.WOPIMessageHandler.WOPIMessageHandler.$4=b?b.toString():""}EnsureScriptFunc("sharingmodern.js","ShowShareV3",function(){ULSudL:;window.self.ShowShareV3(SP.WOPIMessageHandler.WOPIMessageHandler.$A,SP.WOPIMessageHandler.WOPIMessageHandler.$4,SP.WOPIMessageHandler.WOPIMessageHandler.$1.toString(),true,true,a.Values.Id,a.Values.Persons,a.Values.UserPermissionsVerified,SP.WOPIMessageHandler.WOPIMessageHandler.$C)})}};SP.WOPIMessageHandler.WOPIMessageHandler.$Q=function(b,c,d){ULSudL:;if(SP.WOPIMessageHandler.WOPIMessageHandler.$1<0){SP.WOPIMessageHandler.WOPIMessageHandler.$1=window.self.ListItemID;var a=window.self.ListGuid;SP.WOPIMessageHandler.WOPIMessageHandler.$4=a?a.toString():""}if(Flighting.VariantConfiguration.IsExpFeatureClientEnabled(884)&&Flighting.VariantConfiguration.IsExpFeatureClientEnabled(760))EnsureScriptFunc("sharingmodern.js","ShowShareV3",function(){ULSudL:;window.self.ShowShareV3(SP.WOPIMessageHandler.WOPIMessageHandler.$A,SP.WOPIMessageHandler.WOPIMessageHandler.$4,SP.WOPIMessageHandler.WOPIMessageHandler.$1.toString(),true,null,null,null,null,SP.WOPIMessageHandler.WOPIMessageHandler.$C,b,c,d)});else EnsureScriptFunc("sharing.js","DisplayUnthemedSharingDialog",function(){ULSudL:;window.self.DisplayUnthemedSharingDialog(SP.WOPIMessageHandler.WOPIMessageHandler.$A,SP.WOPIMessageHandler.WOPIMessageHandler.$4,SP.WOPIMessageHandler.WOPIMessageHandler.$1.toString())})};SP.WOPIMessageHandler.WOPIMessageHandler.$Y=function(k){ULSudL:;SetWOPIDocLoaded();var b=new SP.WOPIMessageHandler.CrossDocumentMessage("Host_PerfTiming"),e=window.self.WOPIPerf_UserClick,l=window.self.WOPIPerf_StartTag;if(!SP.WOPIMessageHandler.ScriptUtils.isNullOrUndefined(e))b.Values.Click=e;!SP.WOPIMessageHandler.ScriptUtils.isNullOrUndefined(l)&&(window.location.href.toLowerCase().indexOf("wopiframe.aspx")!==-1||window.location.href.toLowerCase().indexOf("wopiframe2.aspx")!==-1)&&SP.QoS.WriteSuccess("WopiOpen_Success");var c=null,f=null,d=-1,g=window.self.performance;if(!SP.ScriptHelpers.isNullOrUndefined(g)){var i=g.timing;if(!SP.ScriptHelpers.isNullOrUndefined(i)){c=i.fetchStart;if(!SP.ScriptHelpers.isNullOrUndefined(c))b.Values.FetchStart=c;f=i.responseEnd}var j=g.navigation;if(!SP.ScriptHelpers.isNullOrUndefined(j)){d=j.redirectCount;if(!SP.ScriptHelpers.isNullOrUndefined(d))b.Values.RedirectCount=d}}var h=window.self.WOPIPerf_WACIframeCreate;if(!SP.WOPIMessageHandler.ScriptUtils.isNullOrUndefined(h))b.Values.Iframe=h;var m=k.Values.m_Source,n=k.Values.m_Origin;SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(b,m,n);var a="UserClick: "+SP.WOPIMessageHandler.WOPIMessageHandler.$D(e);a+=", DeltaFetchStart: "+SP.WOPIMessageHandler.WOPIMessageHandler.$N(c);a+=", DeltaResponseEnd: "+SP.WOPIMessageHandler.WOPIMessageHandler.$N(f);a+=", DeltaIframeCreate: "+SP.WOPIMessageHandler.WOPIMessageHandler.$D(h);a+=", RedirectCount: "+d;a+=", WopiAction: "+SP.WOPIMessageHandler.WOPIMessageHandler.$J;var o=window.self.WOPIPerf_WACTarget;a+=", WacTarget: "+o;SP.DebugLogger.Write("WOPIHostTelemetry",1,a);UploadFileXferTelemetry("WACDownload",SP.WOPIMessageHandler.WOPIMessageHandler.$D(c),SP.WOPIMessageHandler.WOPIMessageHandler.$D(f),0)};SP.WOPIMessageHandler.WOPIMessageHandler.$e=function(a){ULSudL:;if(!a)SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: GetAccessToken message is null.");else if(a.MessageId!=="GetAccessToken")SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: MessageId for ReceiveGetAccessTokenMessage method is not CrossDocumentMessageId.GetAccessToken.");else EnsureScriptFunc("singlesignon.js","GetAccessTokenForAddin",function(){ULSudL:;var b=a.Values.AddinApplicationResource,c=a.Values.AddinSSOAuthChallenge,d=a.Values.AddinIsFirstParty;window.self.GetAccessTokenForAddin(b,c,function(c,d){ULSudL:;var b=new SP.WOPIMessageHandler.CrossDocumentMessage("PostAccessToken");b.Values.AccessToken=d;b.Values.AddinSSOError=c;b.Values.AddinControlId=a.Values.AddinControlId;b.Values.HostApplicationType="SharepointOnline";var e=a.Values.m_Source,f=a.Values.m_Origin;SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(b,e,f)},d)})};SP.WOPIMessageHandler.WOPIMessageHandler.$d=function(a){ULSudL:;if(!a)SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler::ReceiveGetAccessTokenMessageFirstPart: Message is null.");else if(a.MessageId!=="GetAccessToken")SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler::ReceiveGetAccessTokenMessageFirstPart: Message method is not GetAccessTokenFirstParty.");else EnsureScriptFunc("singlesignon.js","GetAccessTokenForAddin",function(){ULSudL:;var b=a.Values.SsoResource,c=a.Values.SsoAuthChallenge,d=a.Values.SsoScope;window.self.GetAccessTokenForAddin(b,c,function(c,d){ULSudL:;var b=new SP.WOPIMessageHandler.CrossDocumentMessage("PostAccessTokenFirstParty");b.Values.SsoAccessToken=d;b.Values.SsoError=c;b.Values.SsoRequestId=a.Values.SsoRequestId;b.Values.HostApplicationType="SharePointOnline";var e=a.Values.m_Source,f=a.Values.m_Origin;SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(b,e,f)},true,d)})};SP.WOPIMessageHandler.WOPIMessageHandler.$f=function(a){ULSudL:;if(!a)SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: GetPrimaryIdentityInfo message is null.");else if(a.MessageId!=="GetPrimaryIdentityInfo")SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: MessageId for GetPrimaryIdentityInfo method is not CrossDocumentMessageId.GetPrimaryIdentityInfo.");else EnsureScriptFunc("singlesignon.js","GetPrimaryIdentityInfoForAddin",function(){ULSudL:;window.self.GetPrimaryIdentityInfoForAddin(function(g,d){ULSudL:;var c=Sys.Serialization.JavaScriptSerializer.deserialize(d),b=new SP.WOPIMessageHandler.CrossDocumentMessage("PostPrimaryIdentityInfo");b.Values.UserName=c.UserName;b.Values.UserEmail=c.UserEmail;b.Values.HostApplicationType=c.HostApplicationType;b.Values.FederationProvider=c.FederationProvider;b.Values.AddinControlId=a.Values.AddinControlId;var e=a.Values.m_Source,f=a.Values.m_Origin;SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(b,e,f)})})};SP.WOPIMessageHandler.WOPIMessageHandler.$Z=function(a){ULSudL:;if(!a){SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: AppPushState message is null.");return}var b=a.Values.Url,c=a.Values.State,d=window.history;d.pushState(c,document.title,b);if(!SP.WOPIMessageHandler.WOPIMessageHandler.$I){SP.WOPIMessageHandler.WOPIMessageHandler.$L=a.Values.m_Source;SP.WOPIMessageHandler.WOPIMessageHandler.$I=a.Values.m_Origin}};SP.WOPIMessageHandler.WOPIMessageHandler.$a=function(a){ULSudL:;if(!a){SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler::ReceiveAppRefreshSessionMessage: Message is null.");SP.QoS.WriteFailure("RefreshAccessToken_NullMessage")}else if(a.MessageId!=="App_RefreshSessionInfo"){SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler::ReceiveAppRefreshSessionMessage: Message id is not AppRefreshSessionInfo.");SP.QoS.WriteFailure("RefreshAccessToken_InvalidMessageId")}else{if(SP.WOPIMessageHandler.WOPIMessageHandler.$1<0){SP.WOPIMessageHandler.WOPIMessageHandler.$1=window.self.ListItemID;var c=window.self.ListGuid;SP.WOPIMessageHandler.WOPIMessageHandler.$4=c?c.toString():""}var b=a.Values.Tokens;if(!SP.ScriptHelpers.isNullOrUndefined(b))EnsureScriptFunc("singlesignon.js","RefreshToken",function(){ULSudL:;window.self.RefreshToken(SP.WOPIMessageHandler.WOPIMessageHandler.$A,SP.WOPIMessageHandler.WOPIMessageHandler.$4,SP.WOPIMessageHandler.WOPIMessageHandler.$1,b,SP.WOPIMessageHandler.WOPIMessageHandler.$C)});else{SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler::ReceiveAppRefreshSessionMessage: Message does not have Tokens field ");SP.QoS.WriteFailure("RefreshAccessToken_MissingTokensField")}}};SP.WOPIMessageHandler.WOPIMessageHandler.$S=function(f){ULSudL:;var d=f.rawEvent,b=d.state,c=b.reason;if(c&&c==="SPRedirect"){SP.DebugLogger.Write("WOPIHostTelemetry",1,"WOPIMessageHandler: DOM statepop event gives empty state object.");var e=window.history;e.back();return}var a=new SP.WOPIMessageHandler.CrossDocumentMessage("App_PopState");a.Values.Url=window.location.href;a.Values.State=b;SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(a,SP.WOPIMessageHandler.WOPIMessageHandler.$L,SP.WOPIMessageHandler.WOPIMessageHandler.$I)};SP.WOPIMessageHandler.WOPIMessageHandler.$N=function(b){ULSudL:;var a=SP.WOPIMessageHandler.WOPIMessageHandler.$D(b);return a===-1?"<none>":a.toString()};SP.WOPIMessageHandler.WOPIMessageHandler.$D=function(b){ULSudL:;if(SP.ScriptHelpers.isNullOrUndefined(b))return-1;var a=b;if(SP.WOPIMessageHandler.WOPIMessageHandler.$H===-1)SP.WOPIMessageHandler.WOPIMessageHandler.$H=a;var c=a-SP.WOPIMessageHandler.WOPIMessageHandler.$H;return c};SP.WOPIMessageHandler.WOPIMessageHandler.$c=function(a){ULSudL:;if(a.MessageId==="File_Rename"){var b=a.Values.NewName;window.document.title=b}};SP.WOPIMessageHandler.WOPIMessageHandler.$X=function(c){ULSudL:;var a=false;try{var f=window.self.origin,g=window.top.origin;a=window.self===window.top||window.parent===window.top&&f===g}catch(h){a=false}var b=new SP.WOPIMessageHandler.CrossDocumentMessage("Host_IsFrameTrusted");b.Values.isTopFrameTrusted=a;var d=c.Values.m_Source,e=c.Values.m_Origin;SP.WOPIMessageHandler.WOPIMessageHandler.$0.send(b,d,e)};SP.WOPIMessageHandler.CrossDocumentMessageId=function(){};SP.WOPIMessageHandler.CrossDocumentMessageFields=function(){};SP.WOPIMessageHandler.CrossDocumentMessenger=function(b,a){ULSudL:;this.$$d_$W_0=Function.createDelegate(this,this.$W_0);this.$6_0=false;this.$5_0=null;this.$8_0=null;this.$3_0=null;this.$7_0=null;this.$B_0=b;this.$F_0=a;this.$9_0=false;this.$2_0=null;SP.WOPIMessageHandler.CrossDocumentMessenger.$M++};SP.WOPIMessageHandler.CrossDocumentMessenger.$P=function(){ULSudL:;return true};SP.WOPIMessageHandler.CrossDocumentMessenger.$O=function(){ULSudL:;return true};SP.WOPIMessageHandler.CrossDocumentMessenger.isPostMessageSupported=function(a){ULSudL:;return SP.WOPIMessageHandler.ScriptUtils.isNullOrUndefined(a)?!SP.WOPIMessageHandler.DomUtils.isFieldNullOrUndefined(window,"postMessage"):!SP.WOPIMessageHandler.DomUtils.isFieldNullOrUndefined(a,"postMessage")};SP.WOPIMessageHandler.CrossDocumentMessenger.sendMessageToElement=function(b,c,d){ULSudL:;var a=b;if(a&&!SP.WOPIMessageHandler.CrossDocumentMessenger.isPostMessageSupported(a))a=a.contentWindow;SP.WOPIMessageHandler.CrossDocumentMessenger.sendMessage(a,c,d)};SP.WOPIMessageHandler.CrossDocumentMessenger.sendMessage=function(b,c,d){ULSudL:;if(SP.WOPIMessageHandler.AFrameworkApplication.isCrossDocumentMessengerDisabled){SP.WOPIMessageHandler.Debug.assertStringTag(false,"Cross-document message is disabled by config setting.",840289);return false}var a=b;if(!a||!SP.WOPIMessageHandler.CrossDocumentMessenger.isPostMessageSupported(a)){SP.WOPIMessageHandler.Debug.assertStringTag(false,"Browser does not support postMessage",840290);throw Error.create("Browser does not support postMessage");}try{a.postMessage(c,d);return true}catch(e){SP.WOPIMessageHandler.Debug.assertStringTag(false,"postMessage failed: "+e.message,840291)}SP.WOPIMessageHandler.Debug.log("After post message failed: ","CrossDocumentMessenger",0);return false};SP.WOPIMessageHandler.CrossDocumentMessenger.prototype={$6_0:false,_name:"",$5_0:null,$8_0:null,$3_0:null,$7_0:null,$B_0:null,$F_0:null,$E_0:null,$9_0:false,$2_0:null,setName:function(a){ULSudL:;this._name=a},logMessenger:function(d,c,e){ULSudL:;for(var b=[],a=3;a<arguments.length;++a)b[a-3]=arguments[a];SP.WOPIMessageHandler.Debug.log.apply(null,[this._name+": "+d,c,e].concat(b))},enable:function(){ULSudL:;if(SP.WOPIMessageHandler.AFrameworkApplication.isCrossDocumentMessengerDisabled)return false;!SP.WOPIMessageHandler.AFrameworkApplication.theWindowEventManager;if(this.$6_0)return true;if(!SP.WOPIMessageHandler.CrossDocumentMessenger.isPostMessageSupported()){this.$G_0();return false}if(!this.$U_0()){this.$G_0();return false}if(!this.$T_0()){this.$G_0();return false}this.$5_0=[];this.$8_0=[];this.$3_0=[];this.$7_0=[];this.createReceivingAllowList();this.createFreeSendingAllowList();this.$6_0=true;return true},isEnabled:function(){ULSudL:;return this.$6_0},$U_0:function(){ULSudL:;return SP.WOPIMessageHandler.AFrameworkApplication.isCrossDocumentMessengerDisabled?false:true},$T_0:function(){ULSudL:;if(SP.WOPIMessageHandler.AFrameworkApplication.isCrossDocumentMessengerDisabled)return false;if(!this.$9_0){this.$E_0=this.$$d_$W_0;SP.WOPIMessageHandler.AFrameworkApplication.theWindowEventManager.addHandler("message",this.$E_0,null);this.$9_0=true;this.$2_0={}}return true},$G_0:function(){ULSudL:;this.$6_0=false;this.$5_0=null;this.$3_0=null;this.$7_0=null;this.$B_0=null;this.$F_0="";if(this.$9_0){SP.WOPIMessageHandler.AFrameworkApplication.theWindowEventManager.removeHandler("message",this.$E_0);this.$9_0=false;this.$2_0=null}},dispose:function(){ULSudL:;this.$G_0()},createReceivingAllowList:function(){},createReceivingAllowListDebug:function(){ULSudL:;SP.WOPIMessageHandler.Debug.assert(!!this.$5_0)},createFreeSendingAllowList:function(){},createFreeSendingAllowListDebug:function(){ULSudL:;SP.WOPIMessageHandler.Debug.assert(!!this.$3_0)},isMessageReceivingAllowed:function(a){ULSudL:;return!!this.$5_0&&Array.contains(this.$5_0,a)||this.isMessageFreeReceivingAllowed(a)},isMessageFreeReceivingAllowed:function(a){ULSudL:;return!!this.$8_0&&Array.contains(this.$8_0,a)},addAllowedReceivingMessage:function(a){ULSudL:;SP.WOPIMessageHandler.Debug.assertStringTag(!!this.$5_0,"Origin allow list should not be null",840284);Array.add(this.$5_0,a);return true},addAllowedFreeReceivingMessage:function(a){ULSudL:;SP.WOPIMessageHandler.Debug.assertStringTag(!!this.$8_0,"Origin free allow list should not be null",1323648);Array.add(this.$8_0,a);return true},isMessageFreeSendingAllowed:function(a){ULSudL:;return!!this.$3_0&&Array.contains(this.$3_0,a)},addAllowedFreeSendingMessage:function(a){ULSudL:;SP.WOPIMessageHandler.Debug.assertStringTag(!!this.$3_0,"Origin allow list should not be null",840285);Array.add(this.$3_0,a);return true},isOriginAllowed:function(b){ULSudL:;var a=SP.WOPIMessageHandler.UrlUtils.getOrigin(b);return!a?false:!!this.$7_0&&Array.contains(this.$7_0,a)},addAllowedOrigin:function(a){ULSudL:;if(!this.isEnabled())return false;SP.WOPIMessageHandler.Debug.assertStringTag(!!this.$7_0,"Origin allow list should not be null",840286);if(a==="*")return false;var b=SP.WOPIMessageHandler.UrlUtils.getOrigin(a);if(!b)return false;Array.add(this.$7_0,b);return true},send:function(a,d,c){ULSudL:;if(!this.$6_0)return false;if(!a)return false;var e=!d?this.$B_0:d;if(!e)return false;var b=!c?this.$F_0:c;if(!b)return false;if(SP.WOPIMessageHandler.CrossDocumentMessenger.$O()&&b==="*"&&!this.isMessageFreeSendingAllowed(a.MessageId))return false;var h=new Date;a.SendTime=h.getTime();var f="";try{f=Sys.Serialization.JavaScriptSerializer.serialize(a)}catch(i){return false}var g=SP.WOPIMessageHandler.CrossDocumentMessenger.sendMessage(e,f,b);g;return g},registerCallback:function(a,b){ULSudL:;if(!this.$6_0)return false;if(!b)return false;if(SP.WOPIMessageHandler.CrossDocumentMessenger.$P()&&!this.isMessageReceivingAllowed(a)){SP.WOPIMessageHandler.Debug.assertStringTag(false,a+" is not allowed to receive.",840287);return false}SP.WOPIMessageHandler.Debug.assert(this.$9_0);SP.WOPIMessageHandler.Debug.assert(!!this.$2_0);if(this.$2_0[a]!==b){if(this.$2_0[a]){SP.WOPIMessageHandler.Debug.assertStringTag(false,"Callback for message "+a+" has been registered. CrossDocument messenger does not allow multiple receiving callbacks.",840288);return false}this.$2_0[a]=b}return true},$W_0:function(c){ULSudL:;var a=this.$R_0(c);if(!a){SP.WOPIMessageHandler.Debug.log("Unexpected post message","CrossDocumentMessenger",0);return false}if(this.$2_0[a.MessageId]){var b=this.$2_0[a.MessageId];b(a)}return false},$R_0:function(a){ULSudL:;var c=new Date;if(!a.origin||!a.source||!a.data)return null;var b=this.$V_0(a.data);if(!b)return null;if(SP.WOPIMessageHandler.CrossDocumentMessenger.$O()&&!this.isOriginAllowed(a.origin)){if(!this.isMessageFreeReceivingAllowed(b.MessageId))return null;if(!SP.WOPIMessageHandler.BrowserUtils.get_isInternetExplorer8()&&a.source!==this.$B_0)return null}SP.WOPIMessageHandler.Debug.assert(!!b.Values);b.Values.m_Source=a.source;b.Values.m_Origin=a.origin;b.Values.m_ReceivedTime=c.getTime();return b},$V_0:function(e){ULSudL:;if(!e)return null;var a=null;try{a=Sys.Serialization.JavaScriptSerializer.deserialize(e,true)}catch(h){return null}if(!a)return null;for(var c=0;c<SP.WOPIMessageHandler.CrossDocumentMessenger.$K.length;c++)if(SP.WOPIMessageHandler.DomUtils.isFieldNullOrUndefined(a,SP.WOPIMessageHandler.CrossDocumentMessenger.$K[c]))return null;if(a.Values)try{a.Values}catch(i){return null}if(SP.WOPIMessageHandler.CrossDocumentMessenger.$P()&&!this.isMessageReceivingAllowed(a.MessageId))return null;if(a.SendTime<0)return null;var d=new Date;if(a.SendTime>d.getTime())return null;var f=6e4,g=new Date(d.getTime()-f);if(a.SendTime<g.getTime())return null;var b=new SP.WOPIMessageHandler.CrossDocumentMessage;b.MessageId=a.MessageId;b.SendTime=a.SendTime;if(a.Values)b.Values=a.Values;return b}};SP.WOPIMessageHandler.CrossDocumentMessage.registerClass("SP.WOPIMessageHandler.CrossDocumentMessage");SP.WOPIMessageHandler.AFrameworkApplication.registerClass("SP.WOPIMessageHandler.AFrameworkApplication");SP.WOPIMessageHandler.WindowEventManager.registerClass("SP.WOPIMessageHandler.WindowEventManager");SP.WOPIMessageHandler.EventHandlerArgs.registerClass("SP.WOPIMessageHandler.EventHandlerArgs");SP.WOPIMessageHandler.WindowEventArgs.registerClass("SP.WOPIMessageHandler.WindowEventArgs",SP.WOPIMessageHandler.EventHandlerArgs);SP.WOPIMessageHandler.EventNames.registerClass("SP.WOPIMessageHandler.EventNames");SP.WOPIMessageHandler.BrowserUtils.registerClass("SP.WOPIMessageHandler.BrowserUtils");SP.WOPIMessageHandler.DomUtils.registerClass("SP.WOPIMessageHandler.DomUtils");SP.WOPIMessageHandler.ScriptUtils.registerClass("SP.WOPIMessageHandler.ScriptUtils");SP.WOPIMessageHandler.UrlUtils.registerClass("SP.WOPIMessageHandler.UrlUtils");SP.WOPIMessageHandler.Debug.registerClass("SP.WOPIMessageHandler.Debug");SP.WOPIMessageHandler.ADebugOptionsTab.registerClass("SP.WOPIMessageHandler.ADebugOptionsTab");SP.WOPIMessageHandler.LogCategory.registerClass("SP.WOPIMessageHandler.LogCategory");SP.WOPIMessageHandler.WOPIMessageHandler.registerClass("SP.WOPIMessageHandler.WOPIMessageHandler");SP.WOPIMessageHandler.CrossDocumentMessageId.registerClass("SP.WOPIMessageHandler.CrossDocumentMessageId");SP.WOPIMessageHandler.CrossDocumentMessageFields.registerClass("SP.WOPIMessageHandler.CrossDocumentMessageFields");SP.WOPIMessageHandler.CrossDocumentMessenger.registerClass("SP.WOPIMessageHandler.CrossDocumentMessenger",null,Sys.IDisposable);function sp_wopimessagehandler_initialize(){ULSudL:;SP.WOPIMessageHandler.AFrameworkApplication.isCrossDocumentMessengerDisabled=false;SP.WOPIMessageHandler.AFrameworkApplication.theWindowEventManager=null;SP.WOPIMessageHandler.EventNames.message="message";SP.WOPIMessageHandler.LogCategory.crossDocumentMessenger="CrossDocumentMessenger";SP.WOPIMessageHandler.WOPIMessageHandler.$0=null;SP.WOPIMessageHandler.WOPIMessageHandler.$A=null;SP.WOPIMessageHandler.WOPIMessageHandler.$4=null;SP.WOPIMessageHandler.WOPIMessageHandler.$1=0;SP.WOPIMessageHandler.WOPIMessageHandler.$J=null;SP.WOPIMessageHandler.WOPIMessageHandler.$C=null;SP.WOPIMessageHandler.WOPIMessageHandler.$I=null;SP.WOPIMessageHandler.WOPIMessageHandler.$L=null;SP.WOPIMessageHandler.WOPIMessageHandler.$H=-1;SP.WOPIMessageHandler.CrossDocumentMessageId.close="UI_Close";SP.WOPIMessageHandler.CrossDocumentMessageId.fileProperties="UI_FileProperties";SP.WOPIMessageHandler.CrossDocumentMessageId.sharing="UI_Sharing";SP.WOPIMessageHandler.CrossDocumentMessageId.fileEmbed="UI_FileEmbed";SP.WOPIMessageHandler.CrossDocumentMessageId.copyAndEdit="UI_CopyAndEdit";SP.WOPIMessageHandler.CrossDocumentMessageId.replyWithChanges="UI_ReplyWithChanges";SP.WOPIMessageHandler.CrossDocumentMessageId.fileVersions="UI_FileVersions";SP.WOPIMessageHandler.CrossDocumentMessageId.fileClose="UI_Close";SP.WOPIMessageHandler.CrossDocumentMessageId.openInClient="UI_OpenInClient";SP.WOPIMessageHandler.CrossDocumentMessageId.signIn="UI_SignIn";SP.WOPIMessageHandler.CrossDocumentMessageId.redeemForCommenting="UI_RedeemForCommenting";SP.WOPIMessageHandler.CrossDocumentMessageId.atMention="UI_CheckUserAccessAndGrantPermissions";SP.WOPIMessageHandler.CrossDocumentMessageId.toggleYammerPanel="UI_ToggleYammerPanel";SP.WOPIMessageHandler.CrossDocumentMessageId.blurFocus="BlurFocus";SP.WOPIMessageHandler.CrossDocumentMessageId.grabFocus="GrabFocus";SP.WOPIMessageHandler.CrossDocumentMessageId.shareForm="UI_ShareForm";SP.WOPIMessageHandler.CrossDocumentMessageId.reportAbuse="UI_ReportAbuse";SP.WOPIMessageHandler.CrossDocumentMessageId.fileRename="File_Rename";SP.WOPIMessageHandler.CrossDocumentMessageId.canEmbed="CanEmbed";SP.WOPIMessageHandler.CrossDocumentMessageId.queryLoadingStatus="QueryLoadingStatus";SP.WOPIMessageHandler.CrossDocumentMessageId.appLoadingStatus="App_LoadingStatus";SP.WOPIMessageHandler.CrossDocumentMessageId.appTempError="App_TempError";SP.WOPIMessageHandler.CrossDocumentMessageId.appAllOK="App_AllOK";SP.WOPIMessageHandler.CrossDocumentMessageId.appFatalError=" App_FatalError";SP.WOPIMessageHandler.CrossDocumentMessageId.appNavigated="App_Navigated";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastGlobalId="Broadcast_GlobalId";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastInSync="Broadcast_InSync";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastLinkedNotesInfo="Broadcast_LinkedNotesInfo";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastNavigateToPage="Broadcast_NavigateToPage";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastOpenInClient="Broadcast_OpenInClient";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastOutOfSync="Broadcast_OutOfSync";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastError="Broadcast_Error";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastInitialized="Broadcast_Initialized";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastLocationChanged="Broadcast_LocationChanged";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastMediaState="Broadcast_MediaState";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastNavigate="Broadcast_Navigate";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastResize="Broadcast_Resize";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastSetOptions="Broadcast_SetOptions";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastState="Broadcast_State";SP.WOPIMessageHandler.CrossDocumentMessageId.broadcastSyncToPresenter="Broadcast_SyncToPresenter";SP.WOPIMessageHandler.CrossDocumentMessageId.checkPolicy="CheckPolicy";SP.WOPIMessageHandler.CrossDocumentMessageId.checkPolicyResponse="CheckPolicyResponse";SP.WOPIMessageHandler.CrossDocumentMessageId.hostPerfTiming="Host_PerfTiming";SP.WOPIMessageHandler.CrossDocumentMessageId.getAccessToken="GetAccessToken";SP.WOPIMessageHandler.CrossDocumentMessageId.postAccessToken="PostAccessToken";SP.WOPIMessageHandler.CrossDocumentMessageId.getAccessTokenFirstParty="GetAccessTokenFirstParty";SP.WOPIMessageHandler.CrossDocumentMessageId.postAccessTokenFirstParty="PostAccessTokenFirstParty";SP.WOPIMessageHandler.CrossDocumentMessageId.getPrimaryIdentityInfo="GetPrimaryIdentityInfo";SP.WOPIMessageHandler.CrossDocumentMessageId.postPrimaryIdentityInfo="PostPrimaryIdentityInfo";SP.WOPIMessageHandler.CrossDocumentMessageId.appPushState="App_PushState";SP.WOPIMessageHandler.CrossDocumentMessageId.appPopState="App_PopState";SP.WOPIMessageHandler.CrossDocumentMessageId.appRefreshSessionInfo="App_RefreshSessionInfo";SP.WOPIMessageHandler.CrossDocumentMessageId.appIsFrameTrusted="App_IsFrameTrusted";SP.WOPIMessageHandler.CrossDocumentMessageId.hostIsFrameTrusted="Host_IsFrameTrusted";SP.WOPIMessageHandler.CrossDocumentMessageFields.hostPerfTiming_Click="Click";SP.WOPIMessageHandler.CrossDocumentMessageFields.hostPerfTiming_FetchStart="FetchStart";SP.WOPIMessageHandler.CrossDocumentMessageFields.hostPerfTiming_Iframe="Iframe";SP.WOPIMessageHandler.CrossDocumentMessageFields.hostPerfTiming_RedirectCount="RedirectCount";SP.WOPIMessageHandler.CrossDocumentMessageFields.appLoadingStatus_DocumentLoadedTime="DocumentLoadedTime";SP.WOPIMessageHandler.CrossDocumentMessageFields.surveyTitle="SurveyTitle";SP.WOPIMessageHandler.CrossDocumentMessageFields.fileRename_NewName="NewName";SP.WOPIMessageHandler.CrossDocumentMessageFields.addinControlId="AddinControlId";SP.WOPIMessageHandler.CrossDocumentMessageFields.addinApplicationResource="AddinApplicationResource";SP.WOPIMessageHandler.CrossDocumentMessageFields.accessToken="AccessToken";SP.WOPIMessageHandler.CrossDocumentMessageFields.addinSSOError="AddinSSOError";SP.WOPIMessageHandler.CrossDocumentMessageFields.hostApplicationType="HostApplicationType";SP.WOPIMessageHandler.CrossDocumentMessageFields.addinSSOAuthChallenge="AddinSSOAuthChallenge";SP.WOPIMessageHandler.CrossDocumentMessageFields.addinIsFirstParty="AddinIsFirstParty";SP.WOPIMessageHandler.CrossDocumentMessageFields.userName="UserName";SP.WOPIMessageHandler.CrossDocumentMessageFields.userEmail="UserEmail";SP.WOPIMessageHandler.CrossDocumentMessageFields.federationProvider="FederationProvider";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoRequestId="SsoRequestId";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoResource="SsoResource";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoScope="SsoScope";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoAuthChallenge="SsoAuthChallenge";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoSilentLogin="SsoSilentLogin";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoOptions="SsoOptions";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoAccessToken="SsoAccessToken";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoTokenExpiration="SsoTokenExpiration";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoAuthority="SsoAuthority";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoUserDisplayName="SsoUserDisplayName";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoUserEmail="SsoUserEmail";SP.WOPIMessageHandler.CrossDocumentMessageFields.ssoError="SsoError";SP.WOPIMessageHandler.CrossDocumentMessageFields.wacUrl="Url";SP.WOPIMessageHandler.CrossDocumentMessageFields.wacState="State";SP.WOPIMessageHandler.CrossDocumentMessageFields.wacUserSession="wdUserSession";SP.WOPIMessageHandler.CrossDocumentMessageFields.wacUILanguage="ui-language";SP.WOPIMessageHandler.CrossDocumentMessageFields.shareCorrelation="ShareCorrelation";SP.WOPIMessageHandler.CrossDocumentMessageFields.nav="nav";SP.WOPIMessageHandler.CrossDocumentMessageFields.mode="mode";SP.WOPIMessageHandler.CrossDocumentMessageFields.tokens="Tokens";SP.WOPIMessageHandler.CrossDocumentMessageFields.isTopFrameTrusted="isTopFrameTrusted";SP.WOPIMessageHandler.CrossDocumentMessenger.$K=["MessageId","SendTime"];SP.WOPIMessageHandler.CrossDocumentMessenger.anyDomain="*";SP.WOPIMessageHandler.CrossDocumentMessenger.$M=0}sp_wopimessagehandler_initialize();RegisterModuleInit("sp.wopimessagehandler.js",sp_wopimessagehandler_initialize);typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();NotifyScriptLoadedAndExecuteWaitingJobs("SP.WOPIMessageHandler.js");