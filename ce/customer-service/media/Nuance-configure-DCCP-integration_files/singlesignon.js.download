function $_global_singlesignon(){if("undefined"==typeof g_all_modules)g_all_modules={};g_all_modules["singlesignon.js"]={version:{rmj:16,rmm:0,rup:23717,rpr:12e3}};typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkBegin_singlesignon.js");RefreshTokenInProgress=false;(function(){var a=null,c=false;function i(b,d){if(c)b();else{var e="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.16/js/adal.min.js",a=document.createElement("script");a.src=e;if(typeof a.onreadystatechange!="function")a.onload=function(){c=true;b()};else a.onreadystatechange=function(){if(typeof a.readyState!="undefined"&&/^(complete|loaded)$/.test(a.readyState)){c=true;setTimeout(b,0)}};a.onerror=d;a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a)}}function f(){return window.location.protocol+"//"+window.location.host}function h(b){var a=document.getElementById(b);Boolean(a)&&document.body.removeChild(a)}function e(a){Boolean(SP)&&Boolean(SP.QoS)&&Boolean(SP.QoS.WriteStart)&&SP.QoS.WriteStart(a)}function d(b,c,d,a){if(Boolean(SP)&&Boolean(SP.QoS)&&Boolean(SP.QoS.WriteSuccess))if(Boolean(c)||!Boolean(d))SP.QoS.WriteFailure(b+"_Failure",{TokenRequestTime:a});else SP.QoS.WriteSuccess(b+"_Success",{TokenRequestTime:a})}function b(d,b){var a={};a.Tokens=d;var c={MessageId:"Host_RefreshSessionInfo",SendTime:Date.now(),Values:a},e=document.getElementById("WebApplicationFrame").contentWindow;e.postMessage(JSON.stringify(c),b)}function g(a){return typeof a=="undefined"||a==null}GetAccessTokenForAddin=function(c,j,b,g,k){g=g===undefined?false:g;var m=function(){var u,i,o=0,p=0,m;if(!Boolean(a)){var s=null,t=null,w="57fb890c-0dab-4253-a5e0-7188c88b2bb4",v=f()+"/_forms/singlesignon.aspx",r=null;if(g){if(Boolean(_spPageContextInfo)){var z=(_spPageContextInfo.webDomain.startsWith(".")?_spPageContextInfo.webDomain:"."+_spPageContextInfo.webDomain).toLowerCase(),y=_spPageContextInfo.webAbsoluteUrl.toLowerCase(),q=document.createElement("a");q.href=y;if(!q.hostname.endsWith(z)&&!q.hostname.endsWith(".sharepoint-df.com")){b("DomainNotSupported",null);return}}w="6da96ed5-354b-4130-ae74-7882233b300b";v=f()+"/_forms/spfxsinglesignon.aspx";r=k===null||k===undefined||k===""?null:"scope="+k}if(Boolean(_spPageContextInfo)&&Boolean(_spPageContextInfo.aadInstanceUrl)&&Boolean(_spPageContextInfo.aadTenantId)){s=_spPageContextInfo.aadInstanceUrl+"/";t=_spPageContextInfo.aadTenantId}(!Boolean(s)||!Boolean(t))&&b("Environment not supported",null);var x={tenant:t,instance:s,clientId:w,redirectUri:v,popUp:true,navigateToLoginRequestUrl:false,loadFrameTimeout:3e4};if(g)x.extraQueryParameter=r;a=new AuthenticationContext(x);if(Boolean(_spPageContextInfo)&&(Boolean(_spPageContextInfo.userEmail)||Boolean(_spPageContextInfo.userLoginName)&&!_spPageContextInfo.userLoginName.startsWith("urn:spo:anon#")))a._user={profile:{upn:Boolean(_spPageContextInfo.userLoginName)?_spPageContextInfo.userLoginName:_spPageContextInfo.userEmail}}}var l={acquireTokenPopup:"acquireTokenPopup",login:"login"},n=function(s,y){var k,f={SignIn:0,Close:1},h=function(g){var q=g==f.SignIn?SP.UI.DialogResult.OK:SP.UI.DialogResult.cancel;k.close(q);if(g==f.SignIn){s==l.acquireTokenPopup&&a.acquireTokenPopup(c,r,y,function(a,c){b(a,c)});if(s==l.login){e("GetIdToken_Start");var h=+new Date;a.callback=function(f,g){var k=+new Date;d("GetIdToken",f,g,k-h);if(Boolean(f)||!Boolean(g))b(f,g);else{u=a.getCachedUser();if(Boolean(j))n(l.acquireTokenPopup,j);else{i=a.getCachedToken(c);if(Boolean(i))m(null,i);else{e("GetAccessToken_Start");o=+new Date;a.acquireToken(c,function(a,b){p=+new Date;d("GetAccessToken",a,b,p-o);m(a,b)})}}}};a.login()}}},v=function(a){if(a==SP.UI.DialogResult.cancel)b("SSO13002: user aborted.",null);else a==SP.UI.DialogResult.invalid&&b("invalid dialog resource.",null)},w=["<div>",STSHtmlEncode(Strings.STS.L_SSOSignInNeededNotification_Description_Text),"</div>","<div class='ms-core-form-bottomButtonBox'>","<button id='js-signinBtn' class='ms-button-enphasize'>",STSHtmlEncode(Strings.STS.L_SSOSignInNeededNotification_SignInButton_Text),"</button>","<button id='js-closeBtn' class='ms-ButtonHeightWidth'>",STSHtmlEncode(Strings.STS.L_SSOSignInNeededNotification_CloseButton_Text),"</button></div>"],t=document.createElement("div");t.innerHTML=w.join("");var x={html:t,width:450,autoSize:true,title:Strings.STS.L_SSOSignInNeededNotification_Title_Text,dialogReturnValueCallback:v};k=new SP.UI.ModalDialog.showModalDialog(x);var g=document.getElementById("js-signinBtn");if(Boolean(g)){g.onclick=function(){h(f.SignIn)};g.focus()}var q=document.getElementById("js-closeBtn");if(Boolean(q))q.onclick=function(){h(f.Close)}};m=function(a,d){h("adalRenewFrame"+c);if(Boolean(a)&&(a.indexOf("AADSTS50079")>-1||a.indexOf("AADSTS50076")>-1||a.indexOf("AADSTS50072")>-1))n(l.acquireTokenPopup,null);else b(a,d)};u=a.getCachedUser();if(u)if(Boolean(j))n(l.acquireTokenPopup,j);else{i=a.getCachedToken(c);if(Boolean(i))m(null,i);else{e("GetAccessToken_Start");o=+new Date;a.acquireToken(c,function(a,b){p=+new Date;d("GetAccessToken",a,b,p-o);m(a,b)})}}else n(l.login,null)},l=function(){b("adal.js load failed",null)};i(m,l)};RefreshToken=function(w,o,m,c,k){var e=[],d=[];if(RefreshTokenInProgress){SP.DebugLogger.Write("RefreshAccessToken",SP.DebugLogger.LoggingLevel.Interesting,"Already a request in progress so cancelling this one");d.push({Id:"202",Details:"Call in progress"});for(var r=0;r<c.length;r++)e.push({Name:c[l],Errors:d});b(e,k);return}var x=_spPageContextInfo.webId,v=_spPageContextInfo.siteId,t=window.location.hostname,i,p=-1,q=-1,u=w+"/_api/v2.0/sites/"+t,h=u+","+v+","+x+"/lists/"+o+"/items/"+m+"/driveItem?expand=openWith";h=h.replace(/[{}]/g,"");var a=new XMLHttpRequest;a.open("GET",h,true);a.setRequestHeader("Content-type","application/json;odata=verbose");var n="Refresh Token",f=new SP.QoS.ScenarioMonitor("RefreshAccessToken","RefreshAccessToken.Start","RefreshAccessToken.Success","RefreshAccessToken.Failure","RefreshAccessToken.NoResult");if(o==null||m==null||o==""||m=="-1"){f.ExpectedFailure("RefreshAccessToken.InvalidIds.ExpectedFailure",{vroomItemUrl:h,ErrorCode:"InvalidIds"});d.push({Id:"Invalid Ids",Details:"Invalid Ids"});for(var l=0;l<c.length;l++)e.push({Name:c[l],Errors:d});b(e,k);return}if(!Array.contains(c,"AccessToken")&&!Array.contains(c,"FileGetUrl")){SP.DebugLogger.Write("RefreshAccessToken",SP.DebugLogger.LoggingLevel.Interesting,"Unknown token request received");f.ExpectedFailure("RefreshAccessToken.UnknownTokenRequest.ExpectedFailure",{requestedTokens:c.toString(),ErrorCode:"UnknownTokenRequest"});d.push({Id:"Unknown token",Details:"Unknown token"});for(var j=0;j<c.length;j++)e.push({Name:c[j],Errors:d});b(e,k);return}var s=+new Date;a.onreadystatechange=function(){if(a.readyState==4){var o=+new Date;i=a.getResponseHeader("SPRequestGuid");p=Number(a.getResponseHeader("SPClientServiceRequestDuration"));q=Number(a.getResponseHeader("SPIisLatency"));EnsureScriptFunc("sp.core.js","SP.SlapiInternal",function(){var a=g(PerformanceLogger)?null:PerformanceLogger.GetLogger();if(!g(a)){a.ResetPerformanceLogger();a.CollectW3CPerfTimings();a.WriteScenarioId(n);a.WritePageTransitionType(4);a.WriteServerCorrelationId(i);a.WriteAppCache(false);a.WriteFolderNav(false);a.WriteServerSideLatency(p,q);if(typeof PerformanceLogger.ControlPerformanceData=="function"){a.AddExpectedControl(n);var b=new PerformanceLogger.ControlPerformanceData(n,s,Number(o),a.ComputeControlRenderTime,a.CheckControlTimeRequiredDataAvailable);a.WriteControlPerformanceData(b)}}});RefreshTokenInProgress=false;if(a.status===200){var l=null,m="No tokens retrieved";try{l=JSON.parse(a.responseText)}catch(r){SP.DebugLogger.Write("RefreshAccessToken_UnexpectedFailure",SP.DebugLogger.LoggingLevel.Interesting,r);f.UnexpectedFailure("RefreshAccessToken.Error.UnexpectedFailure",{CorrelationId:i,response:l,Error:r,vroomItemUrl:h});m=r}if(Boolean(l)&&Boolean(l.error)){SP.DebugLogger.Write("RefreshAccessToken_UnexpectedFailure",SP.DebugLogger.LoggingLevel.Interesting,l.error);f.UnexpectedFailure("RefreshAccessToken.Error.UnexpectedFailure",{CorrelationId:i,Error:l.error,requestedTokens:c.toString(),vroomItemUrl:h,ErrorCode:l.error.code});d.push({Id:l.error.code,Details:l.error.message})}else if(Boolean(l)&&Boolean(l.openWith)&&Boolean(l.openWith.wac)){f.Success("RefreshAccessToken.Success");Array.contains(c,"AccessToken")&&e.push({Name:"AccessToken",Value:l.openWith.wac.accessToken,Expiry:l.openWith.wac.accessTokenExpiry});Array.contains(c,"FileGetUrl")&&e.push({Name:"FileGetUrl",Value:l.openWith.wac.fileGetUrl,Expiry:l.openWith.wac.accessTokenExpiry})}else{d.push({Id:"500",Details:m});f.UnexpectedFailure("RefreshAccessToken.NoToken.UnexpectedFailure",{CorrelationId:i,vroomItemUrl:h,requestedTokens:c.toString(),response:l,ErrorCode:"NoToken"})}}else if(a.status==0){d.push({Id:"503",Details:"Unable to connect to Service"});f.ExpectedFailure("RefreshAccessToken.UnableToConnect.ExpectedFailure",{ErrorCode:"UnableToConnect"})}else{if(a.status==503)d.push({Id:a.status,Details:"Service Unavailable"});else d.push({Id:a.status,Details:a.responseText});if(a.status==401||a.status==404||a.status==403||a.status==423)f.ExpectedFailure("RefreshAccessToken.ApiCallFailed.ExpectedFailure",{CorrelationId:i,requestedTokens:c.toString(),vroomItemUrl:h,Status:a.status,Details:a.responseText,ErrorCode:a.status});else f.UnexpectedFailure("RefreshAccessToken.ApiCallFailed.UnexpectedFailure",{CorrelationId:i,requestedTokens:c.toString(),vroomItemUrl:h,Status:a.status,Details:a.responseText,ErrorCode:a.status})}if(d.length>0)for(j=0;j<c.length;j++)e.push({Name:c[j],Errors:d});b(e,k);f.Dispose()}else RefreshTokenInProgress=true};a.send()};GetPrimaryIdentityInfoForAddin=function(b){var a={};a.UserName="";a.UserEmail="";a.HostApplicationType="SharePointOnline";a.FederationProvider="";if(Boolean(_spPageContextInfo))if(Boolean(_spPageContextInfo.userEmail)||Boolean(_spPageContextInfo.userLoginName)&&!_spPageContextInfo.userLoginName.startsWith("urn:spo:anon#")){a.UserName=_spPageContextInfo.userDisplayName;a.UserEmail=Boolean(_spPageContextInfo.userLoginName)?_spPageContextInfo.userLoginName:_spPageContextInfo.userEmail}b(0,JSON.stringify(a))}})();(function(){typeof Sys!="undefined"&&typeof Sys.Application!="undefined"&&typeof Sys.Application.notifyScriptLoaded!="undefined"&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("singlesignon.js")})();typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkEnd_singlesignon.js")}var GetAccessTokenForAddin,GetPrimaryIdentityInfoForAddin,RefreshToken,RefreshTokenInProgress;$_global_singlesignon();