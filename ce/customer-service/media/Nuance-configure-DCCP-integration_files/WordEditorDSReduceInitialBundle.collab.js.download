'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[9],{1360:function(E,I,c){c.r(I);c.d(I,"RtcUtils",function(){return k});E=c(0);var l=c(8),e=c(1410),a=c(29);class k{static s7e(x,y=e.RealtimeChannel.XOf){let m;try{m=a.c(x)}catch(t){throw x=String.format("Failed to JSON-serialize payload : {0}",t),l.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(m.length>y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,y),l.ULS.sendTraceTag(18637074,
500,10,x),Error.argument("payload",x);return m}static deserialize(x,y,m){if(!x)return null;if(Object.getType(x)!==String){var t=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(x).getName(),m);l.ULS.sendTraceTag(18637075,500,10,t);return null}t=null;try{t=a.a(x)}catch(z){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,z,m),l.ULS.sendTraceTag(18637077,
500,10,x)}return t}static xgc(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return a.c(x)}catch(y){return x.toString()}}static pAl(x){let y,m,t;y=0;t=m=null;if(!x)return{wpi:y,ypi:m,exception:t};try{const z=x.source;z&&Object.getType(z)===String&&(t=z);const v=x.context;v&&(x=v,y=x.status?x.status:0,m=x.statusText?x.statusText:null)}catch(z){}return{wpi:y,ypi:m,exception:t}}}Object(E.a)(k,"RtcUtils",null,[])},1397:function(E,I,c){c.r(I);E=c(0);var l=c(8),e=c(61),a=c(75),k;(function(t){t[t.SendNotification=
0]="SendNotification";t[t.SendPersistentState=1]="SendPersistentState";t[t.FindSession=2]="FindSession";t[t.Last=3]="Last"})(k||(k={}));Object(E.b)("ApiType",k);var x;(function(t){t[t.AttemptCount=0]="AttemptCount";t[t.SuccessCount=1]="SuccessCount";t[t.DropCount=2]="DropCount";t[t.FailedCount=3]="FailedCount";t[t.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";t[t.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";t[t.ThrottledCount=6]="ThrottledCount";t[t.Last=7]="Last"})(x||(x=
{}));Object(E.b)("EventCountType",x);var y=c(1552);c.d(I,"FrequentLoggingMetrics",function(){return m});class m{constructor(t){this.dIh=this.p0h=null;this.PNi=this.k3h=0;this.fu=null;this.e6g=this.$Je=0;this.Zf=t;this.uBm();this.OAe=this.GVg=this.JKe=!1;this.Nyc=0}get Izl(){return this.OAe}ICo(t){this.e6g=t;window.setInterval(Object(e.a)(this,this.kNf,"logMetricsBatchAndReset"),t);this.$Je=(new Date).getTime()}tP(t,z){this.oro(t)&&!this.GVg||this.Izl||!window.navigator.onLine||this.Zf.yRa||(this.fu[t][z]++,
this.JKe=!0)}uBm(){this.fu=Array(3);for(let t=0;3>t;t++){this.fu[t]=Array(7);for(let z=0;7>z;z++)this.fu[t][z]=0}}bOk(){const t={};for(let z=0;3>z;z++)for(let v=0;7>v;v++)this.jXm(z,v)&&(t[k[z]+x[v]]=this.fu[z][v]);t.FSDomain=this.p0h;t.ConnectionDomain=this.dIh;t.FSRetryInterval=this.k3h;t.MaxPayloadSize=this.PNi;t.LogNumber=this.Nyc;1===this.Nyc&&(t.FSLatencies=y.a.instance.$Xl(),t.ConLatencies=y.a.instance.ASl());return t}jXm(t,z){return 2===t&&3!==z&&0!==z?!1:!0}oro(t){return 2===t?!1:!0}kNf(){if(this.JKe){this.Nyc++;
if((new Date).getTime()-this.$Je<5E3+this.e6g){var t=a.a.toJSON(this.bOk());l.ULS.sendTraceTag(50644352,500,15,t)}this.$Je=(new Date).getTime();for(t=0;3>t;t++)for(let z=0;7>z;z++)this.fu[t][z]=0;this.JKe=!1}}N$m(){this.GVg=!0}static get instance(){return m._instance}static create(t){m.instance||(m._instance=new m(t));return m.instance}}m._instance=null;Object(E.a)(m,"FrequentLoggingMetrics",null,[877])},1410:function(E,I,c){c.r(I);E=c(0);var l=c(8),e=c(61),a=c(418),k=c(803),x=c(81),y=c(2);class m{constructor(za,
ha){this.status=za;this.Mec=ha}}Object(E.a)(m,"UserStatusInfo",null,[]);var t=c(40),z=c(1552);class v{constructor(za,ha){this.data=za;this.timeStamp=ha}}Object(E.a)(v,"PresenceData",null,[]);class H{constructor(za){this.HCa=!1;this.Rzb=0;this.Mwe=!1;this.setTimeout=H.Qdf;this.clearTimeout=H.Idf;this.k8m=Object(e.a)(this,this.o7m,"logRtcConnectingUsageStatement");this.dw=za}Jmn(){this.HCa||(this.Rzb=this.setTimeout(()=>{this.HCa=!1;this.gLi()},8E3),this.HCa=!0,this.Mwe=!1)}Dnn(){this.U_()}Lun(){this.gLi()}gLi(){this.U_();
this.Mwe||(this.Mwe=!0,this.k8m())}o7m(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.dw)}U_(){this.HCa&&this.clearTimeout(this.Rzb);this.Rzb=0;this.HCa=!1}static Qdf(za,ha){return window.setTimeout(za,ha)}static Idf(za){window.clearTimeout(za)}}Object(E.a)(H,"ConnectedUsageKpiLogger",null,[902]);class F{constructor(){this.U7i=this.V5f;this.X7i=this.Y5f;this.W7i=this.X5f;this.a8i=this.$5f;this.$7i=this.Z5f;this.k6f=this.l6f;this.Z5c=this.i6f;this.HOb=
this.g6f;this.IOb=this.h6f;this.V7i=this.W5f;this.P5a=this.WSf;this.ULb=this.XSf}V5f(){}Y5f(){}X5f(){}$5f(){}Z5f(){}i6f(){}h6f(){}g6f(){}l6f(){}W5f(){}WSf(){}XSf(){}}Object(E.a)(F,"NoopRealtimeChannelMetrics",null,[890,223]);class G{}G.wdd="presenceUpdated";G.updateNotification="updateNotification";G.X1i="persistentStateCleared";G.updatePersistentState="persistentStateUpdated";Object(E.a)(G,"RtcClientMethodNames",null,[]);class L{}L.cwm="realtimeChannelHub";L.wdd="UpdatePresence";L.qN="SendUpdateNotification";
L.Xof="GetCompletePersistentStateWithMetadata";L.updatePersistentState="UpdatePersistentState";L.Prb="UpdateClientInfo";Object(E.a)(L,"RtcHubMethodNames",null,[]);class J{constructor(za){this.hw=za}uXn(za){this.hw.on(G.wdd,za)}pYn(za){this.hw.on(G.updateNotification,za)}tXn(za){this.hw.on(G.updatePersistentState,za)}sXn(za){this.hw.on(G.X1i,za)}PSo(za){this.hw.off(G.wdd,za)}ZSo(za){this.hw.off(G.updateNotification,za)}OSo(za){this.hw.off(G.updatePersistentState,za)}NSo(za){this.hw.off(G.X1i,za)}wdd(za){return this.hw.invoke(L.wdd,
za)}Prb(za){return this.hw.invoke(L.Prb,za)}qN(za,ha){return this.hw.invoke(L.qN,za,ha)}Xof(za){return this.hw.invoke(L.Xof,za)}updatePersistentState(za,ha){return this.hw.invoke(L.updatePersistentState,za,ha)}}Object(E.a)(J,"RealtimeChannelProxy",null,[895,896,897]);class K{constructor(){this.kue=this.uMg=!1;this.iue=0;this.bwe=this.JSe=this.ISe=this.jte=!1;this.pBe=0;this.peh=!1;this.oeh=this.neh=0;this.bRe=!1;this.iRe=this.gRe=this.kRe=this.cRe=0;this.hRe=!1}get jJk(){return this.kue}get iJk(){return this.iue}get GBk(){return this.jte}get Uso(){return this.ISe}get Vso(){return this.JSe}get EZk(){return this.bwe}get AOd(){return this.pBe}get Y9n(){return this.peh}get hgj(){return this.neh}get X9n(){return this.oeh}get T9n(){return this.bRe}get U9n(){return this.cRe}get ngj(){return this.kRe}get igj(){return this.gRe}get kgj(){return this.iRe}get jgj(){return this.hRe}static createInstance(za){const {RealtimeChannel:ha}=
c(1410);return za?Object.assign(new K,{uMg:za.$("AwayStatusManagerIsEnabled"),kue:za.$("AwayStatusOneMinuteTimeoutIsEnabled"),iue:za.mc("AwayCoauthorThresholdMs",9E5),jte:za.$("RtcAllowCrossDomainAccessEnabled"),ISe:za.$("ShouldLogOnContentNotification"),JSe:za.$("ShouldLogOnHostSubscriptionNotification"),bwe:za.$("RtcClientMetricsEnabled"),pBe:za.mc("RtcFindSessionRequestTimeoutInMS",6E4),peh:za.$("RtcJsClientFrequentlyLogsMetrics"),neh:za.mc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
oeh:za.mc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),bRe:za.$("RtcClientMessageTelemetryEnabled"),cRe:za.mc("RtcClientMessageTelemetrySampleSize",5),kRe:za.mc("RtcSendTelemetryMessageIntervalInMS",3E5),gRe:za.mc("RtcLogClientMessageMetricsTimeOutInMs",2E4),iRe:za.mc("RtcMaxPayloadSizeInCharactersOverride",ha.XOf),hRe:za.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new K,{uMg:!1,kue:!1,iue:9E5,jte:!1,ISe:!1,JSe:!0,bwe:!1,pBe:9E4,bRe:!1,
cRe:5,kRe:3E5,gRe:2E4,iRe:ha.XOf,hRe:!1})}}Object(E.a)(K,"RealtimeChannelSettings",null,[894]);var S=c(1735),R=c(67),M=c(136);class O{constructor(za){this.kEc=null;this.cUa=0;this.KEb=!1;this.zm=za;this.zm.Iua(Object(e.a)(this,this.aja,"onConnectionStateChanged"))}aja(za,ha){this.cUa=ha.newState}svn(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.zm.yce()}Qzm(za){this.kEc.init(za)}}Object(E.a)(O,"ARtcMessageHandler",null,[]);var U=c(326);class X{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(E.a)(X,"PresenceDataEntryForClients",null,[]);var P=c(75);class Z{constructor(za,ha=""){this.vik=za;this.yta=ha}send(){return this.vik()}get messageId(){return this.yta}}Object(E.a)(Z,"MessageHandler",null,[907]);var ba=c(1583);class Y extends Sys.EventArgs{constructor(za,ha,Oa,ib){super();this.v9f=za;this.reconnectDelay=ha;this.reason=Oa;this.Obg=ib}}Object(E.a)(Y,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var da=c(1675);class ia{constructor(){this.bUe=this.ki=
null}get oi(){return this.ki?this.bUe?this.bUe.getTime()-this.ki.getTime():(new Date).getTime()-this.ki.getTime():0}start(){this.ki=new Date}stop(){this.bUe=new Date}}Object(E.a)(ia,"SimpleStopwatch",null,[]);var la=c(1676),wa;(function(za){za[za.contentUpdate=0]="contentUpdate";za[za.editorsTableUpdate=1]="editorsTableUpdate";za[za.fileNameUpdate=2]="fileNameUpdate";za[za.wetContentUpdate=3]="wetContentUpdate";za[za.persistedContentUpdate=4]="persistedContentUpdate";za[za.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";za[za.replicationTelemetry=6]="replicationTelemetry";za[za.lockUpdate=7]="lockUpdate";za[za.collabServiceContentUpdate=8]="collabServiceContentUpdate";za[za.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";za[za.saveTargetUpdate=10]="saveTargetUpdate";za[za.uploadToOcsUpdate=11]="uploadToOcsUpdate";za[za.labelUpdate=12]="labelUpdate";za[za.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";za[za.subscribeOrExtend=14]="subscribeOrExtend";
za[za.elapsedBootTelemetry=15]="elapsedBootTelemetry";za[za.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";za[za.clientToClientResponseMessage=17]="clientToClientResponseMessage";za[za.verifyNotificationPipeline=18]="verifyNotificationPipeline";za[za.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";za[za.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";za[za.last=21]="last"})(wa||(wa={}));Object(E.b)("UpdateNotificationType",wa);var va=c(697),qa=c(549),Na=c(550);
class Sa extends O{constructor(za,ha,Oa,ib,Wa,nb,Db,Ma,Qa,fb){super(Db);this.hw=null;this.T5g=this.V5g=!1;this.yta=0;this.eOe=new M.a;this.c$j=Sa.bTl();this.mNe=y.AFrameworkApplication.K.kb("OwningFeatureCrewForRtcNotificationKpis");this.Wf=za;this.D8g=this.C8g=0;this.kEc=ha;this.kEc.iCd(Object(e.a)(this,this.svn,"onTooManyUndeliveredMessages"));this._clientId=Oa;this.Yfk=Wa;this.zm.Zyk(Object(e.a)(this,this.Lsn,"onRefreshProxyRequired"));this.zm.Xyk(Object(e.a)(this,this.Jsn,"onRefreshAllPersistentStateRequest"));
this.zm.gzk(Object(e.a)(this,this.qN,"sendUpdateNotification"));this.zm.Wwk(Object(e.a)(this,this.Spn,"onInternalPresenceUpdated"));this.zm.Xwk(Object(e.a)(this,this.Tpn,"onInternalUpdateNotificationReceived"));this.zm.Vwk(Object(e.a)(this,this.Rpn,"onInternalPersistentStateUpdated"));this.zm.Uwk(Object(e.a)(this,this.Qpn,"onInternalPersistentStateCleared"));this.zm.ezk(Object(e.a)(this,this.Dkc,"sendPersistentState"));this.zm.tzk(Object(e.a)(this,this.Prb,"updateClientInfo"));this.je=nb;this.dw=
ib;this.fu=Ma;this.sW=Qa;this.kzc=fb;this.Tea=Object(R.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Lsn(za,ha){this.hw=this.Yfk(ha.hubConnection);this.kEc.reset();this.hw.uXn(Object(e.a)(this,this.q5,"onPresenceUpdated"));this.hw.tXn(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.hw.sXn(Object(e.a)(this,this.Ugc,"onPersistentStateCleared"));this.hw.pYn(Object(e.a)(this,this.l1,"onUpdateNotificationReceived"))}aja(za,ha){this.cUa=ha.newState;2===ha.newState&&
this.neo()}neo(){for(let za of this.eOe)this.qN(null,new da.a(za.key,za.value,!1,new a.a));this.eOe=new M.a}Jsn(za,ha){ha.X7e();for(za=0;3>za;++za)this.Pdo(za,ha)}Pdo(za,ha){try{this.hw.Xof(za).done(Oa=>{ha.jpc(ha.T9e,"GetCompletePresenceSuccess")&&(ha.n4k.Lun(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.dw,za),this.zm.KOn(),this.Trn(za,Oa),this.zm.$Nn(Oa),ha.VYh.nb(za)&&this.zm.R6i(za,ha.VYh.J(za),new a.a))}).fail(Oa=>{const {RtcUtils:ib}=
c(1360);ha.jpc(ha.T9e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",ib.xgc(Oa),this.dw,za),this.zm.yce())}).always(()=>{ha.YA&&ha.YA.stop()})}catch(Oa){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",ha.T9e,Oa.message)}}Dkc(za,ha){var {RtcUtils:Oa}=c(1360);za=ha.presence;
let ib;const Wa=ha.J8a;this.sW.tP(1,0);try{ib=Oa.s7e(za,this.kzc)}catch(Db){this.sW.tP(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Db.message);Wa.setException(Db);return}Oa=new x.a;Oa.Z(this._clientId,Object.assign(new X,{Presence:za,TimeStamp:(new Date).getTime()}));this.zm.Y6i(ha.type,Oa);if(2!==this.cUa)this.fu.HOb(),this.sW.tP(1,2),Wa.Dg(null);else{var nb=this.yta.toString();++this.yta;za=new Z(()=>this.peo(ha.type,ib,
nb),nb);za=this.izj(0,ha.type).add(za);za.L7d(Db=>{2===Db&&this.sW.tP(1,6);Wa.Dg(null)});za.K7d(()=>{})}}peo(za,ha,Oa){let ib=null;const Wa=new ia,nb=new ba.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.dw,za);if(2!==this.cUa)return this.fu.HOb(),this.sW.tP(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.dw,za),nb.JOf(),nb;this.je&&20>this.C8g&&(ib=this.je.Yf("WebServiceCall","Send Presence Message"),
this.C8g++);Wa.start();nb.Y_c(1);try{this.hw.updatePersistentState(za,ha).done(()=>{this.fu.Z5c();this.sW.tP(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Oa,this.dw,za);nb.Lmb(1);Wa&&(Wa.stop(),Wa.oi>this.Wf.hgj?this.sW.tP(1,4):this.sW.tP(1,5))}).fail(Db=>{const {RtcUtils:Ma}=c(1360);this.KEb||(this.fu.HOb(),this.sW.tP(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
Oa,Ma.xgc(Db),this.dw));nb.Lmb(2)}).always(()=>{ib&&ib.stop()})}catch(Db){l.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",Db.message),this.sW.tP(1,3),nb.Lmb(2)}return nb}Prb(za,ha){({RtcUtils:za}=c(1360));const Oa=ha.DZk,ib=ha.J8a;let Wa;try{Wa=za.s7e(Oa,this.kzc)}catch(nb){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",nb.message);ib.setException(nb);return}try{this.hw.Prb(Wa).done(()=>
{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(nb=>{const {RtcUtils:Db}=c(1360);this.KEb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Db.xgc(nb));ib.Dg(null)})}catch(nb){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",nb.message),ib.Dg(null)}}qN(za,ha){({RtcUtils:za}=c(1360));const Oa=ha.type,ib=ha.NL,Wa=ha.sll,nb=ha.J8a;let Db;this.sW.tP(0,0);try{Db=za.s7e(ib,this.kzc)}catch(Qa){this.sW.tP(0,
3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Qa.message);nb.setException(Qa);return}if(2!==this.cUa)Wa?this.eOe.Z(Oa,ib):(this.fu.HOb(),this.sW.tP(0,2)),nb.Dg(null);else{var Ma=this.yta.toString();++this.yta;ha=new Z(()=>this.gfo(Oa,Db,Ma),Ma);ha=this.izj(1,Oa).add(ha);ha.L7d(Qa=>{2===Qa&&this.sW.tP(0,6);nb.Dg(null)});ha.K7d(()=>{})}}gfo(za,ha,Oa){let ib=null;const Wa=new ia,nb=new ba.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",
this.dw,za);if(2!==this.cUa)return this.fu.HOb(),this.sW.tP(0,2),l.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.dw),nb.JOf(),nb;this.je&&3===za&&20>this.D8g&&(ib=this.je.Yf("WebServiceCall","Send WetContent Update"),this.D8g++);Wa.start();nb.Y_c(1);this.hw.qN(za,ha).done(()=>{this.fu.Z5c();this.sW.tP(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Oa,this.dw,za);nb.Lmb(1);
Wa&&(Wa.stop(),Wa.oi>this.Wf.hgj?this.sW.tP(0,4):this.sW.tP(0,5))}).fail(Db=>{const {RtcUtils:Ma}=c(1360);this.KEb||(this.fu.HOb(),this.sW.tP(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Oa,Ma.xgc(Db),this.dw));nb.Lmb(2)}).always(()=>{ib&&ib.stop()});return nb}n6(){this.hw.PSo(Object(e.a)(this,this.q5,"onPresenceUpdated"));this.hw.OSo(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.hw.NSo(Object(e.a)(this,this.Ugc,
"onPersistentStateCleared"));this.hw.ZSo(Object(e.a)(this,this.l1,"onUpdateNotificationReceived"))}Spn(za,ha){this.q5(ha.Zra,ha.lLd)}q5(za){this.fu.IOb();this.TSa(0,za)}Rpn(za,ha){this.TSa(ha.type,ha.Zra)}Trn(za,ha){const Oa={};for(let ib in ha)Oa[ib]=ha[ib].Presence;this.WWi(za,Oa,ha)}TSa(za,ha){this.fu.IOb();this.WWi(za,ha)}WWi(za,ha,Oa=null){var {RtcUtils:ib}=c(1360);if(l.ULS.P$(500,100))for(var Wa in ha);delete ha[this._clientId];if(!P.a.isEmpty(ha)){for(var nb in ha)Wa=nb,ha[Wa]=ib.deserialize(ha[nb],
"Presence",Wa,!1,this.kzc);ib=new x.a;nb=(new Date).getTime();for(let Db in ha){Wa=ha[Db];let Ma=Db,Qa;Oa?(Qa=Oa[Ma],Qa.Presence=Wa):Qa=Object.assign(new X,{Presence:Wa,TimeStamp:nb});ib.Z(Ma,Qa)}this.zm.Y6i(za,ib);switch(za){case 0:this.V5g||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.dw),this.V5g=!0,y.AFrameworkApplication.Og&&y.AFrameworkApplication.Og.G$m());this.zm.K6i(ha,[]);break;case 2:this.T5g||(l.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",
this.dw),this.T5g=!0);this.zm.I6i(za,ha);break;default:this.zm.I6i(za,ha)}}}Qpn(za,ha){this.Ugc(ha.tGd)}Ugc(za){this.fu.IOb();if(l.ULS.P$(500,100))for(let ha=0;ha<za.length;++ha);za.length&&(this.zm.$On(za),this.zm.AOn(za),this.zm.K6i({},za))}Tpn(za,ha){this.l1(ha.type,ha.NL)}l1(za,ha=null){this.Wf.Uso&&0===za&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===za&&this.mNe&&0<this.mNe.length){var Oa=Object.assign(new va.a,{topLevelKpiName:"ContentUpdateNotificationReceived",
featureName:"RtcNotification",crewAlias:this.mNe,vetoPillar:"RealTimeCoauth"});(Oa=U.a.getInstance(Oa))&&Oa.logKpiUsage(this.c$j)}this.Wf.Vso&&13===za&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",ha||"<none>"));this.fu.IOb();5===za?(ha=(za=this.eBn(ha))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",za.reason,za.reconnectDelay):"Received client reconnection request from the server without params.",
l.ULS.sendTraceTag(18637071,500,50,ha),this.zm.yce(za)):(ha=c(1360).RtcUtils.deserialize(ha,String.format("UpdateNotification-{0}",wa[za]),null,!1,this.kzc),this.zm.ZOn(za,ha))}eBn(za){try{if(!za||""===za)return null;const ha=JSON.parse(za);return new Y(ha[la.a.yag],ha[la.a.S9n],ha[la.a.W9n],ha[la.a.Obg])}catch(ha){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",ha.message),null}}izj(za,ha){return this.kEc.Phm(this.Qhm(za,ha))}Qhm(za,ha){return za+","+ha}static bTl(){var za=
new Map;za.set("SkipAria","True");za=Object.assign(new qa.a,{extendedProperties:za});return Object.assign(new Na.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:za,blockFutureEmissionDurationInMs:3E5})}}Object(E.a)(Sa,"RtcMessageHandler",O,[]);class Ia{FMh(za,ha=""){const {MaxOutstandingThrottler:Oa}=c(1672);return Oa.createInstance(za,ha)}$bl(za,ha=""){const {MaxRateThrottler:Oa}=c(1674);return Oa.createInstance(za,ha)}}Object(E.a)(Ia,"ThrottlerFactory",null,[892]);var ta=
c(78),ra=c(1677);class fa{constructor(za){this.Wf=null;this.Zh=!1;this.sa=new ta.a;this.uKe=new x.a;this.sKe=new x.a;this.EVe=za;this.zXb=this.EVe.FMh(ha=>ha.send(),"GlobalMaxOustandingThrottler");this.zXb.iCd(()=>{this.sa.raiseEvent("TMUDM")})}init(za){this.Zh||(this.Wf=za,this.zXb.init(this.Wf.rrb,this.Wf.gmm),this.Zh=!0)}Phm(za){var {MaxRateThrottler:ha}=c(1674),{MaxOutstandingThrottler:Oa}=c(1672);this.Zh||this.init(new ra.a(ha.$Ph,Oa.DQh,Oa.kQh,fa.rbn));({value:ha}=this.uKe.Fc(za)).returnValue||
(({value:ha}=this.sKe.Fc(za)).returnValue||(ha="MaxOutstandingThrottler-"+za,ha=this.EVe.FMh(Object(e.a)(this.zXb,this.zXb.add,"add"),ha),ha.init(this.Wf.rrb,this.Wf.qbn),ha.iCd(()=>{this.sa.raiseEvent("TMUDM")}),this.sKe.add(za,ha)),Oa="MaxRateThrottler-"+za,ha=this.EVe.$bl(Object(e.a)(ha,ha.add,"add"),Oa),ha.init(this.Wf.odn),this.uKe.add(za,ha));return ha}reset(){for(let za of this.uKe)za.value.j6f();for(let za of this.sKe)za.value.j6f(),za.value.reset();this.zXb.j6f();this.zXb.reset()}iCd(za){this.sa.addHandler("TMUDM",
za)}}fa.rbn=1E3;Object(E.a)(fa,"ThrottlerManager",null,[891]);var pa;(function(za){za[za.unspecified=0]="unspecified";za[za.word=1]="word";za[za.excel=2]="excel";za[za.powerPoint=3]="powerPoint";za[za.test=4]="test";za[za.wacFrontEnd=5]="wacFrontEnd";za[za.oneNote=6]="oneNote";za[za.visio=7]="visio";za[za.officeMobile=8]="officeMobile";za[za.cosmosDBChangefeed=9]="cosmosDBChangefeed";za[za.last=10]="last"})(pa||(pa={}));Object(E.b)("RtcClientAppName",pa);const oa=(za,ha,Oa,ib,Wa,nb,Db,Ma,Qa=null,
fb=null,dc=null,bc=null)=>{const Bb=K.createInstance(y.AFrameworkApplication.K),Ob=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",Va=Aa(za,ha,Db,Ob),ab=Bb.EZk?c(1861).RealtimeChannelMetrics.createInstance(Va):new F;var Gb=c(1397).FrequentLoggingMetrics.create(Wa);Bb.Y9n&&Gb.ICo(Bb.X9n);var Ua="";Ua=Qa&&""!==Qa?Qa:"/rtc2/";Gb.p0h=t.a.YX(Ua);const yb=Ua+"signalr";Qa=Ua+"findsession";const Yb=L.cwm;Ua=new Ia;dc=dc||S.a.getInstance();l.ULS.shipAssertTag(556867617,500,
Bb.kgj<=c(1410).RealtimeChannel.QNi,"Client attempting to override max payload size beyond absolute limit");const pc=Math.min(Bb.kgj,c(1410).RealtimeChannel.QNi);Gb.PNi=pc;Gb=new Sa(Bb,new fa(Ua),za,Va,Fc=>new J(Fc.createHubProxy(Yb)),Ma,dc,ab,Gb,pc);fb||(fb=c(1740).FindSessionStrategy.createInstance(ha,Wa,Qa,Ma,Ob,Db,za,Va,dc,nb,ib,bc));fb.AOd=Bb.AOd;ha=new H(Va);Oa=Oa?Oa.split(","):null;za=new (c(1410).RealtimeChannel)(za,Oa,Va,Ma,()=>$.hubConnection(yb),fb,Gb,ha,dc,ab,Bb,Wa);za.init();return za},
Aa=(za,ha,Oa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",za,xa(pa[Oa]),xa("browser"),ha),xa=za=>za?za.charAt(0).toLocaleUpperCase()+za.substring(1,za.length):za;c.d(I,"RealtimeChannel",function(){return Ka});class Ka{constructor(za,ha,Oa,ib,Wa,nb,Db,Ma,Qa,fb,dc,bc){this.$Te=!1;this.M6=null;this.r3=new x.a;this.Jsc=1;this.bfa=null;this.lm=!1;this.xIe=(new Date(0)).getTime();this.Rgh=0;this._clientId=za;this.wzd=ha;this.saa=0;this.je=ib;this.Lwe=Ma;this.Whk=Db;this.rUj=Qa;
this.HZj=Wa;this.t$a=nb;this.dw=Oa;this.fu=fb;this.Wf=dc;this.Zf=bc;this.Yjk=1>100*Math.random()}get nSa(){return this.t$a.nSa}set nSa(za){this.t$a.nSa=za}get spb(){return this.Whk}get zm(){return this.rUj}init(){this.zm.Yyk(Object(e.a)(this,this.kLd,"disconnectAndCreateNewConnection"));this.zm.wzk(Object(e.a)(this,this.Nvn,"onUpdatePersistentStateRequestReceivedInternal"));this.zm.vzk(Object(e.a)(this,this.Mvn,"onUpdatePersistentStateClearedRequestReceived"));this.Zf.x2b(this.fu);y.AFrameworkApplication.qI(()=>
{const {FrequentLoggingMetrics:za}=c(1397);this.fu.k6f();za.instance&&za.instance.kNf()});this.YMh();this.Fol();this.zm.izk(Object(e.a)(this,this.$Uo,"updateConnectionQueryString"))}Fol(){try{const Oa=$.signalR;if(!Oa)throw Error.invalidOperation("Failed to retrieve Signalr object");const ib=Oa.version;if(!ib)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===ib){var za=Oa.transports;if(!za)throw Error.invalidOperation("Failed to retrieve transports object");
var ha=za.longPolling;if(!ha)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!ha.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");ha.supportsKeepAlive=this.yel()}}catch(Oa){l.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",Oa.message)}}yel(){return()=>!1}YMh(){const za=++this.Jsc;this.xIe=(new Date(0)).getTime();this.bfa=this.HZj();this.zm.HOn(this.bfa);this.bfa.stateChanged(ha=>
{this.Nmn(ha,za)});this.bfa.connectionSlow(Object(e.a)(this,this.Cun,"onSlowConnection"));this.bfa.error(Object(e.a)(this,this.tun,"onSignalRError"));this.bfa.log=Object(e.a)(this,this.uun,"onSignalRLog")}jpc(za,ha){return za!==this.Jsc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",ha),!1):!0}connect(){2!==this.saa&&1!==this.saa&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.dw),this.Lwe.Jmn(),z.a.instance.JCo(),this.aja(1,
this.saa),this.fvj())}fvj(){const za=this.Jsc;this.$Te=!1;this.fu.U7i();this.t$a.tcm(Object(e.a)(this,this.l4k,"connectSignalrConnection"),Object(e.a)(this,this.aVi,"onFailureToConnect"),Object(e.a)(this.spb,this.spb.Qzm,"initThrottlerManager"),Object(e.a)(this,this.jpc,"verifyConnectionToken"),za)}aVi(za=null){this.fu.W7i();let ha=null;!za||"documentsessiondeleted"!==(ha=za.toLowerCase())&&"documentsessionexpired"!==ha?this.kLd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.dw,za),this.disconnect())}kLd(za,ha=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.M6);za=(za=2===this.saa||1===this.saa)&&!this.spb.KEb;let Oa=!0,ib=0;ha&&Object.getType(ha)!==Object.getType(Sys.EventArgs.Empty)&&ha.v9f&&""!==ha.v9f&&(za=!0,this.t$a.$mo(ha.v9f),Oa=ha.Obg,ib=ha.reconnectDelay);za&&this.aja(1,this.saa);++this.Jsc;this.spb.n6();this.YDo(Oa);this.t$a.fql();this.YMh();za&&window.setTimeout(Object(e.a)(this,this.fvj,"startConnecting"),Math.min(ib,
3E4))}$Uo(){let za=null;const ha=({correlationId:za}=this.t$a.K9h()).returnValue;this.bfa.qs=ha;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.dw,za)}l4k(za){const {FrequentLoggingMetrics:ha}=c(1397);this.xIe=(new Date).getTime();let Oa=null;this.bfa.qs=({correlationId:Oa}=this.t$a.K9h()).returnValue;this.Wf.GBk&&(this.bfa.url=za,ha.instance&&(ha.instance.dIh=t.a.YX(za)));let ib=null;this.je&&(ib=this.je.Yf("WebServiceCall","ConnectToServer"));
l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.dw);za={};this.wzd&&(za.transport=1===this.wzd.length?this.wzd[0]:this.wzd);za.pingInterval=null;z.a.instance.Y5c(1,0);za.waitForPageLoad=!1;this.bfa.start(za,null).done(Wa=>{this.fu.X7i();z.a.instance.Y5c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Wa.id,Oa)}).fail(Wa=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",
this.t$a.yX,Oa,this.dw);this.aVi();this.fu.V7i(Wa);z.a.instance.Y5c(1,1,!1);this.zm.O6i(0,{["CorrelationId"]:Oa,["ErrorDetails"]:Wa,["ConnectionState"]:k.a[this.saa]})}).always(()=>{const {FrequentLoggingMetrics:Wa}=c(1397);ib&&ib.stop();Wa.instance&&(Wa.instance.OAe=!1)})}disconnect(){const {FrequentLoggingMetrics:za}=c(1397);0===this.saa?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.dw):(this.fu.$7i(),za.instance&&(za.instance.OAe=
!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.dw),this.spb.KEb=!0,this.Lwe.Dnn(),this.aja(0,this.saa),this.kLd(),this.spb.KEb=!1)}YDo(za){const ha=this.PRk(),Oa=this.bfa,ib=this.M6,Wa=()=>{if(this.$Te)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.$Te=!0,Oa.stop(!0,za)}catch(nb){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",nb.message)}};0<ha?(l.ULS.sendTraceTag(4309020,
500,50,"Waiting to stop connection [{0}]: [{1}] ms.",ib,ha),window.setTimeout(Wa,ha)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",ib),Wa())}PRk(){let za=0;0===this.bfa.state&&(za=this.xIe+Ka.T3o-(new Date).getTime(),0>za&&(za=0));return za}get connectionState(){return this.saa}Iua(za){this.zm.Iua(za)}qjc(za){this.zm.qjc(za)}ujj(za){this.Dkc(0,za)}Dkc(za,ha){const Oa=new a.a;this.zm.R6i(za,ha,Oa);return Oa.task}A_a(za){this.zm.A_a(za)}cPb(za){this.zm.cPb(za)}bGc(za){this.zm.bGc(za)}U6c(za){this.zm.U6c(za)}fCd(za){this.zm.fCd(za)}Ede(za){this.zm.Ede(za)}gSc(za){return this.Ljm(za)}BFb(){return this.e9b(0)}e9b(za){const ha=
{};for(let Oa of this.r3)Oa.value.nb(za)&&(ha[Oa.key]=Oa.value.J(za).data);return ha}Ljm(za){return this.r3.nb(za)&&this.r3.J(za).nb(0)?this.r3.J(za).J(0).data:null}Nvn(za,ha){for(let Oa of ha.U_o)this.r3.nb(Oa.key)||this.r3.Z(Oa.key,new M.a),za=Oa.value,this.r3.J(Oa.key).Z(ha.type,new v(za.Presence,new Date(za.TimeStamp))),Oa.key===this._clientId&&0===ha.type&&this.zm.mOn(za.Presence)}Mvn(za,ha){for(const Oa of ha.tGd)this.r3.remove(Oa)}bNl(){const za=new M.a;if(!this.r3.nb(this._clientId))return za;
for(let ha of this.r3.J(this._clientId))za.Z(ha.key,ha.value.data);return za}qN(za,ha=null,Oa=!1){const ib=new a.a;this.zm.s5f(za,ha,Oa,ib);return ib.task}S3(za){this.zm.S3(za)}dPb(za){this.zm.dPb(za)}Djb(za){let ha,Oa;return({value:ha}=this.r3.Fc(za)).returnValue&&({value:Oa}=ha.Fc(0)).returnValue?new m(this.Qjm(Oa),Oa.timeStamp):null}uPc(){const za={};for(let ha of this.r3)ha.value.Fc(0).returnValue&&(za[ha.key]=this.Djb(ha.key));return za}Prb(za){const ha=new a.a;this.zm.X6i(za,ha);return ha.task}get clientId(){return this._clientId}get Vyo(){return this.Yjk}dispose(){const {FrequentLoggingMetrics:za}=
c(1397);this.lm||(this.spb.n6(),this.Zf.X7f(this.fu),this.fu.k6f(),za.instance&&za.instance.kNf(),this.lm=!0)}Nmn(za,ha){this.jpc(ha,"StateChangedSignalR")&&this.aja(this.PJh(za.newState),this.PJh(za.oldState))}aja(za,ha){var {FrequentLoggingMetrics:Oa}=c(1397),{ClientToClientMessageTelemetry:ib}=c(1756);if((1!==this.saa||0!==ha||1!==za)&&this.saa!==ha){const Wa=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.saa,
ha,za]));l.ULS.sendTraceTag(3290053,500,10,Wa)}if(this.saa!==za){switch(za){case 2:Oa.instance&&Oa.instance.N$m();this.M6=this.bfa.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.M6,this.dw);this.W7m(this.bfa);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Oa=null;this.je&&(Oa=this.je.Yf("WebServiceCall","Receive First Presence"));ib=this.Jsc;this.zm.GOn(Object(e.a)(this,this.jpc,"verifyConnectionToken"),ib,this.Lwe,Object(e.a)(this,
this.X7e,"clearExistingPersistentState"),this.bNl(),Oa);this.Wf.T9n&&(Oa=100*Math.random()<=this.Wf.U9n,c(1756).ClientToClientMessageTelemetry.p$b(this.zm,this.Wf,Oa).start());break;case 1:2===ha&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.M6);break;case 0:if(ib.instance&&ib.instance.stop(),this.spb.KEb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.M6);else{1===ha&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.M6),this.fu.a8i());2===ha&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.M6);this.kLd();return}}this.saa=za;this.zm.LNn(za,ha)}}W7m(za){if(za&&za.transport&&za.transport.name){za=za.transport.name;var ha=za.toLowerCase();
"websockets"===ha?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",za,this.dw):"serversentevents"===ha?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",za,this.dw):"foreverframe"===ha?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",za,this.dw):"longpolling"===ha?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",za,this.dw):"mocktransport"!==ha&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
za)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}Cun(){if(this.Wf.jgj){const za=t.a.kP(this.nSa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.M6,za)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.M6)}tun(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.M6)}uun(za){za=c(1360).RtcUtils.xgc(za);if(this.Wf.jgj&&za.startsWith("Keep alive timed out.")){const ha=
t.a.kP(this.nSa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",za,ha)}else this.Vyo&&2E3>this.Rgh&&!za.startsWith("Invok")&&!za.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",za),this.Rgh++)}X7e(){let za;const ha=[];({value:za}=this.r3.Fc(this._clientId)).returnValue&&this.r3.remove(this._clientId);for(let Oa of this.r3.keys)Array.add(ha,Oa);for(const Oa of ha)this.r3.remove(Oa);za&&this.r3.Z(this._clientId,za);this.zm.gOn(ha)}PJh(za){switch(za){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",za,"Unknown SignalR state");}}Qjm(za){return za&&za.timeStamp?(new Date).getTime()-za.timeStamp.getTime()>(this.Wf.jJk?6E4:this.Wf.iJk)?2:1:1}static createInstance(za,ha,Oa,ib,Wa,nb,Db,Ma=null,Qa=null,fb=null,dc=null,bc=null,Bb=null){return oa(za,ha,Oa,Bb,ib,Wa,nb,Db,Ma,Qa,fb,bc,dc)}}Ka.QNi=31E3;Ka.XOf=8E3;Ka.T3o=15E3;Object(E.a)(Ka,"RealtimeChannel",null,[863,864])},1552:function(E,I,c){c.d(I,"a",function(){return l});
E=c(0);class l{constructor(){this.Uhh=!1;this.qyb=null;this.QQg=0;this.nBe=this.qOh();this.xid=this.qOh();this.Dtb=this.tXb=0;this.lq=()=>new Date}get mFo(){return this.Uhh}qOh(){const e=Array(6);for(let a=0;a<e.length;a++)e[a]=0;return e}$Xl(){return this.nBe.toString()}ASl(){return this.xid.toString()}JCo(){this.qyb=this.lq()}Y5c(e,a,k=!1){this.mFo||(k&&(this.Uhh=!0),k=this.lq(),0===e&&5<this.tXb||1===e&&5<this.Dtb||(this.QQg<e?(1===this.tXb%2&&(this.nBe[this.tXb]=-1,this.tXb++),this.QQg=e,1===
a&&(this.xid[this.Dtb]=-1,this.Dtb++),this.xid[this.Dtb]=this.tjg(k),this.Dtb++):0===e?(this.nBe[this.tXb]=this.tjg(k),this.tXb++):(this.xid[this.Dtb]=this.tjg(k),this.Dtb++)))}tjg(e){const a=e.getTime()-this.qyb.getTime();this.qyb=e;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(e){l._instance=e}}l._instance=null;Object(E.a)(l,"LatencyMetrics",null,[])},1583:function(E,I,c){E=c(0);class l{constructor(){this.FNg=this.Fwe=!1;this.callback=null}W1c(a){this.callback=
a;this.hBj()}hNi(a){this.Fwe||(this.Fwe=!0,this.zZj=a,this.hBj())}hBj(){this.Fwe&&this.callback&&!this.FNg&&(this.FNg=!0,this.callback(this.zZj))}}Object(E.a)(l,"CompletionTask",null,[]);c.d(I,"a",function(){return e});class e{constructor(){this.f7g=new l;this.d7g=new l}L7d(a){this.f7g.W1c(a)}K7d(a){this.d7g.W1c(a)}Y_c(a){this.f7g.hNi(a)}Lmb(a){this.d7g.hNi(a)}JOf(){this.Y_c(2);this.Lmb(2)}}Object(E.a)(e,"MessageStatus",null,[906])},1672:function(E,I,c){c.r(I);c.d(I,"MaxOutstandingThrottler",function(){return k});
E=c(0);var l=c(61),e=c(78);I=c(1673);var a=c(1583);class k extends I.a{constructor(x,y=""){super(x,y);this.Kfc=this.rrb=0;this.sa=new e.a;this.AYb=!1;this.gsd=this.Zid=this.yid=this.DVe=0;this.I3=[];this.clearTimeout=k.Idf}add(x){this.BYb||this.init(k.DQh,k.kQh);this.Vzb++;const y=new a.a;this.jdc?this.Ghe(x,y):this.gsd<this.Kfc?this.V8c(x,y):(this.Ghe(x,y),this.AYb=!1);return y}V8c(x,y){x=this.mfh(x);const m=this.setTimeout(Object(l.a)(this,this.Nqn,"onMessageWaitTimeExpired"),this.rrb);++this.gsd;
Array.add(this.I3,m);const t=this.yid;x.L7d(z=>{y.Y_c(z)});x.K7d(z=>{this.yid===t&&(this.Mqn(t,m),y.Lmb(z))})}Mqn(x,y){this.yid===x&&(--this.gsd,this.clearTimeout(y),Array.remove(this.I3,y),this.jdc&&this.Teo())}Teo(){this.jdc&&!this.AYb&&(this.DVe=this.setTimeout(Object(l.a)(this,this.Ueo,"sendThrottledMessageFromTimer"),0),this.AYb=!0)}Ueo(){this.AYb=!1;if(this.jdc){const x=this.Vyd,y=this.c1b;this.KIc(!1);this.V8c(x,y)}}Nqn(){++this.Zid;this.Zid>Math.floor(this.Kfc/2)&&(this.Zid=-1E9,this.sa.raiseEvent("TMUDM"))}iCd(x){this.sa.addHandler("TMUDM",
x)}reset(){this.Vzb=this.jEc=this.wuc=this.Zid=0;++this.yid;for(const x of this.I3)this.clearTimeout(x);this.gsd=0;this.I3=[];this.KIc(!0);this.AYb&&(this.clearTimeout(this.DVe),this.DVe=0,this.AYb=!1)}init(x,y){this.BYb||(this.rrb=x,this.Kfc=y,this.BYb=!0)}static createInstance(x,y=""){return new k(x,y)}static Idf(x){window.clearTimeout(x)}}k.DQh=15E3;k.kQh=5;Object(E.a)(k,"MaxOutstandingThrottler",I.a,[903,904])},1673:function(E,I,c){c.d(I,"a",function(){return e});E=c(0);var l=c(8);class e{constructor(a,
k=""){this.wuc=this.jEc=0;this.xGe=!1;this.c1b=this.Vyd=null;this.BYb=!1;this.mfh=a;this.jzj=k;this.setTimeout=e.Qdf;this.Vzb=this.jEc=this.wuc=0}j6f(){0<this.Vzb&&0<this.wuc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.jzj,this.wuc,this.Vzb);0<this.Vzb&&0<this.jEc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.jzj,this.jEc,this.Vzb)}get jdc(){return this.xGe}Ghe(a,k){this.jEc++;this.KIc(!0);this.xGe=
!0;this.Vyd=a;this.c1b=k}KIc(a){this.xGe=!1;this.c1b&&a&&(this.wuc++,this.c1b.JOf());this.c1b=this.Vyd=null}static Qdf(a,k){return window.setTimeout(a,k)}}Object(E.a)(e,"ThrottlerBase",null,[])},1674:function(E,I,c){c.r(I);c.d(I,"MaxRateThrottler",function(){return a});E=c(0);var l=c(61);I=c(1673);var e=c(1583);class a extends I.a{constructor(k,x=""){super(k,x);this.Sfc=0;this.pyc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.BYb||(this.Sfc=k,this.BYb=!0)}add(k){this.BYb||
this.init(a.$Ph);this.Vzb++;const x=this.currentTime(),y=new e.a;this.pyc>x&&(this.pyc=x);this.jdc?(this.KIc(!0),this.Ghe(k,y)):this.pyc+this.Sfc<=x?this.V8c(k,y):(this.Ghe(k,y),this.setTimeout(Object(l.a)(this,this.Seo,"sendThrottledMessage"),this.pyc+this.Sfc-x));return y}Seo(){if(this.jdc){const k=this.Vyd,x=this.c1b;this.KIc(!1);this.V8c(k,x)}}V8c(k,x){this.pyc=this.currentTime();k=this.mfh(k);k.L7d(y=>{x.Y_c(y)});k.K7d(y=>{x.Lmb(y)})}static createInstance(k,x=""){return new a(k,x)}}a.$Ph=200;
Object(E.a)(a,"MaxRateThrottler",I.a,[905,904])},1675:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(e,a,k,x){super();this.type=e;this.NL=a;this.sll=k;this.J8a=x}}Object(E.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1676:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);class l{}l.yag="rr";l.W9n="rd";l.S9n="rbp";l.Obg="sa";Object(E.a)(l,"RtcReconnectParams",null,[])},1677:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);class l{constructor(e,
a,k,x){this.odn=e;this.rrb=a;this.qbn=k;this.gmm=x}}Object(E.a)(l,"ThrottlerManagerSettings",null,[])},1735:function(E,I,c){E=c(0);class l extends Sys.EventArgs{constructor(M,O){super();this.newState=M;this.oldState=O}}Object(E.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(M,O){super();this.DZk=M;this.J8a=O}}Object(E.a)(e,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(M){super();this.presence=M}}Object(E.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1863),x=c(1862),y=c(1860);class m extends Sys.EventArgs{constructor(M,O=null){super();this.ek=M;this.Fnk=O}get type(){return this.ek}get NL(){return this.Fnk}}Object(E.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class t extends Sys.EventArgs{constructor(){super()}}Object(E.a)(t,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(M,O,U,X,P,Z){super();this.jpc=M;this.T9e=O;this.n4k=
U;this.VYh=P;this.X7e=X;this.YA=Z}}Object(E.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(M){super();this.hubConnection=M}}Object(E.a)(v,"RefreshProxyEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(M,O){super();this.tha=M;this.errorMessage=O}}Object(E.a)(H,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(M,O,U){super();this.type=M;this.presence=O;this.J8a=U}}Object(E.a)(F,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var G=c(1675);class L extends Sys.EventArgs{constructor(){super()}}Object(E.a)(L,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(M){super();this.tGd=M}}Object(E.a)(J,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class K extends Sys.EventArgs{constructor(M,O){super();this.type=M;this.U_o=O}}Object(E.a)(K,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var S=c(78);c.d(I,"a",function(){return R});class R{constructor(){this.sa=
new S.a}LNn(M,O){this.sa.raiseEvent("CSC",new l(M,O))}HOn(M){this.sa.raiseEvent("RP",new v(M))}yce(M){this.sa.raiseEvent("RC",M)}KOn(){this.sa.raiseEvent("RMID")}GOn(M,O,U,X,P,Z){this.sa.raiseEvent("RPS",new z(M,O,U,X,P,Z))}Y6i(M,O){this.sa.raiseEvent("UPSR",new K(M,O))}K6i(M,O){this.sa.raiseEvent("PU",new y.a(M,O))}mOn(M){this.sa.raiseEvent("MPU",new a(M))}s5f(M,O,U,X){this.sa.raiseEvent("SUN",new G.a(M,O,U,X))}ZOn(M,O){this.sa.raiseEvent("UNR",new m(M,O))}R6i(M,O,U){this.sa.raiseEvent("SP",new F(M,
O,U))}I6i(M,O){this.sa.raiseEvent("PSU",new x.a(M,O))}AOn(M){this.sa.raiseEvent("PSC",new k.a(M))}gOn(M){this.sa.raiseEvent("IPSC",new k.a(M))}$On(M){this.sa.raiseEvent("UPSC",new J(M))}MOn(M,O){this.sa.raiseEvent("SPC",new L(M,O))}O6i(M,O){this.sa.raiseEvent("RCF",new H(M,O))}$Nn(M){this.sa.raiseEvent("CPSWM",new t(M))}X6i(M,O){this.sa.raiseEvent("UCI",new e(M,O))}Iua(M){this.sa.addHandler("CSC",M)}qjc(M){this.sa.removeHandler("CSC",M)}Zyk(M){this.sa.addHandler("RP",M)}Yyk(M){this.sa.addHandler("RC",
M)}bzk(M){this.sa.addHandler("RMID",M)}Xyk(M){this.sa.addHandler("RPS",M)}wzk(M){this.sa.addHandler("UPSR",M)}A_a(M){this.sa.addHandler("PU",M)}cPb(M){this.sa.removeHandler("PU",M)}Wwk(M){this.sa.addHandler("IPU",M)}tzk(M){this.sa.addHandler("UCI",M)}gzk(M){this.sa.addHandler("SUN",M)}Xwk(M){this.sa.addHandler("IUNR",M)}S3(M){this.sa.addHandler("UNR",M)}dPb(M){this.sa.removeHandler("UNR",M)}bGc(M){this.sa.addHandler("PSU",M)}U6c(M){this.sa.removeHandler("PSU",M)}Vwk(M){this.sa.addHandler("IPSU",M)}fCd(M){this.sa.addHandler("PSC",
M)}Ede(M){this.sa.removeHandler("PSC",M)}Uwk(M){this.sa.addHandler("IPSC",M)}vzk(M){this.sa.addHandler("UPSC",M)}ezk(M){this.sa.addHandler("SP",M)}izk(M){this.sa.addHandler("SPC",M)}static getInstance(){return R._instance||(R._instance=new R)}}R._instance=null;Object(E.a)(R,"RtcEventHub",null,[893])},1740:function(E,I,c){c.r(I);E=c(0);var l=c(8),e=c(61),a=c(69),k=c(803);class x{}x.Sfc="throttling_messageDelay";x.KXc="enabled";x.rrb="throttling_timeToWaitForResponse";x.Kfc="throttling_maxNumberOfOutstandingMessages";
x.Uki="throttling_globalMaxNumberOfOutstandingMessages";x.errorMessage="errorMessage";x.rtj="url";x.cIa="queryString";x.yX="connectionString";Object(E.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=c(2),m=c(40),t=c(37),z=c(288),v=c(1212),H=c(75),F=c(18),G=c(131);class L{constructor(){this.Vki=this.NNi=this.ONi=this.TNi=0;this.t0d=!1;this.correlationId=this.yX=this.cIa=this.U9e=this.errorMessage=null}get i3k(){return this.U9e+"?"+this.cIa}}Object(E.a)(L,"FindSessionResponse",null,[]);
var J=c(541);class K{constructor(Y,da,ia,la,wa,va){this.ZYa=null;const {FindSessionStrategy:qa}=c(1740);this.ggk=Y;Y=String.format("{0}={1}",J.a.clientId,F.a.Gj(la));Y=String.format("{0}&{1}={2}",Y,J.a.userSessionId,F.a.Gj(wa));Y=String.format("{0}&{1}={2}",Y,J.a.PIj,F.a.Gj(ia.toString()));Y=String.format("{0}&{1}={2}",Y,J.a.userType,F.a.Gj("1"));Y=String.format("{0}&{1}={2}",Y,J.a.ZIj,F.a.Gj(da));Y=String.format("{0}&{1}={2}",Y,J.a.lFh,F.a.Gj(qa.FZk));(da=K.aof(ia,va))&&(Y=String.format("{0}&{1}",
Y,da));this.JZj=Y}Z8i(){this.ZYa=this.ggk()}generate(){this.ZYa&&""!==this.ZYa||(this.Z8i(),l.ULS.sendTraceTag(575784194,500,this.ZYa&&""!==this.ZYa?50:15,"Query signature delegate called for refresh returned: {0} ",this.ZYa));const Y=String.format("{0}={1}",J.a.vOb,F.a.Gj(this.ZYa));return String.format("{0}&{1}",Y,this.JZj)}static aof(Y,da){return 4===Y?String.format("{0}={1}",J.a.pRi,"1"):da?da.Sji():null}}Object(E.a)(K,"FindSessionQueryStringGenerator",null,[]);var S=c(1397),R=c(1552),M=c(1360),
O=c(1677);class U{}U.NEl="FSType";Object(E.a)(U,"RtcFindSessionRequestHeaders",null,[]);class X{}X.XPn="polling";Object(E.a)(X,"RtcFindSessionTypes",null,[]);var P=c(1676);class Z{}Z.G2o="RTC-TokenProofkey";Z.EXm="RTC-IsWacJsBootFsRequest";Object(E.a)(Z,"RtcRequestHeaders",null,[]);c.d(I,"FindSessionStrategy",function(){return ba});class ba{constructor(Y,da,ia,la,wa,va,qa,Na,Sa,Ia,ta,ra,fa=null){this.$3g=(new Date(0)).getTime();this.l6g=0;this.Xqd=!1;this.zfh=null;this.A6f=36E5;this.NVb=ba.yri;this.Xuc=
0;this.rPb=null;this.cUa=0;this.ekc=this.fIh=null;this.khk=[x.KXc,x.errorMessage,x.rtj,x.yX,x.cIa,x.Uki,x.Kfc,x.rrb,x.Sfc];this.jhk=[x.KXc,x.errorMessage];this.yX=this.nSa=null;this.yVg=new K(ta?ta:()=>y.AFrameworkApplication.am,wa,va,qa,Y,da);this.Yrc=ra;this.je=la;this.Zf=da;this.rBe=ia;this.dw=Na;this.zm=Sa;this.pvc=fa;this.zVg=!1;this.AOd=9E4;Ia&&Ia.execute(pa=>{pa.x_a(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.dw);this.yVg.Z8i()})});
2>=100*Math.random()&&(this.A6f=3E5);S.FrequentLoggingMetrics.instance&&(S.FrequentLoggingMetrics.instance.k3h=this.A6f)}$mo(Y){this.ekc=Y}init(){this.zm.bzk(Object(e.a)(this,this.d6n,"resetGetMachineIdDelay"));this.zm.Iua(Object(e.a)(this,this.aja,"onConnectionStateChanged"))}aja(Y,da){this.cUa=da.newState;2===da.newState&&(this.Xuc=0)}K9h(){let Y;Y=this.rPb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.rPb.cIa,ba.CKh,F.a.Gj(Y)),correlationId:Y}}tcm(Y,da,ia,la,wa){this.Ndo(()=>
{la(wa,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.yX,this.dw),Y(this.zfh),ia(this.Rhm()))},va=>{la(wa,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.dw),da(va))},la,wa)}fql(){this.SEh();this.jym()}Ndo(Y,da,ia,la){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.yX);if(this.yX)Y();
else{var wa=this.VQk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(Y,da,ia,la)},wa)}}sendFindSessionRequestToServerInternal(Y,da,ia,la){ia(la,"RequestMachineId")&&(this.$3g=(new Date).getTime(),ia=t.a.Ze(),this.DRd(wa=>{const va=t.a.Ze();this.H0i(wa);this.Odg();Y();wa=t.a.Ze()-va;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",wa)},wa=>{const va=t.a.Ze();this.SEh();S.FrequentLoggingMetrics.instance&&S.FrequentLoggingMetrics.instance.tP(2,3);da(wa);wa=
t.a.Ze()-va;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",wa)},!1),ia=t.a.Ze()-ia,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",ia))}jym(){this.NVb+=ba.a4l;this.NVb=Math.min(this.NVb,ba.$an)}VQk(){var Y=(new Date).getTime();Y=this.$3g+this.NVb-Y;0>Y&&(Y=0);return Y}H0i(Y){try{this.rPb=Y,this.nSa=Y.i3k,this.yX=Y.yX,this.fIh=Y.cIa,this.zfh=Y.U9e}catch(da){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
da.toString())}}SEh(){this.yX=null;this.TEh()}Odg(){this.TEh();this.Xqd=!0;this.l6g=window.setTimeout(Object(e.a)(this,this.fUn,"refreshMachineId"),this.A6f)}TEh(){this.Xqd&&(window.clearTimeout(this.l6g),this.Xqd=!1)}fUn(){this.Xqd=!1;this.DRd(Y=>{const da=this.fIh!==Y.cIa,ia=this.yX!==Y.yX,la=this.yX;this.H0i(Y);0!==this.cUa&&(ia?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",la||"null",Y.yX),this.zm.yce()):(this.zm.MOn(da,ia),this.Odg()))},
()=>{S.FrequentLoggingMetrics.instance&&S.FrequentLoggingMetrics.instance.tP(2,3);this.Odg()},!0)}d6n(){this.NVb=ba.yri}Rhm(){return new O.a(this.rPb.TNi,this.rPb.ONi,this.rPb.NNi,this.rPb.Vki)}FNo(Y){if(Object.getType(Y)!==Object)return null;for(let da in Y);return this.lal(Y)}lal(Y){if(!(x.KXc in Y))return null;const da=Y[x.KXc];var ia=da?this.khk:this.jhk;for(const la of ia)if(!(la in Y))return null;ia=Object.assign(new L,{t0d:Y[x.KXc],errorMessage:Y[x.errorMessage],correlationId:G.a.create().toString()});
da&&(ia.U9e=Y[x.rtj],ia.cIa=Y[x.cIa],ia.yX=Y[x.yX],ia.Vki=Y[x.Uki],ia.NNi=Y[x.Kfc],ia.ONi=Y[x.rrb],ia.TNi=Y[x.Sfc]);return ia}aYl(Y,da){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.pvc.q0h.continueWith(()=>{this.pvc.q0h.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),Y(this.pvc.r0h)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),da(this.pvc.r0h))})}Pdj(Y,da,ia,la,wa=
!1){return va=>{R.a.instance.Y5c(0,1);Y&&Y.stop();this.Yrc=this.ekc=null;this.dLi(va.data,!0,da);var qa=M.RtcUtils.deserialize(va.data.se,"FindSession",null);if(qa)if(qa=this.FNo(qa)){if(qa.t0d&&qa.cIa&&qa.yX){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.dw);this.I4m(va.data);ia(qa);return}da.FindSessionFailureReason="FindSessionInvalidResponse";da.IsRtcEnabled=qa.t0d;da.IsQueryStringEmpty=!qa.cIa;da.IsConnectionStringEmpty=!qa.yX;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.dw,qa.t0d,!qa.cIa,!qa.yX)}else da.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.dw);else da.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.dw);this.P6i(da,wa);la(null)}}Jdj(Y,da,ia,la=!1){return wa=>{R.a.instance.Y5c(0,1);Y&&Y.stop();this.Yrc=this.ekc=null;this.dLi(wa.data,!1,da);let va=null;var qa="unknown";let Na="unknown";wa.data&&((qa=wa.data.Cj)&&ba.k8c in qa&&(va=qa[ba.k8c].toString()),qa=v.a[wa.data.status],Na=wa.data.Se.toString());da.FindSessionFailureReason="FindSessionRequestFailed";da.HttpErrorCode=Na;da.HttpErrorStatus=qa;da[ba.k8c]=va;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
qa,Na,this.dw,va,la);this.P6i(da,la);ia(Na)}}DRd(Y,da,ia=!1){let la=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.dw);const wa={};var va=this.yVg.generate();wa[z.a.aR]=G.a.create().toString();this.ekc&&""!==this.ekc?va=String.format("{0}&{1}={2}",va,P.a.yag,this.ekc):this.Yrc&&""!==this.Yrc&&(va=String.format("{0}&{1}={2}",va,P.a.yag,this.Yrc),wa[Z.G2o]="True",wa[Z.EXm]="True");va=this.rBe+"?"+va;ia&&(wa[U.NEl]=X.XPn);const qa={};qa.IsNetworkOfflineBeforeSendRequest=
this.Zf.yRa;qa.HasAvailableConnectionsBeforeSendRequest=this.Zf.UVd;qa.MaxConnectionsAllowed=this.Zf.Hfc;qa.IsRefreshMachineId=ia;this.pvc&&!this.zVg?(this.aYl(this.Pdj(null,qa,Y,da,ia),this.Jdj(null,qa,da,ia)),this.zVg=!0):(this.je&&(la=this.je.Yf("WebServiceCall","GetMachineIdFromTheServer")),S.FrequentLoggingMetrics.instance&&S.FrequentLoggingMetrics.instance.tP(2,0),0>this.Zf.QAb(va,1,null,wa,[ba.HId,ba.k8c,ba.C1c,ba.xag,ba.mQi,ba.SSi,ba.RSi],1,this.Pdj(la,qa,Y,da,ia),this.Jdj(la,qa,da,ia),null,
!1,null,this.AOd,"3",null,!0)&&(5<this.Xuc&&200>this.Xuc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Xuc),window.setTimeout(()=>{this.Xuc++;da("-1")},1E3)))}dLi(Y,da,ia){ia||(ia={});ia.IsNetworkOfflineAfterRequestComplete=this.Zf.yRa;ia.IsRequestSucceeded=da;Y&&(ia.EnqueueTime=Y.oPa,ia.InvokedTime=Y.$H,ia.CompletedTime=Y.ZT,Y.Cj&&(ba.HId in Y.Cj&&(ia.CorrelationId=Y.Cj[ba.HId]),ba.C1c in Y.Cj&&(ia[ba.C1c]=
Y.Cj[ba.C1c])));l.ULS.sendTraceTag(38633565,500,da?50:15,M.RtcUtils.xgc(ia))}P6i(Y,da){Y||(Y={});Y.ConnectionState=k.a[this.cUa];da||this.zm.O6i(1,Y)}I4m(Y){try{var da=!1,ia=!1,la=Y.Cj,wa=m.a.YX(Y.request.get_url());if(la&&ba.xag in la){const Ia=la[ba.xag].toString().toLocaleLowerCase();ia="true"===Ia;da="false"===Ia}la=!1;const Sa=0<=wa.toLocaleLowerCase().indexOf("collab");ia&&!Sa?la=!0:da&&Sa&&(la=!0);if(la){da={};da.HostName=wa;da.Status=v.a[Y.status];da.HttpStatus=Y.Se.toString();var va=Y.request.get_headers();
for(let Ia in va){var qa=va[Ia];(wa=Ia)&&0<wa.length&&(ia=0,qa&&(ia=qa.toString().length),da["r_"+wa]=ia)}if(Y.Cj){const Ia=new a.a;Ia.add(ba.HId);Ia.add(ba.C1c);Ia.add(ba.k8c);Ia.add(ba.SSi);Ia.add(ba.RSi);Ia.add(ba.mQi);ba.Euk(da,Y.Cj,Ia)}ba.puk(Y.request.get_url(),da);var Na=H.a.toJSON(da);l.ULS.sendTraceTag(559437006,500,15,Na)}}catch(Sa){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Sa.toString())}}static createInstance(Y,da,ia,la,wa,va,qa,Na,Sa,Ia,ta,ra=null){return ba.obl(Y,
da,ia,la,wa,va,qa,Na,Sa,Ia,ta,ra)}static obl(Y,da,ia,la,wa,va,qa,Na,Sa,Ia,ta,ra=null){Y=Y||G.a.create().toString();Y=new ba(Y,da,ia,la,wa,va,qa,Na,Sa,Ia,null,ta,ra);Y.init();return Y}static Euk(Y,da,ia){for(let la of ia)la in da&&(Y[la]=da[la])}static puk(Y,da){if(Y){var ia=Y.indexOf("?");if(-1!==ia)for(Y=Y.substr(ia+1).split("&"),ia=0;ia<Y.length;++ia){var la=Y[ia].split("=");if(2===la.length){const wa=la[0];if(wa&&0<wa.length){let va=0;if(la=la[1])va=la.length;da["q_"+wa]=va}}}}}}ba.a4l=3E3;ba.$an=
3E5;ba.FZk="1.0";ba.yri=1E3;ba.HId="X-CorrelationId";ba.CKh="corrid";ba.k8c="RtcErrorCode";ba.C1c="X-OfficeCluster";ba.xag="X-NewEnv";ba.mQi="X-MSEdge-Ref";ba.RSi="X-OFFICEFD";ba.SSi="X-OfficeFE";Object(E.a)(ba,"FindSessionStrategy",null,[889])},1756:function(E,I,c){c.r(I);E=c(0);var l=c(8),e=c(61),a=c(418),k=c(54),x=c(69);class y{constructor(t){this.messageId=t;this.Weo=(new Date).getTime();this.aKf=new x.a}}Object(E.a)(y,"MessageLatencyDetails",null,[]);c.d(I,"ClientToClientMessageTelemetry",function(){return m});
class m{constructor(t,z,v){this.sMa=null;this.aKe=this.eSe=0;this.Wf=z;this.g7g=v;this.YCc=!1;this.zm=t;this.zm.S3(Object(e.a)(this,this.vQn,"receiveMessage"))}start(){if(this.g7g&&!this.YCc){const t=this.Wf.ngj;this.aKe=this.Wf.igj;t<=this.aKe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Wf.ngj,this.Wf.igj),this.g7g=!1):
(this.YCc=!0,this.eSe=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),t))}}sendMessage(){if(this.YCc){const t=k.a.create().toString();this.sMa=new y(t);this.zm.s5f(16,t,!1,new a.a);window.setTimeout(()=>{this.u6m(t)},this.aKe)}}u6m(t){this.sMa&&this.sMa.messageId===t&&(0<this.sMa.aKf.count?(t=this.sMa.aKf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",t)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.sMa=
null)}stop(){this.eSe&&(window.clearInterval(this.eSe),this.YCc=!1)}vQn(t,z){16===z.type?this.zm.s5f(17,z.NL,!1,new a.a):17===z.type&&this.YCc&&z.NL&&this.processMessage(z.NL)}processMessage(t){t&&this.sMa&&t.toString()===this.sMa.messageId&&(t=(new Date).getTime()-this.sMa.Weo,this.sMa.aKf.add(t))}static get instance(){return m._instance}static p$b(t,z,v){return m.instance||(m._instance=new m(t,z,v))}}m._instance=null;Object(E.a)(m,"ClientToClientMessageTelemetry",null,[])},1860:function(E,I,c){c.d(I,
"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.Zra=e;this.lLd=a}}Object(E.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1861:function(E,I,c){c.r(I);c.d(I,"RealtimeChannelMetrics",function(){return x});E=c(0);var l=c(8),e=c(185),a=c(75),k=c(1360);class x{constructor(){this.N8g=this.O8g=this.P8g=this.J8g=this.I8g=this.K8g=this.Uzc=this.OLe=0;this.yLa=this.XIe=this.ryc=this.JIe=this.aYa=this.wIe=this.gcb=this.cyc=this.KYb=this.vIe=this.Ald=this.gXb=
null;this.mKe=this.jzc=this.xfh=this.MOg=0;this.h7g=!1;this.U7i=this.V5f;this.X7i=this.Y5f;this.W7i=this.X5f;this.a8i=this.$5f;this.$7i=this.Z5f;this.k6f=this.l6f;this.Z5c=this.i6f;this.HOb=this.g6f;this.IOb=this.h6f;this.V7i=this.W5f;this.P5a=this.WSf;this.ULb=this.XSf}V5f(){this.OLe++;this.vIe=new Date;this.gXb||(this.gXb=new Date)}Y5f(){this.Uzc++;this.gcb=new Date;this.Ald||(this.Ald=this.gcb);this.ryc=this.gcb;this.C3k()}X5f(){this.K8g++;this.wIe=new Date}$5f(){this.I8g++;this.KYb=new Date}Z5f(){this.J8g++;
this.cyc=new Date}i6f(){this.aYa=new Date;this.P8g++}h6f(){this.yLa||(this.yLa=new Date);this.O8g++}g6f(){this.JIe=new Date;this.N8g++}l6f(){!this.h7g&&this.OLe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.s0k())),this.h7g=!0)}W5f(y){let m,t;({wpi:y,ypi:m,exception:t}=k.RtcUtils.pAl(y));y&&y!==e.a.Zz&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:m,["Exception"]:t})),e.a.DDf(y)&&this.MOg++,e.a.IHf(y)&&this.xfh++)}WSf(){this.XIe=new Date}XSf(){this.KYb=
this.ryc=new Date}s0k(){return{["numberOfConnectionAttempts"]:this.OLe,["numberOfSuccessfulConnections"]:this.Uzc,["numberOfFailedConnections"]:this.K8g,["numberOfDisconnectedConnections"]:this.I8g,["numberOfExplicitDisconnectedConnections"]:this.J8g,["numberOfSentMessages"]:this.P8g,["numberOfReceivedMessages"]:this.O8g,["numberOfLostMessages"]:this.N8g,["firstConnectionAttempt"]:this.gXb?this.gXb:null,["firstMessageReceived"]:this.yLa?this.yLa:null,["firstConnectionSuccess"]:this.Ald?this.Ald:null,
["lastConnectionAttempt"]:this.vIe?this.vIe:null,["lastConnectionSuccess"]:this.gcb?this.gcb:null,["lastConnectionFailure"]:this.wIe?this.wIe:null,["lastMessageSent"]:this.aYa?this.aYa:null,["lastMessageLost"]:this.JIe?this.JIe:null,["lastDisconnect"]:this.KYb?this.KYb:null,["lastExplicitDisconnect"]:this.cyc?this.cyc:null,["lastTimeOnline"]:this.ryc?this.ryc:null,["lastTimeOffline"]:this.XIe?this.XIe:null,["maxDisconnectedTimeMs"]:this.jzc,["maxExplicitDisconnectedTimeMs"]:this.mKe,["clientConnectionErrors"]:this.MOg,
["serverConnectionErrors"]:this.xfh}}C3k(){this.gXb&&1===this.Uzc&&(this.jzc=Math.max(this.jzc,this.gcb.getTime()-this.gXb.getTime()));this.KYb&&1<this.Uzc&&(this.jzc=Math.max(this.jzc,this.gcb.getTime()-this.KYb.getTime()));this.cyc&&1<this.Uzc&&(this.mKe=Math.max(this.mKe,this.gcb.getTime()-this.cyc.getTime()))}static createInstance(y){x._instance||(x._instance=new x,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x._instance}}x._instance=null;Object(E.a)(x,
"RealtimeChannelMetrics",null,[890,223])},1862:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.type=e;this.Zra=a}}Object(E.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1863:function(E,I,c){c.d(I,"a",function(){return l});E=c(0);class l extends Sys.EventArgs{constructor(e){super();this.tGd=e}}Object(E.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2096:function(E,I,c){c.r(I);var l=c(0),e=c(61);class a{constructor(Fa,
ub){this.Rfa=null;this.cBc=Fa;this.efk=ub}init(){this.cBc.continueWith(()=>{this.Rfa=this.cBc.result;this.Rfa.N2b(Object(e.a)(this,this.Jda,"onUsersUpdated"))})}Jda(){a.M2e(this.Rfa.e2a())&&(this.Rfa.K8f(Object(e.a)(this,this.Jda,"onUsersUpdated")),this.efk.IsRealCoauthSession=!0)}get YSm(){return this.Rfa?a.M2e(this.Rfa.e2a()):!1}static M2e(Fa){let ub=null;for(const gc of Fa)if(gc)if(Fa=gc.isAnonymous||!gc.email?gc.clientId:gc.email.toUpperCase(),!ub)ub=Fa;else if(ub!==Fa)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[794]);var k=c(8),x=c(418),y=c(67),m=c(2),t;(function(Fa){Fa[Fa.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Fa[Fa.notImplemented=1]="notImplemented";Fa[Fa.renderHandled=2]="renderHandled";Fa[Fa.renderHandledWithVeto=3]="renderHandledWithVeto"})(t||(t={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",t);var z=c(76),v=c(75),H=c(117);class F{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne){this.Nah=this.hPg=this.FD=null;this.x6=Fa;this.Ixd=new x.a;this.Ca=gc;this.pwe=
ub;this.yZ=Rb;this.Vf=wd;this.iOe=Hc;this.Zcb=de;this.eWj=We;this.oYg=this.hYg=!1;this.azd=0;this.fPg=1;this.ktb=Ne;this.VEc=this.Ca.$("PeoplesWellExtraButtonInfoIsEnabled");this.Tea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Jvj(){return this.Ixd.task}init(){H.Task.WAA.call(null,this.Zcb,this.pwe,this.iOe).continueWith(()=>{this.FD=this.Zcb.result;this.hPg=this.pwe.result;this.Nah=this.iOe.result;H.Task.WAA.call(null,this.pwe.result.U4b,this.iOe.result.szj).continueWith(()=>
{this.fPg=this.hPg.U4b.result;this.azd=this.Nah.szj.result;this.FD.N2b(Object(e.a)(this,this.T8d,"onUsersUpdatedEventListener"));this.FD.e2a().length&&this.Jda()})})}T8d(){this.Jda()}Jda(){this.eWj(this.FD.e2a())?(this.FD.K8f(Object(e.a)(this,this.T8d,"onUsersUpdatedEventListener")),this.pon(this.hYg)):this.Ixd.xS(1);this.hYg=!0}pon(Fa){this.oYg?this.Jvj.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",t[this.Jvj.result])}):(this.oYg=
!0,this.NJn(0===this.fPg&&!Fa))}NJn(Fa){Fa?this.yZ.pk(4,Object(e.a)(this,this.YWf,"onInteractiveReady")):this.Ixd.xS(1)}YWf(){const Fa=this.Vf.pF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.azd);const ub=this.azd-Fa,gc={};gc.InteractiveTime=Fa;gc.ReactRenderComplete=this.azd;gc.HadTabSwitch=this.ktb();gc.IsModernGallery=this.VEc;k.ULS.sendTraceTag(594883104,325,50,v.a.toJSON(gc));this.VEc?(k.ULS.sendTraceTag(42062997,325,15,ub.toString()),this.Ixd.xS(this.d3o(ub)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,ub.toString())}d3o(Fa){const ub=Fa>this.Ca.mc("CoauthorGalleryTimeToRenderDurationMs",1E4),gc="Word"===this.Tea;if(this.ktb())return k.ULS.sendTraceTag(50455714,325,50,ub.toString()),!1;gc&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);ub&&(gc&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Fa.toString()));
return ub}}Object(l.a)(F,"CoauthorGalleryTelemetry",null,[793]);class G{constructor(Fa){this.FD=null;this.Yhd={};this.Ltd={};this.Qwc=null;this.Zcb=Fa}HTd(Fa){const ub=new x.a;this.init().continueWith(()=>{Fa in this.Yhd?ub.xS(this.Yhd[Fa]):this.Ltd[Fa]=ub});return ub.task}init(){if(this.Qwc)return this.Qwc.task;this.Qwc=new x.a;this.Zcb.continueWith(()=>{this.FD=this.Zcb.result;this.FD.N2b(Object(e.a)(this,this.Jda,"onUsersUpdated"));this.jHj();this.Qwc.Dg(null)});return this.Qwc.task}jHj(){const Fa=
this.FD.e2a();Fa.sort(Object(e.a)(this,this.a3k,"comparePresenceUsers"));this.Yhd={};for(let ub=0;ub<Fa.length&&Fa[ub]&&Fa[ub].URa;ub++)this.huk(this.Yhd,Fa[ub].clientId,ub)}huk(Fa,ub,gc){Fa[ub]=gc;ub in this.Ltd&&(this.Ltd[ub].xS(gc),delete this.Ltd[ub])}Jda(){this.jHj()}a3k(Fa,ub){return Fa.URa>ub.URa?1:Fa.URa<ub.URa?-1:0}}Object(l.a)(G,"CoauthorPositionFinder",null,[791]);var L=c(542),J=c(328),K=c(458),S=c(69),R=c(131);class M{constructor(){this.OCa=null;this.Hrc=Array(32)}xor(Fa){if(!Fa)throw Error.argumentNull("Guid argument cannot be null");
const ub=new M,gc=new Sys.StringBuilder;for(let Rb=0;Rb<Fa.Hrc.length;Rb++){const wd=this.Hrc[Rb]^Fa.Hrc[Rb];ub.Hrc[Rb]=wd;gc.append(wd.toString(16));7!==Rb&&11!==Rb&&15!==Rb&&19!==Rb||gc.append("-")}ub.OCa=R.a.Hf(gc.toString());return ub}toString(){return this.OCa.toString()}equals(Fa){if(!Fa)throw Error.argumentNull("Guid argument cannot be null");return this.OCa.equals(Fa.OCa)}static W8b(Fa){if(!Fa)throw Error.argumentNull("String input cannot be null");const ub=new M;ub.OCa=R.a.Hf(Fa);const gc=
ub.OCa.toString();let Rb=0;for(let Hc=0;Hc<gc.length;Hc++){var wd=Fa.charAt(Hc);if(M.VNm(wd))wd=M.aum(wd,Fa.charCodeAt(Hc)),ub.Hrc[Rb++]=wd;else if(!M.qNm(wd))throw Error.argument("String contains characters not valid in Guids");}return ub}static VNm(Fa){return"0"<=Fa&&"9">=Fa||"A"<=Fa&&"F">=Fa||"a"<=Fa&&"f">=Fa}static qNm(Fa){return"{"===Fa||"}"===Fa||"-"===Fa}static aum(Fa,ub){if("0"<=Fa&&"9">=Fa)return ub-48;if("A"<=Fa&&"F">=Fa)return ub-65+10;if("a"<=Fa&&"f">=Fa)return ub-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(M,"Guid",null,[]);class O{constructor(Fa,ub,gc,Rb){this.Rfa=null;this.BRg=this.O7g=!1;this.O4g=0;this.cBc=Fa;this.KUe=ub;this.Ca=gc;this.sZb=Rb;this.zVj=m.AFrameworkApplication.qTb||m.AFrameworkApplication.bqa;this.X5g=new L.a(J.a.hh())}get $cf(){return this.Ca.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.cBc.continueWith(()=>{this.Rfa=this.cBc.result;this.Rfa.N2b(Object(e.a)(this,this.Jda,"onUsersUpdated"))})}Jda(){this.p0k(this.Rfa.e2a())}p0k(Fa){var ub=
0;const gc=new K.a(J.a.hh());for(const Rb of Fa)if(Rb&&Rb.isAnonymous){m.AFrameworkApplication.oe("70eb6120;2gfeb930");if(gc.nb(Rb.userName))gc.J(Rb.userName).add(Rb.clientId);else{let wd;gc.add(Rb.userName,(wd=new S.a,wd.add(Rb.clientId),wd))}Rb.clientId!==this.sZb?(ub++,2<=ub&&!this.O7g&&this.z6m()):!this.BRg&&this.$cf&&"Guest"===Rb.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.BRg=!0)}if(this.$cf&&this.O4g!==ub){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
ub+(this.zVj?1:0));this.O4g=ub;for(let Rb of gc.keys)2<=gc.J(Rb).count&&(Fa=this.nWl(gc.J(Rb)),this.X5g.contains(Fa)||(ub={},ub.guestsWithSameName=gc.J(Rb).count,ub.identifier=Fa,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",ub),this.X5g.add(Fa)))}}z6m(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.O7g=!0;this.$cf&&this.KUe&&this.KUe.continueWith(()=>{window.setTimeout(()=>{this.KUe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}nWl(Fa){if(!Fa||1>=Fa.count)return"";let ub=M.W8b(Fa.J(0));for(let gc=1;gc<Fa.count;gc++)ub=ub.xor(M.W8b(Fa.J(gc)));return ub.toString()}}Object(l.a)(O,"GuestCoauthTelemetry",null,[]);var U=c(228);class X{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(X,"PL",null,[]);var P=c(29);class Z{constructor(){this.ct=this.vt=this.d=0}static Kjj(Fa,ub,gc){const Rb=new Z;Rb.d=Fa;Rb.vt=ub;Rb.ct=gc;return P.c(Rb)}}Object(l.a)(Z,"VD",null,
[]);var ba=c(111);class Y{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch){this.Gfh=!1;this._id=Fa;this.ki=ub;this.shh=gc;this.xs=Rb;this.gLe=wd;this.AVe=Hc;this.oAb=de;this.aub=We;this.MYj=Ne;this.ktb=ng;this.Ukh=Ch;this.Tea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}gpe(Fa){const ub=[this.gLe,this.AVe];this.Ukh&&ub.push(this.shh);H.Task.WAA.apply(null,ub).continueWith(()=>{if(this.gLe.result<=this.AVe.result)Fa.xS(!1);else{this.Ukh&&(this.ki=this.shh.result);
var gc=this.xs-this.ki,Rb=new X;Rb.id=this._id;Rb.et=this.xs;Rb.st=this.ki;Rb.d=this.xs-this.ki;Rb.mp=this.gLe.result;Rb.tp=this.AVe.result;Rb.ct=this.sRl(this.MYj);Rb.vc=this.ktb();var wd=P.c(Rb),Hc="Word"===this.Tea,de="PowerPoint"===this.Tea;k.ULS.sendTraceTag(42078597,302,15,wd);if(Hc){const We=new Map;We.set("data",wd);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",We)}gc>this.oAb.value&&!this.Gfh&&!Rb.vc&&(this.Gfh=!0,Fa.xS(!0),Rb=Object.assign(new ba.a,{inStaging:!0,
extendedProperties:new Map}),Rb.extendedProperties.set("data",wd),Hc&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Rb),gc<this.aub.value&&(k.ULS.sendTraceTag(42078598,302,15,Z.Kjj(gc,this.oAb.value,this.aub.value)),gc=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),de&&gc&&z.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],
!1,!0,!0,!1,Rb)));Fa.task.isCompleted||Fa.xS(!1)}})}sRl(Fa){switch(Fa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(Y,"PresenceLatencyActivityLogger",null,[]);class da{constructor(Fa,ub,gc){this.WNg=this.dPg=this.Ehd=this.Xhd=this.xUb=0;this._id=Fa;this.oAb=ub;this.aub=gc;this.Tea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get esh(){return this.xUb}set esh(Fa){this.xUb=Fa;this.r7e()}get PFh(){return this.Xhd}set PFh(Fa){this.Xhd=
Fa;this.r7e()}get SBh(){return this.Ehd}set SBh(Fa){this.Ehd=Fa;this.r7e()}get QFh(){return 0!==this.dPg}get TBh(){return 0!==this.WNg}r7e(){!this.QFh&&this.xUb&&this.Xhd&&(this.dPg=this.gpe(this.Xhd,"CoauthGalleryLightupDurationTooLong"));!this.TBh&&this.xUb&&this.Ehd&&(this.WNg=this.gpe(this.Ehd,"CanvasPresenceLightupDurationTooLong"))}gpe(Fa,ub){const gc=Fa-this.xUb;var Rb=new X;Rb.id=this._id;Rb.et=Fa;Rb.st=this.xUb;Rb.d=gc;var wd=P.c(Rb),Hc="Word"===this.Tea;Fa="PowerPoint"===this.Tea;Rb="CanvasPresenceLightupDurationTooLong"===
ub?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===ub?k.ULS.sendTraceTag(572289499,302,15,wd):k.ULS.sendTraceTag(571524118,302,15,wd);if(Hc){var de=new Map;de.set("data",wd);z.Health.instance.recordKpiUsage(Rb,0,"wordcollabrel",de)}return gc>this.oAb.value?(de=Object.assign(new ba.a,{inStaging:!0,extendedProperties:new Map}),de.extendedProperties.set("data",wd),wd=gc<this.aub.value,de.extendedProperties.set("cash",wd?"true":"false"),Hc&&z.Health.instance.recordKpiFailure(Rb,
ub,!1,!0,de),Hc=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientRenderLatencyQoSError"),Fa&&Hc&&z.Health.instance.recordQosError(ub,[Rb],!1,!0,!0,!1,de),k.ULS.sendTraceTag(572289500,302,15,Z.Kjj(gc,this.oAb.value,this.aub.value)),wd?2:1):3}}Object(l.a)(da,"PresenceLightupLatencyLogger",null,[]);var ia=c(42),la=c(151);class wa{constructor(Fa,ub,gc,Rb,wd,Hc,de,We=null,Ne=null,ng=null){this.Tbh={};this.owe={};this.s3g=new S.a;this.mhd=this.Rwc=this.FD=
this.jj=null;this.QTe=this.NTe=0;this.oAb=new U.a(()=>We.vU("PresenceBootLatencyThreshold",1E4));this.aub=new U.a(()=>We.vU("PresenceBootLatencyCutoffThreshold",6E4));this.xok=new U.a(()=>We.vU("PresenceLightupLatencyThreshold",2E3));this.R_j=new U.a(()=>We.vU("PresenceLightupLatencyCutoffThreshold",1E4));this.yZ=Rb;this.Ca=We;this.lfk=wd;this.gPg=Fa;this.seh=ub;this.Zcb=gc;this.Vf=Hc;this.sZb=Ne;this.ktb=de;this.wYg=ng;this.Due=!1;this.init()}hNc(Fa,ub,gc=null,Rb=0){gc&&(k.ULS.shipAssertTag(42274970,
302,!this.sZb||this.sZb===gc,"_myClientId is already set and you are trying to update it to something different"),this.sZb=gc);const wd=new x.a;this.init().continueWith(()=>{this.jsn(Fa);this.Lvl(wd,Fa,ub,Rb)})}get GSf(){return this.sZb||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.Rwc)return this.Rwc.task;this.Rwc=new x.a;this.ktb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.gPg.continueWith(()=>{const Fa=this.gPg.result,ub=Fa.U4b,gc=Fa.Hen;gc.continueWith(()=>
{ub.continueWith(()=>{this.wYg&&this.wYg.addQosPillar("RealTimeCoauth");this.fjg(ub.result,gc.result);this.Rwc.Dg(null)})})});this.seh.continueWith(()=>{this.jj=this.seh.result;this.jj.Iua(Object(e.a)(this,this.ztn,"onRtcConnection"));this.jj.S3(Object(e.a)(this,this.mmn,"onCoauthorBootReceived"))});this.Zcb.continueWith(()=>{this.FD=this.Zcb.result;this.FD.N2b(Object(e.a)(this,this.T8d,"onUsersUpdatedEventListener"));0<this.FD.e2a().length&&this.Jda()});return this.Rwc.task}M6h(){return this.Vf.Pga(ia.a.y9a)?
this.Vf.pF(ia.a.y9a):la.a.Bfb?window.performance.timing.fetchStart:-1}Tai(){this.mhd||(this.mhd=new x.a,this.yZ.pk(4,()=>{this.mhd.xS(this.Vf.pF("AppInitStatus_interactivityReady"))}));return this.mhd.task}ztn(Fa,ub){if(!this.Due&&2===ub.newState)if(this.Goe){const gc=this.Tai();gc.continueWith(()=>{var Rb=gc.result;Rb=Date.now()-Rb;const wd={};wd.clientId=this.GSf;wd.bootTime=Rb;this.Due=!0;this.jj.qN(15,wd)})}else Fa=this.M6h(),Fa=Date.now()-Fa,ub={},ub.clientId=this.GSf,ub.bootTime=Fa,this.Due=
!0,this.jj.qN(15,ub)}mmn(Fa,ub){if(15===ub.type){Fa=Date.now();ub=ub.NL;var gc=ub.bootTime;this.Nrf(ub.clientId).esh=Fa-gc}}T8d(){this.Jda()}Jda(){const Fa=Date.now();var ub=this.FD.e2a();const gc=new S.a;for(const Rb of ub)this.s3g.contains(Rb.clientId)||(this.s3g.add(Rb.clientId),gc.add(Rb.clientId));if(0<gc.count)for(let Rb of gc)ub=this.Nrf(Rb),ub.QFh||(ub.PFh=Fa)}jsn(Fa){Fa=this.Nrf(Fa);Fa.TBh||(Fa.SBh=Date.now())}Nrf(Fa){return Fa in this.owe?this.owe[Fa]:this.owe[Fa]=new da(Fa,this.xok,this.R_j)}fjg(Fa,
ub=0){this.NTe=Fa;this.QTe=ub?ub:(new Date).getTime()}Lvl(Fa,ub,gc,Rb){gc=gc?gc.getTime():(new Date).getTime();if(ub in this.Tbh)Fa.Cka();else{const wd=this.Goe?0:this.Yem(),Hc=this.Goe?this.Zem():null;Rb=new Y(ub,wd,Hc,gc,this.HTd(this.GSf),this.HTd(ub),this.oAb,this.aub,Rb,this.ktb,this.Goe);this.Tbh[ub]=Rb;Rb.gpe(Fa)}}Yem(){return 1===this.NTe?this.QTe:this.M6h()}Zem(){return 1===this.NTe?H.Task.z4(this.QTe):this.Tai()}HTd(Fa){return this.lfk.HTd(Fa)}get Goe(){return this.Ca.$("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(l.a)(wa,"PresenceBootTelemetry",null,[790]);var va=c(120),qa=c(162),Na=c(217),Sa=c(21),Ia=c(574);class ta{get name(){return"Common.App.CoauthTelemetry"}wc(Fa){Fa.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().Ud(()=>new a(Ia.a.Fp(Fa.Ta("Common.IPeopleInfoProvider")),m.AFrameworkApplication.Og));Fa.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ha().Ud(()=>new F(m.AFrameworkApplication.va,
Ia.a.Fp(Fa.Ta("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.K,va.a.get_instance(),Na.a.instance,Ia.a.Fp(Fa.Ta("Common.IPeoplesWell")),Ia.a.Fp(Fa.Ta("Common.IPeopleInfoProvider")),a.M2e,()=>this.Hyh()));Fa.register(wa,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ha().Ud(()=>new wa(Ia.a.Fp(Fa.Ta("Common.ICoauthoringTelemeryInfoProvider")),Ia.a.Fp(Fa.Ta("Common.IRealtimeChannelBasic")),Ia.a.Fp(Fa.Ta("Common.IPeopleInfoProvider")),
va.a.get_instance(),Fa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Na.a.instance,()=>this.Hyh(),m.AFrameworkApplication.K,null,z.Health.instance));Fa.register(G,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ha().Ud(()=>new G(Ia.a.Fp(Fa.Ta("Common.IPeopleInfoProvider"))));Fa.register(O,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ha().Ud(()=>new O(Ia.a.Fp(Fa.Ta("Common.IPeopleInfoProvider")),Ia.a.Fp(Fa.Ta("Common.ISystemInitiatedFeedback")),
m.AFrameworkApplication.K,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.Nn(()=>{Sa.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Sa.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Sa.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(Sa.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
Sa.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Hyh(){return la.a.Bfb&&Na.a.instance.Pga(ia.a.aed)?0<Na.a.instance.pF(ia.a.aed)[ia.a.eKj]:!1}static main(){qa.a.instance.Gc(new ta)}}Object(l.a)(ta,"CoauthTelemetryPackage",null,[1,2]);class ra extends Sys.EventArgs{constructor(){super()}}Object(l.a)(ra,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var fa;(function(Fa){Fa[Fa.notYetStarted=0]="notYetStarted";Fa[Fa.polling=1]="polling";Fa[Fa.subscribed=2]="subscribed";
Fa[Fa.blocked=3]="blocked";Fa[Fa.permanentlyStopped=4]="permanentlyStopped"})(fa||(fa={}));Object(l.b)("RtcHostNotificationSubscriptionState",fa);var pa=c(83),oa=c(1252),Aa=c(78);class xa{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne){this.Oh=!1;this.kba=this.s_b=this.fga=this.kZa=null;this.NDc=xa.hse;this.sa=new Aa.a;this.Ydb=new oa.a(0);this.Ydb.r0e(Object(e.a)(this,this.Hun,"onStateMachineChanged"));this.Vhk=Fa;this.Zvd=ub;this.Uhk=gc;this.eRe=Rb;this.Ib=wd;this.rf=Hc;de.execute(ng=>{this.Oh||(this.s_b=
ng,this.s_b.S3(Object(e.a)(this,this.l1,"onUpdateNotificationReceived")),this.start())});We.execute(ng=>{this.Oh||(this.kba=ng,ng.x_a(Object(e.a)(this,this.fja,"onTokenRefreshed")))});this.Yyd=Ne}get Fmc(){return this.Ydb.currentState}get zCi(){return!this.rf||this.rf.Yxa}get VCi(){return 2===this.Fmc&&this.Yyd()<this.NDc}start(){0!==this.Fmc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",fa[this.Fmc]):(this.Ydb.event(1),this.ecg(null))}ecg(){this.kZa=
null;if(this.zCi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",fa[this.Fmc]);let Fa=null;this.eRe&&this.eRe.length&&(Fa={},Fa.etts=this.eRe);this.s_b.qN(14,Fa,!0);this.Chj(this.Vhk)}else this.Ydb.event(3)}Chj(Fa){this.kZa=pa.a.A8(1E3*Fa,Object(e.a)(this,this.ecg,"sendSubscribeEvent"),this.Zvd,192,"RtcHostNotificationSubscribe");this.Ib.Wb(this.kZa)}nbo(Fa){Fa=1E3*(Fa+this.Uhk);const ub=this.Yyd().getTime()+Fa;this.NDc=new Date(ub);Fa-=this.Zvd;
this.fga?this.Ib.z1(this.fga,Fa):(this.fga=pa.a.A8(Fa,Object(e.a)(this,this.yNo,"transitionToPollingEvent"),this.Zvd/2,194,"RtcHostNotificationTransitionToPolling"),this.Ib.Wb(this.fga))}yNo(){this.fga=null;2===this.Fmc&&(this.Ydb.event(1),k.ULS.shipAssertTag(573100185,502,!!this.kZa,"Missing task to ensure that we re-subscribe."))}fja(){this.Knm()}Knm(){3===this.Fmc&&this.zCi&&(this.Ydb.event(this.VCi?2:1),this.ecg(null))}l1(Fa,ub){if(13===ub.type&&(Fa=ub.NL,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:Fa,["DurationBeforeExpirationToResubscribeInSec"]:this.Zvd}),ub=Fa.cts,!this.hQo(ub))){if(Fa.sb){var gc=2;this.nbo(Fa.cts)}else gc=1,this.NDc=xa.hse,this.fga&&(this.Ib.ef(this.fga),this.fga=null);this.Ydb.event(gc);this.kZa?this.Ib.z1(this.kZa,1E3*ub):this.Chj(ub)}}hQo(Fa){if(!isNaN(Fa)&&isFinite(Fa)&&0<Fa)return!1;this.Yvj(!1);return!0}Yvj(Fa){this.kZa&&(this.Ib.ef(this.kZa),this.kZa=null);this.fga&&(this.Ib.ef(this.fga),this.fga=null);this.s_b&&(this.s_b.dPb(Object(e.a)(this,
this.l1,"onUpdateNotificationReceived")),this.s_b=null);this.kba&&(this.kba.bPb(Object(e.a)(this,this.fja,"onTokenRefreshed")),this.kba=null);Fa||this.Ydb.event(4)}Hun(Fa,ub){Fa=ub.newState;const gc=ub.v2f,Rb={};Rb.NewState=fa[Fa];Rb.PreviousState=fa[gc];Rb.PreviousStateHits=ub.w2f;Rb.PreviousStateTransitionTime=ub.x2f.toISOString();Rb.IsSubscribed=this.VCi;this.NDc!==xa.hse&&(Rb.SubscriptionExpiringTime=this.NDc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Fa?15:50,"HostNotificationChanged: {0}",
Rb);this.sa.raiseEvent("HN",new ra(gc,Fa))}dispose(){this.Oh||(this.Oh=!0,this.Yvj(!0),this.fga&&(this.Ib.ef(this.fga),this.fga=null))}}xa.hse=new Date(0);Object(l.a)(xa,"RtcHostNotificationSubscriptionManager",null,[789,10]);var Ka=c(463);class za{constructor(){this.Zh=this.Oh=!1}get name(){return"RtcHostNotificationSubscription"}wc(Fa){Fa.register(xa,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").ha().Ud(()=>
{const ub=m.AFrameworkApplication.K;return new xa(ub.mc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),ub.mc("RtcHostNotificationRetryIntervalBufferInSeconds",120),ub.mc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.Kcm(ub),m.AFrameworkApplication.lc,Ka.SessionStatusManager.instance,Fa.Ta("Common.IRealtimeChannelBasic"),Fa.Ta("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.Nn(()=>{!this.Oh&&m.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Zh=!0,Sa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Oh||(this.Oh=!0,this.Zh&&Sa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}Kcm(Fa){return Fa.rw("RtcEventTypesToSubscribe")?Fa.DB("RtcEventTypesToSubscribe"):null}static main(){qa.a.instance.Gc(new za)}}Object(l.a)(za,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var ha=c(427),Oa=c(590);
class ib{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch){this.clientId=Fa;this.SkypeChatThreadId=gc;this.chatThreadDiscoveryUri=Rb;this.inChat=wd;this.localColbaltSessionId=ub;this.capabilities=Hc;this.email=de;this.isReadOnly=We;this.userName=Ne;this.isAnonymous=ng;this.presenceStatus=Ch}}Object(l.a)(ib,"SerializablePresenceUserData",null,[]);class Wa extends ha.a{constructor(Fa,ub,gc,Rb,wd=null,Hc=null,de=null,We=null,Ne=null,ng=!1,Ch=!1,Uh=!1,ii=null){super(Fa,ub,gc,Rb,Hc,de,We,Ne,ng,Ch,Uh);this.zP=
wd;this.presenceStatus=ii}getData(){return new ib(this.clientId,this.zP,this.mIc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}ITd(Fa){return(Fa=Fa.value)?Fa.user:null}clone(){return new Wa(this.clientId,this.userName,this.color,this.capabilities.clone(),this.zP,this.mIc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static dDb(Fa){return Fa.clientId?
new Wa(Fa.clientId,Fa.userName,null,new Oa.a(void 0===Fa.capabilities?0:Fa.capabilities),Fa.localColbaltSessionId,Fa.SkypeChatThreadId,Fa.email,null,Fa.chatThreadDiscoveryUri,Fa.isAnonymous,Fa.inChat,Fa.isReadOnly,Fa.presenceStatus):null}static $Lh(Fa,ub,gc,Rb=null,wd=null,Hc=null,de=null,We=null,Ne=!1,ng=!1,Ch=!1,Uh=null){return Fa?new Wa(Fa,ub,null,new Oa.a(void 0===gc?0:gc),Rb,wd,Hc,de,We,Ch,Ne,ng,Uh):null}}Object(l.a)(Wa,"PresenceUser",ha.a,[1223,1224,26]);class nb extends Wa{constructor(){super();
this.sic=this.xMf=null}t5l(){const Fa=m.AFrameworkApplication.userName,ub=m.AFrameworkApplication.K.kb("UserPrincipalName"),gc=this.xMf?this.xMf.zP:null,Rb=m.AFrameworkApplication.qTb||m.AFrameworkApplication.bqa,wd=this.sic?this.sic.getStatus():null;return new Wa(this.clientId,Fa,this.color,this.capabilities,gc,this.mIc,ub,this.client,this.chatThreadDiscoveryUri,Rb,this.inChat,this.isReadOnly,wd)}}Object(l.a)(nb,"MyPresenceUser",Wa,[1264,26]);var Db=c(788);class Ma{constructor(Fa,ub,gc,Rb,wd){this.Wf=
Fa;this._clientId=ub;this.T0j=wd;this.P4j=gc||(()=>null);this.Q4j=Rb||(()=>null)}get id(){return this.Wf.id}get UAd(){return this.Wf.UAd}get YAd(){return this.Wf.YAd}get XAd(){return this.Wf.XAd}get WAd(){return this.Wf.WAd}get VAd(){return this.Wf.VAd}get $Ad(){return this.Wf.$Ad}get PYe(){return this.Wf.PYe}get gmc(){return this.Wf.gmc}get Cje(){return this.Wf.Cje}get r5d(){return this.Wf.r5d}get clientId(){return this._clientId}get gSc(){return this.P4j}get Djb(){return this.Q4j}get Ppl(){return this.T0j}static createInstance(Fa,
ub,gc,Rb,wd=!1){return new Ma(Fa,ub,gc,Rb,wd)}}Object(l.a)(Ma,"PeoplesWellSettings",null,[]);var Qa=c(9),fb=c(68),dc=c(164),bc=c(99),Bb=c(190),Ob=c(165),Va=c(369),ab=c(306);class Gb extends Bb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(Gb,"PeopleButtonProps",Bb.a,[]);var Ua=c(378),yb=c(383),Yb=c(18),pc=c(81);class Fc{constructor(Fa){this.bed=new pc.a;this.Zcf=null;this.clientId=
Fa}cpo(Fa){this.mZn();this.xho(Fa);for(const ub of Fa)ub.clientId!==this.clientId&&this.fqh(ub)}get Rqg(){const Fa=[];for(let ub of this.bed.values){const gc=this.uij(ub);Array.add(Fa,gc)}return Fa}get snb(){return this.bed.count}G_e(Fa,ub){Fa=Fa.toUpperCase();let gc;({value:gc}=this.bed.Fc(Fa)).returnValue||(gc=[],this.bed.Z(Fa,gc));Array.add(gc,ub)}mZn(){this.bed=new pc.a}xho(Fa){for(const ub of Fa)if(ub.clientId===this.clientId){this.Zcf=ub;break}}}Object(l.a)(Fc,"UserTracker",null,[984]);class Zb extends Fc{constructor(Fa,
ub){super(Fa);this.R4j=ub}fqh(Fa){Fa.isAnonymous||!Fa.email?this.G_e(Fa.clientId,Fa):this.Zcf&&J.a.hh().equals(this.Zcf.email,Fa.email)||this.G_e(Fa.email,Fa)}uij(Fa){let ub=new Date(0),gc=0<Fa.length?Fa[0]:null;for(const Rb of Fa)(Fa=this.R4j(Rb.clientId))&&ub.getTime()<Fa.Mec.getTime()&&(ub=Fa.Mec,gc=Rb);return gc}}Object(l.a)(Zb,"UniqueUserTracker",Fc,[]);class Tb extends Fc{constructor(Fa){super(Fa)}fqh(Fa){this.G_e(Fa.clientId,Fa)}uij(Fa){return Fa[0]}}Object(l.a)(Tb,"UserInstanceTracker",Fc,
[]);const kc=(Fa,ub,gc)=>gc?new Zb(Fa,ub):new Tb(Fa);var ec=c(73),bb=c(1210),db=c(12);class Kb{constructor(Fa,ub=null,gc=null){this.FD=null;this.JVe=new x.a;this.Wf=Fa;this.w$d=ub;gc&&gc.continueWith(()=>{this.FD=gc.result;this.FD.N2b(Object(e.a)(this,this.Jda,"onUsersUpdated"));this.Tce()});new ha.a(this.settings.clientId,"Anonymous user","#cccccc",new Oa.a(7));this.WZd=this.yHe=!0;this.lDe=this.hOe=!1;this.tAa=kc(this.settings.clientId,this.settings.Djb,Fa.Ppl)}get settings(){return this.Wf}get vJm(){return m.AFrameworkApplication.K?
m.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get Vvi(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}qTl(){let Fa;let ub,gc,Rb,wd;var Hc=this.rTl();this.tAa.snb?1===this.tAa.snb?(ub=!0,gc=this.settings.gmc.cluster,Rb=this.settings.gmc.GJd,wd=this.tAa.Rqg[0].color):(ub=!0,gc=this.settings.r5d.cluster,Rb=this.settings.r5d.GJd,wd=""):(ub=!1,wd=Rb=gc="");Fa=Hc[0];Hc=Hc.slice(1);return{Sxn:Fa,Txn:Hc,Oxn:ub,Oop:gc,Qxn:Rb,Pxn:wd}}rTl(){if(2<=
this.tAa.snb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.tAa.snb)];if(1===this.tAa.snb){const Fa=this.tAa.Rqg[0],ub=this.settings.Djb(Fa.clientId);return ub&&2===ub.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Fa.userName]:[Fa.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Fa.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}Rjm(Fa){return this.Sjm(Fa)}uBh(Fa,
ub,gc){return ub?this.NSk(ub)?(Fa=this.settings.Djb(Fa))&&2===Fa.status?!1:!0:(gc&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(gc&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}ffm(Fa){return Fa.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Sjm(Fa){if(!Fa.capabilities.KFa(1))return this.ffm(Fa);const ub=Fa.isReadOnly,gc=this.settings.Djb(Fa.clientId);
Fa=this.settings.gSc(Fa.clientId);if(!gc)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(gc.status){case 1:return Fa?ub?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.B7k(Fa)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}F0l(Fa){if(this.w$d.PYc)return this.w$d.tDb(Fa.email,
"O365",m.AFrameworkApplication.am,0)}Cjm(Fa){Fa=this.settings.Djb(Fa.clientId);return!Fa||Fa&&1===Fa.status?!0:!1}Fjm(Fa){var ub=String.format("buttonPeoplesWellUser-{0}",Fa.clientId),gc=Fa.clientId,Rb=this.Rjm(Fa);const wd=Fa.userName,Hc=Fa.color;var de=Object,We=de.assign,Ne=new Gb,ng=this.settings.$Ad.toString(),Ch=this.settings.Cje.cluster,Uh=this.settings.Cje.GJd,ii=this.O8h(),yd=Fa.isAnonymous,pi;if(pi=[wd],pi.length){var Eh=new Sys.StringBuilder("STRARRY@");for(const Uk of pi)Eh.append(Uk?
Uk.length:0),Eh.append(","),Eh.append(Uk),Eh.append(",");pi=Eh.toString().slice(0,-1)}else pi=null;ub=We.call(de,Ne,{Id:ub,Command:ng,LabelText:"{0}",Image32by32:Ch,Image32by32Class:Uh,MenuItemId:gc,CommandValueId:gc,Alt:wd,DisplayMode:ii,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Rb,ImageBackColor:Hc,IsAnonymous:yd,LabelTextUserGeneratedPlaceholderReplacements:pi,Upn:Fa.email});m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.w$d&&(gc=this.F0l(Fa),Rb=this.Cjm(Fa),ub.ImageUrl=gc,ub.ActiveStatus=Rb,ub.JoinTimeInMS=Fa.URa,Fa=this.uBh(Fa.clientId,this.settings.gSc(Fa.clientId),!1),ub.CanJump=Fa,""===gc&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return ub}RZl(){return Object.assign(new Bb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}O8h(){return this.vJm?"Initials":
"Menu32"}Gjm(Fa){const ub=[];for(const gc of Fa)Fa=this.Fjm(gc),Array.add(ub,Fa);return ub}uZd(){return 0<this.tAa.snb}ZMn(Fa){if(!this.yHe)return!0;this.WZd||(Fa[bb.a.Visible]=!0);let ub,gc,Rb,wd,Hc;({Sxn:ub,Txn:gc,Oxn:Rb,Qxn:wd,Pxn:Hc}=this.qTl());Fa[bb.a.LabelText]=ub;gc&&gc.length&&(Fa[bb.a.LabelTextUserGeneratedPlaceholderReplacements]=gc);Fa[bb.a.ImageIsVisible]=Rb;Fa[bb.a.Image16by16Class]=wd;Fa[bb.a.ImageBackColor]=Hc;this.yHe=!1;return!0}rEn(Fa){if(0>=this.tAa.snb)return!1;var ub=this.rAo(this.tAa.Rqg),
gc=this.Gjm(ub);ub=Object.assign(new Va.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});gc=Object.assign(new ab.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.O8h(),ControlList:gc});m.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.w$d&&(gc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,gc.TitleId="menuCoauthorsTitle",gc.Theme="Light");Array.add(ub.MenuSectionList,gc);m.AFrameworkApplication.K.$("DocChatIsEnabled")&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Jb.Gr&&(gc=[],Array.add(gc,this.RZl()),gc=Object.assign(new ab.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:gc}),Array.add(ub.MenuSectionList,gc));m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Jb.Gr?Fa.MenuItems=ub:Fa.PopulationXML=Ob.o(ub);return!0}Oqg(Fa){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Fa=Fa.MenuItemId;if(!Fa)return!1;const ub=this.settings.gSc(Fa);if(!this.uBh(Fa,ub,
!0))return!1;this.KYm(ub);return!0}XTn(){const Fa=this.vNl();this.tAa.cpo(Fa);this.WZd&&1<=this.tAa.snb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.WZd=!1);this.yHe=!0}Jda(){this.lDe||(window.setTimeout(()=>{this.Tce();this.lDe=!1},3E3),this.lDe=!0)}vNl(){let Fa;Fa=this.uNl()||[];for(const ub of Fa)this.S$n(ub);return Fa}S$n(Fa){Fa.clientId||(Fa.clientId=R.a.create().toString());Fa.userName||(Fa.userName="Anonymous user");Fa.capabilities||(Fa.capabilities=
new Oa.a);Fa.color||(Fa.color="#cccccc");Fa.URa||(Fa.URa=0)}rAo(Fa){const ub=[];Array.addRange(ub,Fa);ub.sort(Kb.Cxn);return ub}pXn(){m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.hOe&&(m.AFrameworkApplication.va.k0(db.a.aGh)&&Ua.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.fb(db.a.aGh,ec.a.frame,Object(e.a)(this,this.nmn,"onCoauthorGalleryFirstRender"),96));this.qXn();this.hOe=
!0;this.Tce()}nmn(Fa,ub,gc,Rb,wd){this.JVe.xS(wd.RenderTime);return 32}get szj(){return this.JVe.task}Tce(){if(!this.hOe&&(this.JVe.xS((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Vvi))return;this.XTn();this.Vvi&&this.WZd?m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||yb.a.eUf("ribbon","coauthorGallery"):
(m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(yb.a.FSa("ribbon","coauthorGallery"),yb.a.nnb("ribbon","coauthorGallery")),this.YTn())}dispose(){this.FD&&(this.FD.K8f(Object(e.a)(this,this.Jda,"onUsersUpdated")),this.FD=null)}static Cxn(Fa,ub){return Fa.capabilities.KFa(1)&&ub.capabilities.KFa(1)||!Fa.capabilities.KFa(1)&&!ub.capabilities.KFa(1)?Yb.a.localeCompare(Fa.userName,ub.userName):Fa.capabilities.KFa(1)?
-1:1}}Object(l.a)(Kb,"APeoplesWell",null,[929,10]);var Cb=c(14);const lb=()=>!0;class mb extends Kb{constructor(Fa,ub,gc=null,Rb=null){super(Fa,gc,Rb);this.jKm=(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,()=>this.uZd(),lb);this.$Mn=(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,ng=>this.ZMn(ng),lb);this.sEn=(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,lb,ng=>this.rEn(ng));this.h1k=(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,lb,lb);this.g1k=(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,lb,lb);this.d1o=(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,lb,ng=>this.Oqg(ng));this.iCn=
(wd,Hc,de,We,Ne)=>this.k3a(de,Ne,lb,()=>{this.Tce();return!0});this.ga=ub}k3a(Fa,ub,gc,Rb){let wd=!1;switch(Fa){case 1:wd=gc(ub);break;case 2:wd=Rb(ub)}return wd?32:8}qXn(){this.ga.ra(this.settings.UAd,Cb.a.application,this.jKm);this.ga.fb(this.settings.YAd,Cb.a.application,this.$Mn,96);this.ga.fb(this.settings.WAd,Cb.a.application,this.h1k,96);this.ga.fb(this.settings.VAd,Cb.a.application,this.g1k,96);this.ga.fb(this.settings.XAd,Cb.a.application,this.sEn,96);this.ga.ra(this.settings.$Ad,Cb.a.application,
this.d1o);this.ga.fb(this.settings.PYe,Cb.a.application,this.iCn,96)}}Object(l.a)(mb,"ABox4PeoplesWell",Kb,[]);var Da=c(3),xb=c(43),Jb=c(6),Mb=c(23),gb=c(149);class Wb{static isSupported(Fa){for(let ub=0;ub<Wb.axj.length;ub++)if(Fa===Wb.axj[ub])return!0;return!1}}Wb.axj=[1];Object(l.a)(Wb,"RTTDataVersion",null,[]);var vc=c(1553);const Fb=Fa=>{if("number"!==typeof Fa.RK||"number"!==typeof Fa.DK)return!1;let ub,gc=!1,Rb=!1,wd=!1;switch(Fa.RK){case 0:Rb=ub=!0;break;case 1:wd=gc=Rb=ub=!0;break;case 2:if(null!=
Fa.PE&&"number"!==typeof Fa.PE)return!1;ub=!0;break;case 4:ub=!0;break;case 3:Rb=ub=!0;break;case 5:gc=ub=!0;break;default:return!1}return ub&&("number"!==typeof Fa.PS||"number"!==typeof Fa.TS)||Rb&&("object"!==typeof Fa.OS||!Fa.OS||!vc.validateVersionedCpData(Fa.OS))||gc&&("number"!==typeof Fa.PE||"number"!==typeof Fa.TE)||wd&&("object"!==typeof Fa.OE||!Fa.OE||!vc.validateVersionedCpData(Fa.OE))?!1:!0},ya=Fa=>{let ub="";if("number"!==typeof Fa.I)return{returnValue:!1,jia:"Invalid PacketId Type"};
if("number"!==typeof Fa.O)return{returnValue:!1,jia:"Invalid Operation Type"};if("string"!==typeof Fa.A)return{returnValue:!1,jia:"Invalid ClientId Type"};if("object"!==typeof Fa.AN)return{returnValue:!1,jia:"Invalid Anchor Object Type"};if(!Fa.AN)return{returnValue:!1,jia:"Null AnchorObject"};if(!Fb(Fa.AN)){let gc;try{gc=P.c(Fa.AN)}catch(Rb){gc=String.format("Failed to JSON-serialize payload : {0}",Rb)}8E3<gc.length&&(gc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",gc.length,
8E3));ub="Invalid AnchorObject: "+gc+", Client: "+Fa.C;return{returnValue:!1,jia:ub}}return!Fa.O&&Fa.AN.RK?(ub="Invalid RangeKind:"+Fa.AN.RK+" for Caret",{returnValue:!1,jia:ub}):2===Fa.O&&("number"!==typeof Fa.TF||"undefined"!==typeof Fa.TX&&"string"!==typeof Fa.TX||1!==Fa.AN.RK&&Fa.AN.RK)?{returnValue:!1,jia:"Invalid TypingData"}:3!==Fa.O||"object"===typeof Fa.AP&&Fa.AP&&"number"===typeof Fa.AP.TFA&&"number"===typeof Fa.AP.PN&&"number"===typeof Fa.AP.TN&&2===Fa.AN.RK?6!==Fa.O||"object"===typeof Fa.MP&&
Fa.MP&&"number"===typeof Fa.MP.PM&&"number"===typeof Fa.MP.TM&&5===Fa.AN.RK?4!==Fa.O||"object"===typeof Fa.SP&&Fa.SP&&"number"===typeof Fa.SP.PA&&"number"===typeof Fa.SP.TA&&"number"===typeof Fa.SP.PB&&"number"===typeof Fa.SP.TBS&&3===Fa.AN.RK&&(Fa.AN.PS===Fa.SP.PA||Fa.AN.PS===Fa.SP.PB)?7!==Fa.O||"object"===typeof Fa.SPS&&Fa.SPS&&"string"===typeof Fa.SPS.SF&&"boolean"===typeof Fa.SPS.SL?null!=Fa.ISS&&"number"!==typeof Fa.ISS?{returnValue:!1,jia:"invalid StrictlySequentialId"}:{returnValue:!0,jia:ub}:
{returnValue:!1,jia:"Invalid SymbolData"}:{returnValue:!1,jia:"Invalid SplitParaData"}:{returnValue:!1,jia:"Invalid RemoveParaData"}:{returnValue:!1,jia:"Invalid AddParaData"}};var hb=c(1505);class vb{constructor(Fa,ub=null,gc=null){this.U1=this.r_f=this.Ulg=null;null!=Fa&&(this.Ulg=Fa);null!=ub&&(this.r_f=ub);null!=gc&&(this.U1=gc)}}Object(l.a)(vb,"AddParaData",null,[]);class ac{constructor(Fa=null,ub=null){this.qnc=this.q_f=null;null!=Fa&&(this.q_f=Fa);null!=ub&&(this.qnc=ub)}}Object(l.a)(ac,"MergeRemoveParaData",
null,[]);class wb{constructor(Fa,ub,gc,Rb,wd,Hc,de=null,We=null,Ne=null,ng=null,Ch=null,Uh=null,ii=0,yd=null){this.kbd=this.text=this.aSb=this.tRb=this.A0c=this.y2b=this.Oka=null;this.packetId=Fa;this.client=gc;this.mt=Rb;this.clientId=ub.toLowerCase();this.MT=wd;this.version=ii;Hc&&(this.Oka=Hc);null!=de&&(this.aSb=de);void 0!==We&&null!==We&&(this.text=We);Ne&&(this.y2b=Ne);ng&&(this.A0c=ng);Ch&&(this.tRb=Ch);Uh&&(this.kbd=Uh);this.strictlySequentialId=yd}}Object(l.a)(wb,"RTTData",null,[]);class yc{constructor(Fa=
null,ub=null,gc=null,Rb=null){this.Tlg=this.p_f=this.Qlg=this.o_f=null;null!=Fa&&(this.o_f=Fa);null!=ub&&(this.Qlg=ub);null!=gc&&(this.p_f=gc);null!=Rb&&(this.Tlg=Rb)}}Object(l.a)(yc,"SplitParaData",null,[]);class Cc{constructor(Fa=null,ub=null){this.ukg=this.tkg=null;Fa&&(this.tkg=Fa);null!=ub&&(this.ukg=ub)}}Object(l.a)(Cc,"SymbolData",null,[]);class Uc{constructor(Fa,ub=null,gc=null){null!=Fa&&(this.TFA=Fa);null!=ub&&(this.PN=ub);null!=gc&&(this.TN=gc)}}Object(l.a)(Uc,"SerializableAddParaDataV1",
null,[]);class Ad{constructor(Fa=null,ub=null){null!=Fa&&(this.PM=Fa);null!=ub&&(this.TM=ub)}}Object(l.a)(Ad,"SerializableMergeRemoveParaDataV1",null,[]);class qc{}Object(l.a)(qc,"SerializableRTTDataV1",null,[]);class Zc{constructor(Fa=null,ub=null,gc=null,Rb=null){null!=Fa&&(this.PA=Fa);null!=ub&&(this.TA=ub);null!=gc&&(this.PB=gc);null!=Rb&&(this.TBS=Rb)}}Object(l.a)(Zc,"SerializableSplitParaDataV1",null,[]);class Td{constructor(Fa=null,ub=null){Fa&&(this.SF=Fa);null!=ub&&(this.SL=ub)}}Object(l.a)(Td,
"SerializableSymbolDataV1",null,[]);const bd=Fa=>{var ub;if(!({jia:ub}=ya(Fa)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",ub),null;let gc=ub=null,Rb=null,wd=null,Hc=null,de=null,We=null,Ne=null;Fa.WD&&(ub=Fa.WD);null!=Fa.TF&&(gc=Fa.TF);void 0!==Fa.TX&&null!==Fa.TX&&(Rb=Fa.TX);Fa.AP&&(wd=new vb(Fa.AP.TFA,Fa.AP.PN,Fa.AP.TN));Fa.MP&&(Hc=new ac(Fa.MP.PM,Fa.MP.TM));Fa.SP&&(de=new yc(Fa.SP.PA,Fa.SP.TA,Fa.SP.PB,Fa.SP.TBS));Fa.SPS&&(We=new Cc(Fa.SPS.SF,
Fa.SPS.SL));null!=Fa.ISS&&(Ne=Fa.ISS);return new wb(Fa.I,Fa.A,Fa.C,Fa.O,hb.a(Fa.AN),ub,gc,Rb,wd,Hc,de,We,1,Ne)},Ef=Fa=>{let ub=Fa;if("number"===typeof ub.V){if(1===ub.V)return bd(Fa);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let gc=0,Rb=null;for(let wd=0;wd<Fa.length;wd++)ub=Fa[wd],Wb.isSupported(ub.V)&&ub.V>gc&&(gc=ub.V,Rb=Fa[wd]);return 1===gc?bd(Rb):null},ld=Fa=>{if(Fa){const ub=new qc;ub.I=Fa.packetId;ub.V=1;ub.A=Fa.clientId;ub.C=Fa.client;ub.O=Fa.mt;ub.AN=hb.c(Fa.MT);
Fa.Oka&&(ub.WD=Fa.Oka);null!=Fa.aSb&&(ub.TF=Fa.aSb);void 0!==Fa.text&&null!==Fa.text&&0<Fa.text.length&&(ub.TX=Fa.text);Fa.y2b&&(ub.AP=new Uc(Fa.y2b.Ulg,Fa.y2b.r_f,Fa.y2b.U1));Fa.A0c&&(ub.MP=new Ad(Fa.A0c.q_f,Fa.A0c.qnc));Fa.tRb&&(ub.SP=new Zc(Fa.tRb.o_f,Fa.tRb.Qlg,Fa.tRb.p_f,Fa.tRb.Tlg));Fa.kbd&&(ub.SPS=new Td(Fa.kbd.tkg,Fa.kbd.ukg));ub.ISS=Fa.strictlySequentialId;Fa=ub}else Fa=null;return Fa};var Nc=c(54);class Yd{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne){this.LocalCobaltSessionId=Fa;this.SkypeChatThreadId=
ub;this.ChatThreadDiscoveryUri=gc;this.InChat=Rb;this.Capabilities=wd;this.Email=Hc;this.UserName=de;this.IsAnonymous=We;this.PresenceStatus=Ne}}Object(l.a)(Yd,"SerializableWacData",null,[]);class Fd{constructor(){this.Axd=this.zxd=0}j6l(){this.Axd===Number.MAX_VALUE&&(this.Axd=0);this.Axd++;return this.Axd}i6l(){this.zxd===Number.MAX_VALUE&&(this.zxd=0);this.zxd++;return this.zxd}static get instance(){return Fd.Ckk}}Fd.Ckk=new Fd;Object(l.a)(Fd,"StrictlySequentialIdGenerator",null,[154]);var of=
c(1393);class te{constructor(Fa,ub,gc,Rb,wd,Hc,de,We=0){this.Kta=null;this.dryDeletion=0;this.XI=Fa;this.IMa=Hc;this.ud=wd;this.CAb=de;this.Wc=ub;this.shapeId=We;this.QHa=gc;this.m$=de.create(this,Rb,wd,Hc)}clone(){return new te(this.XI,this.Wc,this.QHa,this.m$.qsb,this.ud,this.IMa,this.CAb,this.shapeId)}get paragraphId(){return this.Kta?this.Kta:this.XI.pjb(this.Wc)}WXf(){this.Kta||(this.Kta=this.paragraphId,this.m$.WXf())}isValid(){return 0<=this.m$.cp}getData(){const Fa=this.m$.qsb;return Fa?new of.a(0,
this.Wc,this.QHa,Fa,null,null,null,0,this.shapeId):null}static dDb(Fa,ub,gc,Rb,wd){return ub?new te(ub,parseInt(Fa.bTa),Fa.K8a,Fa.dS,gc,Rb,wd,Fa.shapeId):null}}Object(l.a)(te,"WordPresenceIp",null,[167,49,168]);class uc{constructor(Fa,ub,gc){this.HUa=this.ida=this.ezc=!1;this.Rcb=Fa;this.KXa=gc;this.user=ub}get ip(){return this.KXa}get Gfc(){return this.ezc}set Gfc(Fa){(this.ezc=Fa)&&this.ip.WXf()}nuf(){const Fa=Fd.instance.i6l();return new wb(this.Rcb,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new Yd(this.user.zP,this.user.mIc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Fa)}M$h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Nc.a.nil.toString())}isValid(){const Fa=!!this.user&&this.user.isValid(),ub=!this.ip||this.ip.isValid();return Fa&&ub}clone(){const Fa=new uc;Fa.Rcb=this.Rcb;Fa.ezc=this.ezc;
Fa.user=this.user?this.user.clone():null;Fa.KXa=this.ip?this.ip.clone():null;Fa.ida=this.ida;Fa.HUa=this.HUa;return Fa}static Yaf(Fa,ub,gc,Rb,wd){if(!Fa||!ub)return null;if(Fa.mt)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Fa.mt),null;let Hc;Hc=void 0!==Fa.Oka&&null!==Fa.Oka?Wa.$Lh(Fa.clientId,Fa.Oka.UserName,Fa.Oka.Capabilities,Fa.Oka.LocalCobaltSessionId,Fa.Oka.SkypeChatThreadId,Fa.Oka.Email,Fa.client,Fa.Oka.ChatThreadDiscoveryUri,Fa.Oka.InChat,
!1,Fa.Oka.IsAnonymous,Fa.Oka.PresenceStatus):Wa.$Lh(Fa.clientId,null,0,void 0,void 0,void 0,Fa.client);return new uc(Fa.packetId,Hc,te.dDb(Fa.MT,ub,gc,Rb,wd))}}Object(l.a)(uc,"WordPresenceInfo",null,[179,49]);class $c extends mb{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch,Uh,ii,yd){super(Fa,Hc,yd,ub);this.nYj=gc;this.fik=Rb;this.Agk=wd;this.ib=de;$c.hu=We;this.XI=Ne;this.ud=ng;this.IMa=Ch;this.sYe=Uh;this.KKa=ii}Oqg(Fa){this.KKa.dFi(Fa.CommandValueId);return super.Oqg(Fa)}KYm(Fa){let ub;({h2f:ub}=
this.VGf(Fa)).returnValue&&(this.fik(ub.ip.paragraphId,ub.ip.m$.cp),m.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Fa=$c.Mdm(ub),void 0!==Fa&&null!==Fa?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.Ac(Fa),fb.FocusManager.mK()&&fb.FocusManager.instance().lg(dc.AFrame.In)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Fa=new pa.a(2,1,0,()=>{this.ga.Qb(Da.a.bje,
2,ub)}),bc.a.instance.Wb(Fa))}Wei(Fa){return Fa?(Fa=uc.Yaf(Ef(Fa),this.XI,this.ud,this.IMa,this.sYe.instance))&&Fa.isValid()&&Fa.ip?Fa:null:null}NSk(Fa){return this.ASm(Fa)?this.gTk(Fa)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}ASm(Fa){return!!this.Wei(Fa)}VGf(Fa){Fa=this.Wei(Fa);return{returnValue:!!Fa,h2f:Fa}}gTk(Fa){let ub;
return({h2f:ub}=this.VGf(Fa)).returnValue?this.nYj(ub.ip.paragraphId,ub.ip.m$.cp):!1}uNl(){if(!this.FD)return[];const Fa=[];for(const ub of this.FD.e2a())ub.userName?Fa.push(ub):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Fa}B7k(Fa){let ub;return({h2f:ub}=this.VGf(Fa)).returnValue&&ub.user&&ub.user.presenceStatus&&"0"!==ub.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,ub.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}YTn(){this.Agk(this.settings.id)}static createInstance(Fa,
ub,gc,Rb,wd,Hc,de){const We=Qa.App.za.jb,Ne=m.AFrameworkApplication.va,ng=xb.a.instance,Ch=Sa.a.instance.resolve("Box4.ICoauthCashTelemetry");return new $c(Fa,ub,Uh=>We.rc.Yi?We.rc.y6e(Uh,!0):!1,(Uh,ii)=>{We.rc.Yi&&We.rc.fUa(Uh,ii,!0,!0,!1)},()=>{Qa.App.Iv.fJ.vdd()},Ne,ng,We,gc,Rb,wd,Hc,Ch,de)}static Mdm(Fa){const ub=$c.hu.Zc.xd.Eb(Fa.ip.paragraphId);if(void 0===ub||null===ub)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Jb.ParagraphReader.Xb(ub))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Fa=Mb.a.Pc(ub,Fa.ip.m$.cp);return new gb.Selection([Fa],!0)}}$c.hu=null;Object(l.a)($c,"WordEditorPeoplesWell",mb,[]);class Dd{constructor(){this.Xx=()=>{m.AFrameworkApplication.v1i?Dd.jra.bE().continueWith(this.z2c):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.z2c=()=>{Dd.jj=Dd.jra.bE().result;if(Dd.jj){var Fa=()=>{const ub=Qa.App.za.jb;return ub?ub.Zc?ub.Zc.xd:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Qa.App.Uoa().continueWith(()=>{const ub=Qa.App.Uoa().result.qj,gc=Db.CuiHelper.N9l(m.AFrameworkApplication.Ms,m.AFrameworkApplication.Ms,m.AFrameworkApplication.Ms,m.AFrameworkApplication.Ms),Rb=Ma.createInstance(gc,ub,Object(e.a)(Dd.jj.Tee,Dd.jj.Tee.gSc,"getUserPresence"),Object(e.a)(Dd.jj.Tee,Dd.jj.Tee.Djb,"getUserStatusInfo"),m.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Sa.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>$c.createInstance(Rb,Ia.a.Fp(Dd.W.Ta("Common.IPeopleInfoProvider")),Dd.W.Oa("WordEditor.ParagraphWordIdMapping"),Dd.W.Oa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Fa,Dd.W.Ta("WordEditor.Presence.IWordPresenceCpFactory"),Dd.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").ha();Dd._instance=Sa.a.instance.resolve("Common.IPeoplesWell");Dd._instance.pXn();k.ULS.sendTraceTag(23196877,325,50,
"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}wc(Fa){Dd.W=Fa}init(){m.AFrameworkApplication.K.Nn(this.Xx)}dispose(){Dd._instance&&(Dd._instance.dispose(),Dd._instance=null)}static get jra(){return null!=Dd.mGg?Dd.mGg:Dd.mGg=Sa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}Dd._instance=null;Dd.W=null;Dd.jj=null;Object(l.a)(Dd,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Pd=c(93),Cd=c(238);class Ce{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne=!1){this.f$a=null;this.vBe=!0;this.LOe=this.Ll=this.jue=null;this.sa=new Aa.a;this.CMa=Fa;this.l_=ub;this.vbh=gc;this.oBc=Rb;this.vMg=Hc;Ce.Ib=wd;this.Cfk=de;this.z7=We;this.Jgk=Ne;H.Task.WAA(ub,gc).continueWith(Object(e.a)(this,this.zzm,"initOnTaskReady"))}zzk(Fa){this.sa.addHandler("u",Fa)}Z6i(){this.sa.raiseEvent("u",null,this)}zzm(){this.l_.result&&this.vbh.result&&(this.Ll=
this.l_.result,this.LOe=this.vbh.result,this.Ll.A_a(Object(e.a)(this,this.q5,"onPresenceUpdated")),this.jue=new pa.a(2,2,this.vMg,Object(e.a)(this,this.bUo,"updateAwayClientsTask"),88),Ce.Ib.Wb(this.jue))}q5(Fa,ub){(this.vBe||this.zQn(ub.Zra))&&Ce.Ib.z1(this.jue,0)}zQn(Fa){for(let gc in Fa){var ub=this.oBc.ITd({key:gc,value:Fa[gc]});if(ub&&ub.clientId&&(ub=ub.clientId.toLowerCase(),(ub=this.f$a[ub]||this.f$a[ub.toUpperCase()])&&2===ub.status))return!0}return!1}bUo(Fa){var ub=this.Ll.uPc();if(ub){var gc=
new Date,Rb=!1;if(this.vBe){this.f$a=ub;this.vBe=!1;var wd=this.f$a;for(var Hc in wd){ub=Hc;var de=wd[Hc];de.Mec<gc&&(gc=de.Mec);2===de.status&&(Rb=!0,this.LOe.N6c(ub))}Rb&&this.Z6i();Ce.Ib.z1(Fa,this.Lci(gc))}else{de=new S.a;Hc=!1;var We=this.f$a;for(wd in We){We=wd;if(!(We in this.f$a)||this.CMa.clientId===We)continue;var Ne=this.f$a[We];const ng=ub[We];if(Ne&&ng){Ne=Ne.status;const Ch=ng.status;2===Ne&&1===Ch?(de.add(We),k.ULS.sendTraceTag(38052609,392,50,We+" returned from away")):1===Ne&&2===
Ch&&(Hc=Rb=!0,this.LOe.N6c(We),k.ULS.sendTraceTag(38052610,392,50,We+" went away"));1===Ch&&ng.Mec<gc&&(gc=ng.Mec)}}this.f$a=ub;Ce.Ib.z1(Fa,this.Lci(gc));(0<de.count||Rb)&&this.Z6i();0<de.count&&!this.Jgk?(Fa=this.BRl(de),this.dLo(Fa)):Fa=new S.a;(Hc||0<Fa.count)&&this.Cfk(db.a.GGd,2)}}}dLo(Fa){if(Fa.count)for(let ub of Fa)Fa=this.z7.Cva(String.format(CommonUIStrings.l_EditorsToastArriving,ub),!1),Fa.image=5,Fa.fpa="CoAuth_AuthorStatus_16x16x32",this.z7.sA(Fa)}BRl(Fa){const ub=this.Ll.BFb(),gc=new S.a;
for(let Rb in ub){const wd={key:Rb,value:ub[Rb]};if(Fa.contains(wd.key)){const Hc=this.oBc.ITd(wd);Hc&&(gc.add(Hc.userName),Fa.remove(wd.key))}}gc.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return gc}Lci(Fa){const ub=new Date;return Math.max(Fa.getTime()+this.vMg-ub.getTime(),0)}}Ce.Ib=null;Object(l.a)(Ce,"AwayManager",null,[]);var qf=c(710);class Jg{constructor(Fa=0){this.updates=Fa}get azf(){return 0!==this.updates}KFa(Fa){return!!(this.updates&Fa)}M7a(Fa){this.updates|=
Fa}toString(){if(this.KFa(0))return"none";const Fa=new S.a;this.KFa(1)&&Fa.add("user(s) joined");this.KFa(2)&&Fa.add("user(s) disconnected");this.KFa(4)&&Fa.add("user(s) updated");return Fa.toArray().join(", ")}}Object(l.a)(Jg,"UserUpdateEvent",null,[]);var wg=c(30);class Dh{constructor(Fa,ub,gc,Rb,wd=null){this.sa=new Aa.a;this.wK=this.jj=null;this.S7g=this.o8g=this.lm=!1;this.Aq=new pc.a;Fa.continueWith(()=>{this.jj=Fa.result;this.jj.A_a(Object(e.a)(this,this.WXi,"onRtcPresenceUpdate"));this.jj.Iua(Object(e.a)(this,
this.VXi,"onRtcConnectionChange"));this.mqg(null,null)});ub.continueWith(()=>{this.wK=ub.result;this.wK.Reb(Object(e.a)(this,this.c2c,"onEditorsTableUpdated"))});wd&&wd.continueWith(()=>{wd.result.zzk(Object(e.a)(this,this.mqg,"updateUserStatus"));this.mqg(null,null)});this.UMa=gc;this.oBc=Rb}get users(){return this.Aq}N2b(Fa){this.sa.addHandler("UU",Fa)}K8f(Fa){this.sa.removeHandler("UU",Fa)}mqg(){if(this.jj){var Fa=!1,ub=this.jj.uPc();for(let Rb in ub){var gc=ub[Rb];const wd=Rb;this.users.nb(wd)&&
(gc=this.aBj(gc),Fa=this.users.J(wd).wCb!==gc||Fa,this.users.J(wd).wCb=gc)}Fa&&(Fa=new Jg(4),this.Ufe(Fa))}}aBj(Fa){return 1===Fa.status?0:1}e2a(){this.users.count||(this.o8g||(wg.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.o8g=!0),this.QEn());const Fa=[];for(let ub of this.users)Array.add(Fa,ub.value);return Fa}QEn(){if(this.jj){var Fa=this.jj.BFb();this.wPf(Fa)}if(this.wK){Fa=this.wK.oPc();for(const ub of Fa)ub.Id&&(Fa=this.lOh(ub.Id),this.lqg(new Jg,Fa))}}NNf(Fa){({value:Fa}=
this.users.Fc(Fa));return Fa}dispose(){this.lm||(this.jj&&(this.jj.cPb(Object(e.a)(this,this.WXi,"onRtcPresenceUpdate")),this.jj.qjc(Object(e.a)(this,this.VXi,"onRtcConnectionChange"))),this.wK&&this.wK.nbj(Object(e.a)(this,this.c2c,"onEditorsTableUpdated")),this.lm=!0)}VXi(Fa,ub){2===ub.newState&&(Fa=this.wPf(this.jj.BFb()),Fa.azf&&this.Ufe(Fa))}c2c(Fa,ub){Fa=new Jg;var gc=this.wK.oPc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
gc.length,ub.Yjn,ub.WQi);const Rb=new pc.a;for(var wd of gc){gc=wd.Id;const Hc=this.lOh(gc);this.lqg(Fa,Hc);Rb.Z(gc,Hc)}if((ub=ub.LKf)&&0<ub.length)for(wd=0;wd<ub.length;wd++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,ub.J(wd).Id),({value:gc}=this.users.Fc(ub.J(wd).Id)).returnValue?gc?(this.users.remove(ub.J(wd).Id),Fa.M7a(2),Rb.Z(ub.J(wd).Id,gc)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",ub.J(wd).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",ub.J(wd).Id);ub=this.jj.BFb();for(let Hc in ub)wd=this.oBc.ITd({key:Hc,value:ub[Hc]}),Rb.Z(wd.clientId,wd);for(let Hc of this.users)Rb.nb(Hc.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Hc.key),this.users.remove(Hc.key),Fa.M7a(2));Fa.azf&&this.Ufe(Fa)}WXi(Fa,ub){Fa=this.wPf(ub.Zra);for(const gc of ub.lLd)this.users.nb(gc)&&(Fa.M7a(2),this.users.J(gc).wCb=
2);Fa.azf&&this.Ufe(Fa)}wPf(Fa){const ub=new Jg;if(!Fa)return ub;for(let Rb in Fa){var gc=this.oBc.ITd({key:Rb,value:Fa[Rb]});gc&&(gc=gc.clone(),this.lqg(ub,gc))}return ub}lqg(Fa,ub){if(ub){var gc=ub.clientId;var Rb=this.t7n(ub);({value:ub}=this.users.Fc(gc)).returnValue?ub.equals(Rb)||(Fa.M7a(4),this.users.Z(gc,Rb)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,gc),Fa.M7a(1),this.users.Z(gc,Rb))}}lOh(Fa){return this.users.nb(Fa)?this.users.J(Fa):
ha.a.Aal(Fa)}t7n(Fa){if(!Fa||!Fa.clientId||!this.wK)return Fa;const ub=Fa.clone();ub.wCb=this.ARl(Fa);if(Fa=this.wK.v9b(ub.clientId))ub.isReadOnly=ub.isReadOnly||Fa.IsReadOnly?!0:!1,ub.userName=this.s7n(ub,Fa),ub.capabilities=this.bdn(ub.capabilities,Fa.Capabilities),ub.email=ub.email||Fa.SIPAddress||Fa.EmailAddress,Fa.JoinCoauthTime&&(ub.URa=Fa.JoinCoauthTime);ub.color=this.UMa.fac(new qf.a(ub.email,void 0,ub.userName,void 0,ub.isAnonymous,ub.clientId),3);return ub}ARl(Fa){if(!this.jj)return 2;if(Fa&&
Fa.clientId){const ub=this.jj.uPc();if(Fa.clientId in ub)return this.aBj(ub[Fa.clientId])}return 2}T2k(Fa,ub){ub.Name&&Fa.userName&&ub.Name!==Fa.userName&&!this.S7g&&(this.S7g=!0,wg.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}bdn(Fa,ub){Fa=Fa||new Oa.a;ub&&(ub.SupportsRealtimeChannel&&Fa.M7a(1),ub.SupportsRename&&Fa.M7a(2),ub.SupportsChat&&Fa.M7a(4));return Fa}s7n(Fa,ub){this.T2k(Fa,ub);return ub.Name||Fa.userName||(Fa.isAnonymous||ub.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}Ufe(Fa){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Fa.toString());this.sa.raiseEvent("UU")}}Object(l.a)(Dh,"PeopleInfoProvider",null,[942,10]);var dg;(function(Fa){Fa[Fa.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Fa[Fa.peopleImageClassName=1]="peopleImageClassName";Fa[Fa.peopleImageClusterPath=4]="peopleImageClusterPath";Fa[Fa.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Fa[Fa.imageDimension=6]="imageDimension";
Fa[Fa.rtl=8]="rtl";Fa[Fa.pointerInputManager=9]="pointerInputManager";Fa[Fa.clickInputManager=10]="clickInputManager";Fa[Fa.vertical=11]="vertical";Fa[Fa.zIndex=12]="zIndex";Fa[Fa.contextMenuInputManager=13]="contextMenuInputManager";Fa[Fa.imageDomElement=14]="imageDomElement";Fa[Fa.useIdleTooltip=15]="useIdleTooltip";Fa[Fa.viewportBoundsCallback=16]="viewportBoundsCallback";Fa[Fa.flipHorizontalDirection=17]="flipHorizontalDirection";Fa[Fa.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Fa[Fa.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Fa[Fa.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(dg||(dg={}));Object(l.b)("PresenceTooltipSettingKeys",dg);class kg{constructor(){this.Bu={}}get(Fa,ub=null){Fa=dg[Fa];return"number"===typeof ub?(ub=this.Bu[Fa])?Number.parseInvariant(ub.toString()):0:this.Bu[Fa]}add(Fa,ub){this.Bu[dg[Fa]]=ub}VNa(Fa,ub){dg[Fa]in this.Bu||(this.Bu[dg[Fa]]=ub)}remove(Fa){delete this.Bu[dg[Fa]]}}Object(l.a)(kg,"PresenceTooltipSettings",null,
[]);class fc extends Aa.a{constructor(Fa){super();this._element=null;this.element=Fa}get element(){return this._element}set element(Fa){this._element=Fa}get visible(){return"visible"===this.element.style.visibility}set visible(Fa){this.element.style.visibility=Fa?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Fa){this.element.dir=Fa?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Fa){this.element.style.zIndex=String(Fa)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Fa){return this.element.ownerDocument.createElement(Fa)}pka(){return!0}static ANh(Fa){return"prControl"+(Fa?"Rtl":"")}}Object(l.a)(fc,"BasePresenceControl",Aa.a,[10,955]);class Dc extends Sys.EventArgs{constructor(Fa,ub){super();this.type=Fa;this.Qo=ub}}Dc.KU="InteractivityChanged";Object(l.a)(Dc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class cd{static LUl(Fa){return cd.MUl(Fa)}static MUl(Fa){const ub=
document.createElementNS(cd.Nsg,"svg");ub.setAttribute("viewBox",String.format(cd.Dhl,cd.VJj,cd.UJj));ub.appendChild(cd.Wfm(Fa));return ub}static Wfm(Fa){const ub=cd.VJj/Fa,gc=2*ub,Rb=cd.UJj/2;Fa=(Fa-12-8)*ub/2;const wd=document.createElementNS(cd.Nsg,"g");Sys.UI.DomElement.addCssClass(wd,cd.Chl);for(let Hc=1;3>=Hc;Hc++)wd.appendChild(cd.mRl(Hc,gc,Fa+(6*Hc-2)*ub,Rb));return wd}static mRl(Fa,ub,gc,Rb){const wd=document.createElementNS(cd.Nsg,"circle");Sys.UI.DomElement.addCssClass(wd,String.format("{0}-{1}",
cd.tXk,Fa));wd.setAttribute("cx",String.format("{0}",gc));wd.setAttribute("cy",String.format("{0}",Rb));wd.setAttribute("r",String.format("{0}",ub));return wd}}cd.Nsg="http://www.w3.org/2000/svg";cd.Chl="prDancingDots";cd.tXk="prAnimateCircle";cd.Dhl="0 0 {0} {1}";cd.UJj=40;cd.VJj=120;Object(l.a)(cd,"ModernPresenceTooltipDancingDots",null,[]);var sd=c(88),od=c(84),ie=c(11),cf=c(53),Je=c(167),Lf=c(64);class Kf extends fc{constructor(Fa,ub){super(Fa);this.elh=this.Zab=this.Wve=this._img=this.yE=this.As=
this.ig=null;this.mNa=ub.get(8,!1);this.Eab=ub.get(6,0);this.Wnk=ub.get(15,!1);this.Wf=ub;this.LUg=0;this.element=Fa;this.element.className=Kf.Elf;this._span=document.createElement("span");this.element.appendChild(this._span);this.t1j=cd.LUl(ub.get(6,0));this.fC(ub);this._state=5}WAb(Fa){this.addHandler(Dc.KU,Fa)}ZOb(Fa){this.removeHandler(Dc.KU,Fa)}get user(){return this.elh}get state(){return this._state}dispose(){this.element&&(this.ig.sc(ie.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),
this.ig.sc(ie.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.As.sc(ie.a.pointerDown,this.element,Object(e.a)(this,this.gD,"onPointerDown")),this.As.sc(ie.a.pointerOut,this.element,Object(e.a)(this,this.TJ,"onPointerOut")),this.As.sc(ie.a.pointerOver,this.element,Object(e.a)(this,this.JP,"onPointerOver")),this.yE.sc(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}fC(Fa){this.ig=Fa.get(10);this.ig.ob(ie.a.click,
this.element,Object(e.a)(this,this.onClick,"onClick"));this.ig.ob(ie.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"));this.As=Fa.get(9);this.As.ob(ie.a.pointerOver,this.element,Object(e.a)(this,this.JP,"onPointerOver"));this.As.ob(ie.a.pointerOut,this.element,Object(e.a)(this,this.TJ,"onPointerOut"));this.As.ob(ie.a.pointerDown,this.element,Object(e.a)(this,this.gD,"onPointerDown"));this.yE=Fa.get(13);this.yE.ob(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"))}hide(Fa=
null,ub=0,gc=0){this.Wnk&&Fa?this.Ywo(Fa,ub,gc):(3===this.state&&this.W$i(),this.visible=!1,this._state=5)}Ywo(Fa,ub,gc=0){this.show(Fa,ub,15,4,void 0,gc)}Grj(Fa,ub,gc=!1,Rb=!1,wd=!1,Hc=0){this.show(Fa,ub,20,gc?2:Rb?1:0,wd,Hc)}vwo(Fa,ub,gc,Rb=!1,wd=0){this.show(Fa,ub,gc+20,3,Rb,wd)}show(Fa,ub,gc,Rb=3,wd=!1,Hc=0){!Fa||Rb===this.state&&this.Usm(ub,gc)||(this.nrk(Rb,wd,Hc),this.qga(Fa,Rb,Hc),this._state=Rb,4===Hc||0===Hc&&!this.mNa?this.element.style.left=ub+"px":this.element.style.right=ub+"px",this.element.style.top=
gc+"px",this.visible=!0)}qga(Fa,ub,gc){this.elh=Fa;Lf.a.KC(this._span);Je.a.dZk(this._span);this._span.id="fly_"+Fa.clientId;this._span.style.backgroundColor=Fa.color;4!==ub?(this._span.style.height=this.Eab+"px",this._span.style.lineHeight=this.Eab+"px",Je.a.AQb(this._span,"border-radius",this.Eab+"px")):4===gc||0===gc&&!this.mNa?this._span.style.left="0px":this._span.style.right="0px";2!==ub&&(4===ub?Lf.a.vv(this._span,""):1===ub?this._span.appendChild(this.t1j):(this._span.setAttribute("dir","auto"),
gc=Yb.a.d1l(Fa.userName),(!Fa.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&gc||0!==ub?(Fa=Fa.userName,0===ub&&(Fa=gc,Je.a.AQb(this._span,"text-align","center")),Lf.a.vv(this._span,Fa)):(this._img||(this._img=this.m9k()),this._span.appendChild(this._img),Je.a.AQb(this._span,"text-align","start"))))}onClick(Fa){if(0===this.state)return this.raiseEvent(Dc.KU,new Dc(1,Fa)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}TJ(Fa){3===this.state&&this.raiseEvent(Dc.KU,new Dc(3,Fa));return!1}JP(Fa){3!==Fa.jg&&this.raiseEvent(Dc.KU,new Dc(2,Fa));return!1}gD(Fa){if(3!==Fa.jg)return!0;this.raiseEvent(Dc.KU,new Dc(4,Fa));return!1}m9k(){const Fa=document.createElement("img");Fa.src=sd.a.Rba("doughperson_white_glyph.svg");Fa.setAttribute("Unselectable","on");cf.a.kr(Fa,cf.a.rh,cf.a.wz);return od.createClusteredImageFromClusterWithImageClass(this.Eab,this.Eab,null,null,Kf.dHl,
"",!1,"",this.element.ownerDocument,Fa)}nrk(Fa,ub=!1,gc=0){if(!this.$Vc(this.state)||!this.$Vc(Fa))switch(Sys.UI.DomElement.removeCssClass(this.element,this.Wve),this.state){case 4:3===Fa?this.p_a(Kf.Flf,Kf.B1h):this.$Vc(Fa)&&this.p_a(Kf.Dlf,Kf.B1h);break;case 3:4===Fa?this.p_a(Kf.Ilf,Kf.A1h):this.$Vc(Fa)&&(ub&&this.W$i(),this.p_a(Kf.Dlf,Kf.A1h,ub?Kf.cHl:""));break;case 0:case 1:case 2:4===Fa?this.p_a(Kf.Ilf,Kf.Glf):3===Fa&&(ub&&this.vsk(),this.p_a(Kf.Flf,Kf.Glf,ub?Kf.C1h:"",3===gc?Kf.gHl:Kf.eHl));
break;default:4===Fa?this.p_a(Kf.Ilf):3===Fa?this.p_a(Kf.Flf):this.$Vc(Fa)&&this.p_a(Kf.Dlf)}}p_a(...Fa){this.Wve=Fa.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.Wve)}vsk(){this.LUg=window.setTimeout(()=>{this.element&&(this.Zab=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.Zab),this.element.style.zIndex="2",this.Zab.style.zIndex="1")},300)}W$i(){window.clearTimeout(this.LUg);this.Zab&&(Sys.UI.DomElement.removeCssClass(this.Zab,Kf.Glf+" "+Kf.C1h),Sys.UI.DomElement.addCssClass(this.Zab,
Kf.bHl),H.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.Zab.parentNode&&this.element.parentNode.removeChild(this.Zab)}),Je.a.ojc(this.element,"z-index"))}$Vc(Fa){return 0===Fa||1===Fa||2===Fa}Usm(Fa,ub){const gc=Je.a.VY(this.element.style.top);return Je.a.VY(this.element.style.left)===Fa&&gc===ub}U9f(Fa){3===Fa&&Je.a.Kba(this.element,"left")?(Fa=Je.a.VY(this.element.style.left),Je.a.ojc(this.element,"left"),this.element.style.right=-1*Fa+"px"):4===Fa&&Je.a.Kba(this.element,
"right")&&(Fa=Je.a.VY(this.element.style.right),Je.a.ojc(this.element,"right"),this.element.style.left=-1*Fa+"px")}}Kf.Elf="prModernFlyout UIFont";Kf.Ilf="flyoutIdle";Kf.Flf="flyoutExpanded";Kf.Dlf="flyoutCollapsed";Kf.B1h="flyoutFromIdle";Kf.A1h="flyoutFromExpanded";Kf.Glf="flyoutFromCollapsed";Kf.C1h="flyoutStacked";Kf.cHl="flyoutFromStacked";Kf.bHl="flyoutFadeOut";Kf.dHl="cui-img-cont-float cui-img-20by20";Kf.eHl="flyoutLtrDir";Kf.gHl="flyoutRtlDir";Object(l.a)(Kf,"ModernPresenceTooltipFlyoutControl",
fc,[]);class Th{constructor(Fa,ub,gc=2,Rb=4){this.offsetTop=Fa;this.offsetLeft=ub;this.SJj=gc;this.Voi=Rb}}Object(l.a)(Th,"FlyoutsPositioningInfo",null,[]);var bh=c(37);class Hb{constructor(Fa=!1,ub=!1){this.om=Fa;this.ABe=ub}r2l(Fa,ub,gc,Rb,wd){const Hc=wd.y,de=wd.height;var We=this.GPl(Rb);const Ne=We+ub,ng=Fa*gc+2*(Fa-1);gc=null;1===Fa||this.DSk(We,ng,Hc,de)?Fa=new Th(0,0,2):(Fa=this.olf(Ne,ng,Hc,de),Fa.offsetTop-=We);this.ABe?gc=new Th(0,0,void 0,this.om?4:3):(Rb=this.FPl(Rb,wd),We=Math.max(0,
wd.x),wd=wd.width,ub=Rb+ub,this.ESk(Rb,We,wd)?gc=new Th(0,0,void 0,this.om?3:4):this.FSk(ub,We)&&(gc=new Th(0,0,void 0,this.om?4:3)),gc||(gc=this.NFl(Rb,ub,We,wd)));return new Th(Fa.offsetTop,gc.offsetLeft,Fa.SJj,gc.Voi)}GPl(Fa){return bh.a.jFa(Fa)}FPl(Fa,ub){return this.om?ub.width-bh.a.Q5h(Fa):bh.a.rof(Fa)}DSk(Fa,ub,gc,Rb){return Fa+ub<=gc+Rb}olf(Fa,ub,gc,Rb){let wd=1,Hc=Math.max(gc,Fa-ub);ub>Fa-gc&&(wd=2,Hc=ub<Rb?Rb-ub:gc);return new Th(Hc,0,wd)}ESk(Fa,ub,gc){return Fa+150<=ub+gc}FSk(Fa,ub){return 150<=
Fa-ub}NFl(Fa,ub,gc,Rb){Rb-ub>=Fa-gc?Fa=4:(ub=Fa,Fa=3);return new Th(0,ub,void 0,Fa)}}Object(l.a)(Hb,"ModernPresenceTooltipPositioner",null,[]);class Ib{constructor(Fa,ub,gc,Rb,wd,Hc,de){this.Aaa=Fa;this._parent=ub;this.iPg=gc;this.fZj=Rb;this.i6j=wd;this.V0b=Hc;this.mNa=de;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Fa,ub){if(3!==Fa)if(5!==Fa&&this.Aaa&&this.Aaa.length){if(4===Fa){var gc=this.i6j;var Rb=(this.V0b-gc)/
2;this.element.style.height=this.V0b+"px";this.element.style.width=this.V0b+"px";Fa=Je.a.VY(this.Aaa[0].element.style.top);ub=Je.a.VY(this.mNa?this.Aaa[0].element.style.right:this.Aaa[0].element.style.left)}else gc=this.iPg,Rb=(this.V0b-gc)/2,this.element.style.height=this.V0b+"px",this.element.style.width=this.ERl()+2*Rb+"px",Fa=Je.a.VY(this.Aaa[this.Aaa.length-1].element.style.top),ub=this.IRk(this.Aaa[this.Aaa.length-1].element,gc,ub);Je.a.AQb(this.element,"border-radius",this.V0b+"px");this.element.style.top=
Fa-Rb-gc+"px";this.mNa?this.element.style.right=ub-Rb+"px":this.element.style.left=ub-Rb+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}IRk(Fa,ub,gc){return this.mNa&&!gc?Je.a.VY(Fa.style.right):this.mNa||gc?this.mNa&&gc?-Je.a.VY(Fa.style.left)-ub:-Je.a.VY(Fa.style.right)-ub:Je.a.VY(Fa.style.left)}ERl(){return this.Aaa&&this.Aaa.length?this.iPg+Math.min(this.Aaa.length-1,
2)*this.fZj:0}}Object(l.a)(Ib,"ModernPresenceTooltipTarget",null,[]);var Xc=c(133),Hd=c(177);class ue extends fc{constructor(Fa,ub,gc){super(Fa);this.v_b=this.YLa=this.PZg=this.hvb=!1;this.Aq=[];this.pnd={};this.Wf=gc;this.om=gc.get(8,!1);this.EYg=gc.get(15,!1);this.l0j=gc.get(12,0);this.Cfb=gc.get(6,0);this.tma=ub;this.Blh=gc.get(16);this.ABe=gc.get(17,!1);this.m6j=gc.get(19,!1);this.sfk=gc.get(20,!1);this.lqd=0;this.mfk=new Hb(this.om,this.ABe);this.Dqc=this.v8h();this.dyb=!1;this.oUb=[];this.Dwc=
[];this.element.id=ue.zib();this.element.className=fc.ANh(this.om);this.b1a&&(this.zIndex=this.b1a);this.rtl=this.om;this.Xcg(ub);this.d7=this.createElement("div");this.d7.className="prFlyoutContainer";this.element.appendChild(this.d7);this.Aaa=[];this.zbb=new Ib(this.w4,this.element,this.Cfb,4,6,32,this.om);this.As=gc.get(9);this.As.ob(ie.a.pointerDown,this.zbb.element,Object(e.a)(this,this.Lgc,"onHitTarget"));this.As.ob(ie.a.pointerOver,this.zbb.element,Object(e.a)(this,this.Lgc,"onHitTarget"));
this.As.ob(ie.a.pointerOut,this.zbb.element,Object(e.a)(this,this.Lgc,"onHitTarget"))}get nae(){return Hd.a.clone(this.Aq)}get w4(){return this.Aaa}get b1a(){return this.l0j}get V1a(){return this.w4?this.w4.length:0}get lSb(){return 0<this.V1a?this.w4[0].state:5}get LEf(){return 3===this.lSb&&!this.hvb}WAb(Fa){this.addHandler(Dc.KU,Fa)}ZOb(Fa){this.removeHandler(Dc.KU,Fa)}dispose(){if(this.LEf)this.dyb=!0;else{if(this.w4)for(const Fa of this.w4)Fa.ZOb(Object(e.a)(this,this.QSa,"onInteractivityChanged")),
Pd.a.jC(Fa);this.Aaa=null;this.As.sc(ie.a.pointerDown,this.zbb.element,Object(e.a)(this,this.Lgc,"onHitTarget"));this.As.sc(ie.a.pointerOver,this.zbb.element,Object(e.a)(this,this.Lgc,"onHitTarget"));this.As.sc(ie.a.pointerOut,this.zbb.element,Object(e.a)(this,this.Lgc,"onHitTarget"));super.dispose()}}Wlc(){this.W4b();this.visible=!0}Q$c(){this.visible=!0;this.ZYh();this.hvb=!0}Ogg(){this.Q$c()}hide(){this.Caj();this.t3a();this.zbb.update(this.lSb,this.v_b)}qga(Fa){const ub=this.lSb,gc=this.hvb;Fa.clientId||
(Fa.clientId=(ue.Xwc++).toString());if(Fa.clientId in this.pnd){var Rb=this.ZEb(Fa.clientId);if(0<=Rb){Rb=this.Aq[Rb];if(Rb.color===Fa.color&&Rb.userName===Fa.userName)return;this.g7a(Fa.clientId)}}this.hide();Rb=new Kf(this.createElement("div"),this.Wf);Rb.WAb(Object(e.a)(this,this.QSa,"onInteractivityChanged"));this.d7.insertBefore(Rb.element,this.d7.firstChild);this.pnd[Fa.clientId]=Rb;Array.add(this.Aq,Fa);Array.add(this.w4,Rb);this.dIj(ub,gc);this.visible=!0}g7a(Fa){if(this.LEf)Array.add(this.Dwc,
Fa);else{var ub=this.lSb,gc=this.hvb;this.hide();this.M6c(Fa);this.dIj(ub,gc)}}gQi(Fa){const ub=this.ZEb(Fa);if(!(0>=ub)){var gc=this.Aq[ub];Fa=this.pnd[Fa];Array.removeAt(this.Aq,ub);Array.insert(this.Aq,0,gc);Array.removeAt(this.w4,ub);Array.insert(this.w4,0,Fa);this.d7.removeChild(Fa.element);this.d7.appendChild(Fa.element);this.W4b()}}dIj(Fa,ub){0>=this.Aq.length?this.hide():3===Fa&&ub?this.Q$c():this.Wlc()}gjf(Fa){if(this.LEf&&this.m6j)return!1;Fa=ue.Mtf(Fa);if(this.d7!==Fa&&Lf.a.jRa(this.d7,
Fa))return!0;for(const ub of this.w4)if(Lf.a.jRa(ub.element,Fa))return!0;return!1}position(Fa,ub){this.element.style.top=ub+"px";this.element.style.left=Fa+"px"}W4b(Fa=!1){if(!Fa||this.YLa){this.PZg&&this.snj(!0);var ub=Math.min(3,this.V1a)-1;Fa=0;var gc=1,Rb=0;this.v_b&&(Fa=this.Dqc,gc=-1,Rb=-this.Cfb);for(let wd=this.V1a-1;wd>ub;wd--)this.w4[wd].Grj(this.Aq[wd],-4*ub*gc+Rb,!0,!1,!0,Fa);for(;0<=ub;ub--)this.w4[ub].Grj(this.Aq[ub],-4*ub*gc+Rb,0<ub,Array.contains(this.oUb,this.Aq[ub].clientId),ub!==
this.lqd,Fa);this.lqd=0;this.zbb.update(0,this.v_b);this.zIndex=this.b1a;this.hvb=!1;this.Caj(0);this.dyb&&this.dispose()}}ZYh(){this.PZg&&this.snj(!1);this.zIndex=this.b1a+1;let Fa,ub,gc;({offsetX:ub,offsetY:Fa,Uoi:gc}=this.kko());for(let Rb=0;Rb<this.V1a;Rb++)this.w4[Rb].vwo(this.Aq[Rb],ub,Fa+(this.Cfb+2)*Rb,Rb!==this.lqd,gc)}t3a(){let Fa=0,ub=0;this.v_b&&(Fa=this.Dqc,ub=-6);for(let gc=0;gc<this.V1a;gc++)this.w4[gc].hide(this.Aq[gc],ub,Fa);this.zIndex=this.b1a;this.visible=this.hvb=!1;this.dyb&&
this.dispose()}O8e(Fa=0){Fa?(this.YLa=!0,H.Task.delay(Fa).continueWith(()=>{this.EYg?this.Hum():this.W4b(!0);this.YLa=!1})):this.EYg?this.hide():this.W4b()}Hum(){this.YLa&&this.hide()}LKk(){if(m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Jb.Npa&&Xc.c()){const Fa=appChrome.selectors.getShyState();return Fa.isActive&&0!==Fa.state}return!1}QSa(Fa,ub){Fa=this.lSb;this.LKk()||2!==ub.type&&(4!==ub.type||3===Fa)?4===ub.type&&3===Fa?(this.YLa&&(this.YLa=!1),this.O8e()):3!==ub.type||3!==Fa||this.hvb||
(1<this.V1a?(this.YLa=!0,H.Task.delay(250).continueWith(()=>{this.W4b(!0);this.YLa=!1})):this.O8e()):(this.YLa&&(this.YLa=!1),3!==Fa&&(this.ZYh(),3===ub.Qo.jg&&this.O8e(2E3)));this.raiseEvent(Dc.KU,ub)}Lgc(Fa){3===Fa.jg?this.QSa(this,new Dc(4,Fa)):Fa.eventName===ie.a.pointerOver?this.QSa(this,new Dc(2,Fa)):Fa.eventName===ie.a.pointerOut&&this.QSa(this,new Dc(3,Fa));return!1}Xcg(Fa){this.element.style.width=Fa+"px";this.element.style.height=this.Cfb+"px"}M6c(Fa){this.dZn(Fa);Fa=this.ZEb(Fa);if(!(0>
Fa)){var ub=this.Aq[Fa];Array.removeAt(this.Aq,Fa);delete this.pnd[ub.clientId];ub=this.w4[Fa];this.d7.removeChild(ub.element);this.Wf.get(18,!1)&&ub.ZOb(Object(e.a)(this,this.QSa,"onInteractivityChanged"));Array.removeAt(this.w4,Fa);ub.dispose()}}Caj(Fa=5){if(this.Dwc.length){this.visible&&this.t3a();for(let ub=0;ub<this.Dwc.length;ub++)this.M6c(this.Dwc[ub]);Array.clear(this.Dwc);0>=this.Aq.length||5===Fa?this.hide():0===Fa&&this.Wlc()}}ZEb(Fa){for(let ub=0;ub<this.Aq.length;ub++)if(this.Aq[ub].clientId===
Fa)return ub;return-1}dZn(Fa){-1===this.ZEb(Fa)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.oUb,Fa)&&(Array.remove(this.oUb,Fa),this.Aq[0].clientId===Fa&&0<this.oUb.length&&this.gQi(this.oUb[this.oUb.length-1]),this.Aq[0].clientId===Fa&&1===this.lSb&&this.W4b())}snj(Fa){Fa?Sys.UI.DomElement.addCssClass(this.d7,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.d7,"prBackgroundSelection")}kko(){let Fa,ub;ub=Fa=0;var gc=
this.Dqc;if(this.Blh){const Rb=this.Blh(this);if(!Rb)return{offsetX:Fa,offsetY:ub,Uoi:gc};const wd=4===this.lSb;gc=this.mfk.r2l(this.V1a,wd?6:this.Cfb,this.Cfb,this.element,Rb);ub=gc.offsetTop;this.lqd=this.T0l(gc.SJj,gc.offsetTop);gc=gc.Voi;gc!==this.Dqc&&(this.U9f(gc),this.element.dir=3===gc?"rtl":"ltr",this.Dqc=gc);gc!==this.v8h()?(Fa=this.sfk?-2:wd?-6:-this.Cfb,this.v_b=!0):this.v_b=!1}return{offsetX:Fa,offsetY:ub,Uoi:gc}}T0l(Fa,ub){if(1===Fa)return this.V1a-1;Fa=Math.abs(ub);return 0<Fa?Fa/(this.Cfb+
2):0}U9f(Fa){for(let ub=0;ub<this.V1a;ub++)this.w4[ub].U9f(Fa)}v8h(){return this.om?3:4}static zib(){return String.format("{0}-{1}","presencetooltip",ue.Xwc++)}static Mtf(Fa){return Fa.Hb.rawEvent.relatedTarget}}ue.Xwc=0;Object(l.a)(ue,"ModernPresenceTooltipControl",fc,[1007,10]);var Oe=c(271),Ve=c(274);class xg{constructor(Fa){this.Wf=Fa;this.Wf.VNa(10,Oe.a.instance);this.Wf.VNa(9,Cd.a.instance);this.Wf.VNa(6,20);this.Wf.VNa(13,Ve.a.instance);this.Wf.VNa(17,!1)}Faf(Fa,ub=!1){this.Wf.VNa(15,ub);return new ue(Fa,
20,this.Wf)}}Object(l.a)(xg,"ModernPresenceTooltipFactory",null,[1006]);class Ni extends fc{constructor(Fa,ub){super(Fa);this.Aq=null;this.mNa=ub.get(8,!1);this.Eab=ub.get(6,0);this.element=Fa;this.element.className=Ni.Elf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.ig=ub.get(10);this.ig.ob(ie.a.click,this.element,Object(e.a)(this,this.onClick,"onClick"));this.As=ub.get(9);this.As.ob(ie.a.pointerOut,this.element,Object(e.a)(this,this.TJ,"onPointerOut"));this.As.ob(ie.a.pointerDown,
this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"));this.yE=ub.get(13);this.yE.ob(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior"))}WAb(Fa){this.addHandler(Dc.KU,Fa)}ZOb(Fa){this.removeHandler(Dc.KU,Fa)}get users(){return this.Aq}dispose(){this.element&&(this.ig.sc(ie.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.As.sc(ie.a.pointerDown,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),
this.As.sc(ie.a.pointerOut,this.element,Object(e.a)(this,this.TJ,"onPointerOut")),this.yE.sc(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Fa,ub,gc){this.hide();!Fa||0>=Fa.length||(this.mNa?this.element.style.right=ub+"px":this.element.style.left=ub+"px",this.element.style.top=gc+"px",this.awk(Fa),this.visible=!0)}awk(Fa){this.Aq=Fa;Lf.a.KC(this._ul);for(let ub=Fa.length-1;0<=ub;ub--)this.qga(Fa[ub])}qga(Fa){const ub=
document.createElement("li");ub.style.backgroundColor=Fa.color;ub.style.height=this.Eab+"px";ub.id="fly_"+Fa.clientId;ub.style.lineHeight=this.Eab+"px";Lf.a.vv(ub,Fa.userName);ub.setAttribute("dir","auto");this._ul.appendChild(ub)}onClick(){this.hide();return!1}TJ(Fa){this.raiseEvent(Dc.KU,new Dc(3,Fa));return!1}}Ni.Elf="prFlyout UIFont";Object(l.a)(Ni,"PresenceTooltipFlyoutControl",fc,[]);class yi extends fc{constructor(Fa,ub,gc){super(Fa);this._img=null;this.Aq=[];this.element.className="prGlyph";
this.Wf=ub;this.c_b=this.Wf.get(9);this.Pq=this.Wf.get(10);this.yE=this.Wf.get(13);this.evm();this.qga(gc);this.YFe=!1}get W5a(){return this.Aq.length}get users(){return this.Aq}WAb(Fa){this.addHandler(Dc.KU,Fa)}ZOb(Fa){this.removeHandler(Dc.KU,Fa)}dispose(){this.QRo();super.dispose()}qga(Fa){Array.add(this.Aq,Fa);2===this.W5a?this.Ika(!0):1===this.W5a?this.Ika(!1):this.Ika(this.YFe)}g7a(Fa){this.gDl(Fa)&&(1<this.W5a&&this.Ika(!0),1===this.W5a?this.Ika(!1):1>this.W5a&&this.hide())}show(){this.Ika(2<=
this.W5a);this.visible=!0}hide(){this.visible=!1}D0l(Fa){return Fa?this.U6h(0,5):this.U6h(1,4)}gDl(Fa){for(let ub=0;ub<this.W5a;ub++)if(this.Aq[ub].clientId===Fa)return Fa=this.Aq[ub],Array.removeAt(this.Aq,ub),Fa;return null}Ika(Fa){this.YFe!==Fa&&(this._img&&this.element.removeChild(this._img),this._img=this.D0l(Fa),this.element.appendChild(this._img),this.YFe=Fa);this._img.childNodes[0].style.backgroundColor=this.Aq[this.Aq.length-1].color}U6h(Fa,ub){const gc=this.Wf.get(6,0),Rb=this.Wf.get(14);
return od.createClusteredImageFromClusterWithImageClass(gc,gc,this.Wf.get(Fa),this.Wf.get(ub),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Rb?Rb.cloneNode(!0):null)}JP(Fa){3!==Fa.jg&&this.raiseEvent(Dc.KU,new Dc(2,Fa));return!1}onClick(Fa){this.raiseEvent(Dc.KU,new Dc(1,Fa));return!0}TJ(Fa){3!==Fa.jg&&this.raiseEvent(Dc.KU,new Dc(3,Fa));return!1}QRo(){this.element&&(this.c_b.sc(ie.a.pointerDown,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),
this.c_b.sc(ie.a.pointerOver,this.element,Object(e.a)(this,this.JP,"onPointerOver")),this.c_b.sc(ie.a.pointerOut,this.element,Object(e.a)(this,this.TJ,"onPointerOut")),this.Pq.sc(ie.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.Pq.sc(ie.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.yE.sc(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")))}evm(){this.element&&(this.c_b.ob(ie.a.pointerDown,this.element,
Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.c_b.ob(ie.a.pointerOver,this.element,Object(e.a)(this,this.JP,"onPointerOver")),this.c_b.ob(ie.a.pointerOut,this.element,Object(e.a)(this,this.TJ,"onPointerOut")),this.Pq.ob(ie.a.vB,this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")),this.Pq.ob(ie.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.yE.ob(this.element,Object(e.a)(this,this.pka,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(yi,"PresenceTooltipGlyph",fc,[]);class Kh extends fc{constructor(Fa,ub,gc){super(Fa);this.Aq=[];this.PK=[];this.EMa=0;this.pDc=this.pXb=!1;this.OKg=null;this.qnd={};this.Wf=gc;this.om=gc.get(8,!1);this.Rla=gc.get(11,!1);Fa=gc.get(12,0);this.imageDimension=gc.get(6,0);this.tma=ub;this.element.id=Kh.zib();this.element.className=fc.ANh(this.om);Fa&&(this.zIndex=Fa);this.rtl=this.om;this.Xcg(ub);this.zBa=this.createElement("div");this.zBa.className=this.Rla?"prContainerV":"prContainerHr";
this.element.appendChild(this.zBa);this.WVg=Array(this.EMa);for(ub=0;ub<this.EMa;ub++)this.pca[ub]=new Ni(this.createElement("div"),this.Wf),this.pca[ub].WAb(Object(e.a)(this,this.QSa,"onInteractivityChanged")),this.element.appendChild(this.pca[ub].element)}get nae(){return Hd.a.clone(this.Aq)}get pca(){return this.WVg}get xnh(){return this.OKg}get Ije(){return this.imageDimension+2}get width(){return this.Rla?this.Ije:this.tma}get height(){return this.Rla?this.tma:this.Ije}WAb(Fa){this.addHandler(Dc.KU,
Fa)}ZOb(Fa){this.removeHandler(Dc.KU,Fa)}dispose(){if(this.pca)for(const Fa of this.pca)Fa.ZOb(Object(e.a)(this,this.QSa,"onInteractivityChanged")),Pd.a.jC(Fa);Pd.a.Eag(this.PK);this.PK=this.WVg=null;super.dispose()}Wlc(){this.t3a();this.ahg();this.visible=!0;this.pXb=!1}Q$c(){!this.PK||1>this.PK.length||(this.t3a(),this.visible=!0,this.ahg(),this.eae(this.PK[this.PK.length-1]),this.pXb=!0)}Ogg(){if(this.PK&&!(1>this.PK.length)){this.visible=!0;this.ahg();var Fa=0;for(const ub of this.PK)this.eae(ub,
Fa++);this.pXb=!1;this.pDc=!0}}hide(){this.visible=!1;this.t3a();for(let Fa=0;Fa<this.PK.length;Fa++)this.PK[Fa].hide();this.pXb=!1}vDh(){if(!this.pDc)return!1;let Fa=0;for(const ub of this.pca)ub.visible&&Fa++;return this.pDc=0<Fa&&(this.Aq.length<=this.EMa?Fa===this.Aq.length:Fa===this.EMa)}qga(Fa){if(!(0>=this.EMa)){Fa.clientId||(Fa.clientId=(Kh.Xwc++).toString());if(Fa.clientId in this.qnd){var ub=this.ZEb(Fa.clientId);if(0<=ub){ub=this.Aq[ub];if(ub.color===Fa.color&&ub.userName===Fa.userName)return;
this.g7a(Fa.clientId)}}ub=this.vDh();var gc=0;if(this.Aq.length<this.EMa){var Rb=new yi(this.createElement("div"),this.Wf,Fa);Rb.WAb(Object(e.a)(this,this.QSa,"onInteractivityChanged"));this.om&&!this.Rla&&0<this.Aq.length?this.zBa.insertBefore(Rb.element,this.zBa.firstChild):(this.zBa.appendChild(Rb.element),gc=this.PK.length);Array.add(this.PK,Rb)}else this.om&&!this.Rla?Rb=this.PK[0]:(gc=this.PK.length-1,Rb=this.PK[gc]),Rb.qga(Fa);Rb.show();this.qnd[Fa.clientId]=Rb;Array.add(this.Aq,Fa);this.OFj(Rb,
gc);ub&&this.Ogg()}}g7a(Fa){const ub=this.vDh();ub&&this.t3a();this.M6c(Fa);this.Aq.length>=this.EMa&&this.PK.length<this.EMa&&this.DQn();0>=this.Aq.length?this.hide():ub&&this.Ogg()}gQi(){}M6c(Fa){var ub=this.ZEb(Fa);0>ub||(Fa=this.Aq[ub],Array.removeAt(this.Aq,ub),ub=this.qnd[Fa.clientId],delete this.qnd[Fa.clientId],ub.g7a(Fa.clientId),this.OFj(ub),0>=ub.W5a&&(this.zBa.removeChild(ub.element),Array.remove(this.PK,ub),ub.dispose()))}DQn(){var Fa=this.T7l();!Fa||1>=Fa.users.length||(Fa=Array.clone(this.Aq),
Fa.forEach(ub=>{this.M6c(ub.clientId)}),Fa.forEach(ub=>{this.qga(ub)}))}ZEb(Fa){for(let ub=0;ub<this.Aq.length;ub++)if(this.Aq[ub].clientId===Fa)return ub;return-1}T7l(){return this.om&&!this.Rla?this.PK[0]:this.PK[this.PK.length-1]}position(Fa,ub){this.element.style.top=ub+"px";this.element.style.left=Fa+"px"}ahg(){for(let Fa=0;Fa<this.PK.length;Fa++)this.PK[Fa].show()}t3a(){for(let Fa=0;Fa<this.EMa;Fa++)this.pca[Fa].hide();this.pDc=!1}eae(Fa,ub=0){if(Fa)if(this.OKg=Fa,this.Rla){const gc=this.imageDimension;
if(1<Fa.users.length)this.pca[ub].show(Fa.users,gc,this.height-this.imageDimension);else{const Rb=this.zBa.children.length;for(let wd=0;wd<this.zBa.children.length;wd++)Fa.element===this.zBa.children[wd]&&this.pca[ub].show(Fa.users,gc,this.height-(Rb-wd)*this.Ije+2)}}else this.pca[ub].show(Fa.users,this.width,0)}QSa(Fa,ub){var gc=Object(y.a)(yi,Fa);gc=gc?this.U_h(gc):-1;if(2===ub.type||1===ub.type&&-1!==gc&&!this.pca[gc].visible)this.eae(Fa);else if(1===ub.type)this.t3a(),this.pXb=!1;else if(3===
ub.type){if(this.gjf(ub.Qo))return;this.pXb||this.t3a()}this.raiseEvent(Dc.KU,ub)}gjf(Fa){Fa=Kh.Mtf(Fa);let ub=!1;for(const gc of this.pca)if(Lf.a.jRa(gc.element,Fa)){ub=!0;break}return this.zBa!==Fa&&Lf.a.jRa(this.zBa,Fa)||ub}OFj(Fa,ub=0){const gc=this.oHm(Fa);gc&&0>=Fa.W5a?this.pca[ub].hide():gc?this.eae(Fa):this.pca[ub].hide()}U_h(Fa){let ub=0;for(const gc of this.PK){if(Fa===gc)return ub;ub++}return-1}oHm(Fa){const ub=this.U_h(Fa);return!!this.xnh&&Fa===this.xnh&&-1!==ub&&this.pca[ub].visible}Xcg(Fa){this.EMa=
Fa===this.imageDimension?1:Math.floor(Fa/this.Ije);this.Rla?(this.element.style.height=Fa+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Fa+"px",this.element.style.height=this.imageDimension+"px")}static zib(){return String.format("{0}-{1}","presencetooltip",Kh.Xwc++)}static Mtf(Fa){Fa=Fa.Hb.rawEvent;return Fa.relatedTarget||Fa.toElement}}Kh.Xwc=0;Object(l.a)(Kh,"PresenceTooltipControl",fc,[1007,10]);class yg{constructor(Fa){this.Wf=Fa;this.Wf.VNa(10,Oe.a.instance);
this.Wf.VNa(9,Cd.a.instance);this.Wf.VNa(6,16);this.Wf.VNa(13,Ve.a.instance)}Faf(Fa){return new Kh(Fa,16,this.Wf)}}Object(l.a)(yg,"PresenceTooltipFactory",null,[1006]);var Of=c(235),pg=c(110),aj=c(51),Mf=c(5),Yg=c(96),dh=c(7),mh=c(16),Nk=c(70),yl=c(471),Cl=c(284),Wk=c(227);class df extends Sys.EventArgs{constructor(Fa,ub){super();this.paragraphId=Fa;this.v0m=ub}}Object(l.a)(df,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class Xh extends fc{constructor(Fa,ub,gc,Rb,wd,Hc=null,de=null){super(null);
this.jnd=this.hn=null;this.KZc=!1;this.Qra=0;this.Bp=Fa;this.rEc=ub;this.As=gc;this.vj=Rb;this.KKa=wd;Xh.Dvb=0;this.Qsh=new pc.a;this.Bej=new pc.a;this.QW=Hc;this.Ca=de;this.h3j=this.Ca.mc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.dnk=this.Ca.mc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Gsa=0}get L5a(){return m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Mwk(Fa){this.addHandler("CR",Fa)}lbj(Fa){this.removeHandler("CR",Fa)}xce(){this.raiseEvent("CR",new df(this.Bp.ip.paragraphId,
this.KZc))}qQf(){if(Object(Wk.a)(ue,this.hn)){const Fa=Object(y.a)(ue,this.hn);Xh.Dvb=0<Xh.Dvb?Xh.Dvb+1:Fa.b1a+1;Fa.zIndex=Xh.Dvb;this.element.style.zIndex=String(Xh.Dvb)}}x6n(){if(Object(Wk.a)(ue,this.hn)){const Fa=Object(y.a)(ue,this.hn);Xh.Dvb=Fa.b1a;Fa.zIndex=Fa.b1a;this.element.style.zIndex=String(Fa.b1a)}}$Ki(){this.QW&&!this.gOo()&&this.QW.continueWith(()=>{this.QW.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.h3j)&&this.Gsa++})}gOo(){return this.Gsa>=this.dnk}static tKi(){Xh.IVg||
(Xh.IVg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static zib(Fa){return Xh.uwm+Fa.M$h()}}Xh.B3i="data-presence-control";Xh.r_i="OverlayControlElementOwner";Xh.uwm="ipId_";Xh.C3i="WacPresence";Xh.Hyn="PresenceIpPaddingDiv";Xh.IVg=!1;Xh.Dvb=0;Object(l.a)(Xh,"APresenceControl",fc,[1271,10]);class hh{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.a8a=!1}}Object(l.a)(hh,"PresenceImageControlStyle",null,[1272]);class yj extends Xh{constructor(Fa,
ub,gc,Rb,wd,Hc=null,de=null){super(Fa,ub,gc,Rb,wd,Hc,de);this.TJ=()=>{this.mPi();return!1};this.L8d=We=>{this.hn&&3===We.jg&&(2!==this.Qra?(this.qQf(),this.mRb()):this.mPi());return!1}}g7a(Fa){this.hn&&this.hn.g7a(Fa)}Roe(){return this.hn?this.hn.nae.length:0}updatePosition(Fa){if(this.element&&this.element.parentNode){var ub=this.jai(Fa);if(ub){var gc=Sys.UI.DomElement.getBounds(this.element.parentNode),Rb,wd;({left:gc,top:Rb,height:wd,width:ub}=this.x$l(ub,gc,this.element.parentNode,this.vj.instance));
this.element.style.top=Rb+"px";this.element.style.left=gc+"px";this.element.style.height=wd+"px";this.element.style.width=ub+"px";gc=this.rai(Fa);Je.a.O5(this.element,gc);Fa=this.nrf(Fa,this.Bp.ip.shapeId);this.Wnj(gc,ub,this.isSelected(Fa),m.AFrameworkApplication.isRtl);this.mRb()}}}dZ(){this.element&&(Lf.a.qx(this.element),this.hn.g7a(this.Bp.user.clientId),this.xce())}PHh(Fa,ub,gc,Rb){ub=new hh;if(!Rb||!gc)return ub;gc=this.jai(Fa);if(!gc)return ub;ub.top=gc.y;ub.left=gc.x;ub.height=gc.height;
ub.width=gc.width;ub.rotation=this.icm(Fa);ub.a8a=!0;return ub}kcj(Fa,ub,gc,Rb){Xh.tKi();this.jnd=Fa;if(Rb){const wd=this.nrf(Fa,this.Bp.ip.shapeId);if(!wd)return;const Hc=!this.element;Hc&&this.Jaf(ub.ownerDocument,Fa);Hc||!this.element.parentNode?wd.appendChild(this.element):this.element.parentNode!==wd&&(this.element.parentNode.removeChild(this.element),wd.appendChild(this.element));this.hn.qga(this.Bp.user);this.element.style.borderColor=this.Bp.user.color;this.element.id=Xh.zib(this.Bp);gc.a8a&&
(this.element.style.height=gc.height+"px",this.element.style.top=gc.top+"px",this.element.style.left=gc.left+"px",this.element.style.width=gc.width+"px",Je.a.O5(this.element,gc.rotation),Je.a.O5(this.hn.element,-1*gc.rotation),this.Wnj(gc.rotation,gc.width,this.isSelected(wd),m.AFrameworkApplication.isRtl),this.mRb())}this.KZc=!Rb;this.xce()}icm(Fa){return this.element&&this.element.parentNode&&this.qgi(Je.a.getTransform(this.element.parentNode))?this.qgi(Je.a.getTransform(this.element)):this.rai(Fa)}qgi(Fa){return Fa&&
-1<Fa.indexOf("deg")&&(Fa=parseInt(Fa.substring(Fa.indexOf("(")+1,Fa.indexOf("deg"))),!isNaN(Fa))?Fa:0}mFj(Fa){this.element.style.borderColor=this.Bp.user.color;this.element.id=Xh.zib(this.Bp);this.updatePosition(Fa)}Jaf(Fa,ub){this.element=Fa.createElement("div");this.element.setAttribute(Xh.B3i,!0);pg.a.Sl(this.element,Xh.r_i,this);this.element.className=yj.QGn;(Fa=ub.Cb)&&Fa.$Q&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.hn=this.rEc.Faf(this.createElement("div"),
!0);this.hn.qga(this.Bp.user);this.hn.hide();this.As.ob(ie.a.pointerOut,this.hn.element,this.TJ);this.As.ob(ie.a.pointerDown,this.hn.element,this.L8d);this.hn.element.classList.add(Xh.C3i);this.element.appendChild(this.hn.element)}x$l(Fa,ub,gc,Rb){let wd=Fa.y,Hc=Fa.x,de=Fa.height;Fa=Fa.width;(1<Math.abs(ub.width-gc.offsetWidth)||1<Math.abs(ub.height-gc.offsetHeight))&&Rb&&(wd=Math.round(wd/Rb.mj),Hc=Math.round(Hc/Rb.mj),de=Math.round(de/Rb.mj),Fa=Math.round(Fa/Rb.mj));return{left:Hc,top:wd,height:de,
width:Fa}}isSelected(Fa){return Fa.classList.contains(Cl.a.F6b)}Wnj(Fa,ub,gc,Rb){this.hn.element.style.left="auto";this.hn.element.style.top="auto";this.hn.element.style.right="auto";this.hn.element.style.bottom="auto";gc=gc?Math.round(.5*yj.Pra)+yj.RLo:0;0<=Fa&&90>Fa||360===Fa?(this.hn.element.style.top=-.5*yj.Pra-gc+"px",Rb?this.hn.element.style.right=ub-.5*yj.Pra+"px":this.hn.element.style.left=ub-.5*yj.Pra+"px"):90<=Fa&&180>Fa?(this.hn.element.style.left=-.5*yj.Pra-gc+"px",Rb?this.hn.element.style.bottom=
-.5*yj.Pra+"px":this.hn.element.style.top=-.5*yj.Pra+"px"):180<=Fa&&270>Fa?(this.hn.element.style.bottom=-.5*yj.Pra-gc+"px",Rb?this.hn.element.style.left=ub-.5*yj.Pra+"px":this.hn.element.style.right=ub-.5*yj.Pra+"px"):(this.hn.element.style.right=-.5*yj.Pra-gc+"px",Rb?this.hn.element.style.top=-.5*yj.Pra+"px":this.hn.element.style.bottom=-.5*yj.Pra+"px")}Fl(Fa,ub){const gc=this.XRd(Fa,ub);return gc?gc.properties:(Fa=this.pai(Fa,ub))?Fa.properties:null}nrf(Fa,ub){var gc=this.XRd(Fa,ub);return gc&&
(gc=gc.Swa(Fa.Fg,Fa))?gc.element:(ub=this.pai(Fa,ub))?Object(y.a)(yl.a,ub).te(Fa.$b).htmlElement:null}XRd(Fa,ub){Fa=Nk.i(Fa.Cb,5);for(const gc of Fa)if(gc.properties.getValue(Mf.a.phb)===ub)return gc;return null}pai(Fa,ub){Fa=dh.GraphIterator.eb(Fa.Cb);let gc=Fa.Ub(6);for(;gc;){const Rb=gc.properties.getValue(Mf.a.phb);if(mh.ImageReader.Nt(gc)&&Rb===ub)return gc;gc=Fa.Mf(6)}return null}r0l(Fa){const ub=aj.a.mf(mh.ImageReader.oF(Fa),0);Fa=aj.a.mf(mh.ImageReader.JG(Fa),1);return{Rka:ub,Wtm:Fa}}rai(Fa){Fa=
this.Fl(Fa,this.Bp.ip.shapeId);return mh.ImageReader.n0(Fa)}jai(Fa){var ub=this.Bp.ip;if(!ub||!ub.shapeId)return null;var gc=this.Fl(Fa,ub.shapeId);const Rb=this.nrf(Fa,ub.shapeId);if(!gc||!Rb)return null;const wd=mh.ImageReader.ui(gc);let Hc=Fa=1,de;({Rka:ub,Wtm:de}=this.r0l(gc));Qa.App.instance&&Qa.App.instance.IR(wd)?(gc=mh.ImageReader.zoa(gc),Fa=aj.a.mf(gc[Yg.a.left],0),Hc=aj.a.mf(gc[Yg.a.top],1)):gc.hasProperty(Mf.a.Sda)?(gc=gc.getValue(Mf.a.Sda),Fa+=aj.a.mf(gc[Yg.a.left],0),Hc+=aj.a.mf(gc[Yg.a.top],
1)):(Fa+=0<Rb.offsetWidth?(Rb.offsetWidth-ub)/2:2,Hc+=0<Rb.offsetHeight?(Rb.offsetHeight-de)/2:2);return new Sys.UI.Bounds(Math.round(Fa),Math.round(Hc),Math.round(ub),Math.round(de))}mPi(){this.hn&&(this.hn.Wlc(),this.Qra=1)}mRb(){for(const Fa of this.hn.nae)if(Fa.clientId===this.Bp.user.clientId&&!Fa.equals(this.Bp.user)){this.hn.qga(this.Bp.user);break}if(this.Bp.HUa||2===this.Qra)this.hn.Q$c(),this.Bp.HUa=!1,this.Bp.ida=!0,this.Qra=2;this.Bp.ida&&1!==this.Qra||(this.hn.Wlc(),this.Bp.ida=!0,this.Qra=
1)}}yj.QGn="WACImgPresenceHighlight";yj.Pra=20;yj.RLo=6;Object(l.a)(yj,"PresenceImageControl",Xh,[]);var wf=c(254);class yh{constructor(){this.height=this.top=this.left=this.Lui=0;this.a8a=!1;this.bC=this.Lh=null}}Object(l.a)(yh,"PresenceIpControlStyle",null,[1272]);var uj=c(55);class Ri extends Xh{constructor(Fa,ub,gc,Rb,wd,Hc=null,de=null,We=null){super(Fa,ub,gc,Rb,wd,Hc,de);this.xDc=this.LXa=this.v0b=null;this.JP=Ne=>{!this.hn||this.L5a&&!this.hn.gjf(Ne)||(this.qQf(),this.qfe(Ne));this.mFj(this.jnd);
return!1};this.TJ=()=>{this.hn&&this.AR();return!1};this.L8d=Ne=>{this.hn&&3===Ne.jg&&(2!==this.Qra?(this.qQf(),this.qfe(Ne)):this.AR());return!1};this.FD=We}Jaf(Fa){this.element=Fa.createElement("div");this.element.setAttribute(Xh.B3i,!0);pg.a.Sl(this.element,Xh.r_i,this);this.element.className=Xh.Hyn;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.As.ob(ie.a.pointerOver,this.element,this.JP);this.L5a&&(this.As.ob(ie.a.pointerOut,this.element,this.TJ),this.As.ob(ie.a.pointerDown,
this.element,this.L8d));this.LXa=this.createElement("div");this.LXa.className=Ri.RGn;this.L5a||(this.xDc=this.createElement("div"),this.xDc.className=Ri.UGn,this.LXa.appendChild(this.xDc));this.hn=this.rEc.Faf(this.createElement("div"),this.L5a);Fa=this.Ca.$("NoPresenceUserLookUpBeforeRender");this.FD&&!Fa&&(this.Bp.user=this.FD.NNf(this.Bp.user.clientId)||this.Bp.user);this.hn.qga(this.Bp.user);this.hn.hide();this.hn.element.classList.add(this.L5a?Xh.C3i:Ri.aCn);this.LXa.appendChild(this.hn.element);
this.element.appendChild(this.LXa)}Akl(){this.v0b&&(bc.a.instance.ef(this.v0b),this.v0b=null)}mRb(Fa){for(var ub of this.hn.nae)if(ub.clientId===this.Bp.user.clientId&&!ub.equals(this.Bp.user)){this.hn.qga(this.Bp.user);break}ub=!1;Ri.oil===this.Bp.user.color?({value:ub}=this.Qsh.Fc(this.Bp.user.clientId,!1),ub||(this.Qsh.Z(this.Bp.user.clientId,!0),k.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Bp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:ub}=this.Bej.Fc(this.Bp.user.clientId,
!1),ub||(this.Bej.Z(this.Bp.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Bp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Fa||this.Bp.HUa||2===this.Qra?(this.$Ki(),this.hn.Q$c(),this.Bp.HUa=!1,this.Bp.ida=!0,this.Qra=2,Ri.yKo):this.Bp.ida&&1!==this.Qra?0:(this.$Ki(),this.hn.Wlc(),this.Bp.ida=!0,this.Qra=1,Ri.xKo)}qfe(Fa=null){this.Akl();const ub=this.mRb(!!Fa);this.L5a&&Fa&&Fa.eventName===ie.a.pointerOver||this.ebo(ub)}AR(){this.hn&&this.Qra&&(this.x6n(),
this.hn.hide(),this.Qra=0)}ebo(Fa){this.v0b=new pa.a(2,1,Fa,()=>{this.v0b=null;this.AR()},56);bc.a.instance.Wb(this.v0b)}updatePosition(Fa){if(this.element&&this.element.parentNode){var ub=this.Zai(Fa);if(ub){Fa=Sys.UI.DomElement.getBounds(this.element.parentNode);ub=new Sys.UI.Bounds(ub.x-Fa.x,ub.y-Fa.y,Ri.Pui,ub.height);var gc;({left:Fa,top:ub,height:gc}=this.A$l(ub,Fa,this.element.parentNode,this.vj.instance));this.element.style.height=2*Ri.whc+gc+"px";this.element.style.top=ub-Ri.whc+"px";this.element.style.left=
Fa-Ri.whc+"px";this.LXa.style.height=Math.max(Ri.bPi,gc)+"px";this.qfe()}}}dZ(){this.element&&(Lf.a.qx(this.element),this.xce())}PHh(Fa,ub,gc,Rb,wd){const Hc=new yh;if(!Rb||!gc)return Hc;Rb=this.Zai(Fa);if(!Rb)return Hc;var de=gc;gc=Fa;if(Fa.gk){var We=Fa.nc;de=Fa.Xg.P$b(this.Bp.ip.m$.cp);0>de&&0==de;Fa.nc.Bxa?Lf.a.jRa(We.editingElement,Fa.Xg.gj.J(de))||(gc=uj.InteractiveViewManager.instance.yd.zj(Fa.source),ub=gc.Xg.gj.J(de)):ub=gc.Xg.gj.J(de);de=ub.getBoundingClientRect()}de=new Sys.UI.Bounds(Rb.x-
de.x,Rb.y-de.y,Ri.Pui,Rb.height);Fa=de.y;Rb=de.x;de=de.height;We=this.vj.instance;wd&&We&&(wd=We.mj,Fa=Math.round(Fa/wd),Rb=Math.round(Rb/wd),de=Math.round(de/wd));Hc.top=Fa-Ri.whc;Hc.left=Rb-Ri.whc;Hc.height=2*Ri.whc+de;Hc.Lui=Math.max(Ri.bPi,de);Hc.a8a=!0;Hc.Lh=ub;Hc.bC=gc;return Hc}kcj(Fa,ub,gc,Rb){Xh.tKi();this.jnd=Fa;Fa=gc.Lh;ub=gc.bC;if(Fa&&ub){if(Rb){const wd=!this.element;wd&&this.Jaf(Fa.ownerDocument);wd||!this.element.parentNode?Fa.appendChild(this.element):this.element.parentNode!==Fa&&
(this.element.parentNode.removeChild(this.element),Fa.appendChild(this.element));this.jnd=ub;Fa=this.Bp.user.color;this.LXa.style.borderColor=Fa;this.L5a||(this.xDc.style.borderColor=Fa);this.element.id=Xh.zib(this.Bp);gc.a8a&&(this.element.style.height=gc.height+"px",this.element.style.top=gc.top+"px",this.element.style.left=gc.left+"px",this.LXa.style.height=gc.Lui+"px",this.qfe())}this.KZc=!Rb;this.xce()}else k.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Fa} or paragraphViewElement is null:${!ub}`)}dispose(){this.element&&
(this.dZ(),this.As.sc(ie.a.pointerOver,this.element,this.JP),this.L5a&&(this.As.sc(ie.a.pointerOut,this.element,this.TJ),this.As.sc(ie.a.pointerDown,this.element,this.L8d)),Pd.a.jC(this.hn),this.element=this.hn=null);super.dispose()}mFj(Fa){const ub=this.Bp.user.color;this.LXa.style.borderColor=ub;this.L5a||(this.xDc.style.borderColor=ub);this.element.id=Xh.zib(this.Bp);this.updatePosition(Fa)}A$l(Fa,ub,gc,Rb){let wd=Fa.y,Hc=Fa.x;Fa=Fa.height;(1<Math.abs(ub.width-gc.offsetWidth)||1<Math.abs(ub.height-
gc.offsetHeight))&&Rb&&(wd=Math.round(wd/Rb.mj),Hc=Math.round(Hc/Rb.mj),Fa=Math.round(Fa/Rb.mj));return{left:Hc,top:wd,height:Fa}}Zai(Fa){const ub=this.Bp.ip;if(!ub)return null;let gc;try{const Rb=ub.m$.cp;gc=wf.a.N_(Rb,Fa,0<Rb,!1,!1,!1)}catch(Rb){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",bc.a.instance.Sv,Rb.message,Rb.stack),gc=null}return gc}}Ri.aCn="WacPawn";Ri.Pui=2;Ri.xKo=7E3;Ri.yKo=2E3;Ri.whc=5;Ri.RGn="presenceIp";Ri.UGn="PresenceSmallBox";
Ri.bPi=10;Ri.oil="0xcccccc";Object(l.a)(Ri,"PresenceIpControl",Xh,[]);class oi{constructor(Fa,ub,gc,Rb,wd=null,Hc=null,de=null){this.htc={};this.ftc={};this.POg={};this.rEc=Fa;this.As=ub;this.kn=gc;this.KKa=Rb;this.QW=wd;this.Ca=Hc;this.FD=de}get Tgl(){return this.htc}get VOh(){return this.ftc}w$l(Fa){const ub=!!this.Ca&&this.Ca.$("PeoplesWellExtraButtonInfoIsEnabled");return Fa.ip.shapeId&&ub?this.B$l(Fa):this.C$l(Fa)}B$l(Fa){const ub=Fa.ip.shapeId.toString();this.POg[Fa.user.clientId]=ub;const gc=
this.ftc[ub];return gc?(gc.Bp=Fa,{returnValue:gc,Poe:!0}):{returnValue:this.ftc[ub]=new yj(Fa,this.rEc,this.As,this.kn,this.KKa,this.QW,this.Ca),Poe:!1}}C$l(Fa){const ub=Fa.user.clientId,gc=this.htc[ub];return gc&&gc.Bp.user.equals(Fa.user)?(gc.Bp=Fa,{returnValue:gc,Poe:!0}):{returnValue:this.htc[ub]=new Ri(Fa,this.rEc,this.As,this.kn,this.KKa,this.QW,this.Ca,this.FD),Poe:!1}}$ai(Fa){return this.htc[Fa]}n0l(Fa){return(Fa=this.ftc[this.POg[Fa]])&&!Fa.Roe()?Fa:null}Ypl(){var Fa=this.htc;for(const ub in Fa)Fa[ub].dispose();
Fa=this.ftc;for(const ub in Fa)Fa[ub].dispose()}}Object(l.a)(oi,"PresenceControlProvider",null,[]);var zi=c(146);class bj{constructor(){this.Rcb=0}Qci(){this.Rcb++;this.Rcb===Number.MAX_VALUE&&(this.Rcb=1);return this.Rcb}static get instance(){return bj.CAc}}bj.CAc=new bj;Object(l.a)(bj,"PacketIdGenerator",null,[155]);class Ml{constructor(Fa,ub,gc){this.rbo=Fa;this.Zxm=ub;this.NFi=gc}}Object(l.a)(Ml,"SuccessfulInboundReplicationCallbackData",null,[]);class Fi{constructor(Fa,ub,gc,Rb,wd,Hc,de){this.Z9n=
(We,Ne)=>{Ne.type||(We=this.Wk.JVh>=this.x1j,this.tmk&&We?(We=this.ACe())?We.AXh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.kF())};this.Mun=We=>{if(We=Object(y.a)(Ml,We)){var Ne=We.Zxm.oi.toString(),ng=this.ACe(),Ch=ng.Ou,Uh="";Ch!==We.NFi&&(k.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",We.rbo.toString()),Uh=this.P5l(ng,Ch,We.NFi));k.ULS.sendTraceTag(19964237,
500,50,"Revisions: {0}, InboundDuration: {1}",Uh,Ne)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.R9n=Fa;this.ACe=ub;this.Wk=gc;this.tmk=wd;this.x1j=Hc;this.yYb=Rb;this.Zp=de;this.R9n.S3(this.Z9n)}kF(){const Fa=this.ACe();if(!Fa)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.yYb()&&Fa.$Ra){let ub=-1;null!=Fa&&(ub=Fa.nza());const gc=this.Zp.Yf("Task","ShoulderTapInboundReplicationTimer");
Fa.kF(this.Mun,null,new Ml(ub,gc,Fa.Ou))}}P5l(Fa,ub,gc){const Rb=new Sys.StringBuilder;Fa=Fa.node.xd.store.getRevision(ub);if(!Fa)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:ub}),"";for(Rb.append(Fa.id.guid);ub!==gc;){Rb.append(", ");Rb.append(ub.guid);Fa=Fa.Fn;if(!Fa)break;ub=Fa.id}return Rb.toString()}}Object(l.a)(Fi,"ContentNotificationManager",null,[]);class Fg extends Fi{constructor(Fa,ub,gc,Rb,wd,Hc,de){super(Fa,
ub,gc,Rb,wd,Hc,de)}static get jra(){return null!=Fg.oGg?Fg.oGg:Fg.oGg=Sa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Qa.App.za){var Fa=Qa.App.za.jb;Fa&&(Fa.rga(Fg.P1c),Fa=Fa.Zc)&&(Fg.yH=Fa.contentReplicator,Fg.yH&&Qa.App.Uoa().continueWith(Fg.LVf))}}static LVf(){Fg.Zhd=Qa.App.Uoa().result;Fg.Zhd&&Fg.Zhd.Uo&&Fg.jra.bE().continueWith(Fg.z2c)}static z2c(){Fg.jj=Fg.jra.bE().result;if(Fg.jj){var Fa=m.AFrameworkApplication.K,ub=Fa.$("Box4ThrottleInboundRequests");Fa=Fa.mc("Box4ThrottleInboundsAtUserCount",
20);Fg.yH.$Td=()=>Fg.jj.nSa;Fg.Whd=Fg.Whd||new Fg(Fg.jj,()=>Fg.yH,Fg.Zhd,()=>m.AFrameworkApplication.Rk,ub,Fa,Qa.App.za.Kq);Fg.Whd.kF()}}static P1c(Fa){Fg.Whd||(Fa.gpb(Fg.P1c),Fg.init())}}Fg.Whd=null;Fg.jj=null;Fg.yH=null;Fg.Zhd=null;Object(l.a)(Fg,"WordContentNotificationManager",Fi,[]);var rl=c(50);class cl{constructor(Fa,ub,gc,Rb,wd,Hc){this.$id=null;this.tbh=Fa;this.ud=gc;this.IMa=Rb;this.iz=wd;this.zh=Hc;this.qsb=ub}clone(){return new cl(this.tbh,this.qsb.clone(),this.ud,this.IMa,this.iz,this.zh)}get cp(){if(null!=
this.$id)return this.$id;var Fa=this.tbh.paragraphId;if(Fa.equals(Nc.a.nil))return 0;var ub=this.IMa();if(!ub)return 0;Fa=ub.Eb(Fa);if(!Fa)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;ub=this.ud.ZCb(this.ud.dTa(Fa.characterData,Fa.qa),this.qsb);if(rl.a.Wj&&this.iz){var gc=Mb.a.Pc(Fa,ub);this.zh&&Fa.Ls&&(gc.Fb=this.zh.USd(Fa,ub,this.qsb.vva));ub=this.iz.Xba(gc,!0)}else this.iz&&this.zh&&Fa.Ls&&(gc=Mb.a.Pc(Fa,ub),gc.Fb=this.zh.USd(Fa,ub,this.qsb.vva),
ub=this.iz.Xba(gc,!0));return ub}WXf(){null==this.$id&&(this.$id=this.cp)}equals(Fa){return Fa?this.qsb.isEqual(Fa.qsb,!1):!1}}Object(l.a)(cl,"WordPresenceCp",null,[814,49,815]);class rn{constructor(Fa,ub){this.iz=Fa;this.zh=ub}create(Fa,ub,gc,Rb){return new cl(Fa,ub,gc,Rb,this.iz,this.zh)}}Object(l.a)(rn,"Factory",null,[782]);class Vo extends Sys.EventArgs{constructor(Fa,ub,gc){super();this.paragraphId=Fa;this.presence=ub;this.fDf=gc}}Object(l.a)(Vo,"ParagraphChangedEventArg",Sys.EventArgs,[]);class Nl{constructor(Fa){this.cp=
Fa}equals(Fa){return Fa?this.cp===Fa.cp:!1}clone(){return new Nl(this.cp)}}Object(l.a)(Nl,"PresenceCp",null,[814,49]);class Lh{constructor(Fa,ub,gc,Rb,wd){this.paragraphId=Fa;this.cp=ub;this.length=gc;this.shapeId=Rb;this.dryDeletion=wd}}Object(l.a)(Lh,"SerializablePresenceIpData",null,[]);class bm{constructor(Fa,ub,gc,Rb=0,wd=0){this.Kta=null;Fa&&(this.Kta=Nc.a.Hf(Fa));this.sbh=new Nl(ub);this.QHa=gc;this.Wfh=Rb;this.sTg=wd}get paragraphId(){return this.Kta}get m$(){return this.sbh}get shapeId(){return this.Wfh}get dryDeletion(){return this.sTg}isValid(){return 0<=
this.m$.cp&&!!this.paragraphId&&!this.paragraphId.equals(Nc.a.nil)}getData(){return new Lh(this.paragraphId.toString(),this.m$.cp,this.QHa,this.shapeId,this.dryDeletion)}clone(){const Fa=new bm;Fa.Kta=this.paragraphId;Fa.sbh=this.m$?this.m$.clone():null;Fa.QHa=this.QHa;Fa.Wfh=this.shapeId;Fa.sTg=this.dryDeletion;return Fa}static dDb(Fa){return Fa.paragraphId&&void 0!==Fa.cp&&null!==Fa.cp&&void 0!==Fa.length&&null!==Fa.length?new bm(Fa.paragraphId,Fa.cp,Fa.length,void 0,Fa.dryDeletion):null}}Object(l.a)(bm,
"PresenceIp",null,[167,49]);class rk{constructor(Fa,ub){this.ip=Fa;this.user=ub}}Object(l.a)(rk,"SerializablePresenceData",null,[]);class Xk{constructor(Fa,ub){this.HUa=this.ida=this.Gfc=!1;this.KXa=ub;this.user=Fa}get ip(){return this.KXa}nuf(){return new rk(this.ip?this.ip.getData():null,this.user.getData())}M$h(){return this.user.clientId+(this.KXa?this.KXa.paragraphId.toString():Nc.a.nil.toString())}isValid(){const Fa=!!this.user&&this.user.isValid(),ub=!this.ip||this.ip.isValid();return Fa&&
ub}clone(){const Fa=new Xk;Fa.user=this.user?this.user.clone():null;Fa.KXa=this.KXa?this.KXa.clone():null;Fa.ida=this.ida;Fa.Gfc=this.Gfc;Fa.HUa=this.HUa;return Fa}static dDb(Fa){return Fa?new Xk(Wa.dDb(Fa.user),Fa.ip?bm.dDb(Fa.ip):null):null}}Object(l.a)(Xk,"PresenceInfo",null,[179,49]);class Rj extends Aa.a{constructor(){super();this.OAc={};this.wWa={};this.CVg=!1}get Mzn(){return this.OAc}get AAi(){return!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}srh(Fa){this.addHandler("PPC",
Fa)}Rbj(Fa){this.removeHandler("PPC",Fa)}tRc(Fa){return Fa.ip.paragraphId.toString()}f_e(Fa,ub=!1){this.CVg||(this.CVg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var gc=({SGn:Rb}=this.OWm(Fa)).returnValue;if(Rb&&!ub)(gc=this.wWa[Fa.user.clientId])&&0<=gc.length&&(gc[gc.length-1].ip.QHa=Fa.ip.QHa);else{gc||this.Gaj(Fa.user.clientId);this.AAi&&gc&&this.YWo(Fa);ub=this.tRc(Fa);var Rb=Fa.user.clientId;var wd=this.OAc[ub]||[],Hc=this.wWa[Rb]||[];Hc.length>=Rj.MNi&&(Hc=
Hc.splice(-Rj.jjn,Rj.MNi));gc||wd.push(Rb);Hc.push(Fa);this.OAc[ub]=wd;this.wWa[Rb]=Hc;Fa.ip.paragraphId.equals(Nc.a.nil)||this.o5f(Fa.ip.paragraphId,Fa,!0)}}OWm(Fa){var ub=this.wWa[Fa.user.clientId];const gc=!ub||0>=ub.length?null:ub[ub.length-1],Rb=!!gc&&this.tRc(gc)===this.tRc(Fa);ub=Rb&&gc.ip.m$.equals(Fa.ip.m$)&&gc.user.equals(Fa.user);this.AAi&&ub&&gc.ip.shapeId&&Fa.ip.shapeId&&gc.ip.shapeId!==Fa.ip.shapeId&&(ub=!1);return{returnValue:Rb,SGn:ub}}YWo(Fa){const ub=this.fhl(Fa);ub&&ub.ip.shapeId&&
(Fa.ip.shapeId&&Fa.ip.shapeId===ub.ip.shapeId||this.o5f(ub.ip.paragraphId,ub,!1))}fhl(Fa){Fa=this.wWa[Fa.user.clientId];return!Fa||0>=Fa.length?null:Fa[Fa.length-1]}Gaj(Fa){const ub=this.wWa[Fa];if(ub&&0<ub.length){const gc=ub[0].ip.paragraphId,Rb=this.tRc(ub[0]);delete this.wWa[Fa];this.P_n(Rb,Fa);gc.equals(Nc.a.nil)||this.o5f(gc,ub[0],!1)}}N6h(Fa){return this.OAc[Fa]}sPc(Fa,ub,gc,Rb=!1){const wd=[],Hc=this.N6h(Fa);if(!Hc)return wd;for(let de=0;de<Hc.length;de++){const We=Hc[de],Ne=this.wWa[We];
let ng=!1;for(let Ch=Ne.length-1;0<=Ch;Ch--){const Uh=Ne[Ch];if(Rb){if(Uh.ida&&Uh.ip.paragraphId.equals(Nc.a.Hf(Fa))){ng=!0;wd.push(Uh);break}}else if(Object(Wk.a)(Xk,Uh)?Uh.ip.QHa===ub:Uh.ip.QHa===gc){ng=!0;Uh.Gfc=!0;wd.push(Uh);this.wWa[We]=Ne.splice(Ch,Ne.length);break}}!ng&&0<Ne.length&&Ne[0].Gfc&&Ne[0].ip.paragraphId.equals(Nc.a.Hf(Fa))&&wd.push(Ne[0])}return wd}lNl(Fa){if(!Fa||!Fa.Pa||!Fa.Pa.node)return null;Fa=this.sPc(Fa.Pa.node.id.toString(),0,0,!0);Fa=this.Wjm(Fa);Fa.sort((ub,gc)=>{if(!(ub&&
ub.userName&&gc&&gc.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Fa}Wjm(Fa){if(!Fa||!Fa.length)return[];const ub=[],gc=new L.a(J.a.hh());for(let Rb=0;Rb<Fa.length;Rb++){const wd=Fa[Rb].user;wd.isAnonymous&&gc.contains(wd.clientId)||!wd.isAnonymous&&wd.email&&gc.contains(wd.email)||(ub.push(wd),gc.add(wd.isAnonymous?wd.clientId:wd.email))}return ub}o5f(Fa,ub,gc){this.raiseEvent("PPC",new Vo(Fa,ub,gc))}P_n(Fa,ub){Array.remove(this.OAc[Fa],
ub)}}Rj.MNi=10;Rj.jjn=2;Object(l.a)(Rj,"PresenceDataManager",Aa.a,[1225]);class bn extends Rj{constructor(Fa){super();this.wH=Fa}f_e(Fa,ub=!1){super.f_e(Fa,ub)}tRc(Fa){return Fa.ip.Wc.toString()}N6h(Fa){Fa=this.wH.Eb(Nc.a.Hf(Fa));if(!Fa)return null;Fa=Fa.ja(Mf.a.Wc,0);return this.Mzn[Fa.toString()]}}Object(l.a)(bn,"WordPresenceDataManager",Rj,[]);var Ld=c(1321),nf=c(1219),cj=c(1860),Km=c(17);class ge{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch,Uh,ii,yd,pi,Eh,Uk,Ki,Oi,Bd,we,Qe,le,Yi){this.INa=Array(5);
this.gXe=this._started=this.gSe=!1;this.IOe=null;this.Ubh=new L.a(J.a.hh());this.wtd={};this.cHe=!1;this.szn=()=>{if(!this.gXe&&!this.Yl.My){var ml=new pa.a(0,1,20,()=>{const Qg=new S.a;var mk=this.$cb.Tgl;for(var zh in mk){const Te=mk[zh];Te.KZc&&Qg.add(Te.Bp.ip.paragraphId)}if(this.n6d){mk=this.$cb.VOh;for(const Te in mk)zh=mk[Te],zh.KZc&&!Qg.contains(zh.Bp.ip.paragraphId)&&Qg.add(zh.Bp.ip.paragraphId)}this.Y4h(Qg);this.gXe=!1},72);this.Ib.Wb(ml);this.gXe=!0}};this.tVi=()=>{this.gSe&&(this.Sbg(),
this.gSe=!1)};this.s5=(ml,Qg)=>{this.zjj(Qg.xl.lb)};this.q5=(ml,Qg)=>{ml=Qg.Zra;for(var mk in ml){const zh=ml[mk];this.Ca.$("CashTelemetryIsEnabled")&&this.hNc(zh,new Date,null);zh.ip?this.ZZe(zh):this.N6c(zh.user.clientId)}Qg=Qg.lLd;for(mk=0;mk<Qg.length;++mk)this.oll(Qg[mk]);this.Ide()};this.XXf=(ml,Qg)=>{Qg.paragraphId?this.aZo(Qg.paragraphId.toString(),Qg.v0m,this.wtd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.D3i=(ml,Qg)=>{Qg.paragraphId&&(ml=this.XF.Eb(Qg.paragraphId))&&((Object(Wk.a)(Xk,
Qg.presence)?this.qCe(ml):this.rCe(ml))===Qg.presence.ip.QHa&&this.kbo(Qg.paragraphId),this.n6d&&this.TGn(Qg))};this.hw=Fa;this.ib=Rb;this.FD=wd;this.kyb=Hc;this.Yl=Ne;this.v1j=ng;this.$cb=Ch;this.XF=gc;this.zXg=Uh;this.qCe=ii;this.rCe=yd;this.wUj=de;this.y1j=We;this.CMa=pi;this.Rq=Eh;this.Kc=Uk;this.Ib=Ki;this.fjh=Qe;this.vgk=Yi;this.JOe=Bd;this.Ca=we;this.$sd=ub;ge.dud=new pc.a;for(Fa=0;Fa<this.$sd.length;Fa++)this.$sd[Fa].fXn(this);this.kyb.srh(this.D3i);this.hw.A_a(this.q5);le&&this.Yl.sga(this.szn);
this.hw.bde(this)}get n6d(){return!!this.Ca&&this.Ca.$("PeoplesWellExtraButtonInfoIsEnabled")}Ide(Fa=!1){this.fjh&&!Fa||this.gcj()}gcj(){const Fa=new S.a,ub=this.wtd;for(const gc in ub)Fa.add(Nc.a.Hf(gc));this.Y4h(Fa);this.wtd={}}Sbg(){this.ib.hb&&this.zjj(this.ib.hb.lb,!0)}zjj(Fa,ub=!1){this.vgk||(this.XF.Am.Cia||ub?Fa?(ub=this.wdl(Fa))?this.hw.$bg(ub):(this.hw.$bg(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Fa.Pa.contextId)):this.hw.$bg(null):this.gSe=!0)}wdl(Fa){if(!this.n6d||
!Fa.Vlb)if(Fa=Km.SelectionEditor.Jj(Fa,!0,!1),!Km.SelectionEditor.Pl(Fa))return null;return this.ezh(Fa)}ezh(Fa){const ub=Fa.Pa.cpBegin,gc=Fa.Pa.node.id;Fa=this.qCe(Fa.Pa.node);return new bm(gc.toString(),ub,Fa)}hNc(Fa,ub,gc){if(this.JOe)if(Fa&&Fa.user&&Fa.user.clientId){var Rb=Fa.user.clientId;this.Ubh.contains(Rb)||(this.IOe?(this.IOe.hNc(Rb,ub,null,ge.scm(gc||Fa.user.client)),this.Ubh.add(Rb)):this.JOe.continueWith(()=>{this.IOe=this.JOe.result;this.hNc(Fa,ub,gc)}))}else k.ULS.sendTraceTag(42262876,
302,15,"invalid presence")}y$l(Fa){const ub=new S.a;for(let gc=0;gc<Fa.length;gc++)ub.add(this.Mjm(Fa[gc]));return ub}ZZe(Fa){var ub=null;Fa&&Fa.user&&(ub=Fa.user.client);Fa=Fa.clone();Fa.user=this.FD.NNf(Fa.user.clientId)||Fa.user;this.Ca.$("CashTelemetryIsEnabled")&&this.hNc(Fa,new Date,ub);Fa.isValid()&&!Fa.user.rL()&&(ub=Fa.user.clientId,ge.dud.nb(ub)||this.Oli(ub),this.PYo(ub),Fa.user.userName=CommonUIStrings.l_AnonymousUserName);this.kyb.f_e(Fa,!1)}PYo(Fa){const {value:ub}=ge.dud.Fc(Fa,!1);
ub||(ge.dud.Z(Fa,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Fa+'" , "Event" : "CreateAnonymousGrayPawn"}'))}Oli(){}N6c(Fa){this.kyb.Gaj(Fa)}oll(Fa){this.N6c(Fa);const ub=this.$cb.$ai(Fa);ub&&(ub.lbj(this.XXf),ub.dispose());this.n6d&&(Fa=this.$cb.n0l(Fa))&&(Fa.lbj(this.XXf),Fa.dispose())}q$b(Fa){if(12!==Fa.type)return new S.a;Fa=this.kyb.sPc(Fa.id.toString(),this.qCe(Fa),this.rCe(Fa));return 0>=Fa.length?new S.a:this.y$l(Fa)}aZo(Fa,ub,gc){!ub&&Fa in gc&&delete gc[Fa]}dispose(){this.stop();
this.kyb.Rbj(this.D3i);this.hw.cPb(this.q5);this.hw.Eog(this);for(let Fa=0;Fa<this.$sd.length;Fa++)this.$sd[Fa].KSo(this);Pd.a.Eag([this.wUj,this.y1j,this.hw]);this.$cb.Ypl()}Mjm(Fa){let ub=!1;Fa=({Poe:ub}=this.$cb.w$l(Fa)).returnValue;ub||Fa.Mwk(this.XXf);return Fa}Vji(Fa){Fa=this.XF.Eb(Fa);if(!Fa)return this.INa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.INa[0]=!0),null;if(!Jb.ParagraphReader.Xb(Fa))return this.INa[1]||(k.ULS.sendTraceTag(4281421,302,
50,"Not a paragraph node"),this.INa[1]=!0),null;if(!Fa.te(this.Yl.$b))return this.INa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.INa[2]=!0),null;if(!Fa.anchor)return this.INa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.INa[3]=!0),null;this.INa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.INa[4]=!0);return Fa}laj(Fa){Fa=this.kyb.sPc(Fa.toString(),-1,-1,!0);if(!Hd.a.$e(Fa))for(const ub of Fa)(Fa=
this.$cb.$ai(ub.user.clientId))&&Fa.element&&Fa.dZ()}Y4h(Fa){if(Fa.count){var ub=new S.a;for(var gc of Fa)(Fa=this.Vji(gc))?ub.add(Fa):this.laj(gc);if(ub.count){gc=this.Kc.Nc(2);try{gc.set(this.Rq);for(const Rb of ub)this.TTh(Rb)}finally{gc&&gc.dispose()}}}}TTh(Fa){Fa.qL(this.Yl.$b,32,!0);Fa.qL(this.v1j,32,!0)}kbo(Fa){this.wtd[Fa.toString()]=null;this.fjh&&!this.cHe&&(Fa=new pa.a(0,1,200,()=>{this.cHe=!1;this.gcj()},70),this.Ib.Wb(Fa),this.cHe=!0)}TGn(Fa){if(Fa.presence.ip.shapeId&&!Fa.fDf){var ub=
this.$cb.VOh[Fa.presence.ip.shapeId.toString()];ub&&ub.g7a(Fa.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.eZ(this.s5),this.zXg.G1n(this.tVi))}start(){if(!this._started){this._started=!0;this.ib.Ww(this.s5);this.zXg.crh(this.tVi);var Fa=this.hw.BFb();delete Fa[this.CMa.clientId];this.q5(null,new cj.a(Fa,[]));this.Sbg()}}bje(Fa){if(Fa&&Fa.isValid()&&Fa.ip){var ub=this.kyb.sPc(Fa.ip.paragraphId.toString(),-1,-1),gc=!1,Rb=null;for(let wd=0;wd<ub.length;wd++)if(Rb=ub[wd],Rb.user.clientId===
Fa.user.clientId){gc=Rb.HUa=!0;break}if(gc)if(ub=Rb.ip.paragraphId,Fa=this.Vji(ub)){ub=this.Kc.Nc(2);try{ub.Db(Fa),this.TTh(Fa)}finally{ub&&ub.dispose()}}else this.laj(ub)}}static scm(Fa){return Fa?Fa?1===Fa?1:2===Fa?2:0:2:0}}ge.dud=null;Object(l.a)(ge,"PresenceManager",null,[1219,10,115,1220,1221,1222]);class qd{constructor(Fa,ub,gc,Rb){this.TVb=null;this._started=this.CFe=!1;this.lAb=null;this.xqa=(wd,Hc)=>{if(!m.AFrameworkApplication.Rk&&(wd=this.oGj(Hc.xl),this.TVb&&wd)){wd=this.fye.sPc(this.TVb.toString(),
-1,-1,!0);for(Hc=0;Hc<wd.length;Hc++)this.lAb[wd[Hc].user.clientId]=wd[Hc];0>=wd.length||(wd=this.Y$k(wd),this.Xo.sendNotification(wd,!0))}};this.hXi=(wd,Hc)=>{this.ib.hb&&!m.AFrameworkApplication.Rk&&this.CFe&&this.TVb&&this.TVb.equals(Hc.paragraphId)&&(wd=null,!Hc.fDf||Hc.presence.user.clientId in this.lAb?Hc.fDf||(wd=this.jNh(Hc.presence.user.userName,!1),delete this.lAb[Hc.presence.user.clientId]):(wd=this.jNh(Hc.presence.user.userName,!0),this.lAb[Hc.presence.user.clientId]=Hc.presence),wd&&
this.Xo.sendNotification(wd,!0))};this.jj=Rb;this.ib=ub;this.fye=Fa;this.Xo=gc;this.jj.bde(this)}start(){this._started||(this._started=!0,this.lAb={},this.fye.srh(this.hXi),this.ib.Ww(this.xqa),this.oGj(this.ib.hb))}stop(){this._started&&(this._started=!1,this.lAb=null,this.fye.Rbj(this.hXi),this.ib.eZ(this.xqa))}Y$k(Fa){if(1===Fa.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Fa[0].user.userName);const ub=[],gc=Fa.length;for(let Rb=0;Rb<gc;Rb++)ub.push(Fa[Rb].user.userName);
return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,ub.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}jNh(Fa,ub){return String.format(ub?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Fa)}dispose(){this.jj.Eog(this);this.stop()}oGj(Fa){if(!Fa)return!1;Fa=Fa.lb;if(!Fa)return!1;Fa=Fa.Pa;if(!Fa)return!1;this.CFe=Km.SelectionEditor.Ye(Fa);Fa=Fa.node.id;if(Fa.equals(this.TVb)||!this.CFe)return!1;this.TVb=Fa;this.lAb={};return!0}}Object(l.a)(qd,
"PresenceAccessibilityManager",null,[10,115]);class zk{constructor(Fa,ub){this._started=!1;this.wK=null;this.tod=!1;this.c2c=()=>{this._started&&this.jjj()};this.jj=Fa;ub&&(this.wK=ub,this.wK.Reb(this.c2c));this.jj.bde(this)}start(){this._started||(this._started=!0,this.wK?this.jjj():this.jj.qN(1,this.PLh()))}jjj(){const Fa=this.tod;(this.tod=!!this.wK.Vx)&&!Fa&&this.jj.qN(1,this.PLh())}PLh(){const Fa={};Fa.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Fa.HQ=!1;Fa.NT=1;Fa.WEB=!0;
return Fa}stop(){this._started&&(this._started=this.tod=!1)}dispose(){this.jj.Eog(this);this.wK&&this.wK.nbj(this.c2c)}}Object(l.a)(zk,"EditorsTableNotifier",null,[10,115]);var tf=c(342),eg=c(20);class Wg extends ge{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch,Uh,ii,yd,pi,Eh,Uk,Ki,Oi,Bd,we,Qe,le,Yi,ml,Qg,mk,zh,Te,mp,Op){super(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch,ii,yd,pi,Eh,Oi,Bd,we,Qe,le,Yi,ml,Qg,Te);this.Wk=null;this.cul=Rg=>{const Ho=!!this.Wk.mC.v9b(Rg);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",
Rg,Ho)};this.bul=(Rg,Ho)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Ho,Rg)};this.fja=()=>{if(2===Wg.jj.connectionState&&!Ka.SessionStatusManager.instance.eda){const Rg={};Rg.qs=m.AFrameworkApplication.rootQuerySignature;Wg.jj.Prb(Rg)}};Uh.fb(eg.a.Gxo,Cb.a.application,Wg.juk,64);Uh.fb(eg.a.c8f,Cb.a.application,Wg.c8f,64);Uh.fb(eg.a.N4f,Cb.a.application,Wg.N4f,96);Uh.fb(Da.a.bje,Cb.a.application,Wg.Fxo,64);this.XI=Uk;this.ud=Ki;this.CAb=mk;
this.CMa.sic=zh;this.CMa.sic.Uyk(Wg.iXi);mp.continueWith(()=>{this.Wk=mp.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.v3=Op)&&this.v3.execute(Rg=>{Rg.x_a(this.fja)})}v$b(Fa){if(!Fa||!Fa.anchor)return null;for(Fa=Fa.anchor.Sp;Fa;Fa=Fa.NA)if(Fa.AGa)return Fa.ps.node;return null}ezh(Fa){var ub=null;ub=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var gc=Fa.Pa.cpBegin,Rb=Fa.Pa.node;ub&&mh.ImageReader.Nt(Rb)&&(Rb=this.v$b(Rb));if(!Rb)return k.ULS.sendTraceTag(51242309,
302,15,"selectedNode is null"),null;Rb=this.rCe(Rb);const wd=Fa.Pa.node.ja(Mf.a.Wc,0);if(!this.XI)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Hc=this.XI.value.pjb(wd);const de=Wg.wH.Eb(Hc);if(!de)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Hc),null;gc=this.ud.Cpc(this.ud.dTa(de.characterData,de.qa),gc);gc.vva=-1===Fa.Pa.Fb?0:Fa.Pa.Fb;Hc=0;ub&&Fa.Vlb&&(Hc=this.aem(Fa));return ub=new te(this.XI.value,wd,Rb,gc,this.ud,()=>Wg.wH,this.CAb,Hc)}aem(Fa){const ub=
mh.ImageReader.tFa(Fa.Pa);return ub?ub.properties.ja(Mf.a.phb,0):Fa.Pa.node.properties.ja(Mf.a.phb,0)}Oli(Fa){this.Wk&&this.Wk.aoa&&this.Wk.aoa.kF(this.cul,this.bul,Fa)}dispose(){this.v3&&this.v3.execute(Fa=>{Fa.bPb(this.fja)});super.dispose()}static get Hv(){return Sa.a.instance.resolve("Common.Utils.IAriaNotifier")}static bE(){return Wg.Ywc.task}static get_instance(){return Wg.cud.task}static D$l(){return Wg.ubh.task}static get jra(){return null!=Wg.nGg?Wg.nGg:Wg.nGg=Sa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){Wg.cud||
(Wg.cud=new x.a);Wg.PVg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Wg.PVg=!1);if(Qa.App.za){var Fa=Qa.App.za.jb;Fa?(Fa.rga(Wg.P1c),Wg.JAc=Fa.rc,Fa.Fpa()?(Wg.aO=Fa.Zc.contentReplicator,Wg.aO?(Wg.wH=Fa.Zc.xd,Wg.wH?Wg.jra.bE().continueWith(Wg.Atn):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static Atn(){Wg.jj=Wg.jra.bE().result;if(Wg.jj){var Fa=[Wg.JAc.W2c,Wg.JAc.xe.W2c],ub=xb.a.instance,gc=Sa.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Rb=new qd(gc,ub,Wg.Hv,Wg.jj),wd=m.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Qa.App.zd.mC:null;wd=new zk(Wg.jj,wd);var Hc=Sa.a.instance.Ue("WordEditor.IParagraphWordIdMapping"),de=Sa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),We=Sa.a.instance.resolve("Common.IPeopleInfoProvider");Wg._instance=new Wg(Wg.jj,Fa,Wg.wH,ub,We,gc,Rb,wd,Wg.JAc,Wg.JAc.xe.$b,Sa.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.va,
Wg.aO,Jb.ParagraphReader.textLength,Jb.ParagraphReader.boa,Sa.a.instance.resolve("Box4.Presence.MyPresenceUser"),Hc,de,Qa.App.si.Hl,new tf.a,bc.a.instance,Ld.a.get_instance(),Ia.a.Fp(Sa.a.instance.Ta("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Sa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Sa.a.instance.resolve("Common.IPresenceStatusProvider"),
!Qa.App.Es&&!Qa.App.Dm,Qa.App.Uoa(),Sa.a.instance.Ta("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Wg.cud.Dg(Wg._instance);Wg.Ywc.Dg(Wg._instance);Wg.ubh.Dg(Wg._instance);Fa=Sa.a.instance;Fa.ia("WordEditor.Presence.WordPresenceManager",()=>Wg._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();Fa.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static P1c(Fa){Wg._instance||
(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Fa=Object(y.a)(17,Fa))&&Fa.gpb(Wg.P1c),Wg.init())}static iXi(){Wg._instance.Sbg()}static juk(Fa,ub,gc,Rb,wd){gc=wd.split(",");if(!gc||3!==gc.length)return 8;Fa=gc[0].trim();ub=gc[1].trim();gc=Number.parseInvariant(gc[2].trim());Fa=new Xk(new Wa(Fa),new bm(ub,gc,-1));if(!Wg.Ywc.task.isCompleted)return 8;ub=Wg.bE().result;ub.ZZe(Fa);ub.Ide();return 32}static c8f(Fa,ub,gc,Rb,wd){if(!Wg.Ywc.task.isCompleted)return 8;
Fa=Wg.bE().result;Fa.N6c(wd);Fa.Ide();return 32}static Fxo(Fa,ub,gc,Rb,wd){if(!Wg.Ywc.task.isCompleted)return 8;Fa=Wg.bE().result;if(!Fa)return 8;Fa.bje(wd);return 32}static N4f(Fa,ub,gc,Rb,wd){if(1===gc)return 32;if(!Wg.jra.bE().isCompleted)return 8;Fa=Wg.jra.bE().result;if(!Fa)return k.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;wd[nf.a.Value]=2===Fa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Fa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}Wg._instance=null;Wg.PVg=!0;Wg.cud=new x.a;Wg.Ywc=new x.a;Wg.ubh=new x.a;Wg.wH=null;Wg.JAc=null;Wg.aO=null;Wg.jj=null;Object(l.a)(Wg,"WordPresenceManager",ge,[]);class nh{constructor(Fa){this.sa=new Aa.a;this.OZ=Fa;this.OZ.CWR(()=>this.OZ.result.Owk(()=>{this.sa.raiseEvent("X")}))}Uyk(Fa){this.sa.addHandler("X",Fa)}c2n(Fa){this.sa.removeHandler("X",Fa)}getStatus(){return this.OZ.isCompleted&&this.OZ.result?this.OZ.result.SJd.toString():"0"}}Object(l.a)(nh,"WordPresenceStatusProvider",
null,[781]);class cm{constructor(Fa,ub,gc,Rb){this.jj=null;this.HVg=this.VJe=!1;this.Btn=()=>{this.l_.isCompleted&&this.l_.result?(this.jj=this.l_.result,this.jj.A_a(this.q5),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.q5=(wd,Hc)=>{wd=Hc.Zra;for(const de in wd)if(Hc=wd[de],!this.VJe&&Hc.user.zP&&Hc.user.zP!==this.n3.zP){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",
this.n3.zP,Hc.user.zP);this.VJe=!0;break}this.VJe&&this.jj.cPb(this.q5);this.HVg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.HVg=!0)};this.Wk=Fa;this.n3=ub;this.l_=gc;gc.continueWith(this.Btn);this.pbk=Rb;this.pbk.xMf=this.n3}}Object(l.a)(cm,"WordPresenceUpdateMonitor",null,[]);var zj=c(380),dl=c(1410),yf=c(203),Ol=c(1862),Sf=c(1863),Id=c(1735);class Xl{constructor(Fa,ub,gc,Rb,wd,Hc,de){this.sa=new Aa.a;this.p1g=this.i3g=this.$He=this.S5g=!1;this.lXe=this.Rzd=0;this.D1b=null;
this.CMa=Hc;this.CMa.clientId=Fa.clientId;this.Ll=Fa;this.naa=ub;this.Maa=Rb;this.u3j=wd;this.Ib=gc;this.zab=new yf.a;this.Ip=de;this.naa&&this.naa.continueWith(()=>{this.naa.Io||this.naa.Gi||this.naa.result.kqh(Object(e.a)(this,this.wTi,"onAmIAloneChanged"))})}get connectionState(){return this.Ll.connectionState}A_a(Fa){this.sa.addHandler("PU",Fa)}cPb(Fa){this.sa.removeHandler("PU",Fa)}Iua(Fa){this.sa.addHandler("CSC",Fa)}qjc(Fa){this.sa.removeHandler("CSC",Fa)}bGc(Fa){this.sa.addHandler("PSU",Fa)}U6c(Fa){this.sa.removeHandler("PSU",
Fa)}fCd(Fa){this.sa.addHandler("PSC",Fa)}Ede(Fa){this.sa.removeHandler("PSC",Fa)}ujj(){}get clientId(){return this.Ll.clientId}S3(Fa){this.sa.addHandler("UN",Fa)}dPb(Fa){this.sa.removeHandler("UN",Fa)}Szm(){this.D1b=Array(12);for(let Fa=0;12>Fa;Fa++)this.D1b[Fa]=0;this.i3g=this.Ip?this.Ip.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.qI(()=>{this.i8m()})}init(){this.Ll.Iua(Object(e.a)(this,this.aja,"onConnectionStateChanged"));this.Ll.A_a(Object(e.a)(this,this.q5,"onPresenceUpdated"));
this.Ll.bGc(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.Ll.fCd(Object(e.a)(this,this.Ugc,"onPersistentStateCleared"));this.Ll.S3(Object(e.a)(this,this.l1,"onUpdateNotificationReceived"));this.cIh();this.Szm()}bde(Fa){this.zab.contains(Fa,(ub,gc)=>ub===gc)||(this.zab.add(Fa),2===this.connectionState&&Fa.start())}Eog(Fa){for(let ub=0;ub<this.zab.length;ub++)if(this.zab.J(ub)===Fa){this.zab.zG(ub);break}}connect(){this.$He||this.Ll.connect()}disconnect(){this.Ll.disconnect()}get Tee(){return this.Ll}GRh(Fa){return Xk.dDb(Fa)}pcg(Fa,
ub){return(new Xk(Fa,ub)).nuf()}$bg(Fa){Fa&&Fa.isValid()&&!this.Maa()?this.Ll.ujj(this.pcg(this.CMa.t5l(),Fa)):H.Task.z4(null)}Dkc(Fa,ub){return this.Ll.Dkc(Fa,ub)}e9b(Fa){return this.Ll.e9b(Fa)}uPc(){return this.Ll.uPc()}qN(Fa,ub,gc=!1){return this.Ll.qN(Fa,ub,gc)}BFb(){return this.GLh(this.Ll.BFb())}Prb(Fa){const ub=new x.a;Id.a.getInstance().X6i(Fa,ub);return ub.task}get nSa(){return this.Ll.nSa}aja(Fa,ub){2===ub.newState&&this.zab.forEach(gc=>{gc.start();return!0});ub.newState||this.Ip.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&
!this.$He||this.zab.forEach(gc=>{gc.stop();return!0});this.sa.raiseEvent("CSC",ub)}qlf(Fa){return Fa.toLowerCase()}q5(Fa,ub){if(!this.Maa()){Fa=this.GLh(ub.Zra);ub=this.ILh(ub.lLd);var gc=new cj.a(Fa,ub);ub=new pa.a(0,1,0,()=>{this.sa.raiseEvent("PU",gc)},57);this.Ib.Wb(ub)}}GLh(Fa){const ub={};for(const Rb in Fa){var gc=Rb;const wd=this.GRh(Fa[Rb]);wd&&wd.isValid()?ub[this.qlf(gc)]=wd:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",gc)}return ub}ILh(Fa){const ub=Array(Fa.length);for(let gc=
0;gc<Fa.length;gc++)ub[gc]=this.qlf(Fa[gc]);return ub}TSa(Fa,ub){if(!this.Maa()){var gc={};Fa=ub.Zra;for(var Rb in Fa)gc[this.qlf(Rb)]=Fa[Rb];Rb=new pa.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new Ol.a(ub.type,gc))},80);this.Ib.Wb(Rb)}}Ugc(Fa,ub){if(!this.Maa()){Fa=this.ILh(ub.tGd);var gc=new Sf.a(Fa);Fa=new pa.a(0,1,0,()=>{this.sa.raiseEvent("PSC",gc)},81);this.Ib.Wb(Fa)}}l1(Fa,ub){this.i3g?this.gZi(ub):(Fa=new pa.a(0,1,0,()=>{this.gZi(ub)},58),this.Ib.Wb(Fa))}gZi(Fa){var ub=Date.now();this.sa.raiseEvent("UN",
Fa);ub=Date.now()-ub;500<=ub&&(this.Rzd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Fa.type,ub),this.cFl(Fa));this.lXe++}cFl(Fa){0>Fa.type||21<=Fa.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Fa.type):this.D1b[Fa.type]++}i8m(){if(!this.p1g){var Fa={};Fa.TC=this.lXe;Fa.HRC=this.Rzd;this.D1b&&0<this.Rzd&&(Fa.TBC=this.D1b);this.Rzd=this.lXe=0;this.D1b=null;k.ULS.sendTraceTag(42541603,
302,50,"UpdateNotificationHeuristics: {0}",Fa);this.p1g=!0}}dispose(){this.zab=new yf.a;this.Ll.qjc(Object(e.a)(this,this.aja,"onConnectionStateChanged"));this.Ll.cPb(Object(e.a)(this,this.q5,"onPresenceUpdated"));this.Ll.U6c(Object(e.a)(this,this.TSa,"onPersistentStateUpdated"));this.Ll.Ede(Object(e.a)(this,this.Ugc,"onPersistentStateCleared"));this.Ll.dPb(Object(e.a)(this,this.l1,"onUpdateNotificationReceived"));this.naa&&this.naa.continueWith(()=>{this.naa.Io||this.naa.Gi||this.naa.result.Z0n(Object(e.a)(this,
this.wTi,"onAmIAloneChanged"))});this.Ll.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}wTi(){this.cIh()}cIh(){let Fa=!1;this.naa?this.naa.continueWith(()=>{this.naa.Io||this.naa.Gi||(Fa=!this.naa.result.amIAlone);this.Ll.connectionState||!Fa&&!this.u3j()?2!==this.Ll.connectionState||Fa||(this.disconnect(),k.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));
!this.S5g&&Fa&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.S5g=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}YLc(){this.$He=!0;this.disconnect();k.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(l.a)(Xl,"RtcProxy",null,[1203,10,864,1204]);class ad extends Xl{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch,Uh,ii){super(Fa,ub,gc,Rb,wd,Hc,ii);this.aga=null;this.XI=de;this.ud=
We;this.IMa=Ne;this.CAc=ng;this.YTe=Ch;this.CAb=Uh}get dK(){return this.aga||(this.aga=this.YTe())}aja(Fa,ub){2===ub.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.qZo();super.aja(Fa,ub)}qZo(){this.dK&&this.dK.lV("RtcConnectionStatusLabel")}GRh(Fa){return uc.Yaf(Ef(Fa),this.XI,this.ud,this.IMa,this.CAb)}pcg(Fa,ub){return Object(Wk.a)(te,ub)?(Fa=new uc(this.CAc.Qci(),Fa,ub),ld(Fa.nuf())):super.pcg(Fa,ub)}}Object(l.a)(ad,"WordRtcProxy",Xl,[]);class fg{constructor(Fa,ub,gc,Rb,wd,Hc,
de,We,Ne,ng,Ch,Uh,ii){this.hq=new x.a;this.Dgh=!0;this.je=ub;this.Ib=gc;this.Maa=Rb;this.CMa=wd;this.XI=Hc;this.wua=de;this.IMa=We;this.CAc=Ne;this.YTe=ng;this.v3=Ch;this.CAb=Uh;this.Ca=ii}bE(){this.NOo();return this.hq.task}TQc(){return zj.a.then(this.bE(),Fa=>Fa)}NOo(){if(this.Dgh)if(this.Dgh=!1,Qa.App.NHf()&&Qa.App.LFf()){var Fa=m.AFrameworkApplication.Ge;if(Fa){Fa=dl.RealtimeChannel.createInstance("{"+m.AFrameworkApplication.userSessionId+"}",m.AFrameworkApplication.userSessionId,m.AFrameworkApplication.ogj,
Fa,this.v3,1,this.je,this.Ca.kb("RtcEndpointUrl"),void 0,void 0,null,this.Ca.$("FindSessionOnBootIsEnabled")?Sa.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ca.kb("RtcBootToken"));var ub=this.Ca.$("RtcAlwaysOnEnabled"),gc=new ad(Fa,ub?null:Qa.App.Uoa(),this.Ib,this.Maa,fg.wIl,this.CMa,this.XI,this.wua,this.IMa,this.CAc,this.YTe,this.CAb,m.AFrameworkApplication.K);Qa.App.ymo(gc);this.XWn(gc);gc.init();zi.App.z7a=gc;this.v3.execute(Rb=>{Rb.Teb(()=>{gc.YLc()})});this.hq.Dg(gc)}else k.ULS.sendTraceTag(8206365,
302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}XWn(Fa){const ub=Sa.a.instance;ub.ia("WordEditor.Presence.WordRtcProxy",()=>Fa).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").ha();ub.resolve("Common.IRealtimeChannelBasic")}static wIl(){return!1}}Object(l.a)(fg,"WordRtcProxyProvider",null,[779,780]);class Qf{constructor(){this.W=null;this.lm=
!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Qa.App.rLj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").bE(),Wg.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));Qa.App.NJc&&Fg.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(Qf.c1g){const Fa=this.W.resolve("WordEditor.IMainViewModeManager");Fa.XAb(this.bZf);Qf.HGe=1===Fa.ou}}dispose(){if(!this.lm){this.lm=
!0;Wg.bE().continueWith(()=>{Pd.a.jC(Wg.bE().result)});var Fa=this.W.resolve("Box4.Presence.MyPresenceUser");Fa&&Fa.sic&&Fa.sic.c2n(Wg.iXi)}}wc(Fa){this.W=Fa;this.W.ia("Box4.Presence.MyPresenceUser",()=>new nb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").ha();Fa.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new rn(Fa.resolve("Box4.CpConversionManagerImpl"),Fa.resolve("Box4.IContentControlReader"))).ha();Fa.ia("WordEditor.Presence.WordPresenceUpdateMonitor",
()=>new cm(new U.a(()=>Qa.App.zd),Of.a.instance,Fa.resolve("WordEditor.Presence.WordRtcProxyProvider").TQc(),Fa.resolve("Box4.Presence.IMyPresenceUser"))).ha();Fa.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new fg(m.AFrameworkApplication.buildVersion,Qa.App.za.Kq,bc.a.instance,()=>m.AFrameworkApplication.Rk,Sa.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Sa.a.instance.Oa("WordEditor.ParagraphWordIdMapping"),Sa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
()=>m.AFrameworkApplication.ua&&Qa.App.za.jb&&Qa.App.za.jb.Zc?Qa.App.za.jb.Zc.xd:null,bj.instance,()=>Sa.a.instance.Oa("WordEditor.IStatusBarUser"),Sa.a.instance.Ta("Common.ISessionExpirationManager"),Sa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),m.AFrameworkApplication.K)).ha().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Fa.ia("Box4.Presence.PresenceControlProvider",()=>new oi(Qf.wfl(),Cd.a.instance,Sa.a.instance.Ta("Common.IZoomManager"),
Sa.a.instance.resolve("Box4.ICoauthCashTelemetry"),Ia.a.Fp(Sa.a.instance.Ta("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,Fa.resolve("Common.IPeopleInfoProvider"))).ha();Fa.ia("Common.App.Presence.AwayManager",()=>new Ce(Sa.a.instance.resolve("Common.IPresenceUser"),Sa.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").TQc(),Wg.D$l(),Sa.a.instance.resolve("Common.IPresenceConverter"),bc.a.instance,m.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:m.AFrameworkApplication.K.mc("AwayCoauthorThresholdMs",9E5),Object(e.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.processAction,"processAction"),Qa.App.za.notificationBar,m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();Fa.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new nh(Ia.a.Fp(Sa.a.instance.Ta("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").ha();Fa.ia("Common.App.Presence.PeopleInfoProvider",()=>new Dh(Fa.resolve("WordEditor.Presence.WordRtcProxyProvider").TQc(),
Qa.App.Uoa().CWR(()=>Qa.App.Uoa().result.mC),Fa.resolve("Common.App.People.IPeopleColorUtils"),Fa.resolve("Common.IPresenceConverter"),Ia.a.Fp(Fa.Ta("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").ha();Fa.ia("Box4.Presence.WordPresenceDataManager",()=>new bn(Qa.App.za.jb.Zc.xd)).as("Box4.IPresenceDataManager").ha()}bZf(Fa,ub){Qa.App.za&&Qa.App.za.tD&&(Qf.Xsd=null,Qf.HGe=1===ub.hnb)}static get h_i(){if(!Qf.Xsd&&Qa.App.za&&Qa.App.za.tD){const Fa=zi.App.nn.tD;Qf.Xsd=Qf.HGe&&Qf.c1g?
Fa.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Fa.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Qf.Xsd}static wfl(){const Fa=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),ub=m.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),gc=m.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Rb=new kg;Rb.add(dg.multipleBrowsersImageClassName,od.getImageClassWithCluster(m.AFrameworkApplication.Nca,"MoreUsersGlyph16"));
Rb.add(dg.multipleBrowserImageClusterPath,m.AFrameworkApplication.Ms);Rb.add(dg.peopleImageClassName,od.getImageClassWithCluster(m.AFrameworkApplication.Nca,Fa?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Rb.add(dg.peopleImageClusterPath,m.AFrameworkApplication.Ms);Rb.add(dg.zIndex,1);Rb.add(dg.rtl,m.AFrameworkApplication.isRtl);Rb.add(dg.viewportBoundsCallback,Qf.ykm);Rb.add(dg.ignoreEventOnExpandedTooltip,ub);Rb.add(dg.ipWidthAdjustForFlyout,gc);return Fa?new xg(Rb):new yg(Rb)}static ykm(){return Qf.h_i?
bh.a.getElementBounds(Qf.h_i):null}}Qf.HGe=!0;Qf.c1g=m.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");Qf.Xsd=null;Object(l.a)(Qf,"WordPresencePackage",null,[1,2]);var Bm=c(945),gi=c(1243),zf=c(951),ll=c(174);class gg{constructor(Fa,ub){this.$Ze=Fa;this.paragraphId=ub}get opType(){return 2}get operation(){return this.$Ze}}Object(l.a)(gg,"RttAppliedAddParagraphOp",null,[166]);class sl{constructor(Fa,ub){this.h4n=Fa;this.paragraphId=ub}get opType(){return 6}get operation(){return this.h4n}}
Object(l.a)(sl,"RttAppliedReplaceSymbolRangeOp",null,[166]);class jn{constructor(Fa,ub){this.l4n=Fa;this.paragraphId=ub}get opType(){return 1}get operation(){return this.l4n}}Object(l.a)(jn,"RttAppliedReplaceTextRangeOp",null,[166]);class hi{constructor(Fa,ub,gc){this.Uuj=Fa;this.Hje=ub;this.UKc=gc}get opType(){return 4}get operation(){return this.Uuj}get spk(){return this.Uuj.T5b()?this.UKc:this.Hje}}Object(l.a)(hi,"RttAppliedSplitParagraphOp",null,[166]);class Yh{constructor(){this.s$a=new pc.a}uJf(Fa){return Fa.toString()}FFc(Fa,
ub){Fa=this.uJf(Fa);this.s$a.nb(Fa)||this.s$a.Z(Fa,new S.a);this.s$a.J(Fa).add(ub)}FXf(Fa){switch(Fa.opType){case 1:var ub=Object(y.a)(jn,Fa);this.FFc(ub.paragraphId,Fa);break;case 6:ub=Object(y.a)(sl,Fa);this.FFc(ub.paragraphId,Fa);break;case 4:ub=Object(y.a)(hi,Fa);this.FFc(ub.Hje,Fa);this.FFc(ub.UKc,Fa);break;case 2:ub=Object(y.a)(gg,Fa),this.FFc(ub.paragraphId,Fa)}}Von(Fa){return this.Enb(Fa)}Enb(Fa){Fa=this.uJf(Fa);if(!this.s$a.nb(Fa))return new S.a;const ub=this.s$a.J(Fa);this.s$a.remove(Fa);
for(const gc of ub)gc.operation&&(gc.operation.a8=null);return ub}p7l(Fa){let ub;return({value:ub}=this.s$a.Fc(this.uJf(Fa),ub)).returnValue?ub:new S.a}wMl(Fa){for(const ub of this.s$a.values){if(!ub.count)continue;if(2!==ub.J(0).opType)continue;const gc=ub.J(0);if(gc.$Ze.kTf===Fa)return gc}return null}}Object(l.a)(Yh,"RttAppliedOpTracker",null,[141]);var oh=c(231),lk;(function(Fa){Fa[Fa.Hzl=0]="expired";Fa[Fa.Ehp=1]="dried"})(lk||(lk={}));Object(l.b)("RemoveChangeReason",lk);class dj{constructor(){this.zAa=
new oh.a}irk(Fa){if(!Fa)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const ub=Fa.Wc,gc=Fa.tj;this.zAa.nb(ub)||this.zAa.add(ub,new oh.a);this.zAa.J(ub).Z(gc,Fa);return this.Bhl(ub,gc)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",ub),this.zAa.J(ub).remove(gc),!1):!0}xsf(Fa,ub){if(!this.zAa.nb(Fa))return null;Fa=this.zAa.J(Fa);return Fa.nb(ub)?Fa.J(ub):null}bTd(Fa){const ub=new S.a;for(const gc of this.zAa.keys){const Rb=
this.zAa.J(gc);for(const wd of Rb.keys){const Hc=Rb.J(wd);Fa(Hc)&&ub.add(Hc)}}return ub}yaj(Fa,ub){let gc=null;({value:gc}=this.zAa.Fc(Fa.Wc,gc)).returnValue?(Fa.activity.EVf(lk[ub]),gc.remove(Fa.tj),gc.count||this.zAa.remove(Fa.Wc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Fa.Wc,ub)}J7f(Fa){this.yaj(Fa,1)}M7f(Fa){this.yaj(Fa,0)}Bhl(Fa,ub){if(!this.zAa.nb(Fa))return!1;Fa=this.zAa.J(Fa);if(!Fa.nb(ub))return!1;for(var gc=Fa.J(ub);gc;){gc=
gc.U1;if(gc===ub)return!0;if(!Fa.nb(gc))break;gc=Fa.J(gc)}return!1}}Object(l.a)(dj,"RttDataStore",null,[139,140]);var el=c(268),je=c(79),Yk=c(251),sf=c(285),wi=c(15);class Re{constructor(Fa,ub){this.m7d=(gc,Rb)=>{4===this.Kp.opType?k.ULS.shipAssertTag(9204866,355,12===Rb.node.type||11===Rb.node.type,"Unexpected graph modification detected during RTT edit"):k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Enb=()=>{k.ULS.shipAssertTag(9204868,355,!1,
"Unexpected graph modification detected during RTT edit")};this.uVi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Kp=Fa;if(this.wq=ub)Fa=this.wq.Te(12),Fa.ku(this.m7d),Fa.Vw(this.Enb),Fa.Eo(this.uVi)}dispose(){if(this.wq){const Fa=this.wq.Te(12);Fa.sV(this.m7d);Fa.Lja(this.Enb);Fa.lS(this.uVi)}}}Object(l.a)(Re,"GraphChangeValidator",null,[10]);class Dg{constructor(Fa,ub,gc,Rb){this.id=Fa;this.cpBegin=ub;this.cpEnd=gc;this.UUk=Rb}$1o(Fa){var ub=
this.id===Fa.id;ub&&(ub=this.UUk.replace("\u00a0"," "),Fa=Fa.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),ub=ub===Fa);return ub}}Object(l.a)(Dg,"RttOpValidator",null,[198]);class Ak{constructor(Fa,ub){this.a8=this.ipc=this.activity=null;this.opType=Fa;this.metadata=ub}nvf(){return""}serialize(){return null}}Object(l.a)(Ak,"RttOp",null,[145]);class bk extends Ak{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne){super(Ne,We);this.Wc=Fa;this.tj=ub;this.dS=gc;this.k5=Rb;this.U1=
wd;this.lrb=Hc;this.QH=de}HNh(){return this.dS.isEqual(this.k5,!0)?new of.a(0,this.Wc,this.tj,this.dS,void 0,void 0,void 0,this.QH):new of.a(1,this.Wc,this.tj,this.dS,this.Wc,this.tj,this.k5,this.QH)}static YBj(Fa){let ub,gc;var Rb=Fa.MT;if(1===Rb.Dce&&(Rb.bTa!==Rb.NHa||Rb.K8a!==Rb.pnc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),gc=ub=null,Fa=Rb=-1,{returnValue:!1,dS:gc,k5:ub,Wc:Fa,tj:Rb};if(Rb.QH)return gc=ub=null,Fa=Rb=-1,{returnValue:!1,
dS:gc,k5:ub,Wc:Fa,tj:Rb};ub=gc=Rb.dS;1===Rb.Dce&&(ub=Rb.k5);Fa=Rb.bTa;Rb=Rb.K8a;return{returnValue:!0,dS:gc,k5:ub,Wc:Fa,tj:Rb}}}Object(l.a)(bk,"RttReplaceRangeOp",Ak,[]);var no=c(1241),Rf=c(417),sk=c(920),ej=c(538),xe=c(482);class Cf extends ej.a{constructor(){super();this.RttStatusRecords=this.FileId=null}nl(){return xe.a.rttStatusReplicator}static Tba(Fa,ub){const gc=new Cf;gc.FileId=Fa;gc.RttStatusRecords=ub;return gc}}Object(l.a)(Cf,"RttStatusRequest",ej.a,[]);class eb{}Object(l.a)(eb,"RttStatusOp",
null,[]);class Lb{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(Lb,"WireRttStatusOpRecord",null,[]);class jc extends Rf.a{constructor(){super();const {App:Fa}=c(146);this.N_b=new S.a;this.lRe=new S.a;this.zk=new no.a(m.AFrameworkApplication.K.mc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=1;Fa.V1.register(this)}DRj(){const Fa=Date.now();for(const ub of this.N_b)ub.XMb&&
1===ub.XMb&&(ub.XMb=2,ub.timeToRender=Fa-ub.metadata.lmg)}oqe(Fa){const ub=new eb;ub.metadata=Fa.operation.metadata;ub.opType=Fa.opType;ub.XMb=1;this.N_b.add(ub)}get Via(){return"RttStatusReplicator"}Ica(){return this.he&&this.he.status===sk.a.responseReady?!0:1===this.enabled&&this.zk.v0()?this.dE():!1}dE(){for(const Fa of this.N_b)if(Fa.XMb&&2===Fa.XMb)return!0;return!1}QTa(){if(1===this._state){this._state=3;const ub=this.N_b.toArray().filter(gc=>2===gc.XMb);var Fa=this.u$k(ub);Fa=Cf.Tba(m.AFrameworkApplication.rootQuerySignature,
Fa);ub.forEach(gc=>this.N_b.remove(gc));ub.forEach(gc=>this.lRe.add(gc));this.he.Iq=Fa;this.he.YG="RttStatusRequest";this.he.status=sk.a.requestReady}else 3===this._state&&this.he&&this.he.status===sk.a.responseReady&&(this.zk.h2(),2!==this.he.statusCode&&this.N_b.aD(0,this.lRe),this.lRe.clear(),this._state=1)}u$k(Fa){const ub=[];Fa.forEach(gc=>{const Rb=new Lb;Rb.clientId=gc.metadata.clientId;Rb.clientType=gc.metadata.clientType;Rb.packetId=gc.metadata.packetId;Rb.packetVersion=gc.metadata.packetVersion;
Rb.strictlySequentialId=gc.metadata.strictlySequentialId;Rb.contentType=gc.opType;Rb.contentState=gc.XMb;Rb.timeToRender=gc.timeToRender;ub.push(Rb)});return ub}Flc(){return!0}kF(){}forceOutbound(){}}Object(l.a)(jc,"RttStatusReplicator",Rf.a,[]);class Jc{constructor(Fa,ub,gc,Rb,wd,Hc){this.packetId=Fa;this.clientId=ub;this.clientType=gc;this.lmg=Rb;this.packetVersion=wd;this.strictlySequentialId=Hc}static create(Fa){let ub=null;null!=Fa.strictlySequentialId&&(ub=Fa.strictlySequentialId);return new Jc(Fa.packetId,
Fa.clientId,Fa.client,Date.now(),Fa.version,ub)}}Object(l.a)(Jc,"RttOpMetadata",null,[]);class Rc extends Ak{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne){super(4,Ne);this.U1=0;this.Wc=Fa;this.tj=ub;this.offset=gc;this.QH=Rb;this.psg=wd;this.Rlg=Hc;this.Ppe=de;this.Slg=We;this.psg===this.Wc?this.U1=this.Rlg:this.Ppe===this.Wc?this.U1=this.Slg:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.U1=0)}T5b(){return this.Wc===this.Ppe}get lJo(){return this.U1}get A5o(){return this.T5b()?
this.psg:this.Ppe}get Myj(){return this.T5b()?this.Rlg:this.Slg}serialize(){const Fa=new of.a(3,this.Wc,this.tj,this.offset,null,null,null,this.QH),ub=new yc(this.psg,this.Rlg,this.Ppe,this.Slg);return new wb(this.metadata.packetId,this.metadata.clientId,1,4,Fa,null,void 0,void 0,void 0,void 0,ub,void 0,void 0,this.metadata.strictlySequentialId)}static create(Fa){const ub=Fa.MT,gc=Fa.tRb;return new Rc(ub.bTa,ub.K8a,ub.dS,ub.QH,gc.o_f,gc.Qlg,gc.p_f,gc.Tlg,Jc.create(Fa))}static Bcm(Fa,ub,gc){if(1!==
Fa.type)return null;const Rb=gc.dTa(Fa.l5.characterData,Fa.l5.qa);return new Rc(Fa.l5.Wc,Fa.l5.tj,gc.Cpc(Rb,Fa.Guj),Fa.QH,Fa.FAb.Wc,Fa.FAb.tj,Fa.iHc.Wc,Fa.iHc.tj,ub)}}Object(l.a)(Rc,"RttSplitParagraphOp",Ak,[135,145]);class id{constructor(Fa,ub,gc,Rb){this.Tkn=()=>{this.Wyb.DRj()};this.gla=Fa;this.Yzc=ub;this.Lla=gc;this.Nzb=Rb;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",!1)&&(this.Wyb=new jc,
el.GraphTransactionManager.instance.jqh(this.Tkn))}tFk(Fa,ub,gc,Rb=null){if(ub.isDirty)return Rb&&Rb.properties.Z(id.p0i,"1"),!1;const wd=new Re(Fa,ub.xj);try{if(1===Fa.opType||6===Fa.opType){const We=Object(y.a)(bk,Fa),Ne=this.b6k(We,ub);var Hc=Ne.node.characterData;const ng=10<=Ne.cpBegin?Ne.cpBegin-10:0;let Ch=Ne.cpEnd+10<=Hc.length?Ne.cpEnd+10:Hc.length;const Uh=Hc.substr(ng,Ne.cpBegin-ng),ii=Hc.substr(Ne.cpEnd,Ch-Ne.cpEnd);Ch=Ch+We.lrb.length-(Ne.cpEnd-Ne.cpBegin);var de=new Dg(Ne.node.id,ng,
Ch,Uh+We.lrb+ii);const yd=6===We.opType;Hc="";yd&&(Hc=We.font);if(!this.T3n(Ne,We.lrb,yd,Hc,Rb))return!1;let pi;pi=1===Fa.opType?new jn(We,ub.id):new sl(We,ub.id);ub.boa=Fa.U1;We.ipc=de;Fa.a8=pi;gc.FXf(pi);null!=this.Wyb&&this.Wyb.oqe(pi)}else return 4===Fa.opType?this.sFk(Fa,ub,gc):!1}finally{wd&&wd.dispose()}return!0}sFk(Fa,ub,gc){const Rb=Object(y.a)(Rc,Fa);var wd=this.Nzb.dTa(ub.characterData,ub.qa);wd=this.Nzb.ZCb(wd,Rb.offset);if(!this.kCi(Mb.a.createTextRange(ub,0,Jb.ParagraphReader.textLength(ub))))return!1;
var Hc=dh.GraphIterator.eb(ub);Hc.zb(10);if(this.c0d(Hc))return!1;let de;Hc=this.Lla.Nc(3);try{Hc.Db(ub);const We=ub.pZ();try{const Ne=dh.GraphIterator.eb(ub);Ne.zb(10);Ne.jd(11);let ng=Ne.currentNode;Rb.T5b()&&(Ne.QEf?ng=null:(Ne.FJ(),ng=Ne.currentNode));Ne.uc();const Ch=this.Yzc.Igb();Ne.ZH(Ch,ng,89);Ne.Aj(Ch);de=ub.clone();const Uh=de.pZ();try{de.setValue(Mf.a.Wc,Rb.A5o);de.setValue(Mf.a.tj,Rb.Myj);de.isDirty=!1;Ne.zf(de,2);Ne.Aj(de);this.X7k(ub,de);const ii=Rb.T5b()?de:ub,yd=Rb.T5b()?ub:de;ii.BO=
!0;yd.BO=!0;this.gla.t9f(this.gEa(ii,wd,Jb.ParagraphReader.textLength(ii)),"",!1,"");this.gla.t9f(this.gEa(yd,0,wd),"",!1,"");ub.boa=Rb.lJo;de.boa=Rb.Myj}finally{Uh&&Uh.dispose()}}finally{We&&We.dispose()}Hc.kUa()}finally{Hc&&Hc.dispose()}ub=new hi(Rb,ub.id,de.id);Fa.a8=ub;gc.FXf(ub);null!=this.Wyb&&this.Wyb.oqe(ub);return!0}c0d(Fa){const ub=new dh.GraphIterator;ub.kd(Fa);ub.jd(11);return je.ListItemReader.kg(ub)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}hEl(Fa,
ub,gc){var Rb=ub.pjb(Fa.Wc);if(Rb.equals(Nc.a.nil))return null;Rb=gc.Eb(Rb);if(!Rb||!Jb.ParagraphReader.Xb(Rb)||!Rb.isConnected)return null;const wd=dh.GraphIterator.eb(Rb);if(!wd.zb(23))return null;if(Fa.osg){Fa=ub.pjb(Fa.osg);if(Fa.equals(Nc.a.nil))return null;gc=gc.Eb(Fa);if(!gc||!Jb.ParagraphReader.Xb(gc)||!gc.isConnected)return null;gc=dh.GraphIterator.eb(gc);if(!gc.zb(23))return null;gc.jd(11);gc.FJ();gc.Rd();if(gc.currentNode!==Rb)return null}return this.c0d(wd)?null:wd}GOo(Fa,ub,gc,Rb){const wd=
ub.currentNode,Hc=this.Lla.Nc(3);try{Hc.Db(wd);ub.jd(11);const de=ub.currentNode;ub.uc();const We=this.Yzc.Igb();ub.ZH(We,de,89);ub.Aj(We);const Ne=Yk.a.instance.createInstance(393230),ng=Ne.pZ();try{Ne.setValue(wi.a.wo,""),Ne.BGa=!0,Rb.YOb(Ne),Rb=[0],Ne.setValue(Mf.a.uq,Rb),Ne.setValue(Mf.a.nt,Rb),Ne.BGa=!1,Ne.setValue(Mf.a.Wc,Fa.kTf),Ne.setValue(Mf.a.tj,Fa.jTf),Ne.isDirty=!1,ub.zf(Ne,2),Ne.BO=!0,Ne.boa=Fa.jTf}finally{ng&&ng.dispose()}Hc.kUa();Fa.a8=new gg(Fa,Ne.id);gc.FXf(Fa.a8);null!=this.Wyb&&
this.Wyb.oqe(Fa.a8)}finally{Hc&&Hc.dispose()}return!0}gEa(Fa,ub,gc){return ub===gc?Mb.a.Pc(Fa,ub):Mb.a.createTextRange(Fa,ub,gc)}T3n(Fa,ub,gc,Rb,wd=null){const Hc=Fa.node;if(Fa.cpBegin!==Fa.cpEnd&&!this.kCi(Fa))return wd&&wd.properties.Z(id.aEj,"1"),!1;wd=this.Lla.Nc(3);try{wd.Db(Hc);const de=Hc.pZ();try{Hc.BO=!0,this.gla.t9f(Fa,ub,gc,Rb)}finally{de&&de.dispose()}wd.kUa()}finally{wd&&wd.dispose()}return!0}X7k(Fa,ub){ub.BGa=!0;ub.qra(Fa.characterData);ub.boa=Fa.boa;ub.qa.clear();for(var gc=0;gc<Fa.qa.length;gc++){const Rb=
Fa.qa.J(gc).rna(ub);ub.qa.add(Rb)}ub.im();if(ub.ye.length)for(Fa=0;Fa<ub.qa.length;Fa++){if((gc=ub.qa.J(Fa).formatting)&&-1!==gc.qe)for(;ub.ye.length<=gc.qe;)ub.ye.rY(ub.ye.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");ub.BGa=!1}TIf(Fa){Fa=dh.GraphIterator.eb(Fa);Fa.zb(23);Fa.uc();return{returnValue:89===Fa.role,iterator:Fa}}u8f(Fa){const ub=new dh.GraphIterator;ub.kd(Fa);ub.uc();const gc=this.Lla.Nc(3);try{gc.Db(ub.currentNode),
Fa.zg()}finally{gc&&gc.dispose()}}oZn(Fa){if(Fa.anchor)if(({iterator:ub}=this.TIf(Fa)).returnValue)this.u8f(ub);else{var ub=Fa.Lc.Am;var gc=this.Lla.Nc(3);try{gc.Db(Fa),Fa.load(Object(sf.a)(ub).Eb(Fa.id)),Fa.anchor.sY(4)}finally{gc&&gc.dispose()}}}S$f(Fa,ub,gc){for(let Hc=ub.count-1;0<=Hc;Hc--){var Rb=ub.J(Hc);switch(Rb.opType){case 4:Rb=Object(y.a)(hi,Rb);if(!Fa.id.equals(Rb.Hje)){k.ULS.shipAssertTag(9204885,355,Fa.id.equals(Rb.UKc));continue}Rb=gc.Eb(Rb.UKc);if(!Rb)break;if(!Rb||!Jb.ParagraphReader.Xb(Rb)){k.ULS.shipAssertTag(9204886,
355,!1);break}if(!Rb.isConnected)continue;var wd=({iterator:Rb}=this.TIf(Rb)).returnValue;k.ULS.shipAssertTag(9204887,355,wd);wd&&this.u8f(Rb);break;case 2:(Rb=Object(y.a)(gg,Rb),Fa.id.equals(Rb.paragraphId))?Fa.isConnected&&(wd=({iterator:Rb}=this.TIf(Fa)).returnValue,k.ULS.shipAssertTag(16820002,355,wd),wd&&this.u8f(Rb)):k.ULS.shipAssertTag(16820001,355,!1)}}}b6k(Fa,ub){const gc=this.Nzb.dTa(ub.characterData,ub.qa),Rb=this.Nzb.ZCb(gc,Fa.dS);Fa=this.Nzb.ZCb(gc,Fa.k5);return Rb===Fa?Mb.a.Pc(ub,Rb):
Mb.a.createTextRange(ub,Rb,Fa)}kCi(Fa){const ub=Fa.node.qa,gc=Fa.cpBegin;Fa=Fa.cpEnd;for(let Rb=0;Rb<ub.length;Rb++){const wd=ub.J(Rb);if(wd.cp>=Fa)break;if(wd.cp>=gc){if(wd.pf)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(wd.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(wd.Qc||wd.Llb||wd.Dcc)return k.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}
id.p0i="ParagraphAlreadyDirty";id.aEj="UnsafeWetChange";Object(l.a)(id,"RttEditor",null,[138]);var dd=c(19),Ke=c(1286),oc=c(233);class ne{constructor(){this.qgd=new S.a}add(Fa){this.qgd.add(Fa);return!0}bTd(Fa){const ub=new S.a;for(const gc of this.qgd)Fa(gc)&&ub.add(gc);return ub}J7f(Fa){Fa.activity.EVf("dried");this.qgd.remove(Fa)}M7f(Fa){Fa.activity.EVf("expired");this.qgd.remove(Fa)}}Object(l.a)(ne,"RttAddParagraphDataStore",null,[]);class hc extends Ak{constructor(Fa,ub,gc,Rb,wd,Hc,de,We){super(2,
We);this.Wc=Fa;this.tj=ub;this.U1=gc;this.osg=Rb;this.kTf=wd;this.jTf=Hc;this.QH=de}serialize(){const Fa=new of.a(2,this.Wc,this.tj,null,this.osg,null,null,this.QH),ub=new vb(this.U1,this.kTf,this.jTf);return new wb(this.metadata.packetId,this.metadata.clientId,1,3,Fa,null,void 0,void 0,ub,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Fa){const ub=Fa.MT,gc=Fa.y2b;let Rb=null;null!=Fa.MT.NHa&&(Rb=Fa.MT.NHa);return new hc(ub.bTa,ub.K8a,gc.Ulg,Rb,gc.r_f,gc.U1,ub.QH,Jc.create(Fa))}static xcm(Fa,
ub){return 3!==Fa.type?null:new hc(Fa.sqa.Wc,Fa.sqa.tj,Fa.ygn.tj,Fa.JSa?Fa.JSa.Wc:null,Fa.nya.Wc,Fa.nya.tj,Fa.QH,ub)}}Object(l.a)(hc,"RttAddParagraphOp",Ak,[]);class ch{constructor(Fa){this.UV=Fa}l8i(){this.UV&&this.UV.properties.Z(ch.BZh,"1")}VQn(Fa){this.UV&&(this.UV.properties.nb(ch.CQf)||this.UV.properties.Z(ch.CQf,(Fa-this.UV.startTime).toString()))}EVf(Fa){this.UV&&(this.UV.properties.Z(ch.Vbj,Fa),this.UV.end())}uSn(Fa){this.UV&&this.UV.properties.Z(ch.x_i,Fa.toString())}tSn(Fa){this.UV&&this.UV.properties.Z(ch.UZi,
Fa)}static bBf(Fa){Fa.J5(eg.a.HPb,ch.BZh,Ke.a.Vwj);Fa.J5(eg.a.HPb,ch.XAl,Ke.a.Vwj);Fa.J5(eg.a.HPb,ch.CQf,Ke.a.fJk);Fa.J5(eg.a.HPb,ch.Vbj,Ke.a.zva);Fa.J5(eg.a.HPb,ch.x_i,Ke.a.zva);Fa.J5(eg.a.HPb,ch.UZi,Ke.a.zva)}static create(Fa){if(!Fa)return null;Fa=Fa.Ep(eg.a.HPb,ch.q4o);return new ch(Fa)}}ch.BZh="FailedToFindInitialParaID";ch.XAl="FailedToFindInitialTextID";ch.CQf="MsecUntilApplied";ch.Vbj="RemovedBecause";ch.x_i="PacketVersions";ch.UZi="OperationType";ch.q4o=48E4;Object(l.a)(ch,"RttOpActivity",
null,[]);var fj;(function(Fa){Fa[Fa.unknown=0]="unknown";Fa[Fa.hqp=1]="replaceTextRangeOp";Fa[Fa.rep=2]="addParagraphOp";Fa[Fa.ahp=3]="deleteParagraphOp";Fa[Fa.Usp=4]="splitParagraphOp";Fa[Fa.Ump=5]="mergeParagraphOp";Fa[Fa.gqp=6]="replaceSymbolRangeOp"})(fj||(fj={}));Object(l.b)("RttOpType",fj);var Si=c(118);class ee extends bk{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch){super(Rb,wd,Hc,de,We,Ne,ng,Ch,6);this.font=Fa;this.legacy=ub}nvf(){return"OffsetStart: "+this.dS+"OffsetEnd: "+this.k5}serialize(){const Fa=
this.HNh();return new wb(this.metadata.packetId,this.metadata.clientId,1,7,Fa,null,this.U1,this.lrb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Fa){let ub,gc,Rb,wd;if(!({dS:ub,k5:gc,Wc:Rb,tj:wd}=bk.YBj(Fa)).returnValue)return null;let Hc,de;if(1===Fa.text.length)Hc=!1,de=Si.AParagraphNode.RC;else if(2===Fa.text.length)if(Yb.a.Gyi(Fa.text,0)&&Yb.a.Kz(Fa.text,1))Hc=!0,de=Fa.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Fa.mt),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Fa.mt),null;const We=Fa.kbd,Ne=Jc.create(Fa);return new ee(We.tkg,We.ukg,Hc,Rb,wd,ub,gc,Fa.aSb,de,Fa.MT.QH,Ne)}}Object(l.a)(ee,"RttReplaceSymbolRangeOp",bk,[135,145]);class gh extends bk{constructor(Fa,ub,gc,Rb,wd,Hc,de,We){super(Fa,ub,gc,Rb,wd,Hc,de,We,1)}nvf(){return"OffsetStart: "+this.dS+"OffsetEnd: "+this.k5+"TextAddedLength: "+this.lrb.length}serialize(){const Fa=
this.HNh();return new wb(this.metadata.packetId,this.metadata.clientId,1,2,Fa,null,this.U1,this.lrb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Fa){let ub,gc,Rb,wd;if(!({dS:ub,k5:gc,Wc:Rb,tj:wd}=bk.YBj(Fa)).returnValue)return null;let Hc="";Fa.text&&(Hc=Fa.text);const de=Jc.create(Fa);return new gh(Rb,wd,ub,gc,Fa.aSb,Hc,Fa.MT.QH,de)}static xbm(Fa,ub,gc){if(Fa.type)return null;const Rb=gc.dTa(Fa.l5.characterData,Fa.l5.qa);return new gh(Fa.l5.Wc,Fa.l5.tj,gc.Cpc(Rb,
Fa.cpBegin),gc.Cpc(Rb,Fa.cpEnd),Fa.nya.tj,Fa.R9,Fa.QH,ub)}}Object(l.a)(gh,"RttReplaceTextRangeOp",bk,[135,145]);class Gf{constructor(Fa,ub,gc,Rb,wd,Hc,de,We,Ne,ng,Ch,Uh,ii,yd,pi,Eh,Uk,Ki,Oi){this.Ll=null;this.dHe=this.Xlh=!1;this.tkd=!0;this.U8g=0;this.sfh=this.hSe=this.ufh=this.rfh=this.tfh=!1;this.mYf=()=>{k.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Ll=this.l_.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Ll.S3(this.l1)};this.l1=
(Bd,we)=>{if(3===we.type||10===we.type)if(10===we.type)this.U8g="boolean"===typeof we.NL?we.NL?1:0:we.NL;else if(this.gZb.value&&!this.gZb.value.cWd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(we.NL){if(this.HSn(),(Bd=this.Ill(we.NL))&&1!==Bd.metadata.clientType){this.GSn();if(!(!this.Zo||this.Zo.kda||dd.a.hRa||dd.a.jda||(m.AFrameworkApplication.oe("1i00j689;ba0dg262"),dd.a.hRa||dd.a.jda)))return;if(2!==this.U8g)switch(this.tkd&&(this.M_b.u8i(),
this.tkd=!1),this.Xlh||this.Uzm(),Bd.opType){case 1:case 6:case 4:if(!({Bg:Bd}=this.jrk(Bd)).returnValue)break;this.gjh?this.Ehj(Bd):this.eDj(Bd);break;case 2:this.Kqc.add(Bd),this.rri(Bd),this.gjh?this.Ehj(Nc.a.nil):this.dDj(Bd)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Gzl=()=>{const Bd=this.ji.value;if(Bd){var we=this.zD()-Gf.AZn,Qe=this.cub.bTd(Yi=>Yi.metadata.lmg<we);0<Qe.count&&this.WQn();var le=new oc.a;for(const Yi of Qe)if(this.cub.M7f(Yi),Yi.a8)switch(Yi.a8.opType){case 1:le.add(Yi.a8.paragraphId.toString());
break;case 6:le.add(Yi.a8.paragraphId.toString());break;case 4:le.add(Yi.a8.Hje.toString()),le.add(Yi.a8.UKc.toString())}Qe=this.Kqc.bTd(Yi=>Yi.metadata.lmg<we);for(const Yi of Qe)this.Kqc.M7f(Yi),Yi.a8&&le.add(Yi.a8.paragraphId.toString());for(const Yi of le)(le=Bd.Eb(Nc.a.Hf(Yi)))?le.BO?(this.Vyb.oZn(le),le.BO||this.Lyc.value.jbj(le)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.ji.bzf&&
k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.Vyb=Fa;this.cub=ub;this.Lyc=gc;this.gZb=Rb;this.XI=wd;this.l_=Hc;this.ji=de;this.Ib=We;this.zD=Ne;this.Nzb=ng;this.Ad=Ch;this.MOe=ii;this.Kc=yd;this.gjh=pi;this.M_b=Eh;this.ctb=Uk;this.sYe=Ki;this.PAc=new L.a(J.a.hh());this.Kqc=new ne;Uh.execute(Gf.bBf);this.Zo=Oi}Uzm(){const Fa=new pa.a(3,2,Gf.E0n,this.Gzl);this.Ib.Wb(Fa);this.Xlh=!0}init(){return this.l_?this.l_.continueWith(this.mYf):H.Task.z4(!1)}Ill(Fa){Fa=
Ef(Fa);if(!Fa)return null;switch(Fa.mt){case 2:return gh.create(Fa);case 7:return ee.create(Fa);case 4:return Rc.create(Fa);case 3:return hc.create(Fa);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Fa.mt),null}}jrk(Fa){let ub=Nc.a.nil;if(!this.cub.irk(Fa))return{returnValue:!1,Bg:ub};this.rri(Fa);if(!this.XI)return{returnValue:!1,Bg:ub};const gc=this.XI.pjb(Fa.Wc);if(gc.equals(Nc.a.nil)||!this.ji.value.Eb(gc))return Fa.activity.l8i(),{returnValue:!1,
Bg:ub};this.w8i();return{returnValue:!0,Bg:gc}}Ehj(Fa){Fa.equals(Nc.a.nil)||this.PAc.add(Fa.toString());this.dHe||(Fa=new pa.a(0,1,200,()=>{this.xQo();this.dHe=!1},71),this.Ib.Wb(Fa),this.dHe=!0)}abo(Fa){Fa=new pa.a(0,1,0,Fa,71);this.Ib.Wb(Fa)}rri(Fa){Fa.activity=ch.create(this.Ad);Fa.activity.uSn(Fa.metadata.packetVersion);Fa.activity.tSn(fj[Fa.opType])}xQo(){var Fa=this.Kqc.bTd(gc=>!gc.a8);for(const gc of Fa)this.dDj(gc);if(this.PAc.count){Fa=null;for(var ub of this.PAc){ub=Nc.a.Hf(ub);Fa=this.ji.value.Eb(ub);
break}ub=this.Kc.Nc(3);try{ub.Db(Fa);for(const gc of this.PAc)this.eDj(Nc.a.Hf(gc))}finally{ub&&ub.dispose()}this.PAc.clear()}}eDj(Fa){Fa=this.ji.value.Eb(Fa);let ub;const gc=this.Kc.Nc(3);try{gc.Db(Fa);ub=this.Ad.Ep(eg.a.Fuh);const Rb=this.Kuh(Fa,ub);ub.end();Rb&&this.iuk(Rb)}finally{gc&&gc.dispose(),this.M_b.b6f(1),this.tkd=!0}}dDj(Fa){var ub=this.Vyb.hEl(Fa,this.XI,this.ji.value);ub&&(this.w8i(),this.Vyb.GOo(Fa,ub,this.ctb,Sa.a.instance.resolve("Box4.IParagraphEditor"))&&(ub=this.ji.value.Eb(Fa.a8.paragraphId),
this.bvh(ub,Fa),this.M_b.b6f(1),this.tkd=!0))}iuk(Fa){this.MOe.continueWith(()=>{if(1===Fa.opType){var ub=this.z$l(Fa);ub&&(this.MOe.result.ZZe(ub),this.MOe.result.Ide(!0))}})}z$l(Fa){const ub=Fa.serialize();if(2!==ub.mt||ub.MT.NHa&&ub.MT.bTa!==ub.MT.NHa)return null;const gc=Fa.dS.clone();0<Fa.lrb.length&&(gc.cFh(),gc.cp+=Fa.lrb.length);ub.mt=0;ub.text=null;ub.MT.Dce=0;ub.MT.dS=gc;ub.MT.K8a=ub.aSb;ub.MT.NHa=null;ub.MT.pnc=null;ub.MT.k5=null;ub.aSb=null;return uc.Yaf(ub,this.XI,this.Nzb,()=>this.ji.value,
this.sYe.instance)}bvh(Fa,ub){return this.Lyc.value?this.Lyc.value.Vpk(Fa,ub.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.Lyc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}Juh(Fa,ub){this.Kuh(Fa,ub)}Kuh(Fa,ub){if(!Fa)return null;if(!Fa.anchor)return ub&&ub.properties.Z(Gf.GRi,"1"),null;if(!Fa.hasProperty(Mf.a.Wc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Fa.hasProperty(Mf.a.tj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Fa.hasProperty(Mf.a.WSh)&&Fa.getValue(Mf.a.WSh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const gc=Fa.getValue(Mf.a.Wc);var Rb=Fa.boa;ub&&(ub.properties.Z(Gf.vhn,Rb.toString()),ub.properties.Z(Gf.xhn,gc.toString()));Rb=this.cub.xsf(gc,Rb);if(!Rb)return ub&&ub.properties.Z(Gf.sRi,"1"),null;if(!this.bvh(Fa,Rb))return ub&&ub.properties.Z(Gf.EKh,
"1"),null;let wd=0,Hc=null;for(;Rb;){if(!this.Vyb.tFk(Rb,Fa,this.ctb,ub)){ub&&ub.properties.Z(Gf.EKj,"1");break}wd++;Rb.activity.VQn(this.zD());Hc=Rb;Rb=Fa.boa;Rb=this.cub.xsf(gc,Rb)}0<wd&&this.S7i();ub&&ub.properties.add(Gf.FKj,wd.toString());return Hc}pde(Fa){if(Fa.hasProperty(Mf.a.Wc)&&Fa.hasProperty(Mf.a.tj)){var ub=Fa.getValue(Mf.a.Wc),gc=Fa.ja(Mf.a.tj,0),Rb=this.Ad.Ep(eg.a.m$i),wd=this.ctb.Von(Fa.id);0<wd.count&&(this.Vyb.S$f(Fa,wd,this.ji.value),this.YZn(Fa,wd,gc));var Hc=this.ctb.wMl(ub);
if(Hc&&!Fa.id.equals(Hc.paragraphId)){const de=this.ji.value;this.abo(()=>{const We=this.ctb.Enb(Hc.paragraphId),Ne=de.Eb(Hc.paragraphId);k.ULS.shipAssertTag(16820032,355,!!Ne,"Could not find added graph node");Ne&&(this.Vyb.S$f(Ne,We,de),this.Kqc.J7f(Hc.$Ze))})}this.cub.xsf(ub,gc)||this.Lyc.value.jbj(Fa);this.Juh(Fa,Rb);Rb.end()}}YZn(Fa,ub,gc){let Rb=!1;for(let Hc=ub.count-1;0<=Hc;Hc--){var wd=ub.J(Hc);switch(wd.opType){case 1:case 6:case 4:wd=Object(y.a)(135,wd.operation);break;default:continue}wd.U1===
gc&&(Rb=!0,wd.ipc&&!wd.ipc.$1o(Fa)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",wd.opType,wd.nvf(),Fa.id,wd.ipc.id,wd.ipc.cpBegin,wd.ipc.cpEnd));Rb&&this.cub.J7f(wd)}Rb&&this.S7i()}n2c(Fa){const ub=this.ctb.Enb(Fa.id);0<ub.count&&(2===ub.J(0).opType&&ub.removeAt(0),this.Vyb.S$f(Fa,ub,this.ji.value))}Yhe(Fa){var ub=this.ctb.p7l(Fa.id);for(const gc of ub)if(4===gc.opType&&
(ub=Object(y.a)(hi,gc),Fa.id.equals(ub.spk)))return!0;return!1}HSn(){this.tfh||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.tfh=!0)}GSn(){this.rfh||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.rfh=!0)}w8i(){this.ufh||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.ufh=!0)}S7i(){this.hSe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.hSe=!0)}WQn(){this.hSe||this.sfh||(k.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.sfh=!0)}static bBf(Fa){const ub=[eg.a.Fuh,eg.a.m$i];for(const gc of ub)Fa.J5(gc,Gf.FKj,Ke.a.zva),Fa.J5(gc,Gf.sRi,Ke.a.zva),Fa.J5(gc,Gf.GRi,Ke.a.zva),Fa.J5(gc,Gf.EKh,Ke.a.zva),Fa.J5(gc,Gf.EKj,Ke.a.zva),Fa.J5(gc,id.p0i,Ke.a.zva),Fa.J5(gc,id.aEj,Ke.a.zva);ch.bBf(Fa)}}Gf.E0n=6E4;Gf.AZn=18E4;Gf.FKj="WetChangeCount";Gf.sRi="NoChangesToApply";Gf.GRi="NodeNotConnected";Gf.EKh="CouldNotGetLock";Gf.EKj="WetChangeBlocked";Gf.xhn="NodeWordId";Gf.vhn="NodeTextId";
Object(l.a)(Gf,"RttManager",null,[136]);class ai{constructor(Fa,ub){this.qgj=0;this.oj=Fa;this.a$n=ub}u8i(){this.qgj=this.oj()}b6f(Fa){const ub=this.oj()-this.qgj;0<=ub&&this.a$n.track(Math.round(ub),0===Fa?"CTB":"RTP")}}Object(l.a)(ai,"RttPerfCounter",null,[134]);var bi=c(1998);class Bk{constructor(){this.tCc=new bi.a}Nuk(Fa,ub){this.tCc.back()&&ub&&this.tCc.back().dgb(Fa)||this.tCc.enqueue(Fa)}T5l(){return this.tCc.isEmpty?null:this.tCc.dequeue()}}Object(l.a)(Bk,"RttSendDataStore",null,[133]);class ug extends Ak{constructor(Fa,
ub,gc,Rb){super(3,Rb);this.Wc=Fa;this.tj=ub;this.QH=gc}get U1(){return 0}serialize(){const Fa=new of.a(4,this.Wc,this.tj,null,null,null,null,this.QH);return new wb(this.metadata.packetId,this.metadata.clientId,1,5,Fa,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Fa){const ub=Fa.MT;return new ug(ub.bTa,ub.K8a,ub.QH,Jc.create(Fa))}static ycm(Fa,ub){return 4!==Fa.type?null:new ug(Fa.K6b.Wc,Fa.K6b.tj,Fa.QH,ub)}}Object(l.a)(ug,"RttDeleteParagraphOp",
Ak,[135,145]);class Wo extends Ak{constructor(Fa,ub,gc,Rb,wd,Hc,de,We){super(5,We);this.nsg=Fa;this.Lyj=ub;this.z5o=gc;this.mJo=Rb;this.QH=wd;this.uLj=Hc;this.qnc=de}get Wc(){return this.nsg}get tj(){return this.Lyj}get U1(){return this.nsg===this.uLj?this.qnc:0}serialize(){const Fa=new of.a(5,this.nsg,this.Lyj,null,this.z5o,this.mJo,null,this.QH),ub=new ac(this.uLj,this.qnc);return new wb(this.metadata.packetId,this.metadata.clientId,1,6,Fa,null,void 0,void 0,void 0,ub,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Fa){const ub=
Fa.MT,gc=Fa.A0c;return new Wo(ub.bTa,ub.K8a,ub.NHa,ub.pnc,ub.QH,gc.q_f,gc.qnc,Jc.create(Fa))}static zcm(Fa,ub){return 2!==Fa.type?null:new Wo(Fa.sqa.Wc,Fa.sqa.tj,Fa.JSa.Wc,Fa.JSa.tj,Fa.QH,Fa.B4d.Wc,Fa.B4d.tj,ub)}}Object(l.a)(Wo,"RttMergeParagraphOp",Ak,[135,145]);class Zh{constructor(Fa,ub,gc,Rb,wd,Hc){this.XCc=this.jj=null;this.zfa=!1;this.jWe=this.Ejh=0;this.Xxd=this.Tkh=!1;this.jRe=0;this.mYf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.jj=this.l_.result;
this.jj.bde(this)};this.VWi=(de,We)=>{if(this.jj&&2===this.jj.connectionState&&(de=We.sF,de.length))if(We.f8)100>this.jWe&&(this.jWe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",We.OKk,this.Ejh,this.jWe));else{for(We=0;We<de.length;We++)if(!this.fXm(de[We]))return;for(We=0;We<de.length;We++){const Ne=de[We];this.ueh.Nuk(Ne,!Ne.type&&!We)}this.XCc||this.yWi(this.XCc,this.jj)}};this.l_=Fa;this.ueh=ub;this.lcb=gc;this.hu=Rb;this.wua=wd;this.M_b=
Hc}get Tm(){return this.lcb.value}init(){return this.l_?this.l_.continueWith(this.mYf):H.Task.z4(!1)}start(){this.zfa||(this.hu.Zc?(this.hu.Zc.sF.Oyk(this.VWi),this.zfa=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.zfa&&(this.zfa=!1,this.hu.Zc.sF.Z1n(this.VWi))}fXm(Fa){return Fa&&-1!==Fa.QH?Fa.type&&3!==Fa.type&&1!==Fa.type?!1:!0:!1}t7m(){this.Xxd||(this.Tkh||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Tkh=!0),!this.Xxd&&
5>=this.jRe&&this.jRe++)}I7m(){!this.Xxd&&5>=this.jRe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.Xxd=!0)}yWi(Fa,ub){this.t7m();Fa&&(Fa.Gi||Fa.Io)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Fa.exception);this.M_b.u8i();(Fa=this.Acm(this.ueh.T5l()))?(this.Ejh++,this.XCc=ub.qN(3,ld(Fa.serialize())),this.I7m(),this.M_b.b6f(0),this.XCc.continueWith(gc=>{this.yWi(gc,ub)})):this.XCc=null}Acm(Fa){if(!Fa)return null;if(!this.Tm)return k.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const ub=new Jc(bj.instance.Qci(),this.Tm.qj,1,0,0,Fd.instance.j6l());let gc=null;switch(Fa.type){case 0:gc=gh.xbm(Fa,ub,this.wua);break;case 4:gc=ug.ycm(Fa,ub);break;case 3:gc=hc.xcm(Fa,ub);break;case 2:gc=Wo.zcm(Fa,ub);break;case 1:gc=Rc.Bcm(Fa,ub,this.wua)}return gc}}Object(l.a)(Zh,"RttSendManager",null,[115]);class oo{constructor(){this.W=null;this.O3l=()=>Qa.App.zd&&Qa.App.zd.$p?Qa.App.zd.$p:(k.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}wc(Fa){const ub=Ia.a.Fp(Fa.Ta("Box4.IOutlineElementEditor")),gc=Ia.a.Fp(Fa.Ta("Box4.IFeatureHelper")),Rb=Ia.a.Fp(Fa.Ta("Common.IActivityAggregationInfo")),wd=Ia.a.Fp(Fa.Ta("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),Hc=Ia.a.Fp(Fa.Ta("Box4.CompositionStateManager"));this.W=Fa;const de=new tf.a;H.Task.WAA.call(null,ub,gc,Rb,wd,Hc).continueWith(()=>{Fa.ia("WordEditor.RealTimeTyping.IRttEditor",
()=>new id(Fa.resolve("Box4.ICharacterPropertiesEditor"),Fa.resolve("Box4.IOutlineElementEditor"),de,Fa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).ha();Fa.register(ai,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").ha().Ud(()=>new ai(bh.a.Ze,Bm.a.mF(17,1,new gi.a(new zf.a(.25)))));Fa.ia("WordEditor.RealTimeTyping.RttManager",()=>new Gf(Fa.resolve("WordEditor.RealTimeTyping.IRttEditor"),new dj(ll.a.instance),new U.a(this.O3l),new U.a(()=>Qa.App.uS),Fa.resolve("WordEditor.ParagraphWordIdMapping"),
Fa.resolve("Box4.Presence.IRtcProxyProvider").bE(),new U.a(()=>Qa.App.za.jb&&Qa.App.za.jb.Zc?Qa.App.za.jb.Zc.xd:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),bc.a.instance,()=>Date.now(),Fa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),ll.a.instance,Fa.Ta("Common.IActivityAggregationInfo"),Wg.bE(),de,m.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Fa.resolve("WordEditor.IRttPerfCounter"),new Yh,Fa.Ta("WordEditor.Presence.IWordPresenceCpFactory"),
Fa.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").ha();Fa.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new Zh(Fa.resolve("Box4.Presence.IRtcProxyProvider").bE(),new Bk,new U.a(()=>Qa.App.zd),Qa.App.za.jb,Fa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Fa.resolve("WordEditor.IRttPerfCounter"))).ha();this.cBf()})}cBf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){qa.a.instance.Gc(new oo)}}
Object(l.a)(oo,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");ta.main();Type.registerNamespace("Common.App.CollabControls");Wa.prototype.toString=ha.a.prototype.toString;
nb.prototype.toString=ha.a.prototype.toString;qa.a.instance.Gc(new Qf);oo.main();Type.registerNamespace("RealtimePresenceUI");qa.a.instance.Gc(new Dd);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");za.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/20299002/wdjs/WordEditorDSReduceInitialBundle.collab.js.map